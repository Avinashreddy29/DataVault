2021-04-08 06:27:34.271992 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:36.108121 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2021-04-08 06:27:36.112335 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:36.112450 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-08 06:27:36.242509 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:27:36.247037 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:36.247153 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-08 06:27:36.431087 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-08 06:27:36.433707 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:36.433825 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-08 06:27:36.654869 (Thread-1): SQL status: SUCCESS 0 in 0.22 seconds
2021-04-08 06:27:36.656197 (Thread-1): 06:27:36 + Ran for day 1 of 5 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-08 06:27:36.656425 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:36.656610 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:36.656703 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:36.869431 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-08 06:27:36.870552 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:36.870686 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-08 06:27:36.981728 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:27:36.983591 (Thread-1): 06:27:36 + Running for day 2 of 5 (2021-04-05) [model.Dbt_demo.sat_orders]
2021-04-08 06:27:36.988988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:36.989109 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-08 06:27:37.159513 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:27:37.159710 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:37.159801 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:38.573892 (Thread-1): SQL status: SUCCESS 1 in 1.41 seconds
2021-04-08 06:27:38.579582 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:38.579744 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-08 06:27:38.720120 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-08 06:27:38.724695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:38.724859 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-08 06:27:38.848360 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:38.850701 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:38.850822 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-08 06:27:39.069015 (Thread-1): SQL status: SUCCESS 0 in 0.22 seconds
2021-04-08 06:27:39.070734 (Thread-1): 06:27:39 + Ran for day 2 of 5 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-08 06:27:39.070961 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:39.071149 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:39.071245 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:39.260284 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-08 06:27:39.261433 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:39.261549 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-08 06:27:39.370220 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:27:39.371698 (Thread-1): 06:27:39 + Running for day 3 of 5 (2021-04-06) [model.Dbt_demo.sat_orders]
2021-04-08 06:27:39.377520 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:39.377637 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-08 06:27:39.528718 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-08 06:27:39.528908 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:39.528998 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:40.382749 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-04-08 06:27:40.386697 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:40.386814 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-08 06:27:40.519260 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:27:40.523888 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:40.524009 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-08 06:27:40.648072 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:40.650393 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:40.650508 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-08 06:27:40.885664 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-04-08 06:27:40.887010 (Thread-1): 06:27:40 + Ran for day 3 of 5 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-08 06:27:40.887217 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:40.887396 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:40.887491 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:41.049632 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:27:41.050800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:41.050912 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-08 06:27:41.171897 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:27:41.173328 (Thread-1): 06:27:41 + Running for day 4 of 5 (2021-04-07) [model.Dbt_demo.sat_orders]
2021-04-08 06:27:41.178789 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:41.178905 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-08 06:27:41.308993 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:27:41.309191 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:41.309288 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:42.306863 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-08 06:27:42.311107 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:42.311229 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-08 06:27:42.440063 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:27:42.444548 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:42.444670 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-08 06:27:42.570251 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:27:42.572627 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:42.572750 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-08 06:27:42.866527 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-08 06:27:42.867900 (Thread-1): 06:27:42 + Ran for day 4 of 5 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-08 06:27:42.868117 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:42.868304 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:42.868398 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:43.034480 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:27:43.035665 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:43.035785 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-08 06:27:43.492599 (Thread-1): SQL status: SUCCESS 1 in 0.46 seconds
2021-04-08 06:27:43.494032 (Thread-1): 06:27:43 + Running for day 5 of 5 (2021-04-08) [model.Dbt_demo.sat_orders]
2021-04-08 06:27:43.499808 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:43.499920 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-08 06:27:43.645291 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-08 06:27:43.645483 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:43.645572 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:44.764218 (Thread-1): SQL status: SUCCESS 1 in 1.12 seconds
2021-04-08 06:27:44.768187 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:44.768300 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-08 06:27:44.898579 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:27:44.903148 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:44.903270 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-08 06:27:45.020681 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:45.023086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:45.023218 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-08 06:27:45.232001 (Thread-1): SQL status: SUCCESS 0 in 0.21 seconds
2021-04-08 06:27:45.233354 (Thread-1): 06:27:45 + Ran for day 5 of 5 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-08 06:27:45.233571 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:45.233758 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-08 06:27:45.233853 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-08 06:27:45.401561 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:27:45.407150 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_orders"
2021-04-08 06:27:45.410281 (Thread-1): finished collecting timing info
2021-04-08 06:27:45.410579 (Thread-1): On model.Dbt_demo.sat_orders: Close
2021-04-08 06:27:45.625522 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf242f40>]}
2021-04-08 06:27:45.627058 (Thread-1): 06:27:45 | 14 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_orders [INSERT 0 in 13.53s]
2021-04-08 06:27:45.627238 (Thread-1): Finished running node model.Dbt_demo.sat_orders
2021-04-08 06:27:45.627416 (Thread-1): Began running node model.Dbt_demo.hub_products
2021-04-08 06:27:45.628583 (Thread-1): 06:27:45 | 15 of 23 START incremental model SS_RAW_VLT.hub_products............. [RUN]
2021-04-08 06:27:45.629087 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:45.629227 (Thread-1): Compiling model.Dbt_demo.hub_products
2021-04-08 06:27:45.642573 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_products"
2021-04-08 06:27:45.642971 (Thread-1): finished collecting timing info
2021-04-08 06:27:45.650994 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:45.651123 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_PK, PRODUCTID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_PK, a.PRODUCTID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products AS d
    ON a.PRODUCT_PK = d.PRODUCT_PK
    WHERE d.PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-08 06:27:45.651235 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:27:47.516711 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2021-04-08 06:27:47.521579 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:47.521700 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
2021-04-08 06:27:47.649163 (Thread-1): SQL status: SUCCESS 4 in 0.13 seconds
2021-04-08 06:27:47.653283 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:47.653435 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-04-08 06:27:47.879640 (Thread-1): SQL status: SUCCESS 4 in 0.23 seconds
2021-04-08 06:27:47.883809 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:47.883929 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-04-08 06:27:48.007308 (Thread-1): SQL status: SUCCESS 4 in 0.12 seconds
2021-04-08 06:27:48.009087 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_products"
2021-04-08 06:27:48.009897 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:48.010014 (Thread-1): On model.Dbt_demo.hub_products: BEGIN
2021-04-08 06:27:48.142071 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:27:48.142271 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:48.142359 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products ("PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
        );
2021-04-08 06:27:48.358670 (Thread-1): SQL status: SUCCESS 0 in 0.22 seconds
2021-04-08 06:27:48.359897 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-04-08 06:27:48.360085 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-08 06:27:48.360183 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-04-08 06:27:48.523815 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:27:48.528098 (Thread-1): finished collecting timing info
2021-04-08 06:27:48.528394 (Thread-1): On model.Dbt_demo.hub_products: Close
2021-04-08 06:27:48.722621 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf35e4f0>]}
2021-04-08 06:27:48.724107 (Thread-1): 06:27:48 | 15 of 23 OK created incremental model SS_RAW_VLT.hub_products........ [SUCCESS 0 in 3.09s]
2021-04-08 06:27:48.724283 (Thread-1): Finished running node model.Dbt_demo.hub_products
2021-04-08 06:27:48.724464 (Thread-1): Began running node model.Dbt_demo.link_prod_supp
2021-04-08 06:27:48.725592 (Thread-1): 06:27:48 | 16 of 23 START incremental model SS_RAW_VLT.link_prod_supp........... [RUN]
2021-04-08 06:27:48.726133 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:48.726288 (Thread-1): Compiling model.Dbt_demo.link_prod_supp
2021-04-08 06:27:48.739944 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_prod_supp"
2021-04-08 06:27:48.740341 (Thread-1): finished collecting timing info
2021-04-08 06:27:48.748543 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:48.748700 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_SUPPLIER_PK, PRODUCT_PK, SUPPLIER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_SUPPLIER_PK, a.PRODUCT_PK, a.SUPPLIER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp AS d
    ON a.PRODUCT_SUPPLIER_PK = d.PRODUCT_SUPPLIER_PK
    WHERE d.PRODUCT_SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-08 06:27:48.748821 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:27:50.429051 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2021-04-08 06:27:50.432725 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:50.432850 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
2021-04-08 06:27:50.561999 (Thread-1): SQL status: SUCCESS 5 in 0.13 seconds
2021-04-08 06:27:50.567774 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:50.567922 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-04-08 06:27:50.684079 (Thread-1): SQL status: SUCCESS 5 in 0.12 seconds
2021-04-08 06:27:50.688153 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:50.688273 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-04-08 06:27:50.834015 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-04-08 06:27:50.835867 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_prod_supp"
2021-04-08 06:27:50.836681 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:50.836793 (Thread-1): On model.Dbt_demo.link_prod_supp: BEGIN
2021-04-08 06:27:50.958249 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:27:50.958459 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:50.958561 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp ("PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
        );
2021-04-08 06:27:51.164092 (Thread-1): SQL status: SUCCESS 0 in 0.21 seconds
2021-04-08 06:27:51.165296 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-04-08 06:27:51.165483 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-08 06:27:51.165581 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-04-08 06:27:51.342839 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-08 06:27:51.347152 (Thread-1): finished collecting timing info
2021-04-08 06:27:51.347439 (Thread-1): On model.Dbt_demo.link_prod_supp: Close
2021-04-08 06:27:51.542939 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaee24d90>]}
2021-04-08 06:27:51.544419 (Thread-1): 06:27:51 | 16 of 23 OK created incremental model SS_RAW_VLT.link_prod_supp...... [SUCCESS 0 in 2.82s]
2021-04-08 06:27:51.544597 (Thread-1): Finished running node model.Dbt_demo.link_prod_supp
2021-04-08 06:27:51.544790 (Thread-1): Began running node model.Dbt_demo.sat_products
2021-04-08 06:27:51.546076 (Thread-1): 06:27:51 | 17 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_products.. [RUN]
2021-04-08 06:27:51.546414 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:51.546545 (Thread-1): Compiling model.Dbt_demo.sat_products
2021-04-08 06:27:51.569519 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_products"
2021-04-08 06:27:51.569939 (Thread-1): finished collecting timing info
2021-04-08 06:27:51.578242 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:51.578401 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-08 06:27:51.578512 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:27:52.388614 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-04-08 06:27:52.392019 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:52.392134 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-07 23:27:48.272000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-07 23:27:48.272000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_products
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-08 06:27:52.700730 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-08 06:27:52.705948 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:52.706077 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-08 06:27:52.865880 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-08 06:27:52.868382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:52.868494 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-08 06:27:52.967569 (Thread-1): SQL status: SUCCESS 1 in 0.10 seconds
2021-04-08 06:27:52.968999 (Thread-1): 06:27:52 + Running for day 1 of 5 (2021-04-04) [model.Dbt_demo.sat_products]
2021-04-08 06:27:52.974797 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:52.974922 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-08 06:27:53.091817 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:27:53.092015 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:53.092115 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:53.917611 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-04-08 06:27:53.921623 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:53.921742 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-08 06:27:54.045484 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:54.050088 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:54.050206 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-08 06:27:54.166041 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:54.168420 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:54.168529 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-08 06:27:54.372687 (Thread-1): SQL status: SUCCESS 0 in 0.20 seconds
2021-04-08 06:27:54.374305 (Thread-1): 06:27:54 + Ran for day 1 of 5 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-08 06:27:54.374512 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:54.374714 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:54.374809 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:54.551084 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-08 06:27:54.552203 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:54.552311 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-08 06:27:54.704689 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-08 06:27:54.706105 (Thread-1): 06:27:54 + Running for day 2 of 5 (2021-04-05) [model.Dbt_demo.sat_products]
2021-04-08 06:27:54.711849 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:54.711970 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-08 06:27:54.837639 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:27:54.837836 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:54.837929 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:55.654826 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-04-08 06:27:55.658710 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:55.658825 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-08 06:27:55.779091 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:55.783652 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:55.783770 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-08 06:27:55.887612 (Thread-1): SQL status: SUCCESS 12 in 0.10 seconds
2021-04-08 06:27:55.889926 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:55.890036 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-08 06:27:56.104552 (Thread-1): SQL status: SUCCESS 0 in 0.21 seconds
2021-04-08 06:27:56.105872 (Thread-1): 06:27:56 + Ran for day 2 of 5 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-08 06:27:56.106077 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:56.106255 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:56.106346 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:56.264645 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:27:56.265771 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:56.265880 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-08 06:27:56.369345 (Thread-1): SQL status: SUCCESS 1 in 0.10 seconds
2021-04-08 06:27:56.370787 (Thread-1): 06:27:56 + Running for day 3 of 5 (2021-04-06) [model.Dbt_demo.sat_products]
2021-04-08 06:27:56.376328 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:56.376448 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-08 06:27:56.512065 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-08 06:27:56.512257 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:56.512346 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:57.370871 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-04-08 06:27:57.376418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:57.376541 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-08 06:27:57.494799 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:57.499296 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:57.499421 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-08 06:27:57.617454 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:57.619836 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:57.619948 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-08 06:27:57.848348 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-04-08 06:27:57.849650 (Thread-1): 06:27:57 + Ran for day 3 of 5 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-08 06:27:57.849859 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:57.850046 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:57.850141 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:58.004445 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-08 06:27:58.005582 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:58.005693 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-08 06:27:58.116817 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:27:58.118264 (Thread-1): 06:27:58 + Running for day 4 of 5 (2021-04-07) [model.Dbt_demo.sat_products]
2021-04-08 06:27:58.124222 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:58.124371 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-08 06:27:58.245666 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:27:58.245865 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:58.245958 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:27:59.342262 (Thread-1): SQL status: SUCCESS 1 in 1.10 seconds
2021-04-08 06:27:59.346310 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:59.346462 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-08 06:27:59.467994 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:27:59.472698 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:59.472821 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-08 06:27:59.580800 (Thread-1): SQL status: SUCCESS 12 in 0.11 seconds
2021-04-08 06:27:59.583178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:59.583296 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-08 06:27:59.786734 (Thread-1): SQL status: SUCCESS 0 in 0.20 seconds
2021-04-08 06:27:59.788083 (Thread-1): 06:27:59 + Ran for day 4 of 5 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-08 06:27:59.788310 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:59.788496 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:59.788599 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:27:59.943037 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-08 06:27:59.944557 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:27:59.944673 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-08 06:28:00.048731 (Thread-1): SQL status: SUCCESS 1 in 0.10 seconds
2021-04-08 06:28:00.050217 (Thread-1): 06:28:00 + Running for day 5 of 5 (2021-04-08) [model.Dbt_demo.sat_products]
2021-04-08 06:28:00.055896 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:28:00.056013 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-08 06:28:00.179003 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:28:00.179196 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:28:00.179289 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:00.960555 (Thread-1): SQL status: SUCCESS 1 in 0.78 seconds
2021-04-08 06:28:00.964408 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:28:00.964531 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-08 06:28:01.084067 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:28:01.088496 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:28:01.088623 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-08 06:28:01.193754 (Thread-1): SQL status: SUCCESS 12 in 0.11 seconds
2021-04-08 06:28:01.196087 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:28:01.196199 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-08 06:28:01.405458 (Thread-1): SQL status: SUCCESS 0 in 0.21 seconds
2021-04-08 06:28:01.406787 (Thread-1): 06:28:01 + Ran for day 5 of 5 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-08 06:28:01.406999 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:28:01.407190 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-08 06:28:01.407287 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-08 06:28:01.576059 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:28:01.576520 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_products"
2021-04-08 06:28:01.579667 (Thread-1): finished collecting timing info
2021-04-08 06:28:01.579962 (Thread-1): On model.Dbt_demo.sat_products: Close
2021-04-08 06:28:01.763238 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf4f5520>]}
2021-04-08 06:28:01.764704 (Thread-1): 06:28:01 | 17 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_products [INSERT 0 in 10.22s]
2021-04-08 06:28:01.764876 (Thread-1): Finished running node model.Dbt_demo.sat_products
2021-04-08 06:28:01.765050 (Thread-1): Began running node model.Dbt_demo.hub_customers
2021-04-08 06:28:01.766335 (Thread-1): 06:28:01 | 18 of 23 START incremental model SS_RAW_VLT.hub_customers............ [RUN]
2021-04-08 06:28:01.766694 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:01.767572 (Thread-1): Compiling model.Dbt_demo.hub_customers
2021-04-08 06:28:01.780981 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_customers"
2021-04-08 06:28:01.781368 (Thread-1): finished collecting timing info
2021-04-08 06:28:01.789465 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:01.789616 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT CUSTOMER_PK, CUSTOMERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-08 06:28:01.789739 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:28:03.627620 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2021-04-08 06:28:03.631357 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:03.631512 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
2021-04-08 06:28:03.780739 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-04-08 06:28:03.784847 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:03.784968 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-04-08 06:28:03.901998 (Thread-1): SQL status: SUCCESS 4 in 0.12 seconds
2021-04-08 06:28:03.906120 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:03.906253 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-04-08 06:28:04.076940 (Thread-1): SQL status: SUCCESS 4 in 0.17 seconds
2021-04-08 06:28:04.078822 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_customers"
2021-04-08 06:28:04.079703 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:04.079817 (Thread-1): On model.Dbt_demo.hub_customers: BEGIN
2021-04-08 06:28:04.203150 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:28:04.203344 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:04.203436 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers ("CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
        );
2021-04-08 06:28:04.434294 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-04-08 06:28:04.435538 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-04-08 06:28:04.435728 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-08 06:28:04.435825 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-04-08 06:28:04.598385 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:28:04.603020 (Thread-1): finished collecting timing info
2021-04-08 06:28:04.603300 (Thread-1): On model.Dbt_demo.hub_customers: Close
2021-04-08 06:28:04.860737 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf07a4f0>]}
2021-04-08 06:28:04.862266 (Thread-1): 06:28:04 | 18 of 23 OK created incremental model SS_RAW_VLT.hub_customers....... [SUCCESS 0 in 3.09s]
2021-04-08 06:28:04.862443 (Thread-1): Finished running node model.Dbt_demo.hub_customers
2021-04-08 06:28:04.862629 (Thread-1): Began running node model.Dbt_demo.sat_customers
2021-04-08 06:28:04.863876 (Thread-1): 06:28:04 | 19 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_customers. [RUN]
2021-04-08 06:28:04.864329 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:04.864459 (Thread-1): Compiling model.Dbt_demo.sat_customers
2021-04-08 06:28:04.888245 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_customers"
2021-04-08 06:28:04.888636 (Thread-1): finished collecting timing info
2021-04-08 06:28:04.896593 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:04.896735 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-08 06:28:04.896840 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:28:05.991418 (Thread-1): SQL status: SUCCESS 1 in 1.09 seconds
2021-04-08 06:28:05.994844 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:05.994955 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-07 23:28:01.842000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-07 23:28:01.842000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_customers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-08 06:28:06.331470 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-04-08 06:28:06.335444 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:06.335566 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-08 06:28:06.515914 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-08 06:28:06.518392 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:06.518505 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-08 06:28:06.635072 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:28:06.636508 (Thread-1): 06:28:06 + Running for day 1 of 5 (2021-04-04) [model.Dbt_demo.sat_customers]
2021-04-08 06:28:06.642606 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:06.642749 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-08 06:28:06.777517 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:06.777714 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:06.777809 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:08.307877 (Thread-1): SQL status: SUCCESS 1 in 1.53 seconds
2021-04-08 06:28:08.311839 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:08.311953 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-08 06:28:08.774705 (Thread-1): SQL status: SUCCESS 12 in 0.46 seconds
2021-04-08 06:28:08.780673 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:08.780813 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-08 06:28:09.001247 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-04-08 06:28:09.003662 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:09.003777 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-08 06:28:09.445740 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-04-08 06:28:09.447110 (Thread-1): 06:28:09 + Ran for day 1 of 5 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-08 06:28:09.447316 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:09.447494 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:09.447582 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:09.672516 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-08 06:28:09.673634 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:09.673747 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-08 06:28:09.792789 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:28:09.794187 (Thread-1): 06:28:09 + Running for day 2 of 5 (2021-04-05) [model.Dbt_demo.sat_customers]
2021-04-08 06:28:09.799650 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:09.799760 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-08 06:28:09.930030 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:09.930218 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:09.930306 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:10.630045 (Thread-1): SQL status: SUCCESS 1 in 0.70 seconds
2021-04-08 06:28:10.634262 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:10.634386 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-08 06:28:10.777775 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-08 06:28:10.782321 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:10.782442 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-08 06:28:10.919793 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-08 06:28:10.922125 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:10.922236 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-08 06:28:11.398479 (Thread-1): SQL status: SUCCESS 0 in 0.48 seconds
2021-04-08 06:28:11.399793 (Thread-1): 06:28:11 + Ran for day 2 of 5 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-08 06:28:11.399999 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:11.400184 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:11.400280 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:11.571600 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:28:11.572702 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:11.572808 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-08 06:28:11.697983 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:11.699408 (Thread-1): 06:28:11 + Running for day 3 of 5 (2021-04-06) [model.Dbt_demo.sat_customers]
2021-04-08 06:28:11.705183 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:11.705297 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-08 06:28:11.837717 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:11.837911 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:11.838003 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:12.766569 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-04-08 06:28:12.770513 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:12.770628 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-08 06:28:12.908062 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-08 06:28:12.912609 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:12.912734 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-08 06:28:13.033998 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:28:13.036346 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:13.036454 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-08 06:28:13.318146 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-08 06:28:13.319478 (Thread-1): 06:28:13 + Ran for day 3 of 5 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-08 06:28:13.319687 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:13.319867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:13.319957 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:13.513202 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-08 06:28:13.514719 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:13.514837 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-08 06:28:13.633856 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:28:13.635332 (Thread-1): 06:28:13 + Running for day 4 of 5 (2021-04-07) [model.Dbt_demo.sat_customers]
2021-04-08 06:28:13.641117 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:13.641232 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-08 06:28:13.784798 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-08 06:28:13.784999 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:13.785092 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:14.712514 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-04-08 06:28:14.716268 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:14.716383 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-08 06:28:14.869310 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-08 06:28:14.873860 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:14.873977 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-08 06:28:14.997463 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:28:14.999831 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:14.999950 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-08 06:28:15.238896 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-04-08 06:28:15.240234 (Thread-1): 06:28:15 + Ran for day 4 of 5 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-08 06:28:15.240448 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:15.240638 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:15.240737 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:15.428772 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-08 06:28:15.429927 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:15.430038 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-08 06:28:15.544780 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:15.546699 (Thread-1): 06:28:15 + Running for day 5 of 5 (2021-04-08) [model.Dbt_demo.sat_customers]
2021-04-08 06:28:15.552521 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:15.552638 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-08 06:28:15.685234 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:15.685429 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:15.685519 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:16.479821 (Thread-1): SQL status: SUCCESS 1 in 0.79 seconds
2021-04-08 06:28:16.483926 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:16.484043 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-08 06:28:16.634059 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-08 06:28:16.638483 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:16.638598 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-08 06:28:16.761219 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-08 06:28:16.763621 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:16.763733 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-08 06:28:17.012607 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-04-08 06:28:17.014304 (Thread-1): 06:28:17 + Ran for day 5 of 5 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-08 06:28:17.014517 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:17.014730 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-08 06:28:17.014828 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-08 06:28:17.189236 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:28:17.189698 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_customers"
2021-04-08 06:28:17.192845 (Thread-1): finished collecting timing info
2021-04-08 06:28:17.193140 (Thread-1): On model.Dbt_demo.sat_customers: Close
2021-04-08 06:28:17.421486 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf44a0a0>]}
2021-04-08 06:28:17.422975 (Thread-1): 06:28:17 | 19 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_customers [INSERT 0 in 12.56s]
2021-04-08 06:28:17.423143 (Thread-1): Finished running node model.Dbt_demo.sat_customers
2021-04-08 06:28:17.423314 (Thread-1): Began running node model.Dbt_demo.hub_shippers
2021-04-08 06:28:17.424578 (Thread-1): 06:28:17 | 20 of 23 START incremental model SS_RAW_VLT.hub_shippers............. [RUN]
2021-04-08 06:28:17.424889 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:17.425013 (Thread-1): Compiling model.Dbt_demo.hub_shippers
2021-04-08 06:28:17.437981 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_shippers"
2021-04-08 06:28:17.438297 (Thread-1): finished collecting timing info
2021-04-08 06:28:17.445759 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:17.445876 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SHIPPER_PK, SHIPPERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SHIPPER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SHIPPER_PK, a.SHIPPERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers AS d
    ON a.SHIPPER_PK = d.SHIPPER_PK
    WHERE d.SHIPPER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-08 06:28:17.445982 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:28:19.352585 (Thread-1): SQL status: SUCCESS 1 in 1.91 seconds
2021-04-08 06:28:19.360939 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:19.361076 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
2021-04-08 06:28:19.554321 (Thread-1): SQL status: SUCCESS 4 in 0.19 seconds
2021-04-08 06:28:19.558405 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:19.558520 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-04-08 06:28:19.687043 (Thread-1): SQL status: SUCCESS 4 in 0.13 seconds
2021-04-08 06:28:19.691510 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:19.691638 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-04-08 06:28:19.814160 (Thread-1): SQL status: SUCCESS 4 in 0.12 seconds
2021-04-08 06:28:19.815933 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_shippers"
2021-04-08 06:28:19.816725 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:19.816834 (Thread-1): On model.Dbt_demo.hub_shippers: BEGIN
2021-04-08 06:28:19.952140 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-08 06:28:19.952346 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:19.952436 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers ("SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
        );
2021-04-08 06:28:20.200938 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-04-08 06:28:20.202153 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-04-08 06:28:20.202344 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-08 06:28:20.202439 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-04-08 06:28:20.409460 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-08 06:28:20.414235 (Thread-1): finished collecting timing info
2021-04-08 06:28:20.414526 (Thread-1): On model.Dbt_demo.hub_shippers: Close
2021-04-08 06:28:20.617039 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf2f7ca0>]}
2021-04-08 06:28:20.618625 (Thread-1): 06:28:20 | 20 of 23 OK created incremental model SS_RAW_VLT.hub_shippers........ [SUCCESS 0 in 3.19s]
2021-04-08 06:28:20.618836 (Thread-1): Finished running node model.Dbt_demo.hub_shippers
2021-04-08 06:28:20.619023 (Thread-1): Began running node model.Dbt_demo.sat_shippers
2021-04-08 06:28:20.620322 (Thread-1): 06:28:20 | 21 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_shippers.. [RUN]
2021-04-08 06:28:20.620645 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:20.620774 (Thread-1): Compiling model.Dbt_demo.sat_shippers
2021-04-08 06:28:20.640594 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_shippers"
2021-04-08 06:28:20.640952 (Thread-1): finished collecting timing info
2021-04-08 06:28:20.650364 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:20.650494 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-08 06:28:20.650604 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:28:21.848587 (Thread-1): SQL status: SUCCESS 1 in 1.20 seconds
2021-04-08 06:28:21.852188 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:21.852301 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-07 23:28:17.750000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-07 23:28:17.750000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_shippers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-08 06:28:22.157057 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-04-08 06:28:22.160979 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:22.161095 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-08 06:28:22.289033 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-08 06:28:22.291197 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:22.291304 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-08 06:28:22.414849 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:28:22.416252 (Thread-1): 06:28:22 + Running for day 1 of 5 (2021-04-04) [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:22.421422 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:22.421538 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-08 06:28:22.548265 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:22.548451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:22.548537 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:23.569443 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-04-08 06:28:23.573353 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:23.573464 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-08 06:28:23.714686 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-08 06:28:23.718840 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:23.718954 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-08 06:28:23.833635 (Thread-1): SQL status: SUCCESS 7 in 0.11 seconds
2021-04-08 06:28:23.835573 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:23.835681 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-08 06:28:24.065198 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-04-08 06:28:24.066505 (Thread-1): 06:28:24 + Ran for day 1 of 5 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:24.066734 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:24.066920 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:24.067012 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:24.228777 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:28:24.229937 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:24.230046 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-08 06:28:24.342303 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:24.343782 (Thread-1): 06:28:24 + Running for day 2 of 5 (2021-04-05) [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:24.349327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:24.349439 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-08 06:28:24.479559 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:24.479753 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:24.479842 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:25.280441 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-04-08 06:28:25.284433 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:25.284556 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-08 06:28:25.414967 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-08 06:28:25.420596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:25.420719 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-08 06:28:25.546176 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-08 06:28:25.548183 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:25.548291 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-08 06:28:25.780026 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-04-08 06:28:25.781324 (Thread-1): 06:28:25 + Ran for day 2 of 5 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:25.781530 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:25.781713 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:25.781803 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:25.942015 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:28:25.943176 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:25.943292 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-08 06:28:26.080270 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-08 06:28:26.081684 (Thread-1): 06:28:26 + Running for day 3 of 5 (2021-04-06) [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:26.086834 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:26.086943 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-08 06:28:26.217376 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:26.217562 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:26.217651 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:26.856191 (Thread-1): SQL status: SUCCESS 1 in 0.64 seconds
2021-04-08 06:28:26.860431 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:26.860547 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-08 06:28:26.984502 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-08 06:28:26.988648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:26.988760 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-08 06:28:27.102710 (Thread-1): SQL status: SUCCESS 7 in 0.11 seconds
2021-04-08 06:28:27.104673 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:27.104787 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-08 06:28:27.298990 (Thread-1): SQL status: SUCCESS 0 in 0.19 seconds
2021-04-08 06:28:27.300632 (Thread-1): 06:28:27 + Ran for day 3 of 5 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:27.300840 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:27.301017 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:27.301106 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:27.479224 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-08 06:28:27.480323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:27.480429 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-08 06:28:27.594088 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:27.595612 (Thread-1): 06:28:27 + Running for day 4 of 5 (2021-04-07) [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:27.601458 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:27.601574 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-08 06:28:27.728489 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:27.728683 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:27.728770 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:28.502685 (Thread-1): SQL status: SUCCESS 1 in 0.77 seconds
2021-04-08 06:28:28.506605 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:28.506741 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-08 06:28:28.631690 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-08 06:28:28.635841 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:28.635951 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-08 06:28:28.754697 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-08 06:28:28.756663 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:28.756771 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-08 06:28:28.980663 (Thread-1): SQL status: SUCCESS 0 in 0.22 seconds
2021-04-08 06:28:28.981971 (Thread-1): 06:28:28 + Ran for day 4 of 5 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:28.982177 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:28.982358 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:28.982449 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:29.158000 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-08 06:28:29.159183 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:29.159296 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-08 06:28:29.264800 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:29.266693 (Thread-1): 06:28:29 + Running for day 5 of 5 (2021-04-08) [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:29.271861 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:29.271981 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-08 06:28:29.401972 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:29.402165 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:29.402256 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:30.055450 (Thread-1): SQL status: SUCCESS 1 in 0.65 seconds
2021-04-08 06:28:30.059531 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:30.059659 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-08 06:28:30.187828 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-08 06:28:30.193785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:30.193926 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-08 06:28:30.608750 (Thread-1): SQL status: SUCCESS 7 in 0.41 seconds
2021-04-08 06:28:30.610789 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:30.610904 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-08 06:28:30.845332 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-04-08 06:28:30.846700 (Thread-1): 06:28:30 + Ran for day 5 of 5 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-08 06:28:30.846923 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:30.847114 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-08 06:28:30.847214 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-08 06:28:31.026174 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-08 06:28:31.026610 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_shippers"
2021-04-08 06:28:31.029719 (Thread-1): finished collecting timing info
2021-04-08 06:28:31.030008 (Thread-1): On model.Dbt_demo.sat_shippers: Close
2021-04-08 06:28:31.239626 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaeee4490>]}
2021-04-08 06:28:31.241115 (Thread-1): 06:28:31 | 21 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_shippers [INSERT 0 in 10.62s]
2021-04-08 06:28:31.241289 (Thread-1): Finished running node model.Dbt_demo.sat_shippers
2021-04-08 06:28:31.241471 (Thread-1): Began running node model.Dbt_demo.hub_suppliers
2021-04-08 06:28:31.242656 (Thread-1): 06:28:31 | 22 of 23 START incremental model SS_RAW_VLT.hub_suppliers............ [RUN]
2021-04-08 06:28:31.243117 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:31.243247 (Thread-1): Compiling model.Dbt_demo.hub_suppliers
2021-04-08 06:28:31.256669 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_suppliers"
2021-04-08 06:28:31.257052 (Thread-1): finished collecting timing info
2021-04-08 06:28:31.265064 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:31.265195 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SUPPLIER_PK, SUPPLIERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers AS d
    ON a.SUPPLIER_PK = d.SUPPLIER_PK
    WHERE d.SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-08 06:28:31.265307 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:28:34.248824 (Thread-1): SQL status: SUCCESS 1 in 2.98 seconds
2021-04-08 06:28:34.252389 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:34.252519 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
2021-04-08 06:28:34.408750 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-04-08 06:28:34.412690 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:34.412803 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-04-08 06:28:34.563097 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-04-08 06:28:34.568906 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:34.569040 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-04-08 06:28:34.692260 (Thread-1): SQL status: SUCCESS 4 in 0.12 seconds
2021-04-08 06:28:34.693967 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_suppliers"
2021-04-08 06:28:34.694805 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:34.694913 (Thread-1): On model.Dbt_demo.hub_suppliers: BEGIN
2021-04-08 06:28:34.831933 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-08 06:28:34.832123 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:34.832210 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers ("SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
        );
2021-04-08 06:28:35.022838 (Thread-1): SQL status: SUCCESS 0 in 0.19 seconds
2021-04-08 06:28:35.024019 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-04-08 06:28:35.024195 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-08 06:28:35.024286 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-04-08 06:28:35.188324 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:28:35.192959 (Thread-1): finished collecting timing info
2021-04-08 06:28:35.193244 (Thread-1): On model.Dbt_demo.hub_suppliers: Close
2021-04-08 06:28:35.409684 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf01aa60>]}
2021-04-08 06:28:35.411130 (Thread-1): 06:28:35 | 22 of 23 OK created incremental model SS_RAW_VLT.hub_suppliers....... [SUCCESS 0 in 4.17s]
2021-04-08 06:28:35.411299 (Thread-1): Finished running node model.Dbt_demo.hub_suppliers
2021-04-08 06:28:35.411460 (Thread-1): Began running node model.Dbt_demo.sat_suppliers
2021-04-08 06:28:35.412696 (Thread-1): 06:28:35 | 23 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_suppliers. [RUN]
2021-04-08 06:28:35.413003 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:35.413135 (Thread-1): Compiling model.Dbt_demo.sat_suppliers
2021-04-08 06:28:35.435819 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_suppliers"
2021-04-08 06:28:35.436153 (Thread-1): finished collecting timing info
2021-04-08 06:28:35.443743 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:35.443862 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-08 06:28:35.443974 (Thread-1): Opening a new connection, currently in state closed
2021-04-08 06:28:36.983011 (Thread-1): SQL status: SUCCESS 1 in 1.54 seconds
2021-04-08 06:28:36.986619 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:36.986757 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-07 23:28:32.795000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-07 23:28:32.795000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_suppliers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-08 06:28:37.482114 (Thread-1): SQL status: SUCCESS 1 in 0.50 seconds
2021-04-08 06:28:37.486110 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:37.486264 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-08 06:28:37.617871 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:28:37.620386 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:37.620495 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-08 06:28:37.730349 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:37.731818 (Thread-1): 06:28:37 + Running for day 1 of 5 (2021-04-04) [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:37.737363 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:37.737474 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-08 06:28:37.864407 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:37.864601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:37.864688 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:39.233197 (Thread-1): SQL status: SUCCESS 1 in 1.37 seconds
2021-04-08 06:28:39.237164 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:39.237300 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-08 06:28:39.367398 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:28:39.371915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:39.372030 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-08 06:28:39.501034 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:28:39.503403 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:39.503515 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-08 06:28:39.715808 (Thread-1): SQL status: SUCCESS 0 in 0.21 seconds
2021-04-08 06:28:39.717098 (Thread-1): 06:28:39 + Ran for day 1 of 5 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:39.717307 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:39.717486 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:39.717577 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:39.887478 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:28:39.888603 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:39.888709 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-08 06:28:39.998226 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:39.999669 (Thread-1): 06:28:39 + Running for day 2 of 5 (2021-04-05) [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:40.005540 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:40.005653 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-08 06:28:40.133647 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:40.133851 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:40.133940 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:41.078181 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-08 06:28:41.082251 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:41.082375 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-08 06:28:41.210365 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:28:41.214911 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:41.215110 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-08 06:28:41.328795 (Thread-1): SQL status: SUCCESS 12 in 0.11 seconds
2021-04-08 06:28:41.331245 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:41.331358 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-08 06:28:41.581254 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-04-08 06:28:41.582532 (Thread-1): 06:28:41 + Ran for day 2 of 5 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:41.582760 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:41.582941 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:41.583030 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:41.747829 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:28:41.749301 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:41.749410 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-08 06:28:41.863168 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:41.864595 (Thread-1): 06:28:41 + Running for day 3 of 5 (2021-04-06) [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:41.870433 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:41.870545 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-08 06:28:41.995747 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:41.995934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:41.996021 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:42.989092 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-08 06:28:42.992907 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:42.993018 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-08 06:28:43.136601 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-08 06:28:43.141302 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:43.141415 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-08 06:28:43.279431 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-08 06:28:43.281681 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:43.281794 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-08 06:28:43.576455 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-08 06:28:43.577749 (Thread-1): 06:28:43 + Ran for day 3 of 5 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:43.577952 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:43.578128 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:43.578216 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:43.759451 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-08 06:28:43.760571 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:43.760678 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-08 06:28:43.879368 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-08 06:28:43.880805 (Thread-1): 06:28:43 + Running for day 4 of 5 (2021-04-07) [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:43.886653 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:43.886766 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-08 06:28:44.012589 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:44.012779 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:44.012866 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:44.998304 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-08 06:28:45.002292 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:45.002403 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-08 06:28:45.143777 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-08 06:28:45.148484 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:45.148618 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-08 06:28:45.262008 (Thread-1): SQL status: SUCCESS 12 in 0.11 seconds
2021-04-08 06:28:45.264596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:45.264719 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-08 06:28:45.498105 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-04-08 06:28:45.499482 (Thread-1): 06:28:45 + Ran for day 4 of 5 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:45.499702 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:45.499889 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:45.499984 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:45.669688 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-08 06:28:45.671276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:45.671394 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-08 06:28:45.781760 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-08 06:28:45.783291 (Thread-1): 06:28:45 + Running for day 5 of 5 (2021-04-08) [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:45.788911 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:45.789028 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-08 06:28:45.915567 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-08 06:28:45.915761 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:45.915850 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-08 06:28:46.781252 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-04-08 06:28:46.785159 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:46.785281 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-08 06:28:46.913241 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-08 06:28:46.917698 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:46.917814 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-08 06:28:47.024715 (Thread-1): SQL status: SUCCESS 12 in 0.11 seconds
2021-04-08 06:28:47.027301 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:47.027425 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-08 06:28:47.270531 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-04-08 06:28:47.271901 (Thread-1): 06:28:47 + Ran for day 5 of 5 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-08 06:28:47.272113 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:47.272297 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-08 06:28:47.272392 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-08 06:28:47.433576 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:28:47.434036 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_suppliers"
2021-04-08 06:28:47.437139 (Thread-1): finished collecting timing info
2021-04-08 06:28:47.437432 (Thread-1): On model.Dbt_demo.sat_suppliers: Close
2021-04-08 06:28:47.634299 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e4d761-b306-4cdb-8bb8-22606ab8452b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf4f5e20>]}
2021-04-08 06:28:47.635819 (Thread-1): 06:28:47 | 23 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_suppliers [INSERT 0 in 12.22s]
2021-04-08 06:28:47.635993 (Thread-1): Finished running node model.Dbt_demo.sat_suppliers
2021-04-08 06:28:47.637312 (MainThread): Acquiring new snowflake connection "master".
2021-04-08 06:28:47.637535 (MainThread): Using snowflake connection "master".
2021-04-08 06:28:47.637631 (MainThread): On master: BEGIN
2021-04-08 06:28:47.637727 (MainThread): Opening a new connection, currently in state closed
2021-04-08 06:28:48.791376 (MainThread): SQL status: SUCCESS 1 in 1.15 seconds
2021-04-08 06:28:48.791576 (MainThread): On master: COMMIT
2021-04-08 06:28:48.791744 (MainThread): Using snowflake connection "master".
2021-04-08 06:28:48.791835 (MainThread): On master: COMMIT
2021-04-08 06:28:48.947003 (MainThread): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-08 06:28:48.947226 (MainThread): On master: Close
2021-04-08 06:28:49.163319 (MainThread): 06:28:49 | 
2021-04-08 06:28:49.163529 (MainThread): 06:28:49 | Finished running 10 view models, 8 incremental models, 5 vault_insert_by_period models in 110.09s.
2021-04-08 06:28:49.163649 (MainThread): Connection 'master' was properly closed.
2021-04-08 06:28:49.163739 (MainThread): Connection 'model.Dbt_demo.sat_suppliers' was properly closed.
2021-04-08 06:28:49.300918 (MainThread): 
2021-04-08 06:28:49.301132 (MainThread): Completed successfully
2021-04-08 06:28:49.301313 (MainThread): 
Done. PASS=23 WARN=0 ERROR=0 SKIP=0 TOTAL=23
2021-04-08 06:28:49.301564 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf309f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf0ea070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaf133df0>]}
2021-04-08 06:28:49.301790 (MainThread): Flushing usage events
2021-04-27 15:55:49.587166 (MainThread): Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3, and in 3.9 it will stop working
2021-04-27 15:55:49.590592 (MainThread): Running with dbt=0.19.0
2021-04-27 15:55:51.637761 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/ubuntu/dvdemo2/dvdemo', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-04-27 15:55:51.640410 (MainThread): Tracking: tracking
2021-04-27 15:55:51.640735 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16b0bef8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a472ac40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a472acd0>]}
2021-04-27 15:55:51.717132 (MainThread): Partial parsing not enabled
2021-04-27 15:55:51.721284 (MainThread): Parsing macros/adapters.sql
2021-04-27 15:55:51.760254 (MainThread): Parsing macros/catalog.sql
2021-04-27 15:55:51.763615 (MainThread): Parsing macros/materializations/incremental.sql
2021-04-27 15:55:51.776717 (MainThread): Parsing macros/materializations/view.sql
2021-04-27 15:55:51.779279 (MainThread): Parsing macros/materializations/merge.sql
2021-04-27 15:55:51.782421 (MainThread): Parsing macros/materializations/table.sql
2021-04-27 15:55:51.796203 (MainThread): Parsing macros/core.sql
2021-04-27 15:55:51.801941 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-04-27 15:55:51.805056 (MainThread): Parsing macros/schema_tests/unique.sql
2021-04-27 15:55:51.807951 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-04-27 15:55:51.812089 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-04-27 15:55:51.815285 (MainThread): Parsing macros/adapters/common.sql
2021-04-27 15:55:51.870785 (MainThread): Parsing macros/etc/datetime.sql
2021-04-27 15:55:51.882959 (MainThread): Parsing macros/etc/query.sql
2021-04-27 15:55:51.885067 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-04-27 15:55:51.888339 (MainThread): Parsing macros/etc/is_incremental.sql
2021-04-27 15:55:51.891089 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-04-27 15:55:51.892942 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-04-27 15:55:51.895715 (MainThread): Parsing macros/materializations/helpers.sql
2021-04-27 15:55:51.908019 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-04-27 15:55:51.935086 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-04-27 15:55:51.943711 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-04-27 15:55:51.946722 (MainThread): Parsing macros/materializations/table/table.sql
2021-04-27 15:55:51.955965 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-04-27 15:55:51.994733 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-04-27 15:55:52.018273 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-04-27 15:55:52.021254 (MainThread): Parsing macros/materializations/view/view.sql
2021-04-27 15:55:52.029714 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-04-27 15:55:52.036763 (MainThread): Parsing macros/materializations/common/merge.sql
2021-04-27 15:55:52.060900 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2021-04-27 15:55:52.086912 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2021-04-27 15:55:52.096645 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2021-04-27 15:55:52.098933 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2021-04-27 15:55:52.124076 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2021-04-27 15:55:52.144382 (MainThread): Parsing macros/supporting/hash.sql
2021-04-27 15:55:52.154108 (MainThread): Parsing macros/supporting/prefix.sql
2021-04-27 15:55:52.162103 (MainThread): Parsing macros/staging/rank_columns.sql
2021-04-27 15:55:52.165836 (MainThread): Parsing macros/staging/source_columns.sql
2021-04-27 15:55:52.168241 (MainThread): Parsing macros/staging/hash_columns.sql
2021-04-27 15:55:52.173901 (MainThread): Parsing macros/staging/derive_columns.sql
2021-04-27 15:55:52.182684 (MainThread): Parsing macros/staging/stage.sql
2021-04-27 15:55:52.197994 (MainThread): Parsing macros/internal/expand_column_list.sql
2021-04-27 15:55:52.202815 (MainThread): Parsing macros/internal/as_constant.sql
2021-04-27 15:55:52.206404 (MainThread): Parsing macros/internal/multikey.sql
2021-04-27 15:55:52.213681 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2021-04-27 15:55:52.226565 (MainThread): Parsing macros/internal/alias_all.sql
2021-04-27 15:55:52.230559 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2021-04-27 15:55:52.232609 (MainThread): Parsing macros/internal/alias.sql
2021-04-27 15:55:52.238055 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2021-04-27 15:55:52.239264 (MainThread): Parsing macros/internal/is_checks.sql
2021-04-27 15:55:52.244022 (MainThread): Parsing macros/tables/sat.sql
2021-04-27 15:55:52.255532 (MainThread): Parsing macros/tables/link.sql
2021-04-27 15:55:52.270047 (MainThread): Parsing macros/tables/eff_sat.sql
2021-04-27 15:55:52.286602 (MainThread): Parsing macros/tables/t_link.sql
2021-04-27 15:55:52.293510 (MainThread): Parsing macros/tables/hub.sql
2021-04-27 15:55:52.314281 (MainThread): Parsing macros/schema_tests/not_constant.sql
2021-04-27 15:55:52.317155 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2021-04-27 15:55:52.320863 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2021-04-27 15:55:52.325090 (MainThread): Parsing macros/schema_tests/equality.sql
2021-04-27 15:55:52.331140 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-04-27 15:55:52.336005 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2021-04-27 15:55:52.339056 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-04-27 15:55:52.347990 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2021-04-27 15:55:52.351246 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2021-04-27 15:55:52.354860 (MainThread): Parsing macros/schema_tests/recency.sql
2021-04-27 15:55:52.358175 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2021-04-27 15:55:52.361364 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2021-04-27 15:55:52.364204 (MainThread): Parsing macros/cross_db_utils/literal.sql
2021-04-27 15:55:52.366455 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2021-04-27 15:55:52.368933 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2021-04-27 15:55:52.372319 (MainThread): Parsing macros/cross_db_utils/replace.sql
2021-04-27 15:55:52.375282 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2021-04-27 15:55:52.378416 (MainThread): Parsing macros/cross_db_utils/concat.sql
2021-04-27 15:55:52.382255 (MainThread): Parsing macros/cross_db_utils/position.sql
2021-04-27 15:55:52.385764 (MainThread): Parsing macros/cross_db_utils/except.sql
2021-04-27 15:55:52.390353 (MainThread): Parsing macros/cross_db_utils/length.sql
2021-04-27 15:55:52.393190 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2021-04-27 15:55:52.406218 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2021-04-27 15:55:52.410780 (MainThread): Parsing macros/cross_db_utils/hash.sql
2021-04-27 15:55:52.413668 (MainThread): Parsing macros/cross_db_utils/right.sql
2021-04-27 15:55:52.417620 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-04-27 15:55:52.419436 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2021-04-27 15:55:52.422829 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2021-04-27 15:55:52.432574 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-04-27 15:55:52.435775 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2021-04-27 15:55:52.439965 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2021-04-27 15:55:52.445353 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2021-04-27 15:55:52.448231 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2021-04-27 15:55:52.450692 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2021-04-27 15:55:52.458172 (MainThread): Parsing macros/logger/pretty_time.sql
2021-04-27 15:55:52.460785 (MainThread): Parsing macros/logger/pretty_log_format.sql
2021-04-27 15:55:52.463187 (MainThread): Parsing macros/logger/log_info.sql
2021-04-27 15:55:52.465741 (MainThread): Parsing macros/web/get_url_path.sql
2021-04-27 15:55:52.470058 (MainThread): Parsing macros/web/get_url_host.sql
2021-04-27 15:55:52.473296 (MainThread): Parsing macros/web/get_url_parameter.sql
2021-04-27 15:55:52.476450 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2021-04-27 15:55:52.509318 (MainThread): Parsing macros/geo/haversine_distance.sql
2021-04-27 15:55:52.512285 (MainThread): Parsing macros/datetime/date_spine.sql
2021-04-27 15:55:52.519396 (MainThread): Parsing macros/sql/surrogate_key.sql
2021-04-27 15:55:52.525025 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-04-27 15:55:52.534047 (MainThread): Parsing macros/sql/pivot.sql
2021-04-27 15:55:52.540384 (MainThread): Parsing macros/sql/get_column_values.sql
2021-04-27 15:55:52.547286 (MainThread): Parsing macros/sql/unpivot.sql
2021-04-27 15:55:52.557588 (MainThread): Parsing macros/sql/groupby.sql
2021-04-27 15:55:52.560306 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-04-27 15:55:52.563351 (MainThread): Parsing macros/sql/star.sql
2021-04-27 15:55:52.568957 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2021-04-27 15:55:52.582760 (MainThread): Parsing macros/sql/union.sql
2021-04-27 15:55:52.595246 (MainThread): Parsing macros/sql/generate_series.sql
2021-04-27 15:55:52.601867 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2021-04-27 15:55:52.605749 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2021-04-27 15:55:52.611068 (MainThread): Parsing macros/sql/nullcheck_table.sql
2021-04-27 15:55:52.614078 (MainThread): Parsing macros/sql/safe_add.sql
2021-04-27 15:55:52.617112 (MainThread): Parsing macros/sql/nullcheck.sql
2021-04-27 15:55:52.626744 (MainThread): Partial parsing not enabled
2021-04-27 15:55:52.706557 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:55:52.795640 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:55:52.816410 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 15:55:52.837216 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 15:55:52.857690 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:55:52.878332 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:55:52.921247 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:55:52.943358 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:55:52.964836 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:55:53.030629 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:55:53.061229 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 15:55:53.090583 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:55:53.119860 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 15:55:53.146966 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 15:55:53.157744 (MainThread): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-04-27 15:55:53.157939 (MainThread): source_model: raw_suppliers
2021-04-27 15:55:53.158064 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:55:53.158177 (MainThread): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-04-27 15:55:53.270498 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 15:55:53.280751 (MainThread): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-04-27 15:55:53.280922 (MainThread): source_model: raw_customers
2021-04-27 15:55:53.281038 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:55:53.281148 (MainThread): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-04-27 15:55:53.299451 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 15:55:53.311405 (MainThread): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-04-27 15:55:53.311561 (MainThread): source_model: raw_products
2021-04-27 15:55:53.311682 (MainThread): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:55:53.311802 (MainThread): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-04-27 15:55:53.333490 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 15:55:53.343868 (MainThread): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-04-27 15:55:53.344043 (MainThread): source_model: raw_shippers
2021-04-27 15:55:53.344159 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:55:53.344273 (MainThread): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-04-27 15:55:53.361357 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 15:55:53.373033 (MainThread): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-04-27 15:55:53.373190 (MainThread): source_model: raw_orders
2021-04-27 15:55:53.373306 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:55:53.373421 (MainThread): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-04-27 15:55:53.396095 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 15:55:53.478730 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 15:55:53.496521 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 15:55:53.514222 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 15:55:53.531629 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 15:55:54.492426 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a46f68b0>]}
2021-04-27 15:55:54.629945 (MainThread): Found 23 models, 0 tests, 0 snapshots, 0 analyses, 372 macros, 0 operations, 0 seed files, 5 sources, 0 exposures
2021-04-27 15:55:54.631966 (MainThread): 
2021-04-27 15:55:54.632345 (MainThread): Acquiring new snowflake connection "master".
2021-04-27 15:55:54.667125 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 15:55:54.683732 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 15:55:54.683873 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-04-27 15:55:54.683974 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-04-27 15:55:56.053309 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 1.37 seconds
2021-04-27 15:55:56.057840 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-04-27 15:55:56.299669 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 15:55:56.303594 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 15:55:56.303710 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-04-27 15:55:56.303822 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-04-27 15:55:57.459777 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 1.16 seconds
2021-04-27 15:55:57.460790 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-04-27 15:55:57.703933 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 15:55:57.707198 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 15:55:57.707308 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-04-27 15:55:57.707406 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-04-27 15:55:58.529904 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 0.82 seconds
2021-04-27 15:55:58.530894 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-04-27 15:55:58.874086 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-04-27 15:55:58.883413 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-04-27 15:55:58.883552 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW_VLT"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW_VLT
2021-04-27 15:55:58.883663 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-04-27 15:55:59.968561 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 13 in 1.08 seconds
2021-04-27 15:55:59.981885 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: Close
2021-04-27 15:56:00.212299 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-04-27 15:56:00.215824 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-04-27 15:56:00.215934 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_STG"} */

    show terse objects in DATAVAULTDEMO_DB.SS_STG
2021-04-27 15:56:00.216033 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-04-27 15:56:01.032280 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 0.82 seconds
2021-04-27 15:56:01.037953 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: Close
2021-04-27 15:56:01.460305 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-04-27 15:56:01.463784 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-04-27 15:56:01.463893 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW
2021-04-27 15:56:01.463991 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-04-27 15:56:02.383419 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 0.92 seconds
2021-04-27 15:56:02.389003 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: Close
2021-04-27 15:56:02.575054 (MainThread): Using snowflake connection "master".
2021-04-27 15:56:02.575258 (MainThread): On master: BEGIN
2021-04-27 15:56:02.575363 (MainThread): Opening a new connection, currently in state init
2021-04-27 15:56:03.696841 (MainThread): SQL status: SUCCESS 1 in 1.12 seconds
2021-04-27 15:56:03.697049 (MainThread): On master: COMMIT
2021-04-27 15:56:03.697211 (MainThread): Using snowflake connection "master".
2021-04-27 15:56:03.697305 (MainThread): On master: COMMIT
2021-04-27 15:56:04.040456 (MainThread): SQL status: SUCCESS 1 in 0.34 seconds
2021-04-27 15:56:04.040672 (MainThread): On master: Close
2021-04-27 15:56:04.270180 (MainThread): 15:56:04 | Concurrency: 1 threads (target='dev')
2021-04-27 15:56:04.270427 (MainThread): 15:56:04 | 
2021-04-27 15:56:04.272003 (Thread-1): Began running node model.Dbt_demo.raw_orders
2021-04-27 15:56:04.273431 (Thread-1): 15:56:04 | 1 of 23 START view model SS_RAW.raw_orders........................... [RUN]
2021-04-27 15:56:04.273762 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 15:56:04.273912 (Thread-1): Compiling model.Dbt_demo.raw_orders
2021-04-27 15:56:04.296117 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_orders"
2021-04-27 15:56:04.299129 (Thread-1): finished collecting timing info
2021-04-27 15:56:04.331547 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_orders"
2021-04-27 15:56:04.334746 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 15:56:04.334851 (Thread-1): On model.Dbt_demo.raw_orders: BEGIN
2021-04-27 15:56:04.334948 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:05.143956 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-04-27 15:56:05.144144 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 15:56:05.144232 (Thread-1): On model.Dbt_demo.raw_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_orders  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.ORDERS 
--FROM DATAVAULTDEMO_DB.SS.ORDERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 15:56:05.496997 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 15:56:05.498316 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-04-27 15:56:05.498496 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 15:56:05.498587 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-04-27 15:56:05.618871 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:56:05.630675 (Thread-1): finished collecting timing info
2021-04-27 15:56:05.630964 (Thread-1): On model.Dbt_demo.raw_orders: Close
2021-04-27 15:56:05.924025 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a3511460>]}
2021-04-27 15:56:05.925536 (Thread-1): 15:56:05 | 1 of 23 OK created view model SS_RAW.raw_orders...................... [SUCCESS 1 in 1.65s]
2021-04-27 15:56:05.925718 (Thread-1): Finished running node model.Dbt_demo.raw_orders
2021-04-27 15:56:05.925901 (Thread-1): Began running node model.Dbt_demo.raw_products
2021-04-27 15:56:05.927260 (Thread-1): 15:56:05 | 2 of 23 START view model SS_RAW.raw_products......................... [RUN]
2021-04-27 15:56:05.927772 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 15:56:05.927906 (Thread-1): Compiling model.Dbt_demo.raw_products
2021-04-27 15:56:05.939304 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_products"
2021-04-27 15:56:05.939656 (Thread-1): finished collecting timing info
2021-04-27 15:56:05.945462 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_products"
2021-04-27 15:56:05.946126 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 15:56:05.946234 (Thread-1): On model.Dbt_demo.raw_products: BEGIN
2021-04-27 15:56:05.946351 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:06.797633 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-04-27 15:56:06.797828 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 15:56:06.797916 (Thread-1): On model.Dbt_demo.raw_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_products  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.PRODUCTS 
--FROM DATAVAULTDEMO_DB.SS.PRODUCTS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 15:56:07.308134 (Thread-1): SQL status: SUCCESS 1 in 0.51 seconds
2021-04-27 15:56:07.309309 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-04-27 15:56:07.309484 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 15:56:07.309572 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-04-27 15:56:07.439172 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:56:07.443263 (Thread-1): finished collecting timing info
2021-04-27 15:56:07.443529 (Thread-1): On model.Dbt_demo.raw_products: Close
2021-04-27 15:56:07.653869 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a3234fa0>]}
2021-04-27 15:56:07.655429 (Thread-1): 15:56:07 | 2 of 23 OK created view model SS_RAW.raw_products.................... [SUCCESS 1 in 1.73s]
2021-04-27 15:56:07.655605 (Thread-1): Finished running node model.Dbt_demo.raw_products
2021-04-27 15:56:07.655785 (Thread-1): Began running node model.Dbt_demo.raw_customers
2021-04-27 15:56:07.657051 (Thread-1): 15:56:07 | 3 of 23 START view model SS_RAW.raw_customers........................ [RUN]
2021-04-27 15:56:07.657529 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 15:56:07.657659 (Thread-1): Compiling model.Dbt_demo.raw_customers
2021-04-27 15:56:07.668794 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_customers"
2021-04-27 15:56:07.669158 (Thread-1): finished collecting timing info
2021-04-27 15:56:07.674752 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_customers"
2021-04-27 15:56:07.675442 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 15:56:07.675550 (Thread-1): On model.Dbt_demo.raw_customers: BEGIN
2021-04-27 15:56:07.675649 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:08.392944 (Thread-1): SQL status: SUCCESS 1 in 0.72 seconds
2021-04-27 15:56:08.393137 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 15:56:08.393226 (Thread-1): On model.Dbt_demo.raw_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_customers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.CUSTOMERS 
--FROM DATAVAULTDEMO_DB.SS.CUSTOMERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 15:56:09.249690 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-04-27 15:56:09.250861 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-04-27 15:56:09.251035 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 15:56:09.251153 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-04-27 15:56:09.377754 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:56:09.381842 (Thread-1): finished collecting timing info
2021-04-27 15:56:09.382110 (Thread-1): On model.Dbt_demo.raw_customers: Close
2021-04-27 15:56:09.605516 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a307aa90>]}
2021-04-27 15:56:09.606924 (Thread-1): 15:56:09 | 3 of 23 OK created view model SS_RAW.raw_customers................... [SUCCESS 1 in 1.95s]
2021-04-27 15:56:09.607092 (Thread-1): Finished running node model.Dbt_demo.raw_customers
2021-04-27 15:56:09.607284 (Thread-1): Began running node model.Dbt_demo.raw_shippers
2021-04-27 15:56:09.608560 (Thread-1): 15:56:09 | 4 of 23 START view model SS_RAW.raw_shippers......................... [RUN]
2021-04-27 15:56:09.609020 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 15:56:09.609142 (Thread-1): Compiling model.Dbt_demo.raw_shippers
2021-04-27 15:56:09.620223 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_shippers"
2021-04-27 15:56:09.620537 (Thread-1): finished collecting timing info
2021-04-27 15:56:09.625851 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_shippers"
2021-04-27 15:56:09.626463 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 15:56:09.626562 (Thread-1): On model.Dbt_demo.raw_shippers: BEGIN
2021-04-27 15:56:09.626663 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:10.936664 (Thread-1): SQL status: SUCCESS 1 in 1.31 seconds
2021-04-27 15:56:10.936861 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 15:56:10.936951 (Thread-1): On model.Dbt_demo.raw_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_shippers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SHIPPERS 
--FROM DATAVAULTDEMO_DB.SS.SHIPPERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 15:56:11.756636 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-04-27 15:56:11.757809 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-04-27 15:56:11.758003 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 15:56:11.758093 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-04-27 15:56:12.045150 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 15:56:12.049247 (Thread-1): finished collecting timing info
2021-04-27 15:56:12.049528 (Thread-1): On model.Dbt_demo.raw_shippers: Close
2021-04-27 15:56:12.290215 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a322e490>]}
2021-04-27 15:56:12.291658 (Thread-1): 15:56:12 | 4 of 23 OK created view model SS_RAW.raw_shippers.................... [SUCCESS 1 in 2.68s]
2021-04-27 15:56:12.291826 (Thread-1): Finished running node model.Dbt_demo.raw_shippers
2021-04-27 15:56:12.291991 (Thread-1): Began running node model.Dbt_demo.raw_suppliers
2021-04-27 15:56:12.293384 (Thread-1): 15:56:12 | 5 of 23 START view model SS_RAW.raw_suppliers........................ [RUN]
2021-04-27 15:56:12.293691 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 15:56:12.293814 (Thread-1): Compiling model.Dbt_demo.raw_suppliers
2021-04-27 15:56:12.304792 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_suppliers"
2021-04-27 15:56:12.305103 (Thread-1): finished collecting timing info
2021-04-27 15:56:12.310474 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_suppliers"
2021-04-27 15:56:12.311114 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 15:56:12.311220 (Thread-1): On model.Dbt_demo.raw_suppliers: BEGIN
2021-04-27 15:56:12.311318 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:13.389432 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-04-27 15:56:13.389626 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 15:56:13.389715 (Thread-1): On model.Dbt_demo.raw_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_suppliers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SUPPLIERS 
--FROM DATAVAULTDEMO_DB.SS.SUPPLIERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 15:56:14.097289 (Thread-1): SQL status: SUCCESS 1 in 0.71 seconds
2021-04-27 15:56:14.098466 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-04-27 15:56:14.098648 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 15:56:14.098737 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-04-27 15:56:14.250450 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:56:14.254529 (Thread-1): finished collecting timing info
2021-04-27 15:56:14.254804 (Thread-1): On model.Dbt_demo.raw_suppliers: Close
2021-04-27 15:56:14.470872 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a304a460>]}
2021-04-27 15:56:14.472311 (Thread-1): 15:56:14 | 5 of 23 OK created view model SS_RAW.raw_suppliers................... [SUCCESS 1 in 2.18s]
2021-04-27 15:56:14.472480 (Thread-1): Finished running node model.Dbt_demo.raw_suppliers
2021-04-27 15:56:14.472657 (Thread-1): Began running node model.Dbt_demo.v_stg_orders
2021-04-27 15:56:14.473923 (Thread-1): 15:56:14 | 6 of 23 START view model SS_STG.v_stg_orders......................... [RUN]
2021-04-27 15:56:14.474390 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 15:56:14.474555 (Thread-1): Compiling model.Dbt_demo.v_stg_orders
2021-04-27 15:56:14.489438 (Thread-1): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-04-27 15:56:14.489616 (Thread-1): source_model: raw_orders
2021-04-27 15:56:14.489742 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:56:14.489866 (Thread-1): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-04-27 15:56:14.501332 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 15:56:14.501445 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-04-27 15:56:14.501550 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:15.464909 (Thread-1): SQL status: SUCCESS 13 in 0.96 seconds
2021-04-27 15:56:15.471647 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 15:56:15.471765 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-04-27 15:56:15.644975 (Thread-1): SQL status: SUCCESS 13 in 0.17 seconds
2021-04-27 15:56:15.657340 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_orders"
2021-04-27 15:56:15.658395 (Thread-1): finished collecting timing info
2021-04-27 15:56:15.664430 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_orders"
2021-04-27 15:56:15.669994 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 15:56:15.670098 (Thread-1): On model.Dbt_demo.v_stg_orders: BEGIN
2021-04-27 15:56:15.831080 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:56:15.831296 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 15:56:15.831388 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_orders  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_orders
),

derived_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-ORDERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''))) AS BINARY(16)) AS ORDER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS ORDER_PRODUCT_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^')
    ), '^^||^^||^^')) AS BINARY(16)) AS ORDER_SHIPPER_CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCOUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPOSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPREGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    ORDER_PK,
    PRODUCT_PK,
    SHIPPER_PK,
    CUSTOMER_PK,
    ORDER_PRODUCT_PK,
    ORDER_SHIPPER_CUSTOMER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 15:56:16.307942 (Thread-1): SQL status: SUCCESS 1 in 0.48 seconds
2021-04-27 15:56:16.309099 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-04-27 15:56:16.309272 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 15:56:16.309360 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-04-27 15:56:16.453140 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:56:16.457182 (Thread-1): finished collecting timing info
2021-04-27 15:56:16.457448 (Thread-1): On model.Dbt_demo.v_stg_orders: Close
2021-04-27 15:56:16.838222 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a304a760>]}
2021-04-27 15:56:16.839680 (Thread-1): 15:56:16 | 6 of 23 OK created view model SS_STG.v_stg_orders.................... [SUCCESS 1 in 2.36s]
2021-04-27 15:56:16.839851 (Thread-1): Finished running node model.Dbt_demo.v_stg_orders
2021-04-27 15:56:16.840011 (Thread-1): Began running node model.Dbt_demo.v_stg_products
2021-04-27 15:56:16.841301 (Thread-1): 15:56:16 | 7 of 23 START view model SS_STG.v_stg_products....................... [RUN]
2021-04-27 15:56:16.841645 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 15:56:16.841979 (Thread-1): Compiling model.Dbt_demo.v_stg_products
2021-04-27 15:56:16.856052 (Thread-1): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-04-27 15:56:16.856216 (Thread-1): source_model: raw_products
2021-04-27 15:56:16.856345 (Thread-1): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:56:16.856459 (Thread-1): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-04-27 15:56:16.860459 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 15:56:16.860573 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-04-27 15:56:16.860672 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:17.976252 (Thread-1): SQL status: SUCCESS 11 in 1.12 seconds
2021-04-27 15:56:17.982603 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 15:56:17.982722 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-04-27 15:56:18.231513 (Thread-1): SQL status: SUCCESS 11 in 0.25 seconds
2021-04-27 15:56:18.241289 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_products"
2021-04-27 15:56:18.241626 (Thread-1): finished collecting timing info
2021-04-27 15:56:18.247910 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_products"
2021-04-27 15:56:18.251988 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 15:56:18.252100 (Thread-1): On model.Dbt_demo.v_stg_products: BEGIN
2021-04-27 15:56:18.411381 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:56:18.411572 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 15:56:18.411659 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_products  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_products
),

derived_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORYID AS CATEGORY,
    'TPCH-PRODUCTS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS PRODUCT_SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CATEGORYID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(QUANTITYPERUNIT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REORDERLEVEL AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITPRICE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSINSTOCK AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSONORDER AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS PRODUCT_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,
    PRODUCT_PK,
    SUPPLIER_PK,
    PRODUCT_SUPPLIER_PK,
    PRODUCT_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 15:56:18.847307 (Thread-1): SQL status: SUCCESS 1 in 0.44 seconds
2021-04-27 15:56:18.848453 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-04-27 15:56:18.848634 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 15:56:18.848729 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-04-27 15:56:19.007757 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:56:19.011796 (Thread-1): finished collecting timing info
2021-04-27 15:56:19.012069 (Thread-1): On model.Dbt_demo.v_stg_products: Close
2021-04-27 15:56:19.443931 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a31be340>]}
2021-04-27 15:56:19.445318 (Thread-1): 15:56:19 | 7 of 23 OK created view model SS_STG.v_stg_products.................. [SUCCESS 1 in 2.60s]
2021-04-27 15:56:19.445484 (Thread-1): Finished running node model.Dbt_demo.v_stg_products
2021-04-27 15:56:19.445660 (Thread-1): Began running node model.Dbt_demo.v_stg_customers
2021-04-27 15:56:19.446805 (Thread-1): 15:56:19 | 8 of 23 START view model SS_STG.v_stg_customers...................... [RUN]
2021-04-27 15:56:19.447301 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 15:56:19.447632 (Thread-1): Compiling model.Dbt_demo.v_stg_customers
2021-04-27 15:56:19.461256 (Thread-1): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-04-27 15:56:19.461420 (Thread-1): source_model: raw_customers
2021-04-27 15:56:19.461545 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:56:19.461662 (Thread-1): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-04-27 15:56:19.465633 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 15:56:19.465741 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-04-27 15:56:19.465841 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:20.327979 (Thread-1): SQL status: SUCCESS 10 in 0.86 seconds
2021-04-27 15:56:20.335265 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 15:56:20.335375 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-04-27 15:56:20.466751 (Thread-1): SQL status: SUCCESS 10 in 0.13 seconds
2021-04-27 15:56:20.474229 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_customers"
2021-04-27 15:56:20.474560 (Thread-1): finished collecting timing info
2021-04-27 15:56:20.480207 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_customers"
2021-04-27 15:56:20.483248 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 15:56:20.483351 (Thread-1): On model.Dbt_demo.v_stg_customers: BEGIN
2021-04-27 15:56:20.625022 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:56:20.625201 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 15:56:20.625287 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_customers  as (
    










    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_customers
),

derived_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-CUSTOMERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 15:56:21.022288 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 15:56:21.023447 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-04-27 15:56:21.023623 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 15:56:21.023714 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-04-27 15:56:21.140194 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:56:21.144543 (Thread-1): finished collecting timing info
2021-04-27 15:56:21.144817 (Thread-1): On model.Dbt_demo.v_stg_customers: Close
2021-04-27 15:56:21.353307 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a304fb50>]}
2021-04-27 15:56:21.354860 (Thread-1): 15:56:21 | 8 of 23 OK created view model SS_STG.v_stg_customers................. [SUCCESS 1 in 1.91s]
2021-04-27 15:56:21.355039 (Thread-1): Finished running node model.Dbt_demo.v_stg_customers
2021-04-27 15:56:21.355248 (Thread-1): Began running node model.Dbt_demo.v_stg_shippers
2021-04-27 15:56:21.356385 (Thread-1): 15:56:21 | 9 of 23 START view model SS_STG.v_stg_shippers....................... [RUN]
2021-04-27 15:56:21.356909 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 15:56:21.357214 (Thread-1): Compiling model.Dbt_demo.v_stg_shippers
2021-04-27 15:56:21.370416 (Thread-1): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-04-27 15:56:21.370585 (Thread-1): source_model: raw_shippers
2021-04-27 15:56:21.370715 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:56:21.370839 (Thread-1): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-04-27 15:56:21.375029 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 15:56:21.375163 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-04-27 15:56:21.375270 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:22.120356 (Thread-1): SQL status: SUCCESS 5 in 0.75 seconds
2021-04-27 15:56:22.126004 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 15:56:22.126122 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-04-27 15:56:22.284776 (Thread-1): SQL status: SUCCESS 5 in 0.16 seconds
2021-04-27 15:56:22.290317 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_shippers"
2021-04-27 15:56:22.290650 (Thread-1): finished collecting timing info
2021-04-27 15:56:22.297957 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_shippers"
2021-04-27 15:56:22.300163 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 15:56:22.300267 (Thread-1): On model.Dbt_demo.v_stg_shippers: BEGIN
2021-04-27 15:56:22.456402 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:56:22.456586 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 15:56:22.456671 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_shippers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_shippers
),

derived_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SHIPPERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PHONE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SHIPPER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SHIPPER_PK,
    SHIPPER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 15:56:22.833691 (Thread-1): SQL status: SUCCESS 1 in 0.38 seconds
2021-04-27 15:56:22.834852 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-04-27 15:56:22.835026 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 15:56:22.835141 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-04-27 15:56:22.964779 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:56:22.968770 (Thread-1): finished collecting timing info
2021-04-27 15:56:22.969035 (Thread-1): On model.Dbt_demo.v_stg_shippers: Close
2021-04-27 15:56:23.181682 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a31e6850>]}
2021-04-27 15:56:23.183079 (Thread-1): 15:56:23 | 9 of 23 OK created view model SS_STG.v_stg_shippers.................. [SUCCESS 1 in 1.82s]
2021-04-27 15:56:23.183274 (Thread-1): Finished running node model.Dbt_demo.v_stg_shippers
2021-04-27 15:56:23.183443 (Thread-1): Began running node model.Dbt_demo.v_stg_suppliers
2021-04-27 15:56:23.184695 (Thread-1): 15:56:23 | 10 of 23 START view model SS_STG.v_stg_suppliers..................... [RUN]
2021-04-27 15:56:23.185209 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 15:56:23.185332 (Thread-1): Compiling model.Dbt_demo.v_stg_suppliers
2021-04-27 15:56:23.198932 (Thread-1): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-04-27 15:56:23.199130 (Thread-1): source_model: raw_suppliers
2021-04-27 15:56:23.199262 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 15:56:23.199384 (Thread-1): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-04-27 15:56:23.203525 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 15:56:23.203633 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-04-27 15:56:23.203731 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:23.889938 (Thread-1): SQL status: SUCCESS 10 in 0.69 seconds
2021-04-27 15:56:23.896251 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 15:56:23.896381 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-04-27 15:56:24.056373 (Thread-1): SQL status: SUCCESS 10 in 0.16 seconds
2021-04-27 15:56:24.064158 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-04-27 15:56:24.064498 (Thread-1): finished collecting timing info
2021-04-27 15:56:24.070300 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-04-27 15:56:24.073438 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 15:56:24.073549 (Thread-1): On model.Dbt_demo.v_stg_suppliers: BEGIN
2021-04-27 15:56:24.221016 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:56:24.221208 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 15:56:24.221298 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
),

derived_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SUPPLIERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTTITLE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SUPPLIER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SUPPLIER_PK,
    SUPPLIER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 15:56:24.580064 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-04-27 15:56:24.581207 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-04-27 15:56:24.581380 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 15:56:24.581469 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-04-27 15:56:25.139640 (Thread-1): SQL status: SUCCESS 1 in 0.56 seconds
2021-04-27 15:56:25.145287 (Thread-1): finished collecting timing info
2021-04-27 15:56:25.145552 (Thread-1): On model.Dbt_demo.v_stg_suppliers: Close
2021-04-27 15:56:25.423313 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a3590310>]}
2021-04-27 15:56:25.424708 (Thread-1): 15:56:25 | 10 of 23 OK created view model SS_STG.v_stg_suppliers................ [SUCCESS 1 in 2.24s]
2021-04-27 15:56:25.424877 (Thread-1): Finished running node model.Dbt_demo.v_stg_suppliers
2021-04-27 15:56:25.425056 (Thread-1): Began running node model.Dbt_demo.hub_orders
2021-04-27 15:56:25.426315 (Thread-1): 15:56:25 | 11 of 23 START incremental model SS_RAW_VLT.hub_orders............... [RUN]
2021-04-27 15:56:25.426638 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:25.426775 (Thread-1): Compiling model.Dbt_demo.hub_orders
2021-04-27 15:56:25.509877 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_orders"
2021-04-27 15:56:25.511542 (Thread-1): finished collecting timing info
2021-04-27 15:56:25.553860 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:25.554033 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PK, ORDERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 15:56:25.554152 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:36.580612 (Thread-1): SQL status: SUCCESS 1 in 11.03 seconds
2021-04-27 15:56:36.584204 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:36.584321 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
2021-04-27 15:56:36.770493 (Thread-1): SQL status: SUCCESS 4 in 0.19 seconds
2021-04-27 15:56:36.774571 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:36.774688 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-04-27 15:56:36.992970 (Thread-1): SQL status: SUCCESS 4 in 0.22 seconds
2021-04-27 15:56:36.996920 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:36.997034 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-04-27 15:56:37.132665 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-04-27 15:56:37.149502 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_orders"
2021-04-27 15:56:37.151701 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:37.151829 (Thread-1): On model.Dbt_demo.hub_orders: BEGIN
2021-04-27 15:56:37.457971 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 15:56:37.458155 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:37.458242 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders ("ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
        );
2021-04-27 15:56:37.814672 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-04-27 15:56:37.815827 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-04-27 15:56:37.816002 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 15:56:37.816092 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-04-27 15:56:38.129357 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 15:56:38.138094 (Thread-1): finished collecting timing info
2021-04-27 15:56:38.138410 (Thread-1): On model.Dbt_demo.hub_orders: Close
2021-04-27 15:56:38.362741 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a3188ee0>]}
2021-04-27 15:56:38.364168 (Thread-1): 15:56:38 | 11 of 23 OK created incremental model SS_RAW_VLT.hub_orders.......... [SUCCESS 0 in 12.94s]
2021-04-27 15:56:38.364343 (Thread-1): Finished running node model.Dbt_demo.hub_orders
2021-04-27 15:56:38.364519 (Thread-1): Began running node model.Dbt_demo.link_order_prod
2021-04-27 15:56:38.365723 (Thread-1): 15:56:38 | 12 of 23 START incremental model SS_RAW_VLT.link_order_prod.......... [RUN]
2021-04-27 15:56:38.366169 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:38.366295 (Thread-1): Compiling model.Dbt_demo.link_order_prod
2021-04-27 15:56:38.379183 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_prod"
2021-04-27 15:56:38.380162 (Thread-1): finished collecting timing info
2021-04-27 15:56:38.387847 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:38.387961 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PRODUCT_PK, PRODUCT_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PRODUCT_PK, a.PRODUCT_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod AS d
    ON a.ORDER_PRODUCT_PK = d.ORDER_PRODUCT_PK
    WHERE d.ORDER_PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 15:56:38.388076 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:41.073339 (Thread-1): SQL status: SUCCESS 1 in 2.69 seconds
2021-04-27 15:56:41.076862 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:41.076972 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
2021-04-27 15:56:41.241938 (Thread-1): SQL status: SUCCESS 5 in 0.16 seconds
2021-04-27 15:56:41.246043 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:41.246163 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-04-27 15:56:41.452257 (Thread-1): SQL status: SUCCESS 5 in 0.21 seconds
2021-04-27 15:56:41.457464 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:41.457591 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-04-27 15:56:41.618691 (Thread-1): SQL status: SUCCESS 5 in 0.16 seconds
2021-04-27 15:56:41.620760 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_prod"
2021-04-27 15:56:41.622937 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:41.623070 (Thread-1): On model.Dbt_demo.link_order_prod: BEGIN
2021-04-27 15:56:41.847161 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:56:41.847345 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:41.847432 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod ("ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
        );
2021-04-27 15:56:42.252748 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-04-27 15:56:42.253918 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-04-27 15:56:42.254094 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 15:56:42.254183 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-04-27 15:56:42.587929 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-04-27 15:56:42.592048 (Thread-1): finished collecting timing info
2021-04-27 15:56:42.592315 (Thread-1): On model.Dbt_demo.link_order_prod: Close
2021-04-27 15:56:42.807722 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a35b93a0>]}
2021-04-27 15:56:42.809137 (Thread-1): 15:56:42 | 12 of 23 OK created incremental model SS_RAW_VLT.link_order_prod..... [SUCCESS 0 in 4.44s]
2021-04-27 15:56:42.809308 (Thread-1): Finished running node model.Dbt_demo.link_order_prod
2021-04-27 15:56:42.809477 (Thread-1): Began running node model.Dbt_demo.link_order_ship_cust
2021-04-27 15:56:42.810609 (Thread-1): 15:56:42 | 13 of 23 START incremental model SS_RAW_VLT.link_order_ship_cust..... [RUN]
2021-04-27 15:56:42.811085 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:42.811234 (Thread-1): Compiling model.Dbt_demo.link_order_ship_cust
2021-04-27 15:56:42.824455 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-04-27 15:56:42.824779 (Thread-1): finished collecting timing info
2021-04-27 15:56:42.832345 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:42.832460 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_SHIPPER_CUSTOMER_PK, SHIPPER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_SHIPPER_CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_SHIPPER_CUSTOMER_PK, a.SHIPPER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust AS d
    ON a.ORDER_SHIPPER_CUSTOMER_PK = d.ORDER_SHIPPER_CUSTOMER_PK
    WHERE d.ORDER_SHIPPER_CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 15:56:42.832564 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:44.920284 (Thread-1): SQL status: SUCCESS 1 in 2.09 seconds
2021-04-27 15:56:44.923837 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:44.923962 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
2021-04-27 15:56:45.089628 (Thread-1): SQL status: SUCCESS 6 in 0.17 seconds
2021-04-27 15:56:45.093679 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:45.093790 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-04-27 15:56:45.261817 (Thread-1): SQL status: SUCCESS 6 in 0.17 seconds
2021-04-27 15:56:45.267307 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:45.267423 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-04-27 15:56:45.410273 (Thread-1): SQL status: SUCCESS 6 in 0.14 seconds
2021-04-27 15:56:45.412134 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-04-27 15:56:45.412966 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:45.413072 (Thread-1): On model.Dbt_demo.link_order_ship_cust: BEGIN
2021-04-27 15:56:45.567964 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:56:45.568142 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:45.568237 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust ("ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
        );
2021-04-27 15:56:45.924118 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-04-27 15:56:45.925283 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-04-27 15:56:45.925460 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 15:56:45.925550 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-04-27 15:56:46.150670 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 15:56:46.155118 (Thread-1): finished collecting timing info
2021-04-27 15:56:46.155401 (Thread-1): On model.Dbt_demo.link_order_ship_cust: Close
2021-04-27 15:56:46.405215 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a333a8b0>]}
2021-04-27 15:56:46.406622 (Thread-1): 15:56:46 | 13 of 23 OK created incremental model SS_RAW_VLT.link_order_ship_cust [SUCCESS 0 in 3.59s]
2021-04-27 15:56:46.406795 (Thread-1): Finished running node model.Dbt_demo.link_order_ship_cust
2021-04-27 15:56:46.406967 (Thread-1): Began running node model.Dbt_demo.sat_orders
2021-04-27 15:56:46.408337 (Thread-1): 15:56:46 | 14 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_orders.... [RUN]
2021-04-27 15:56:46.408694 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:46.408824 (Thread-1): Compiling model.Dbt_demo.sat_orders
2021-04-27 15:56:46.430996 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_orders"
2021-04-27 15:56:46.432055 (Thread-1): finished collecting timing info
2021-04-27 15:56:46.496769 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:46.496933 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 15:56:46.497039 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:56:47.310569 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-04-27 15:56:47.340583 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:47.340704 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 08:56:47.014000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 08:56:47.014000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_orders
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 15:56:49.780802 (Thread-1): SQL status: SUCCESS 1 in 2.44 seconds
2021-04-27 15:56:49.784539 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:49.784654 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:56:49.952025 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:56:49.960854 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:49.961000 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:56:50.093641 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:56:50.107037 (Thread-1): 15:56:50 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_orders]
2021-04-27 15:56:50.126070 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:50.126246 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:56:50.286078 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:56:50.286272 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:50.286360 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:56:51.707059 (Thread-1): SQL status: SUCCESS 1 in 1.42 seconds
2021-04-27 15:56:51.711167 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:51.711284 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:56:51.882993 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:56:51.887410 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:51.887521 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:56:52.035769 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:56:52.038312 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:52.038421 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:56:52.336608 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:56:52.337888 (Thread-1): 15:56:52 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:56:52.338098 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:52.338281 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:52.338376 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:52.684054 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 15:56:52.685141 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:52.685246 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:56:52.830937 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:56:52.832761 (Thread-1): 15:56:52 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_orders]
2021-04-27 15:56:52.838402 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:52.838522 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:56:52.997768 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:56:52.997947 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:52.998034 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:56:54.168319 (Thread-1): SQL status: SUCCESS 1 in 1.17 seconds
2021-04-27 15:56:54.172299 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:54.172411 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:56:54.362031 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:56:54.367868 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:54.367980 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:56:54.508436 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:56:54.510732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:54.510841 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:56:54.823949 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 15:56:54.825547 (Thread-1): 15:56:54 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:56:54.825751 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:54.825929 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:54.826015 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:55.056220 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 15:56:55.057344 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:55.057449 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:56:55.191144 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:56:55.192540 (Thread-1): 15:56:55 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_orders]
2021-04-27 15:56:55.198196 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:55.198306 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:56:55.349948 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:56:55.350137 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:55.350229 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:56:56.373526 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-04-27 15:56:56.377333 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:56.377445 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:56:56.544535 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:56:56.549044 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:56.549165 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:56:56.712179 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:56:56.714458 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:56.714570 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:56:57.018145 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:56:57.019472 (Thread-1): 15:56:57 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:56:57.019677 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:57.019855 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:57.019942 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:57.264012 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 15:56:57.265139 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:57.265247 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:56:57.400290 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:56:57.401731 (Thread-1): 15:56:57 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_orders]
2021-04-27 15:56:57.407176 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:57.407292 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:56:57.589006 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 15:56:57.589199 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:57.589291 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:56:58.813992 (Thread-1): SQL status: SUCCESS 1 in 1.22 seconds
2021-04-27 15:56:58.818124 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:58.818236 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:56:59.016516 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 15:56:59.020878 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:59.020994 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:56:59.177936 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:56:59.180262 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:59.180372 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:56:59.485405 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:56:59.486660 (Thread-1): 15:56:59 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:56:59.486861 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:59.487040 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:59.487148 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:56:59.767448 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 15:56:59.768551 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:59.768659 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:56:59.906947 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:56:59.908369 (Thread-1): 15:56:59 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_orders]
2021-04-27 15:56:59.914085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:56:59.914194 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:00.079524 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:57:00.079714 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:00.079802 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:01.271742 (Thread-1): SQL status: SUCCESS 1 in 1.19 seconds
2021-04-27 15:57:01.277125 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:01.277244 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:01.657313 (Thread-1): SQL status: SUCCESS 12 in 0.38 seconds
2021-04-27 15:57:01.662039 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:01.662191 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:01.809854 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:57:01.812178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:01.812288 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:02.163598 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 15:57:02.164890 (Thread-1): 15:57:02 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:02.165096 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:02.165272 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:02.165360 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:02.387636 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:02.388702 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:02.388813 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:02.538142 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:02.539577 (Thread-1): 15:57:02 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:02.545251 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:02.545362 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:02.698361 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:02.698552 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:02.698638 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:03.814803 (Thread-1): SQL status: SUCCESS 1 in 1.12 seconds
2021-04-27 15:57:03.818745 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:03.818864 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:03.986097 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:57:03.990575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:03.990698 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:04.345460 (Thread-1): SQL status: SUCCESS 12 in 0.35 seconds
2021-04-27 15:57:04.347782 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:04.347899 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:04.671376 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 15:57:04.672698 (Thread-1): 15:57:04 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:04.672902 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:04.673078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:04.673173 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:05.372725 (Thread-1): SQL status: SUCCESS 1 in 0.70 seconds
2021-04-27 15:57:05.373852 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:05.373960 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:05.526826 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:05.528665 (Thread-1): 15:57:05 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:05.533956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:05.534065 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:05.741144 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:57:05.741329 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:05.741420 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:08.442932 (Thread-1): SQL status: SUCCESS 1 in 2.70 seconds
2021-04-27 15:57:08.446895 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:08.447011 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:09.005785 (Thread-1): SQL status: SUCCESS 12 in 0.56 seconds
2021-04-27 15:57:09.010063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:09.010184 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:09.311427 (Thread-1): SQL status: SUCCESS 12 in 0.30 seconds
2021-04-27 15:57:09.313744 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:09.313864 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:09.923770 (Thread-1): SQL status: SUCCESS 0 in 0.61 seconds
2021-04-27 15:57:09.927172 (Thread-1): 15:57:09 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:09.927394 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:09.927572 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:09.927662 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:10.469445 (Thread-1): SQL status: SUCCESS 1 in 0.54 seconds
2021-04-27 15:57:10.470559 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:10.470668 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:10.666086 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:57:10.667570 (Thread-1): 15:57:10 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:10.673351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:10.673463 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:10.990522 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 15:57:10.990714 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:10.990804 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:13.685911 (Thread-1): SQL status: SUCCESS 1 in 2.69 seconds
2021-04-27 15:57:13.689821 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:13.689937 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:14.167696 (Thread-1): SQL status: SUCCESS 12 in 0.48 seconds
2021-04-27 15:57:14.172357 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:14.172476 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:14.517900 (Thread-1): SQL status: SUCCESS 12 in 0.35 seconds
2021-04-27 15:57:14.520298 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:14.520415 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:15.091034 (Thread-1): SQL status: SUCCESS 0 in 0.57 seconds
2021-04-27 15:57:15.092403 (Thread-1): 15:57:15 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:15.092619 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:15.092806 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:15.092899 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:15.385061 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 15:57:15.386504 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:15.386621 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:15.576185 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:57:15.577592 (Thread-1): 15:57:15 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:15.583018 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:15.583143 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:15.754093 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:57:15.754274 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:15.754361 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:17.108715 (Thread-1): SQL status: SUCCESS 1 in 1.35 seconds
2021-04-27 15:57:17.112884 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:17.112995 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:17.270489 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:57:17.380353 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:17.380522 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:17.522871 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:57:17.525189 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:17.525298 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:17.781114 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 15:57:17.782756 (Thread-1): 15:57:17 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:17.782968 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:17.783179 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:17.783287 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:18.003714 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:18.004819 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:18.004924 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:18.149231 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:57:18.150640 (Thread-1): 15:57:18 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:18.156365 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:18.156484 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:18.317625 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:57:18.317812 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:18.317897 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:19.260022 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 15:57:19.263901 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:19.264022 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:19.434634 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:57:19.440662 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:19.440776 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:19.590030 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:57:19.592355 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:19.592464 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:19.873359 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 15:57:19.874644 (Thread-1): 15:57:19 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:19.874851 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:19.875024 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:19.875153 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:20.085994 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:57:20.087141 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:20.087250 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:20.229047 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:57:20.230449 (Thread-1): 15:57:20 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:20.235810 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:20.235917 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:20.431696 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:57:20.431884 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:20.431971 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:21.409384 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-04-27 15:57:21.413513 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:21.413624 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:21.591709 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 15:57:21.596054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:21.596169 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:21.740926 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:57:21.743254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:21.743362 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:22.041691 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:57:22.042955 (Thread-1): 15:57:22 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:22.043186 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:22.043361 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:22.043449 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:22.260923 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:22.262018 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:22.262123 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:22.402751 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:57:22.404173 (Thread-1): 15:57:22 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:22.409837 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:22.409952 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:22.579621 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:57:22.579804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:22.579890 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:23.789439 (Thread-1): SQL status: SUCCESS 1 in 1.21 seconds
2021-04-27 15:57:23.793466 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:23.793586 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:23.976579 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 15:57:23.981152 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:23.981279 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:24.136533 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:57:24.138851 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:24.138966 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:24.441891 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:57:24.443230 (Thread-1): 15:57:24 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:24.443441 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:24.443627 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:24.443720 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:24.754863 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 15:57:24.756313 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:24.756443 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:24.888352 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:57:24.889730 (Thread-1): 15:57:24 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:24.895041 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:24.895170 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:25.049346 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:25.049524 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:25.049610 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:26.081652 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 15:57:26.085546 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:26.085665 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:26.253821 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:57:26.258315 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:26.258434 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:26.400863 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:57:26.403208 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:26.403319 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:26.709000 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 15:57:26.710324 (Thread-1): 15:57:26 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:26.710533 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:26.710713 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:26.710808 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:26.935258 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:26.936348 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:26.936454 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:27.131832 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:57:27.133606 (Thread-1): 15:57:27 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:27.138898 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:27.139005 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:27.296471 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:57:27.296654 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:27.296741 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:28.323241 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 15:57:28.327183 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:28.327294 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:28.494008 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:57:28.498604 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:28.498715 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:28.665264 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:57:28.667574 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:28.667682 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:28.975586 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 15:57:28.977164 (Thread-1): 15:57:28 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:28.977381 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:28.977553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:28.977641 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:29.187890 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:57:29.188977 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:29.189080 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:29.321903 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:57:29.323385 (Thread-1): 15:57:29 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:29.329151 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:29.329265 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:29.503383 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:57:29.503569 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:29.503657 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:30.509094 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 15:57:30.513054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:30.513184 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:30.666102 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:57:30.672476 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:30.672622 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:30.804877 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:57:30.807197 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:30.807309 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:31.078968 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 15:57:31.080317 (Thread-1): 15:57:31 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:31.080538 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:31.080718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:31.080817 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:31.310286 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 15:57:31.311467 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:31.311578 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:31.443253 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:57:31.445127 (Thread-1): 15:57:31 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:31.450501 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:31.450614 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:31.629463 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 15:57:31.629654 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:31.629744 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:32.562909 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-04-27 15:57:32.566999 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:32.567131 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:32.826831 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-04-27 15:57:32.831259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:32.831367 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:32.994728 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:57:32.997037 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:32.997147 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:33.348172 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 15:57:33.349451 (Thread-1): 15:57:33 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:33.349653 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:33.349826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:33.349913 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:33.562631 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:57:33.563765 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:33.563870 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:33.711428 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:33.712877 (Thread-1): 15:57:33 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:33.718648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:33.718769 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:33.889915 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:57:33.890107 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:33.890195 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:34.953168 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-04-27 15:57:34.957078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:34.957207 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:35.138177 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 15:57:35.142676 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:35.142785 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:35.284714 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:57:35.286988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:35.287096 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:35.706457 (Thread-1): SQL status: SUCCESS 0 in 0.42 seconds
2021-04-27 15:57:35.707779 (Thread-1): 15:57:35 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:35.707987 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:35.708169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:35.708256 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:36.161878 (Thread-1): SQL status: SUCCESS 1 in 0.45 seconds
2021-04-27 15:57:36.163347 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:36.163456 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:36.297924 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:57:36.299352 (Thread-1): 15:57:36 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:36.304661 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:36.304774 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:36.462286 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:57:36.462464 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:36.462549 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:37.530315 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-04-27 15:57:37.535471 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:37.535586 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:37.786326 (Thread-1): SQL status: SUCCESS 12 in 0.25 seconds
2021-04-27 15:57:37.790780 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:37.790896 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:38.040430 (Thread-1): SQL status: SUCCESS 12 in 0.25 seconds
2021-04-27 15:57:38.042849 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:38.042963 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:38.364133 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 15:57:38.365388 (Thread-1): 15:57:38 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:38.365594 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:38.365766 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:38.365851 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:38.605646 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 15:57:38.606743 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:38.606942 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:38.747894 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:57:38.749689 (Thread-1): 15:57:38 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:38.754992 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:38.755132 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:38.921122 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:57:38.921310 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:38.921396 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:40.148159 (Thread-1): SQL status: SUCCESS 1 in 1.23 seconds
2021-04-27 15:57:40.152093 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:40.152202 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:40.378979 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-04-27 15:57:40.383286 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:40.383392 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:40.549253 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:57:40.551545 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:40.551664 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:41.036667 (Thread-1): SQL status: SUCCESS 0 in 0.48 seconds
2021-04-27 15:57:41.038259 (Thread-1): 15:57:41 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:41.038465 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:41.038637 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:41.038737 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:41.334374 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-04-27 15:57:41.335537 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:41.335648 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:41.476969 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:57:41.478364 (Thread-1): 15:57:41 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:41.484068 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:41.484177 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:41.674034 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:57:41.674212 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:41.674296 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:43.155286 (Thread-1): SQL status: SUCCESS 1 in 1.48 seconds
2021-04-27 15:57:43.159118 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:43.159231 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:43.519569 (Thread-1): SQL status: SUCCESS 12 in 0.36 seconds
2021-04-27 15:57:43.523947 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:43.524064 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:43.672301 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:57:43.674595 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:43.674709 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:44.034164 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-04-27 15:57:44.035458 (Thread-1): 15:57:44 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:44.035664 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:44.035837 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:44.035924 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:44.272655 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 15:57:44.273761 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:44.273866 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:44.414389 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:57:44.417943 (Thread-1): 15:57:44 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:44.423245 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:44.423352 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:44.586582 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:57:44.586766 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:44.586850 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:45.694039 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-04-27 15:57:45.698014 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:45.698124 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:45.855238 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:57:45.859513 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:45.859626 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:46.011987 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:57:46.014298 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:46.014405 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:46.315157 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:57:46.316771 (Thread-1): 15:57:46 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:46.316975 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:46.317150 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:46.317237 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:46.541723 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:46.542821 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:46.542924 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:46.691725 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:46.693127 (Thread-1): 15:57:46 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:46.698440 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:46.698549 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:46.862534 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:57:46.862718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:46.862814 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:47.896468 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 15:57:47.900543 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:47.900660 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:48.070918 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:57:48.075469 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:48.075585 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:48.231287 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:57:48.233571 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:48.233677 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:48.515452 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 15:57:48.516708 (Thread-1): 15:57:48 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:48.516922 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:48.517095 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:48.517181 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:48.739311 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:48.740418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:48.740534 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:48.875377 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:57:48.877163 (Thread-1): 15:57:48 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:48.882489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:48.882597 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:49.040282 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:57:49.040467 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:49.040552 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:50.358502 (Thread-1): SQL status: SUCCESS 1 in 1.32 seconds
2021-04-27 15:57:50.362475 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:50.362590 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:50.595362 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-04-27 15:57:50.601557 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:50.601671 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:50.922791 (Thread-1): SQL status: SUCCESS 12 in 0.32 seconds
2021-04-27 15:57:50.925121 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:50.925229 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:51.332276 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-04-27 15:57:51.333549 (Thread-1): 15:57:51 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:51.333747 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:51.333920 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:51.334006 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:51.607130 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 15:57:51.608604 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:51.608709 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:51.747151 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:57:51.748535 (Thread-1): 15:57:51 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:51.753950 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:51.754058 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:51.902032 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:51.902213 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:51.902305 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:53.584889 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2021-04-27 15:57:53.588706 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:53.588814 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:53.881255 (Thread-1): SQL status: SUCCESS 12 in 0.29 seconds
2021-04-27 15:57:53.885649 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:53.885764 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:54.090869 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 15:57:54.093215 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:54.093328 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:54.543781 (Thread-1): SQL status: SUCCESS 0 in 0.45 seconds
2021-04-27 15:57:54.545061 (Thread-1): 15:57:54 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:54.545275 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:54.545451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:54.545538 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:54.765148 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:54.766235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:54.766340 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 15:57:54.921109 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:57:54.922935 (Thread-1): 15:57:54 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_orders]
2021-04-27 15:57:54.928233 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:54.928340 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 15:57:55.125265 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:57:55.125446 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:55.125532 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:57:56.640009 (Thread-1): SQL status: SUCCESS 1 in 1.51 seconds
2021-04-27 15:57:56.643978 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:56.644088 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 15:57:56.902213 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-04-27 15:57:56.906473 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:56.906581 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 15:57:57.211828 (Thread-1): SQL status: SUCCESS 12 in 0.31 seconds
2021-04-27 15:57:57.214122 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:57.214229 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 15:57:57.518374 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:57:57.519998 (Thread-1): 15:57:57 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 15:57:57.520203 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:57.520375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 15:57:57.520468 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 15:57:57.735627 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:57:57.740527 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_orders"
2021-04-27 15:57:57.744379 (Thread-1): finished collecting timing info
2021-04-27 15:57:57.744661 (Thread-1): On model.Dbt_demo.sat_orders: Close
2021-04-27 15:57:57.996775 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a4746970>]}
2021-04-27 15:57:57.998211 (Thread-1): 15:57:57 | 14 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_orders [INSERT 0 in 71.59s]
2021-04-27 15:57:57.998377 (Thread-1): Finished running node model.Dbt_demo.sat_orders
2021-04-27 15:57:57.998547 (Thread-1): Began running node model.Dbt_demo.hub_products
2021-04-27 15:57:57.999719 (Thread-1): 15:57:57 | 15 of 23 START incremental model SS_RAW_VLT.hub_products............. [RUN]
2021-04-27 15:57:58.000182 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:57:58.000307 (Thread-1): Compiling model.Dbt_demo.hub_products
2021-04-27 15:57:58.015571 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_products"
2021-04-27 15:57:58.015913 (Thread-1): finished collecting timing info
2021-04-27 15:57:58.024097 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:57:58.024234 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_PK, PRODUCTID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_PK, a.PRODUCTID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products AS d
    ON a.PRODUCT_PK = d.PRODUCT_PK
    WHERE d.PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 15:57:58.024344 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:58:00.470151 (Thread-1): SQL status: SUCCESS 1 in 2.45 seconds
2021-04-27 15:58:00.473692 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:58:00.473802 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
2021-04-27 15:58:00.637432 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-04-27 15:58:00.641445 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:58:00.641558 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-04-27 15:58:00.790281 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-04-27 15:58:00.794428 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:58:00.794554 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-04-27 15:58:01.243144 (Thread-1): SQL status: SUCCESS 4 in 0.45 seconds
2021-04-27 15:58:01.244838 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_products"
2021-04-27 15:58:01.245609 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:58:01.245709 (Thread-1): On model.Dbt_demo.hub_products: BEGIN
2021-04-27 15:58:01.416716 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:58:01.416900 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:58:01.416986 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products ("PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
        );
2021-04-27 15:58:01.767349 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 15:58:01.768545 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-04-27 15:58:01.768730 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 15:58:01.768823 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-04-27 15:58:02.024390 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 15:58:02.028952 (Thread-1): finished collecting timing info
2021-04-27 15:58:02.029260 (Thread-1): On model.Dbt_demo.hub_products: Close
2021-04-27 15:58:02.277818 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a31fcee0>]}
2021-04-27 15:58:02.279292 (Thread-1): 15:58:02 | 15 of 23 OK created incremental model SS_RAW_VLT.hub_products........ [SUCCESS 0 in 4.28s]
2021-04-27 15:58:02.279459 (Thread-1): Finished running node model.Dbt_demo.hub_products
2021-04-27 15:58:02.279630 (Thread-1): Began running node model.Dbt_demo.link_prod_supp
2021-04-27 15:58:02.280871 (Thread-1): 15:58:02 | 16 of 23 START incremental model SS_RAW_VLT.link_prod_supp........... [RUN]
2021-04-27 15:58:02.281181 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:02.281303 (Thread-1): Compiling model.Dbt_demo.link_prod_supp
2021-04-27 15:58:02.294343 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_prod_supp"
2021-04-27 15:58:02.294683 (Thread-1): finished collecting timing info
2021-04-27 15:58:02.303829 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:02.303952 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_SUPPLIER_PK, PRODUCT_PK, SUPPLIER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_SUPPLIER_PK, a.PRODUCT_PK, a.SUPPLIER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp AS d
    ON a.PRODUCT_SUPPLIER_PK = d.PRODUCT_SUPPLIER_PK
    WHERE d.PRODUCT_SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 15:58:02.304056 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:58:04.107320 (Thread-1): SQL status: SUCCESS 1 in 1.80 seconds
2021-04-27 15:58:04.110888 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:04.111010 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
2021-04-27 15:58:04.278352 (Thread-1): SQL status: SUCCESS 5 in 0.17 seconds
2021-04-27 15:58:04.282533 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:04.282685 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-04-27 15:58:04.454107 (Thread-1): SQL status: SUCCESS 5 in 0.17 seconds
2021-04-27 15:58:04.458276 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:04.458386 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-04-27 15:58:04.615491 (Thread-1): SQL status: SUCCESS 5 in 0.16 seconds
2021-04-27 15:58:04.617265 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_prod_supp"
2021-04-27 15:58:04.618057 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:04.618156 (Thread-1): On model.Dbt_demo.link_prod_supp: BEGIN
2021-04-27 15:58:04.824766 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:58:04.824953 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:04.825043 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp ("PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
        );
2021-04-27 15:58:05.111038 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 15:58:05.112236 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-04-27 15:58:05.112413 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 15:58:05.112502 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-04-27 15:58:05.361424 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 15:58:05.365930 (Thread-1): finished collecting timing info
2021-04-27 15:58:05.366198 (Thread-1): On model.Dbt_demo.link_prod_supp: Close
2021-04-27 15:58:05.705895 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a3371a30>]}
2021-04-27 15:58:05.707363 (Thread-1): 15:58:05 | 16 of 23 OK created incremental model SS_RAW_VLT.link_prod_supp...... [SUCCESS 0 in 3.42s]
2021-04-27 15:58:05.707532 (Thread-1): Finished running node model.Dbt_demo.link_prod_supp
2021-04-27 15:58:05.707709 (Thread-1): Began running node model.Dbt_demo.sat_products
2021-04-27 15:58:05.709064 (Thread-1): 15:58:05 | 17 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_products.. [RUN]
2021-04-27 15:58:05.709408 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:05.709534 (Thread-1): Compiling model.Dbt_demo.sat_products
2021-04-27 15:58:05.731779 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_products"
2021-04-27 15:58:05.732187 (Thread-1): finished collecting timing info
2021-04-27 15:58:05.741314 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:05.741441 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 15:58:05.741543 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:58:06.809056 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-04-27 15:58:06.812581 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:06.812701 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 08:58:06.539000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 08:58:06.539000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_products
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 15:58:07.202306 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-04-27 15:58:07.206258 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:07.206374 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:07.354077 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:07.356592 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:07.356704 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:07.516476 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:58:07.517884 (Thread-1): 15:58:07 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_products]
2021-04-27 15:58:07.523398 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:07.523504 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:07.715022 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:58:07.715225 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:07.715312 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:09.076270 (Thread-1): SQL status: SUCCESS 1 in 1.36 seconds
2021-04-27 15:58:09.080208 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:09.080319 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:09.269265 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:58:09.273732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:09.273851 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:09.477898 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 15:58:09.480239 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:09.480358 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:09.769745 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 15:58:09.771028 (Thread-1): 15:58:09 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:09.771258 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:09.771443 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:09.771530 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:10.117521 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 15:58:10.118626 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:10.118731 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:10.324923 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:58:10.326678 (Thread-1): 15:58:10 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_products]
2021-04-27 15:58:10.332107 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:10.332225 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:10.519786 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:58:10.519968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:10.520053 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:11.700288 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-04-27 15:58:11.704233 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:11.704341 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:11.853508 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:11.859341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:11.859469 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:11.984666 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:11.986968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:11.987073 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:12.326871 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 15:58:12.328567 (Thread-1): 15:58:12 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:12.328787 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:12.328966 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:12.329058 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:12.961344 (Thread-1): SQL status: SUCCESS 1 in 0.63 seconds
2021-04-27 15:58:12.962477 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:12.962585 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:13.091616 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:58:13.093024 (Thread-1): 15:58:13 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_products]
2021-04-27 15:58:13.098814 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:13.098924 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:13.236960 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:13.237139 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:13.237224 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:14.522519 (Thread-1): SQL status: SUCCESS 1 in 1.29 seconds
2021-04-27 15:58:14.526380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:14.526488 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:14.683532 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:58:14.687994 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:14.688115 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:14.818388 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:14.820724 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:14.820833 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:15.334416 (Thread-1): SQL status: SUCCESS 0 in 0.51 seconds
2021-04-27 15:58:15.335722 (Thread-1): 15:58:15 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:15.335925 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:15.336098 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:15.336184 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:15.535484 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:58:15.536548 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:15.536651 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:15.654602 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:15.656027 (Thread-1): 15:58:15 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_products]
2021-04-27 15:58:15.661799 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:15.661907 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:15.802132 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:15.802314 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:15.802399 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:16.701507 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-04-27 15:58:16.705444 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:16.705556 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:16.851013 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:16.855501 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:16.855615 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:16.978510 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 15:58:16.980829 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:16.980938 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:17.271747 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 15:58:17.273064 (Thread-1): 15:58:17 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:17.273272 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:17.273451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:17.273539 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:17.474394 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:58:17.475845 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:17.475951 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:17.595233 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:17.596669 (Thread-1): 15:58:17 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_products]
2021-04-27 15:58:17.602175 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:17.602287 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:17.744325 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:17.744515 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:17.744618 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:18.726120 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-04-27 15:58:18.729934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:18.730055 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:18.878959 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:18.883415 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:18.883526 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:19.038176 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:19.040736 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:19.040850 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:19.311949 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 15:58:19.313224 (Thread-1): 15:58:19 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:19.313431 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:19.313604 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:19.313691 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:19.580626 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 15:58:19.581731 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:19.581836 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:19.708357 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:58:19.710178 (Thread-1): 15:58:19 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_products]
2021-04-27 15:58:19.715578 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:19.715684 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:19.860279 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:19.860458 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:19.860542 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:21.035720 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-04-27 15:58:21.039789 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:21.039905 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:21.195397 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:58:21.199911 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:21.200020 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:21.332889 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:21.335191 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:21.335298 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:21.598272 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 15:58:21.599914 (Thread-1): 15:58:21 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:21.600116 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:21.600287 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:21.600373 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:21.802795 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:58:21.803915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:21.804020 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:21.928800 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:21.930191 (Thread-1): 15:58:21 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_products]
2021-04-27 15:58:21.936052 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:21.936161 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:22.077744 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:22.077933 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:22.078018 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:23.021009 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 15:58:23.024923 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:23.025042 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:23.178674 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:23.183137 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:23.183247 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:23.309564 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:23.311915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:23.312021 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:23.597844 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 15:58:23.599143 (Thread-1): 15:58:23 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:23.599349 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:23.599523 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:23.599611 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:23.790352 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:58:23.791474 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:23.791578 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:23.906351 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 15:58:23.908205 (Thread-1): 15:58:23 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_products]
2021-04-27 15:58:23.913672 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:23.913791 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:24.054590 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:24.054784 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:24.054870 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:25.016523 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-04-27 15:58:25.020507 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:25.020623 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:25.176544 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:58:25.181081 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:25.181196 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:25.307355 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:25.309656 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:25.309780 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:25.576470 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 15:58:25.578093 (Thread-1): 15:58:25 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:25.578304 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:25.578479 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:25.578566 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:25.780088 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:58:25.781195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:25.781299 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:25.906982 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:58:25.908405 (Thread-1): 15:58:25 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_products]
2021-04-27 15:58:25.913838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:25.913944 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:26.061763 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:58:26.061952 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:26.062040 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:27.010197 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 15:58:27.014140 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:27.014264 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:27.167532 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:27.250345 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:27.250503 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:27.390843 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:58:27.393139 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:27.393245 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:27.644105 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-04-27 15:58:27.645699 (Thread-1): 15:58:27 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:27.645914 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:27.646076 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:27.646173 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:27.841953 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:58:27.843080 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:27.843216 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:27.967809 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:27.969234 (Thread-1): 15:58:27 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_products]
2021-04-27 15:58:27.975323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:27.975445 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:28.115535 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:28.115731 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:28.115817 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:29.325772 (Thread-1): SQL status: SUCCESS 1 in 1.21 seconds
2021-04-27 15:58:29.329658 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:29.329768 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:29.612427 (Thread-1): SQL status: SUCCESS 12 in 0.28 seconds
2021-04-27 15:58:29.618470 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:29.618586 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:29.748603 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:29.750934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:29.751041 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:29.987031 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-04-27 15:58:29.988342 (Thread-1): 15:58:29 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:29.988544 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:29.988717 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:29.988804 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:30.342159 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 15:58:30.343294 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:30.343399 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:30.460269 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:30.462096 (Thread-1): 15:58:30 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_products]
2021-04-27 15:58:30.467597 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:30.467704 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:30.603546 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:30.603720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:30.603804 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:31.593124 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 15:58:31.597098 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:31.597208 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:31.747534 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:31.752097 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:31.752205 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:31.888245 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:58:31.890540 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:31.890646 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:32.234120 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 15:58:32.235770 (Thread-1): 15:58:32 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:32.235978 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:32.236149 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:32.236236 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:32.430848 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:58:32.432008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:32.432117 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:32.551933 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:32.553396 (Thread-1): 15:58:32 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_products]
2021-04-27 15:58:32.559323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:32.559444 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:32.775746 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:58:32.775932 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:32.776024 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:35.924176 (Thread-1): SQL status: SUCCESS 1 in 3.15 seconds
2021-04-27 15:58:35.928108 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:35.928225 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:36.226838 (Thread-1): SQL status: SUCCESS 12 in 0.30 seconds
2021-04-27 15:58:36.231309 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:36.231429 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:36.677072 (Thread-1): SQL status: SUCCESS 12 in 0.45 seconds
2021-04-27 15:58:36.679399 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:36.679505 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:37.155218 (Thread-1): SQL status: SUCCESS 0 in 0.48 seconds
2021-04-27 15:58:37.156490 (Thread-1): 15:58:37 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:37.156692 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:37.156867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:37.156953 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:37.454796 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-04-27 15:58:37.455915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:37.456020 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:37.628946 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:58:37.630722 (Thread-1): 15:58:37 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_products]
2021-04-27 15:58:37.636160 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:37.636268 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:37.827250 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:58:37.827431 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:37.827516 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:39.760033 (Thread-1): SQL status: SUCCESS 1 in 1.93 seconds
2021-04-27 15:58:39.765689 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:39.765829 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:39.939378 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:58:39.943838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:39.943953 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:40.135650 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:58:40.137958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:40.138070 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:40.614056 (Thread-1): SQL status: SUCCESS 0 in 0.48 seconds
2021-04-27 15:58:40.615701 (Thread-1): 15:58:40 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:40.615903 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:40.616076 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:40.616163 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:40.848396 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 15:58:40.849494 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:40.849602 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:41.040566 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:58:41.042001 (Thread-1): 15:58:41 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_products]
2021-04-27 15:58:41.047558 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:41.047671 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:41.296289 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 15:58:41.296472 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:41.296557 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:43.286926 (Thread-1): SQL status: SUCCESS 1 in 1.99 seconds
2021-04-27 15:58:43.290937 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:43.291062 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:43.470620 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 15:58:43.475227 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:43.475344 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:43.601413 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:43.603804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:43.603918 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:44.074152 (Thread-1): SQL status: SUCCESS 0 in 0.47 seconds
2021-04-27 15:58:44.075482 (Thread-1): 15:58:44 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:44.075690 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:44.075869 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:44.075956 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:44.319823 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 15:58:44.320933 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:44.321036 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:44.482118 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:58:44.484028 (Thread-1): 15:58:44 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_products]
2021-04-27 15:58:44.489574 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:44.489686 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:44.695863 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:58:44.696044 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:44.696129 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:46.128873 (Thread-1): SQL status: SUCCESS 1 in 1.43 seconds
2021-04-27 15:58:46.132832 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:46.132951 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:46.356493 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-04-27 15:58:46.360935 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:46.361045 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:46.485095 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 15:58:46.487416 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:46.487523 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:46.803202 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 15:58:46.806573 (Thread-1): 15:58:46 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:46.806785 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:46.806960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:46.807045 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:47.078873 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 15:58:47.080006 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:47.080115 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:47.192885 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 15:58:47.194328 (Thread-1): 15:58:47 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_products]
2021-04-27 15:58:47.199931 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:47.200047 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:47.405970 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:58:47.406162 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:47.406252 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:48.431365 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-04-27 15:58:48.435232 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:48.435341 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:48.582755 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:48.587209 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:48.587315 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:48.712977 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:48.715310 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:48.715415 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:49.155700 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-04-27 15:58:49.156958 (Thread-1): 15:58:49 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:49.157156 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:49.157333 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:49.157421 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:49.383410 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 15:58:49.384530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:49.384636 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:49.501183 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:49.502596 (Thread-1): 15:58:49 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_products]
2021-04-27 15:58:49.508451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:49.508568 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:49.652909 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:58:49.653088 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:49.653177 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:50.553169 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-04-27 15:58:50.557117 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:50.557225 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:50.700899 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:58:50.705443 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:50.705553 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:50.832967 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:50.835331 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:50.835444 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:51.147919 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 15:58:51.149245 (Thread-1): 15:58:51 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:51.149457 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:51.149636 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:51.149727 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:51.373448 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:58:51.374884 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:51.374989 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:51.495278 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:51.496664 (Thread-1): 15:58:51 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_products]
2021-04-27 15:58:51.502113 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:51.502226 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:51.661219 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:58:51.661400 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:51.661484 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:52.546435 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-04-27 15:58:52.550237 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:52.550344 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:52.701542 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:52.707518 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:52.707626 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:53.028748 (Thread-1): SQL status: SUCCESS 12 in 0.32 seconds
2021-04-27 15:58:53.031052 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:53.031182 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:53.359356 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-04-27 15:58:53.360643 (Thread-1): 15:58:53 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:53.360844 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:53.361017 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:53.361103 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:53.558552 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:58:53.559653 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:53.559758 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:53.689621 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:58:53.691456 (Thread-1): 15:58:53 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_products]
2021-04-27 15:58:53.696856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:53.696961 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:53.883649 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 15:58:53.883826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:53.883910 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:54.957104 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-04-27 15:58:54.961097 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:54.961212 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:55.156119 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:58:55.160638 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:55.160749 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:55.293255 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:58:55.295567 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:55.295673 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:55.576306 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 15:58:55.577900 (Thread-1): 15:58:55 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:55.578103 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:55.578276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:55.578383 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:55.783512 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:58:55.784602 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:55.784704 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:55.909262 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:58:55.910660 (Thread-1): 15:58:55 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_products]
2021-04-27 15:58:55.916504 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:55.916612 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:56.083616 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:58:56.083801 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:56.083887 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:57.116885 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 15:58:57.120935 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:57.121050 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:57.306725 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:58:57.311248 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:57.311370 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:57.432210 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 15:58:57.434518 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:57.434626 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:57.709347 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 15:58:57.710634 (Thread-1): 15:58:57 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:57.710834 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:57.711011 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:57.711122 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:57.909299 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:58:57.910389 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:57.910491 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:58:58.036487 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:58:58.038264 (Thread-1): 15:58:58 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_products]
2021-04-27 15:58:58.043781 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:58.043894 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:58:58.194089 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:58:58.194279 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:58.194363 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:58:59.154244 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-04-27 15:58:59.159889 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:59.160008 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:58:59.311403 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:58:59.315915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:59.316036 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:58:59.434137 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 15:58:59.436446 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:59.436551 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:58:59.812804 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-04-27 15:58:59.814414 (Thread-1): 15:58:59 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:58:59.814625 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:58:59.814800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:58:59.814888 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:00.035962 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:59:00.037076 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:00.037183 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:59:00.166374 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:59:00.167872 (Thread-1): 15:59:00 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_products]
2021-04-27 15:59:00.173454 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:00.173573 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:59:00.316023 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:59:00.316210 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:00.316299 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:01.290299 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 15:59:01.294236 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:01.294345 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:59:01.439354 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:59:01.443816 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:01.443938 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:59:01.574200 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:59:01.576539 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:01.576649 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:59:01.853423 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 15:59:01.854761 (Thread-1): 15:59:01 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:59:01.854987 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:01.855198 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:01.855297 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:02.057623 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:02.058761 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:02.058872 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:59:02.192067 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:59:02.193551 (Thread-1): 15:59:02 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_products]
2021-04-27 15:59:02.199577 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:02.199708 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:59:02.345029 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:59:02.345218 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:02.345302 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:03.370677 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 15:59:03.374665 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:03.374773 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:59:03.533068 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:59:03.537584 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:03.537700 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:59:03.676232 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:59:03.678529 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:03.678639 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:59:03.956961 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 15:59:03.958250 (Thread-1): 15:59:03 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:59:03.958455 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:03.958631 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:03.958723 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:04.178448 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:59:04.181715 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:04.181830 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:59:04.296095 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 15:59:04.297476 (Thread-1): 15:59:04 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_products]
2021-04-27 15:59:04.302905 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:04.303012 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:59:04.449371 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:59:04.449560 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:04.449650 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:05.577153 (Thread-1): SQL status: SUCCESS 1 in 1.13 seconds
2021-04-27 15:59:05.581286 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:05.581396 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:59:05.726772 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:59:05.731254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:05.731373 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:59:05.864556 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:59:05.867072 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:05.867214 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:59:06.141760 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 15:59:06.143091 (Thread-1): 15:59:06 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:59:06.143324 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:06.143507 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:06.143596 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:06.341622 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:06.342733 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:06.342845 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 15:59:06.458641 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:59:06.460482 (Thread-1): 15:59:06 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_products]
2021-04-27 15:59:06.465948 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:06.466067 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 15:59:06.605419 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:59:06.605602 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:06.605688 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:07.595604 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 15:59:07.599595 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:07.599706 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 15:59:07.753041 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:59:07.757594 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:07.757703 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 15:59:07.885046 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:59:07.887363 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:07.887470 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 15:59:08.145505 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 15:59:08.147091 (Thread-1): 15:59:08 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 15:59:08.147326 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:08.147500 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 15:59:08.147588 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 15:59:08.352674 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:08.353094 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_products"
2021-04-27 15:59:08.356146 (Thread-1): finished collecting timing info
2021-04-27 15:59:08.356424 (Thread-1): On model.Dbt_demo.sat_products: Close
2021-04-27 15:59:08.556039 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a2f9b070>]}
2021-04-27 15:59:08.557493 (Thread-1): 15:59:08 | 17 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_products [INSERT 0 in 62.85s]
2021-04-27 15:59:08.557672 (Thread-1): Finished running node model.Dbt_demo.sat_products
2021-04-27 15:59:08.557849 (Thread-1): Began running node model.Dbt_demo.hub_customers
2021-04-27 15:59:08.558986 (Thread-1): 15:59:08 | 18 of 23 START incremental model SS_RAW_VLT.hub_customers............ [RUN]
2021-04-27 15:59:08.559480 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:08.559611 (Thread-1): Compiling model.Dbt_demo.hub_customers
2021-04-27 15:59:08.572967 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_customers"
2021-04-27 15:59:08.573297 (Thread-1): finished collecting timing info
2021-04-27 15:59:08.582589 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:08.582707 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT CUSTOMER_PK, CUSTOMERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 15:59:08.582813 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:59:10.556849 (Thread-1): SQL status: SUCCESS 1 in 1.97 seconds
2021-04-27 15:59:10.560450 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:10.560570 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
2021-04-27 15:59:10.725070 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-04-27 15:59:10.729061 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:10.729173 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-04-27 15:59:10.904919 (Thread-1): SQL status: SUCCESS 4 in 0.18 seconds
2021-04-27 15:59:10.909023 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:10.909147 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-04-27 15:59:11.083369 (Thread-1): SQL status: SUCCESS 4 in 0.17 seconds
2021-04-27 15:59:11.085061 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_customers"
2021-04-27 15:59:11.085848 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:11.085949 (Thread-1): On model.Dbt_demo.hub_customers: BEGIN
2021-04-27 15:59:11.635821 (Thread-1): SQL status: SUCCESS 1 in 0.55 seconds
2021-04-27 15:59:11.636003 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:11.636087 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers ("CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
        );
2021-04-27 15:59:12.023373 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-04-27 15:59:12.024535 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-04-27 15:59:12.024719 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 15:59:12.024808 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-04-27 15:59:12.267887 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 15:59:12.272452 (Thread-1): finished collecting timing info
2021-04-27 15:59:12.272731 (Thread-1): On model.Dbt_demo.hub_customers: Close
2021-04-27 15:59:12.519346 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a307b8b0>]}
2021-04-27 15:59:12.520862 (Thread-1): 15:59:12 | 18 of 23 OK created incremental model SS_RAW_VLT.hub_customers....... [SUCCESS 0 in 3.96s]
2021-04-27 15:59:12.521039 (Thread-1): Finished running node model.Dbt_demo.hub_customers
2021-04-27 15:59:12.521214 (Thread-1): Began running node model.Dbt_demo.sat_customers
2021-04-27 15:59:12.522563 (Thread-1): 15:59:12 | 19 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_customers. [RUN]
2021-04-27 15:59:12.522899 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:12.523023 (Thread-1): Compiling model.Dbt_demo.sat_customers
2021-04-27 15:59:12.544694 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_customers"
2021-04-27 15:59:12.545025 (Thread-1): finished collecting timing info
2021-04-27 15:59:12.553868 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:12.553979 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 15:59:12.554077 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 15:59:13.887301 (Thread-1): SQL status: SUCCESS 1 in 1.33 seconds
2021-04-27 15:59:13.890730 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:13.890849 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 08:59:13.200000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 08:59:13.200000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_customers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 15:59:14.259774 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-04-27 15:59:14.263718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:14.263840 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:14.421225 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:59:14.423685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:14.423792 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:14.606136 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 15:59:14.607585 (Thread-1): 15:59:14 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:14.612996 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:14.613110 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:14.762135 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:59:14.762317 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:14.762402 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:17.608058 (Thread-1): SQL status: SUCCESS 1 in 2.85 seconds
2021-04-27 15:59:17.611981 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:17.612095 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:17.836194 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-04-27 15:59:17.840639 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:17.840750 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:18.033852 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:59:18.036202 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:18.036310 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:18.590140 (Thread-1): SQL status: SUCCESS 0 in 0.55 seconds
2021-04-27 15:59:18.591455 (Thread-1): 15:59:18 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:18.591660 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:18.591835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:18.591923 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:18.919665 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-04-27 15:59:18.920778 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:18.920884 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:19.154988 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 15:59:19.156438 (Thread-1): 15:59:19 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:19.162158 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:19.162273 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:19.363492 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:19.363679 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:19.363764 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:21.133265 (Thread-1): SQL status: SUCCESS 1 in 1.77 seconds
2021-04-27 15:59:21.137214 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:21.137323 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:21.295327 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:59:21.301270 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:21.301379 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:21.882685 (Thread-1): SQL status: SUCCESS 12 in 0.58 seconds
2021-04-27 15:59:21.885018 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:21.885124 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:22.605432 (Thread-1): SQL status: SUCCESS 0 in 0.72 seconds
2021-04-27 15:59:22.606708 (Thread-1): 15:59:22 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:22.606909 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:22.607082 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:22.607198 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:22.827580 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:59:22.829054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:22.829161 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:22.950617 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:59:22.952059 (Thread-1): 15:59:22 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:22.957562 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:22.957670 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:23.328655 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-04-27 15:59:23.328838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:23.328923 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:24.505463 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-04-27 15:59:24.509666 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:24.509776 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:24.753635 (Thread-1): SQL status: SUCCESS 12 in 0.24 seconds
2021-04-27 15:59:24.758053 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:24.758164 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:24.904692 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:59:24.907267 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:24.907377 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:25.199433 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 15:59:25.200770 (Thread-1): 15:59:25 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:25.200982 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:25.201172 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:25.201277 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:25.701215 (Thread-1): SQL status: SUCCESS 1 in 0.50 seconds
2021-04-27 15:59:25.702338 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:25.702441 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:25.997532 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 15:59:25.998937 (Thread-1): 15:59:25 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:26.004690 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:26.004801 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:26.175723 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 15:59:26.175908 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:26.175992 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:27.157133 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-04-27 15:59:27.161102 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:27.161210 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:27.315038 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:59:27.319575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:27.319683 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:27.605048 (Thread-1): SQL status: SUCCESS 12 in 0.29 seconds
2021-04-27 15:59:27.607336 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:27.607444 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:27.879812 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 15:59:27.881095 (Thread-1): 15:59:27 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:27.881291 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:27.881463 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:27.881550 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:28.081723 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:28.083195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:28.083302 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:28.205571 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:59:28.206970 (Thread-1): 15:59:28 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:28.212325 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:28.212442 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:28.366544 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:59:28.366724 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:28.366808 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:29.415972 (Thread-1): SQL status: SUCCESS 1 in 1.05 seconds
2021-04-27 15:59:29.421507 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:29.421619 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:29.614566 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:59:29.618970 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:29.619079 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:29.772095 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:59:29.774389 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:29.774496 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:30.194184 (Thread-1): SQL status: SUCCESS 0 in 0.42 seconds
2021-04-27 15:59:30.195492 (Thread-1): 15:59:30 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:30.195693 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:30.195868 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:30.195955 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:30.412864 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:59:30.413958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:30.414060 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:30.537559 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:59:30.538952 (Thread-1): 15:59:30 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:30.544629 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:30.544735 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:31.044294 (Thread-1): SQL status: SUCCESS 1 in 0.50 seconds
2021-04-27 15:59:31.044468 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:31.044559 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:32.452838 (Thread-1): SQL status: SUCCESS 1 in 1.41 seconds
2021-04-27 15:59:32.456842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:32.456951 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:32.624115 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 15:59:32.628625 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:32.628732 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:33.313026 (Thread-1): SQL status: SUCCESS 12 in 0.68 seconds
2021-04-27 15:59:33.315337 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:33.315444 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:33.600955 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 15:59:33.602236 (Thread-1): 15:59:33 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:33.602435 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:33.602607 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:33.602693 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:33.814847 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:59:33.816369 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:33.816480 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:33.940821 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:59:33.942258 (Thread-1): 15:59:33 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:33.947683 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:33.947793 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:34.146179 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:34.146371 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:34.146460 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:35.534709 (Thread-1): SQL status: SUCCESS 1 in 1.39 seconds
2021-04-27 15:59:35.539008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:35.539149 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:35.694969 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:59:35.699514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:35.699630 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:35.827505 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:59:35.831896 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:35.832034 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:36.131139 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:59:36.132488 (Thread-1): 15:59:36 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:36.132714 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:36.132907 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:36.133001 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:36.342194 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:59:36.343335 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:36.343445 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:36.507863 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:59:36.509256 (Thread-1): 15:59:36 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:36.514950 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:36.515059 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:36.662066 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:59:36.662250 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:36.662335 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:37.602580 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 15:59:37.606736 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:37.606846 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:37.770691 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:59:37.775299 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:37.775409 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:37.907670 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:59:37.909956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:37.910062 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:38.171165 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 15:59:38.172449 (Thread-1): 15:59:38 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:38.172670 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:38.172842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:38.172928 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:38.374749 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:38.376258 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:38.376365 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:38.508091 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 15:59:38.509475 (Thread-1): 15:59:38 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:38.514792 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:38.514913 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:38.665731 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:59:38.665912 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:38.665998 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:39.662818 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 15:59:39.667073 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:39.667202 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:39.825192 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:59:39.922596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:39.922770 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:40.058448 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:59:40.060832 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:40.060945 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:40.356534 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:59:40.357855 (Thread-1): 15:59:40 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:40.358068 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:40.358252 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:40.358344 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:40.575837 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 15:59:40.576867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:40.576971 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:40.700593 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:59:40.701998 (Thread-1): 15:59:40 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:40.707371 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:40.707485 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:40.857219 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 15:59:40.857403 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:40.857489 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:42.106098 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-04-27 15:59:42.110002 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:42.110114 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:42.273326 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 15:59:42.279251 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:42.279359 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:42.414654 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:59:42.417023 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:42.417135 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:42.774396 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-04-27 15:59:42.775722 (Thread-1): 15:59:42 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:42.775925 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:42.776099 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:42.776191 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:42.978980 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:42.980104 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:42.980209 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:43.123406 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:59:43.125233 (Thread-1): 15:59:43 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:43.130541 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:43.130650 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:43.293374 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 15:59:43.293562 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:43.293650 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:44.466495 (Thread-1): SQL status: SUCCESS 1 in 1.17 seconds
2021-04-27 15:59:44.470495 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:44.470602 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:44.651822 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 15:59:44.656404 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:44.656536 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:44.803037 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 15:59:44.805364 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:44.805471 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:45.124888 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 15:59:45.126512 (Thread-1): 15:59:45 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:45.126728 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:45.126905 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:45.126991 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:45.338216 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 15:59:45.339327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:45.339432 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:45.832051 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-04-27 15:59:45.833453 (Thread-1): 15:59:45 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:45.839083 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:45.839208 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:46.107002 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 15:59:46.107211 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:46.107296 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:47.114264 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 15:59:47.118130 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:47.118238 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:47.300695 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 15:59:47.305061 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:47.305169 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:47.447502 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 15:59:47.449777 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:47.449889 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:47.753187 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:59:47.754476 (Thread-1): 15:59:47 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:47.754675 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:47.754848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:47.754935 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:47.953086 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 15:59:47.954201 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:47.954306 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:48.095585 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:59:48.097360 (Thread-1): 15:59:48 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:48.103013 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:48.103148 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:48.831253 (Thread-1): SQL status: SUCCESS 1 in 0.73 seconds
2021-04-27 15:59:48.831435 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:48.831521 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:49.772472 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 15:59:49.778018 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:49.778128 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:49.970307 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 15:59:49.974808 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:49.974922 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:50.385279 (Thread-1): SQL status: SUCCESS 12 in 0.41 seconds
2021-04-27 15:59:50.387601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:50.387708 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:50.676040 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 15:59:50.677610 (Thread-1): 15:59:50 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:50.677817 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:50.677988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:50.678075 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:50.909302 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 15:59:50.910404 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:50.910507 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:51.026381 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 15:59:51.027808 (Thread-1): 15:59:51 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:51.033151 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:51.033259 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:51.178102 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:59:51.178285 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:51.178371 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:55.478595 (Thread-1): SQL status: SUCCESS 1 in 4.30 seconds
2021-04-27 15:59:55.482588 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:55.482701 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:55.837970 (Thread-1): SQL status: SUCCESS 12 in 0.36 seconds
2021-04-27 15:59:55.842442 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:55.842550 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:55.976427 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:59:55.978769 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:55.978879 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:56.277194 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 15:59:56.278521 (Thread-1): 15:59:56 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:56.278733 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:56.278912 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:56.279004 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:56.540468 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 15:59:56.541563 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:56.541666 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 15:59:56.679768 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 15:59:56.681554 (Thread-1): 15:59:56 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_customers]
2021-04-27 15:59:56.686862 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:56.686968 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 15:59:56.866511 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 15:59:56.866713 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:56.866798 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 15:59:59.196374 (Thread-1): SQL status: SUCCESS 1 in 2.33 seconds
2021-04-27 15:59:59.200415 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:59.200539 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 15:59:59.382557 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 15:59:59.387098 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:59.387235 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 15:59:59.520949 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 15:59:59.523328 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:59.523441 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 15:59:59.947548 (Thread-1): SQL status: SUCCESS 0 in 0.42 seconds
2021-04-27 15:59:59.951048 (Thread-1): 15:59:59 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 15:59:59.951293 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 15:59:59.951472 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 15:59:59.951562 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:00.212566 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:00:00.213664 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:00.213771 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:00.346683 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:00:00.348122 (Thread-1): 16:00:00 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:00.353430 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:00.353542 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:00.704363 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 16:00:00.704546 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:00.704632 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:02.868330 (Thread-1): SQL status: SUCCESS 1 in 2.16 seconds
2021-04-27 16:00:02.872177 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:02.872303 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:03.502113 (Thread-1): SQL status: SUCCESS 12 in 0.63 seconds
2021-04-27 16:00:03.506588 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:03.506713 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:03.726596 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-04-27 16:00:03.728937 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:03.729043 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:04.563931 (Thread-1): SQL status: SUCCESS 0 in 0.83 seconds
2021-04-27 16:00:04.565258 (Thread-1): 16:00:04 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:04.565467 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:04.565646 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:04.565734 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:04.950909 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-04-27 16:00:04.952040 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:04.952145 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:05.074501 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:00:05.075954 (Thread-1): 16:00:05 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:05.081623 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:05.081733 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:05.556517 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-04-27 16:00:05.556698 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:05.556782 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:06.865829 (Thread-1): SQL status: SUCCESS 1 in 1.31 seconds
2021-04-27 16:00:06.869834 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:06.869945 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:08.544143 (Thread-1): SQL status: SUCCESS 12 in 1.67 seconds
2021-04-27 16:00:08.548675 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:08.548783 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:09.261620 (Thread-1): SQL status: SUCCESS 12 in 0.71 seconds
2021-04-27 16:00:09.263977 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:09.264095 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:12.246823 (Thread-1): SQL status: SUCCESS 0 in 2.98 seconds
2021-04-27 16:00:12.248157 (Thread-1): 16:00:12 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:12.248370 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:12.248549 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:12.248646 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:12.568717 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 16:00:12.570219 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:12.570333 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:13.182405 (Thread-1): SQL status: SUCCESS 1 in 0.61 seconds
2021-04-27 16:00:13.183888 (Thread-1): 16:00:13 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:13.189367 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:13.189479 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:13.370016 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:00:13.370200 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:13.370285 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:14.580226 (Thread-1): SQL status: SUCCESS 1 in 1.21 seconds
2021-04-27 16:00:14.584382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:14.584492 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:14.744316 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:00:14.750261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:14.750377 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:15.033982 (Thread-1): SQL status: SUCCESS 12 in 0.28 seconds
2021-04-27 16:00:15.036392 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:15.036505 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:15.401811 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-04-27 16:00:15.403095 (Thread-1): 16:00:15 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:15.403334 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:15.403512 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:15.403599 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:16.632868 (Thread-1): SQL status: SUCCESS 1 in 1.23 seconds
2021-04-27 16:00:16.633968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:16.634077 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:17.193171 (Thread-1): SQL status: SUCCESS 1 in 0.56 seconds
2021-04-27 16:00:17.194999 (Thread-1): 16:00:17 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:17.200300 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:17.200407 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:18.289977 (Thread-1): SQL status: SUCCESS 1 in 1.09 seconds
2021-04-27 16:00:18.290161 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:18.290245 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:19.381447 (Thread-1): SQL status: SUCCESS 1 in 1.09 seconds
2021-04-27 16:00:19.385646 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:19.385763 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:20.717796 (Thread-1): SQL status: SUCCESS 12 in 1.33 seconds
2021-04-27 16:00:20.722353 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:20.722470 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:20.853711 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:00:20.856053 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:20.856167 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:21.282497 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-04-27 16:00:21.284161 (Thread-1): 16:00:21 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:21.284368 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:21.284544 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:21.284632 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:23.311709 (Thread-1): SQL status: SUCCESS 1 in 2.03 seconds
2021-04-27 16:00:23.312819 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:23.312923 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:23.445884 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:00:23.447319 (Thread-1): 16:00:23 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:23.452976 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:23.453086 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:23.612673 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:00:23.612854 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:23.612946 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:25.161619 (Thread-1): SQL status: SUCCESS 1 in 1.55 seconds
2021-04-27 16:00:25.165630 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:25.165752 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:25.329253 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:00:25.333764 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:25.333904 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:25.599263 (Thread-1): SQL status: SUCCESS 12 in 0.27 seconds
2021-04-27 16:00:25.601574 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:25.601682 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:25.982910 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-04-27 16:00:25.984207 (Thread-1): 16:00:25 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:25.984410 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:25.984583 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:25.984670 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:26.399573 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-04-27 16:00:26.400674 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:26.400789 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:26.586735 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:00:26.588555 (Thread-1): 16:00:26 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:26.594216 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:26.594334 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:26.748214 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:00:26.748396 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:26.748481 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:27.747854 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 16:00:27.753459 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:27.753577 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:27.941005 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:00:27.945532 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:27.945647 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:28.988144 (Thread-1): SQL status: SUCCESS 12 in 1.04 seconds
2021-04-27 16:00:28.990423 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:28.990530 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:29.296247 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:00:29.297864 (Thread-1): 16:00:29 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:29.298071 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:29.298244 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:29.298344 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:29.698086 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:00:29.699229 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:29.699340 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:30.399878 (Thread-1): SQL status: SUCCESS 1 in 0.70 seconds
2021-04-27 16:00:30.401330 (Thread-1): 16:00:30 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:30.406750 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:30.406862 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:30.962257 (Thread-1): SQL status: SUCCESS 1 in 0.56 seconds
2021-04-27 16:00:30.962439 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:30.962525 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:35.936380 (Thread-1): SQL status: SUCCESS 1 in 4.97 seconds
2021-04-27 16:00:35.940344 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:35.940470 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:36.515537 (Thread-1): SQL status: SUCCESS 12 in 0.57 seconds
2021-04-27 16:00:36.519995 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:36.520112 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:36.694785 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:00:36.697154 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:36.697263 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:39.266404 (Thread-1): SQL status: SUCCESS 0 in 2.57 seconds
2021-04-27 16:00:39.267736 (Thread-1): 16:00:39 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:39.267940 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:39.268120 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:39.268209 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:39.507438 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:00:39.508541 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:39.508646 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:39.648849 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:00:39.650233 (Thread-1): 16:00:39 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:39.656042 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:39.656150 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:39.832998 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:00:39.833203 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:39.833292 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:41.241739 (Thread-1): SQL status: SUCCESS 1 in 1.41 seconds
2021-04-27 16:00:41.245865 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:41.245984 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:41.430922 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:00:41.435450 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:41.435563 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:41.586589 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:00:41.588896 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:41.589006 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:42.059888 (Thread-1): SQL status: SUCCESS 0 in 0.47 seconds
2021-04-27 16:00:42.061191 (Thread-1): 16:00:42 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:42.061393 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:42.061568 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:42.061655 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:42.337427 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:00:42.340630 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:42.340744 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:42.526715 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:00:42.528112 (Thread-1): 16:00:42 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:42.533387 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:42.533505 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:43.286736 (Thread-1): SQL status: SUCCESS 1 in 0.75 seconds
2021-04-27 16:00:43.286918 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:43.287005 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:44.935952 (Thread-1): SQL status: SUCCESS 1 in 1.65 seconds
2021-04-27 16:00:44.940064 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:44.940175 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:45.117260 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:00:45.121665 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:45.121790 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:45.938955 (Thread-1): SQL status: SUCCESS 12 in 0.82 seconds
2021-04-27 16:00:45.941481 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:45.941587 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:48.273625 (Thread-1): SQL status: SUCCESS 0 in 2.33 seconds
2021-04-27 16:00:48.274908 (Thread-1): 16:00:48 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:48.275159 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:48.275346 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:48.275439 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:48.672270 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:00:48.673382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:48.673486 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:00:48.840540 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:00:48.842306 (Thread-1): 16:00:48 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_customers]
2021-04-27 16:00:48.847956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:48.848064 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:00:49.321117 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-04-27 16:00:49.321299 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:49.321391 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:00:53.378316 (Thread-1): SQL status: SUCCESS 1 in 4.06 seconds
2021-04-27 16:00:53.382349 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:53.382463 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:00:53.637783 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-04-27 16:00:53.642285 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:53.642393 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:00:54.058127 (Thread-1): SQL status: SUCCESS 12 in 0.42 seconds
2021-04-27 16:00:54.060498 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:54.060612 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:00:54.381156 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:00:54.382755 (Thread-1): 16:00:54 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:00:54.382959 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:54.383155 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:00:54.383245 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:00:55.080779 (Thread-1): SQL status: SUCCESS 1 in 0.70 seconds
2021-04-27 16:00:55.081215 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_customers"
2021-04-27 16:00:55.084296 (Thread-1): finished collecting timing info
2021-04-27 16:00:55.084570 (Thread-1): On model.Dbt_demo.sat_customers: Close
2021-04-27 16:00:55.325689 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a2f1a370>]}
2021-04-27 16:00:55.327130 (Thread-1): 16:00:55 | 19 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_customers [INSERT 0 in 102.80s]
2021-04-27 16:00:55.327299 (Thread-1): Finished running node model.Dbt_demo.sat_customers
2021-04-27 16:00:55.327473 (Thread-1): Began running node model.Dbt_demo.hub_shippers
2021-04-27 16:00:55.328701 (Thread-1): 16:00:55 | 20 of 23 START incremental model SS_RAW_VLT.hub_shippers............. [RUN]
2021-04-27 16:00:55.329009 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:00:55.329137 (Thread-1): Compiling model.Dbt_demo.hub_shippers
2021-04-27 16:00:55.342241 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_shippers"
2021-04-27 16:00:55.342613 (Thread-1): finished collecting timing info
2021-04-27 16:00:55.352132 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:00:55.352298 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SHIPPER_PK, SHIPPERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SHIPPER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SHIPPER_PK, a.SHIPPERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers AS d
    ON a.SHIPPER_PK = d.SHIPPER_PK
    WHERE d.SHIPPER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:00:55.352403 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:00:59.436181 (Thread-1): SQL status: SUCCESS 1 in 4.08 seconds
2021-04-27 16:00:59.439741 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:00:59.439849 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
2021-04-27 16:01:00.253123 (Thread-1): SQL status: SUCCESS 4 in 0.81 seconds
2021-04-27 16:01:00.257080 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:01:00.257189 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-04-27 16:01:00.458375 (Thread-1): SQL status: SUCCESS 4 in 0.20 seconds
2021-04-27 16:01:00.462425 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:01:00.462539 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-04-27 16:01:00.605292 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-04-27 16:01:00.606961 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_shippers"
2021-04-27 16:01:00.607755 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:01:00.607856 (Thread-1): On model.Dbt_demo.hub_shippers: BEGIN
2021-04-27 16:01:01.091539 (Thread-1): SQL status: SUCCESS 1 in 0.48 seconds
2021-04-27 16:01:01.091732 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:01:01.091818 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers ("SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
        );
2021-04-27 16:01:01.920331 (Thread-1): SQL status: SUCCESS 0 in 0.83 seconds
2021-04-27 16:01:01.921501 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-04-27 16:01:01.921679 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:01:01.921769 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-04-27 16:01:02.227943 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 16:01:02.232636 (Thread-1): finished collecting timing info
2021-04-27 16:01:02.232942 (Thread-1): On model.Dbt_demo.hub_shippers: Close
2021-04-27 16:01:02.466270 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a3230c10>]}
2021-04-27 16:01:02.467765 (Thread-1): 16:01:02 | 20 of 23 OK created incremental model SS_RAW_VLT.hub_shippers........ [SUCCESS 0 in 7.14s]
2021-04-27 16:01:02.467939 (Thread-1): Finished running node model.Dbt_demo.hub_shippers
2021-04-27 16:01:02.468105 (Thread-1): Began running node model.Dbt_demo.sat_shippers
2021-04-27 16:01:02.469382 (Thread-1): 16:01:02 | 21 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_shippers.. [RUN]
2021-04-27 16:01:02.469699 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:02.469823 (Thread-1): Compiling model.Dbt_demo.sat_shippers
2021-04-27 16:01:02.489297 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_shippers"
2021-04-27 16:01:02.489667 (Thread-1): finished collecting timing info
2021-04-27 16:01:02.499148 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:02.499279 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 16:01:02.499394 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:01:03.575452 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-04-27 16:01:03.578962 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:03.579078 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 09:01:03.299000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 09:01:03.299000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_shippers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 16:01:04.595315 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-04-27 16:01:04.599169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:04.599278 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:04.876848 (Thread-1): SQL status: SUCCESS 7 in 0.28 seconds
2021-04-27 16:01:04.878956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:04.879065 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:05.067150 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:01:05.068853 (Thread-1): 16:01:05 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:05.073888 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:05.074002 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:05.725275 (Thread-1): SQL status: SUCCESS 1 in 0.65 seconds
2021-04-27 16:01:05.725460 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:05.725549 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:08.263903 (Thread-1): SQL status: SUCCESS 1 in 2.54 seconds
2021-04-27 16:01:08.267972 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:08.268083 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:08.544291 (Thread-1): SQL status: SUCCESS 7 in 0.28 seconds
2021-04-27 16:01:08.548327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:08.548448 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:08.892372 (Thread-1): SQL status: SUCCESS 7 in 0.34 seconds
2021-04-27 16:01:08.894303 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:08.894409 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:09.379219 (Thread-1): SQL status: SUCCESS 0 in 0.48 seconds
2021-04-27 16:01:09.380513 (Thread-1): 16:01:09 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:09.380719 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:09.380893 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:09.380980 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:10.237576 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-04-27 16:01:10.238656 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:10.238760 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:10.391887 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:01:10.393648 (Thread-1): 16:01:10 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:10.398973 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:10.399084 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:10.582590 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:01:10.582780 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:10.582865 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:13.003639 (Thread-1): SQL status: SUCCESS 1 in 2.42 seconds
2021-04-27 16:01:13.008762 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:13.008881 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:13.192080 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-04-27 16:01:13.196250 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:13.196364 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:13.570173 (Thread-1): SQL status: SUCCESS 7 in 0.37 seconds
2021-04-27 16:01:13.572151 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:13.572263 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:14.392999 (Thread-1): SQL status: SUCCESS 0 in 0.82 seconds
2021-04-27 16:01:14.394324 (Thread-1): 16:01:14 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:14.394533 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:14.394723 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:14.394816 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:14.628216 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:01:14.629349 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:14.629458 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:14.785285 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:01:14.786690 (Thread-1): 16:01:14 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:14.792023 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:14.792137 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:15.260135 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-04-27 16:01:15.260319 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:15.260407 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:17.424711 (Thread-1): SQL status: SUCCESS 1 in 2.16 seconds
2021-04-27 16:01:17.428785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:17.428901 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:17.883771 (Thread-1): SQL status: SUCCESS 7 in 0.45 seconds
2021-04-27 16:01:17.887812 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:17.887926 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:18.208881 (Thread-1): SQL status: SUCCESS 7 in 0.32 seconds
2021-04-27 16:01:18.210835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:18.210946 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:18.547946 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 16:01:18.549579 (Thread-1): 16:01:18 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:18.549801 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:18.549982 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:18.550073 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:19.217404 (Thread-1): SQL status: SUCCESS 1 in 0.67 seconds
2021-04-27 16:01:19.218519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:19.218629 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:19.968231 (Thread-1): SQL status: SUCCESS 1 in 0.75 seconds
2021-04-27 16:01:19.969672 (Thread-1): 16:01:19 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:19.975178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:19.975292 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:20.245011 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:01:20.245198 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:20.245284 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:23.155336 (Thread-1): SQL status: SUCCESS 1 in 2.91 seconds
2021-04-27 16:01:23.159368 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:23.159491 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:23.327745 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:01:23.331873 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:23.331988 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:23.473276 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:01:23.475208 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:23.475315 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:25.900049 (Thread-1): SQL status: SUCCESS 0 in 2.42 seconds
2021-04-27 16:01:25.903145 (Thread-1): 16:01:25 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:25.903351 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:25.903519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:25.903603 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:26.129087 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:01:26.130179 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:26.130289 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:26.271086 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:01:26.272508 (Thread-1): 16:01:26 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:26.277835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:26.277945 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:26.466895 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:01:26.467076 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:26.467193 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:28.368170 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2021-04-27 16:01:28.372066 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:28.372177 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:29.367696 (Thread-1): SQL status: SUCCESS 7 in 1.00 seconds
2021-04-27 16:01:29.371915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:29.372040 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:29.830262 (Thread-1): SQL status: SUCCESS 7 in 0.46 seconds
2021-04-27 16:01:29.832224 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:29.832343 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:30.148980 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:01:30.150241 (Thread-1): 16:01:30 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:30.150443 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:30.150622 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:30.150709 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:32.178879 (Thread-1): SQL status: SUCCESS 1 in 2.03 seconds
2021-04-27 16:01:32.179987 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:32.180092 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:32.628122 (Thread-1): SQL status: SUCCESS 1 in 0.45 seconds
2021-04-27 16:01:32.629509 (Thread-1): 16:01:32 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:32.634800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:32.634914 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:33.507775 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-04-27 16:01:33.507955 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:33.508040 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:37.426166 (Thread-1): SQL status: SUCCESS 1 in 3.92 seconds
2021-04-27 16:01:37.430248 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:37.430367 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:38.048339 (Thread-1): SQL status: SUCCESS 7 in 0.62 seconds
2021-04-27 16:01:38.052530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:38.052651 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:38.395045 (Thread-1): SQL status: SUCCESS 7 in 0.34 seconds
2021-04-27 16:01:38.396967 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:38.397072 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:40.181490 (Thread-1): SQL status: SUCCESS 0 in 1.78 seconds
2021-04-27 16:01:40.182773 (Thread-1): 16:01:40 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:40.182979 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:40.183199 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:40.183294 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:40.413514 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:01:40.414970 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:40.415078 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:40.829552 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-04-27 16:01:40.830957 (Thread-1): 16:01:40 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:40.836008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:40.836117 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:41.213822 (Thread-1): SQL status: SUCCESS 1 in 0.38 seconds
2021-04-27 16:01:41.214019 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:41.214109 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:45.458041 (Thread-1): SQL status: SUCCESS 1 in 4.24 seconds
2021-04-27 16:01:45.463488 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:45.463607 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:46.358669 (Thread-1): SQL status: SUCCESS 7 in 0.89 seconds
2021-04-27 16:01:46.362774 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:46.362885 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:46.504781 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:01:46.506924 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:46.507031 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:46.903305 (Thread-1): SQL status: SUCCESS 0 in 0.40 seconds
2021-04-27 16:01:46.904576 (Thread-1): 16:01:46 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:46.904795 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:46.904973 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:46.905059 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:47.119750 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:01:47.120832 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:47.120936 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:47.365729 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:01:47.367632 (Thread-1): 16:01:47 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:47.373025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:47.373134 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:47.654467 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:01:47.654651 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:47.654736 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:48.967280 (Thread-1): SQL status: SUCCESS 1 in 1.31 seconds
2021-04-27 16:01:48.971336 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:48.971454 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:49.165337 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-04-27 16:01:49.169352 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:49.169462 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:49.393511 (Thread-1): SQL status: SUCCESS 7 in 0.22 seconds
2021-04-27 16:01:49.395444 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:49.395552 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:49.713439 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:01:49.715027 (Thread-1): 16:01:49 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:49.715253 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:49.715427 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:49.715511 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:50.463762 (Thread-1): SQL status: SUCCESS 1 in 0.75 seconds
2021-04-27 16:01:50.464864 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:50.464966 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:50.602821 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:01:50.604248 (Thread-1): 16:01:50 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:50.609983 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:50.610093 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:50.800658 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:01:50.800842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:50.800927 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:51.679802 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-04-27 16:01:51.683656 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:51.683768 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:51.901404 (Thread-1): SQL status: SUCCESS 7 in 0.22 seconds
2021-04-27 16:01:52.065629 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:52.065788 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:52.367814 (Thread-1): SQL status: SUCCESS 7 in 0.30 seconds
2021-04-27 16:01:52.369732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:52.369838 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:52.690216 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:01:52.691804 (Thread-1): 16:01:52 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:52.692005 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:52.692174 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:52.692260 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:52.964080 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:01:52.965192 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:52.965296 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:53.129217 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:01:53.130625 (Thread-1): 16:01:53 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:53.137723 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:53.137835 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:53.306880 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:01:53.307066 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:53.307180 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:01:55.602126 (Thread-1): SQL status: SUCCESS 1 in 2.29 seconds
2021-04-27 16:01:55.606072 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:55.606181 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:01:55.773513 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:01:55.777682 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:55.777789 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:01:56.175733 (Thread-1): SQL status: SUCCESS 7 in 0.40 seconds
2021-04-27 16:01:56.177640 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:56.177746 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:01:57.421553 (Thread-1): SQL status: SUCCESS 0 in 1.24 seconds
2021-04-27 16:01:57.422813 (Thread-1): 16:01:57 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:57.423021 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:57.423227 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:57.423325 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:01:58.219585 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-04-27 16:01:58.221009 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:58.221113 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:01:58.472670 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:01:58.474114 (Thread-1): 16:01:58 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_shippers]
2021-04-27 16:01:58.479254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:58.479366 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:01:59.526422 (Thread-1): SQL status: SUCCESS 1 in 1.05 seconds
2021-04-27 16:01:59.526602 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:01:59.526699 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:00.918670 (Thread-1): SQL status: SUCCESS 1 in 1.39 seconds
2021-04-27 16:02:00.922933 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:00.923047 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:01.310717 (Thread-1): SQL status: SUCCESS 7 in 0.39 seconds
2021-04-27 16:02:01.314785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:01.314894 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:01.529119 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-04-27 16:02:01.531312 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:01.531436 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:02.148100 (Thread-1): SQL status: SUCCESS 0 in 0.62 seconds
2021-04-27 16:02:02.149390 (Thread-1): 16:02:02 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:02.149595 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:02.149768 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:02.149854 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:02.590986 (Thread-1): SQL status: SUCCESS 1 in 0.44 seconds
2021-04-27 16:02:02.592126 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:02.592231 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:02.937660 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 16:02:02.939538 (Thread-1): 16:02:02 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:02.944867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:02.944976 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:03.297549 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 16:02:03.297736 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:03.297821 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:04.324894 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 16:02:04.328909 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:04.329016 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:04.997088 (Thread-1): SQL status: SUCCESS 7 in 0.67 seconds
2021-04-27 16:02:05.002695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:05.002846 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:05.179464 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-04-27 16:02:05.181380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:05.181485 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:06.283507 (Thread-1): SQL status: SUCCESS 0 in 1.10 seconds
2021-04-27 16:02:06.284776 (Thread-1): 16:02:06 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:06.284977 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:06.285148 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:06.285245 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:06.563924 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:02:06.565375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:06.565484 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:06.725308 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:02:06.726703 (Thread-1): 16:02:06 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:06.731734 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:06.731841 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:06.897547 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:02:06.897724 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:06.897808 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:07.789521 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-04-27 16:02:07.793324 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:07.793432 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:07.983930 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-04-27 16:02:07.988010 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:07.988120 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:08.319366 (Thread-1): SQL status: SUCCESS 7 in 0.33 seconds
2021-04-27 16:02:08.321277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:08.321384 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:09.025467 (Thread-1): SQL status: SUCCESS 0 in 0.70 seconds
2021-04-27 16:02:09.026752 (Thread-1): 16:02:09 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:09.026966 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:09.027193 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:09.027285 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:09.274529 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:02:09.275664 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:09.275768 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:09.426155 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:02:09.427998 (Thread-1): 16:02:09 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:09.433028 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:09.433140 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:09.606496 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:02:09.606682 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:09.606767 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:11.372187 (Thread-1): SQL status: SUCCESS 1 in 1.77 seconds
2021-04-27 16:02:11.376280 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:11.376418 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:11.561591 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-04-27 16:02:11.565605 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:11.565717 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:11.806019 (Thread-1): SQL status: SUCCESS 7 in 0.24 seconds
2021-04-27 16:02:11.807974 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:11.808083 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:12.220159 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-04-27 16:02:12.221808 (Thread-1): 16:02:12 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:12.222021 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:12.222206 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:12.222298 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:12.493880 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:02:12.494975 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:12.495079 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:12.675674 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:02:12.677132 (Thread-1): 16:02:12 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:12.682525 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:12.682635 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:12.868459 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:02:12.868642 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:12.868727 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:14.288929 (Thread-1): SQL status: SUCCESS 1 in 1.42 seconds
2021-04-27 16:02:14.294388 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:14.294506 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:14.466265 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:02:14.470517 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:14.470627 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:14.653137 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-04-27 16:02:14.655074 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:14.655225 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:15.033657 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-04-27 16:02:15.034952 (Thread-1): 16:02:15 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:15.035176 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:15.035351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:15.035445 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:15.259478 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:02:15.260575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:15.260680 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:15.418314 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:02:15.419693 (Thread-1): 16:02:15 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:15.424729 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:15.424868 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:15.739157 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 16:02:15.739344 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:15.739430 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:16.668177 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-04-27 16:02:16.672304 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:16.672416 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:16.843485 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:02:16.847567 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:16.847677 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:17.054088 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-04-27 16:02:17.056069 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:17.056182 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:17.466717 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-04-27 16:02:17.467978 (Thread-1): 16:02:17 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:17.468181 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:17.468356 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:17.468456 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:17.706361 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:02:17.707481 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:17.707584 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:17.964014 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:02:17.965456 (Thread-1): 16:02:17 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:17.970999 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:17.971131 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:18.766877 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-04-27 16:02:18.767058 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:18.767187 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:22.456352 (Thread-1): SQL status: SUCCESS 1 in 3.69 seconds
2021-04-27 16:02:22.460329 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:22.460441 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:23.105269 (Thread-1): SQL status: SUCCESS 7 in 0.64 seconds
2021-04-27 16:02:23.109502 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:23.109612 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:23.594383 (Thread-1): SQL status: SUCCESS 7 in 0.48 seconds
2021-04-27 16:02:23.596332 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:23.596458 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:24.894841 (Thread-1): SQL status: SUCCESS 0 in 1.30 seconds
2021-04-27 16:02:24.896168 (Thread-1): 16:02:24 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:24.896374 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:24.896548 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:24.896635 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:25.110880 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:02:25.114178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:25.114303 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:25.553938 (Thread-1): SQL status: SUCCESS 1 in 0.44 seconds
2021-04-27 16:02:25.555375 (Thread-1): 16:02:25 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:25.560376 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:25.560482 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:25.728923 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:02:25.729104 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:25.729189 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:28.720389 (Thread-1): SQL status: SUCCESS 1 in 2.99 seconds
2021-04-27 16:02:28.724695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:28.724825 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:29.217667 (Thread-1): SQL status: SUCCESS 7 in 0.49 seconds
2021-04-27 16:02:29.221744 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:29.221857 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:29.476912 (Thread-1): SQL status: SUCCESS 7 in 0.25 seconds
2021-04-27 16:02:29.478897 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:29.479005 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:29.818711 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 16:02:29.820032 (Thread-1): 16:02:29 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:29.820233 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:29.820405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:29.820491 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:30.043342 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:02:30.044486 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:30.044603 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:30.181454 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:02:30.183313 (Thread-1): 16:02:30 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:30.188342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:30.188452 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:30.867701 (Thread-1): SQL status: SUCCESS 1 in 0.68 seconds
2021-04-27 16:02:30.867885 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:30.867972 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:32.211504 (Thread-1): SQL status: SUCCESS 1 in 1.34 seconds
2021-04-27 16:02:32.215493 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:32.215606 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:33.056681 (Thread-1): SQL status: SUCCESS 7 in 0.84 seconds
2021-04-27 16:02:33.060698 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:33.060807 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:33.213990 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:02:33.215945 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:33.216056 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:34.740377 (Thread-1): SQL status: SUCCESS 0 in 1.52 seconds
2021-04-27 16:02:34.741973 (Thread-1): 16:02:34 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:34.742175 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:34.742346 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:34.742433 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:35.036679 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 16:02:35.037804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:35.037909 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:35.216408 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:02:35.217832 (Thread-1): 16:02:35 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:35.223300 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:35.223407 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:35.712095 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-04-27 16:02:35.712279 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:35.712365 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:36.728617 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-04-27 16:02:36.732543 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:36.732653 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:36.902618 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:02:36.908345 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:36.908563 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:37.051514 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:02:37.053407 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:37.053512 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:38.249391 (Thread-1): SQL status: SUCCESS 0 in 1.20 seconds
2021-04-27 16:02:38.250665 (Thread-1): 16:02:38 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:38.250864 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:38.251043 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:38.251157 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:39.196468 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:02:39.197574 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:39.197680 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:39.347726 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:02:39.349123 (Thread-1): 16:02:39 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:39.354281 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:39.354391 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:39.520453 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:02:39.520642 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:39.520732 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:42.901413 (Thread-1): SQL status: SUCCESS 1 in 3.38 seconds
2021-04-27 16:02:42.905576 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:42.905686 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:43.078240 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:02:43.082327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:43.082434 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:43.236560 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:02:43.238480 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:43.238587 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:43.659350 (Thread-1): SQL status: SUCCESS 0 in 0.42 seconds
2021-04-27 16:02:43.660614 (Thread-1): 16:02:43 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:43.660820 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:43.660995 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:43.661085 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:43.996063 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-04-27 16:02:43.997206 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:43.997314 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:44.135010 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:02:44.136440 (Thread-1): 16:02:44 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:44.141843 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:44.141957 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:44.421838 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:02:44.422020 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:44.422105 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:46.617364 (Thread-1): SQL status: SUCCESS 1 in 2.20 seconds
2021-04-27 16:02:46.621337 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:46.621447 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:46.977474 (Thread-1): SQL status: SUCCESS 7 in 0.36 seconds
2021-04-27 16:02:46.981685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:46.981793 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:47.191441 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-04-27 16:02:47.193363 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:47.193469 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:48.116349 (Thread-1): SQL status: SUCCESS 0 in 0.92 seconds
2021-04-27 16:02:48.117630 (Thread-1): 16:02:48 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:48.117841 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:48.118018 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:48.118105 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:48.365592 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:02:48.367159 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:48.367273 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:48.496254 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:02:48.497701 (Thread-1): 16:02:48 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:48.502842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:48.502960 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:48.849108 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 16:02:48.849293 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:48.849383 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:49.772582 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-04-27 16:02:49.778244 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:49.778353 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:49.953184 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:02:49.957253 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:49.957380 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:50.106082 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:02:50.108055 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:50.108161 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:50.392393 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:02:50.393737 (Thread-1): 16:02:50 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:50.393950 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:50.394138 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:50.394230 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:50.696738 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-04-27 16:02:50.697836 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:50.697940 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:50.843531 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:02:50.845333 (Thread-1): 16:02:50 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:50.850358 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:50.850467 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:51.236228 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-04-27 16:02:51.236406 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:51.236492 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:52.250570 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:02:52.254543 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:52.254657 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:52.465308 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-04-27 16:02:52.469318 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:52.469428 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:52.675900 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-04-27 16:02:52.677829 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:52.677934 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:53.466204 (Thread-1): SQL status: SUCCESS 0 in 0.79 seconds
2021-04-27 16:02:53.467860 (Thread-1): 16:02:53 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:53.468069 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:53.468246 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:53.468334 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:53.755225 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 16:02:53.756319 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:53.756422 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:02:53.886495 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:02:53.887925 (Thread-1): 16:02:53 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:53.893309 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:53.893420 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:02:54.063999 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:02:54.064180 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:54.064272 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:02:54.993519 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-04-27 16:02:54.997409 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:54.997519 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:02:55.177162 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-04-27 16:02:55.181238 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:55.183195 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:02:55.321775 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:02:55.323713 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:55.323821 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:02:55.812286 (Thread-1): SQL status: SUCCESS 0 in 0.49 seconds
2021-04-27 16:02:55.813550 (Thread-1): 16:02:55 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:02:55.813762 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:55.813934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:02:55.814020 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:02:56.114773 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-04-27 16:02:56.115217 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_shippers"
2021-04-27 16:02:56.118285 (Thread-1): finished collecting timing info
2021-04-27 16:02:56.118564 (Thread-1): On model.Dbt_demo.sat_shippers: Close
2021-04-27 16:02:56.414774 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a314a700>]}
2021-04-27 16:02:56.416247 (Thread-1): 16:02:56 | 21 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_shippers [INSERT 0 in 113.94s]
2021-04-27 16:02:56.416415 (Thread-1): Finished running node model.Dbt_demo.sat_shippers
2021-04-27 16:02:56.416577 (Thread-1): Began running node model.Dbt_demo.hub_suppliers
2021-04-27 16:02:56.417816 (Thread-1): 16:02:56 | 22 of 23 START incremental model SS_RAW_VLT.hub_suppliers............ [RUN]
2021-04-27 16:02:56.418121 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:02:56.418249 (Thread-1): Compiling model.Dbt_demo.hub_suppliers
2021-04-27 16:02:56.431156 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_suppliers"
2021-04-27 16:02:56.431481 (Thread-1): finished collecting timing info
2021-04-27 16:02:56.439021 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:02:56.439153 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SUPPLIER_PK, SUPPLIERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers AS d
    ON a.SUPPLIER_PK = d.SUPPLIER_PK
    WHERE d.SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:02:56.439259 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:02:58.749347 (Thread-1): SQL status: SUCCESS 1 in 2.31 seconds
2021-04-27 16:02:58.753007 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:02:58.753123 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
2021-04-27 16:02:59.259522 (Thread-1): SQL status: SUCCESS 4 in 0.51 seconds
2021-04-27 16:02:59.263566 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:02:59.263682 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-04-27 16:02:59.654924 (Thread-1): SQL status: SUCCESS 4 in 0.39 seconds
2021-04-27 16:02:59.658786 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:02:59.658899 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-04-27 16:02:59.827533 (Thread-1): SQL status: SUCCESS 4 in 0.17 seconds
2021-04-27 16:02:59.829183 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_suppliers"
2021-04-27 16:02:59.829953 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:02:59.830052 (Thread-1): On model.Dbt_demo.hub_suppliers: BEGIN
2021-04-27 16:02:59.993244 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:02:59.993430 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:02:59.993518 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers ("SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
        );
2021-04-27 16:03:00.282453 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:03:00.283647 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-04-27 16:03:00.283825 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:03:00.283922 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-04-27 16:03:00.648339 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-04-27 16:03:00.652556 (Thread-1): finished collecting timing info
2021-04-27 16:03:00.652827 (Thread-1): On model.Dbt_demo.hub_suppliers: Close
2021-04-27 16:03:01.015724 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a31ca430>]}
2021-04-27 16:03:01.017153 (Thread-1): 16:03:01 | 22 of 23 OK created incremental model SS_RAW_VLT.hub_suppliers....... [SUCCESS 0 in 4.60s]
2021-04-27 16:03:01.017320 (Thread-1): Finished running node model.Dbt_demo.hub_suppliers
2021-04-27 16:03:01.017484 (Thread-1): Began running node model.Dbt_demo.sat_suppliers
2021-04-27 16:03:01.018724 (Thread-1): 16:03:01 | 23 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_suppliers. [RUN]
2021-04-27 16:03:01.019028 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:01.019169 (Thread-1): Compiling model.Dbt_demo.sat_suppliers
2021-04-27 16:03:01.042572 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_suppliers"
2021-04-27 16:03:01.042906 (Thread-1): finished collecting timing info
2021-04-27 16:03:01.051143 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:01.051266 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 16:03:01.051371 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:03:01.962580 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-04-27 16:03:01.965922 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:01.966029 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 09:03:01.717000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 09:03:01.717000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_suppliers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 16:03:03.145597 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-04-27 16:03:03.149533 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:03.149656 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:03.321188 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:03.323638 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:03.323749 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:03.702159 (Thread-1): SQL status: SUCCESS 1 in 0.38 seconds
2021-04-27 16:03:03.703602 (Thread-1): 16:03:03 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:03.709373 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:03.709483 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:04.197968 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-04-27 16:03:04.198152 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:04.198237 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:08.359560 (Thread-1): SQL status: SUCCESS 1 in 4.16 seconds
2021-04-27 16:03:08.363538 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:08.363659 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:08.532630 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:08.538254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:08.538364 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:08.961730 (Thread-1): SQL status: SUCCESS 12 in 0.42 seconds
2021-04-27 16:03:08.964123 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:08.964232 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:09.900515 (Thread-1): SQL status: SUCCESS 0 in 0.94 seconds
2021-04-27 16:03:09.901801 (Thread-1): 16:03:09 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:09.902006 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:09.902179 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:09.902265 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:10.220819 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 16:03:10.222280 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:10.222387 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:10.355749 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:03:10.357182 (Thread-1): 16:03:10 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:10.362590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:10.362699 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:10.510463 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:03:10.510650 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:10.510734 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:12.091621 (Thread-1): SQL status: SUCCESS 1 in 1.58 seconds
2021-04-27 16:03:12.095351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:12.095459 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:12.483953 (Thread-1): SQL status: SUCCESS 12 in 0.39 seconds
2021-04-27 16:03:12.488341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:12.488456 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:12.629975 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:03:12.632297 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:12.632405 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:13.027289 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-04-27 16:03:13.028581 (Thread-1): 16:03:13 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:13.028785 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:13.028965 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:13.029052 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:13.593526 (Thread-1): SQL status: SUCCESS 1 in 0.56 seconds
2021-04-27 16:03:13.594651 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:13.594755 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:13.766162 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:03:13.767635 (Thread-1): 16:03:13 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:13.773696 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:13.773809 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:13.950987 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:03:13.951192 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:13.951280 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:17.030884 (Thread-1): SQL status: SUCCESS 1 in 3.08 seconds
2021-04-27 16:03:17.034835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:17.034943 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:17.205404 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:17.209872 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:17.209990 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:17.483095 (Thread-1): SQL status: SUCCESS 12 in 0.27 seconds
2021-04-27 16:03:17.485399 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:17.485505 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:18.039064 (Thread-1): SQL status: SUCCESS 0 in 0.55 seconds
2021-04-27 16:03:18.040702 (Thread-1): 16:03:18 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:18.040909 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:18.041078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:18.041165 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:18.257919 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:03:18.259004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:18.259143 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:18.391707 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:03:18.393101 (Thread-1): 16:03:18 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:18.400478 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:18.400589 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:18.629410 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:03:18.629592 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:18.629682 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:19.570179 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 16:03:19.574050 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:19.574174 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:19.839053 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-04-27 16:03:19.843580 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:19.843692 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:20.101672 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-04-27 16:03:20.103972 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:20.104085 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:20.414942 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:03:20.416250 (Thread-1): 16:03:20 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:20.416460 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:20.416635 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:20.416722 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:20.615666 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:03:20.616767 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:20.616871 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:20.784070 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:03:20.785477 (Thread-1): 16:03:20 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:20.791059 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:20.791195 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:20.934801 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:03:20.934981 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:20.935067 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:22.177112 (Thread-1): SQL status: SUCCESS 1 in 1.24 seconds
2021-04-27 16:03:22.181309 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:22.181418 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:22.338047 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:03:22.342437 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:22.342544 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:22.483003 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:03:22.485286 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:22.485392 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:22.807468 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:03:22.808690 (Thread-1): 16:03:22 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:22.808893 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:22.809066 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:22.809155 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:23.064491 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:03:23.065609 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:23.065723 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:23.199596 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:03:23.201016 (Thread-1): 16:03:23 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:23.206749 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:23.206865 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:23.353646 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:03:23.353833 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:23.353919 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:24.368479 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:03:24.372415 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:24.372527 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:24.524862 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:03:24.531004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:24.531144 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:24.666654 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:03:24.668971 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:24.669079 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:24.988213 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:03:24.989497 (Thread-1): 16:03:24 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:24.989700 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:24.989874 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:24.989969 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:25.213986 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:03:25.215484 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:25.215592 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:25.354306 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:03:25.355744 (Thread-1): 16:03:25 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:25.361329 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:25.361440 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:25.513612 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:03:25.513802 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:25.513888 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:26.623528 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-04-27 16:03:26.627732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:26.627845 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:26.798470 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:26.802884 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:26.802997 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:26.937771 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:03:26.940323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:26.940431 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:27.245128 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:03:27.246418 (Thread-1): 16:03:27 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:27.246616 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:27.246790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:27.246877 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:27.464178 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:03:27.465267 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:27.465372 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:27.588360 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:03:27.590166 (Thread-1): 16:03:27 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:27.595519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:27.595632 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:27.757973 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:03:27.758156 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:27.758241 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:28.730215 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:03:28.734170 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:28.734278 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:28.916768 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:03:28.920998 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:28.921105 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:29.060085 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:03:29.062447 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:29.062555 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:29.336921 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:03:29.338571 (Thread-1): 16:03:29 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:29.338784 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:29.338968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:29.339060 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:29.547594 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:03:29.548695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:29.548801 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:29.676111 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:03:29.677534 (Thread-1): 16:03:29 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:29.683295 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:29.683405 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:29.829178 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:03:29.829380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:29.829473 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:30.689574 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-04-27 16:03:30.695123 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:30.695242 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:30.862595 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:30.958889 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:30.959053 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:31.107847 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:03:31.110187 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:31.110299 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:31.381759 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:03:31.383450 (Thread-1): 16:03:31 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:31.383668 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:31.383852 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:31.383945 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:31.605421 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:03:31.606562 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:31.606673 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:31.751008 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:03:31.752504 (Thread-1): 16:03:31 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:31.758382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:31.758505 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:31.947900 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:03:31.948089 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:31.948184 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:32.922828 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:03:32.926848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:32.926969 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:33.097504 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:33.102158 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:33.102274 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:33.261584 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:03:33.263931 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:33.264044 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:33.582603 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:03:33.583957 (Thread-1): 16:03:33 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:33.584171 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:33.584350 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:33.584449 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:33.786629 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:03:33.787807 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:33.787918 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:33.932597 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:03:33.933988 (Thread-1): 16:03:33 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:33.939402 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:33.939513 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:34.093843 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:03:34.094025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:34.094110 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:35.099532 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:03:35.103686 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:35.103797 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:35.265699 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:03:35.270033 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:35.270140 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:35.401445 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:03:35.403732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:35.403840 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:35.731665 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-04-27 16:03:35.733239 (Thread-1): 16:03:35 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:35.733441 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:35.733614 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:35.733702 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:35.964039 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:03:35.965124 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:35.965228 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:36.138202 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:03:36.139645 (Thread-1): 16:03:36 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:36.147148 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:36.147259 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:36.304244 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:03:36.304424 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:36.304508 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:37.289517 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-04-27 16:03:37.293406 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:37.293513 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:37.442911 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:03:37.447439 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:37.447553 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:37.608853 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:03:37.611153 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:37.611259 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:37.890400 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:03:37.891708 (Thread-1): 16:03:37 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:37.891913 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:37.892088 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:37.892176 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:38.921564 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 16:03:38.922659 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:38.922762 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:39.056296 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:03:39.057697 (Thread-1): 16:03:39 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:39.063081 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:39.063211 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:39.223794 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:03:39.223977 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:39.224064 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:43.211927 (Thread-1): SQL status: SUCCESS 1 in 3.99 seconds
2021-04-27 16:03:43.216117 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:43.216230 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:43.373760 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:03:43.378090 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:43.378197 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:43.516908 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:03:43.519314 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:43.519434 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:43.863797 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 16:03:43.865399 (Thread-1): 16:03:43 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:43.865603 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:43.865787 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:43.865876 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:44.668653 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-04-27 16:03:44.669746 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:44.669850 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:44.802130 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:03:44.803543 (Thread-1): 16:03:44 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:44.809288 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:44.809396 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:44.966488 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:03:44.966668 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:44.966760 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:46.074898 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-04-27 16:03:46.078811 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:46.078920 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:46.248532 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:46.254706 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:46.254817 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:46.380370 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:03:46.382670 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:46.382776 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:47.104906 (Thread-1): SQL status: SUCCESS 0 in 0.72 seconds
2021-04-27 16:03:47.106181 (Thread-1): 16:03:47 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:47.106382 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:47.106554 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:47.106640 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:47.325388 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:03:47.326535 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:47.326640 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:47.536462 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:03:47.537845 (Thread-1): 16:03:47 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:47.543297 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:47.543412 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:47.697150 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:03:47.697338 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:47.697427 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:48.758852 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-04-27 16:03:48.763068 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:48.763206 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:48.945264 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:03:48.949658 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:48.949784 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:49.094236 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:03:49.096546 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:49.096656 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:49.393840 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:03:49.395470 (Thread-1): 16:03:49 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:49.395678 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:49.395856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:49.395947 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:49.715838 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 16:03:49.716943 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:49.717046 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:49.845126 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:03:49.846517 (Thread-1): 16:03:49 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:49.852646 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:49.852755 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:50.124878 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:03:50.125062 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:50.125149 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:52.254924 (Thread-1): SQL status: SUCCESS 1 in 2.13 seconds
2021-04-27 16:03:52.258980 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:52.259095 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:52.428101 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:03:52.432638 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:52.432746 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:52.579901 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:03:52.582179 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:52.582289 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:53.210371 (Thread-1): SQL status: SUCCESS 0 in 0.63 seconds
2021-04-27 16:03:53.211683 (Thread-1): 16:03:53 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:53.211888 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:53.212064 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:53.212151 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:53.611396 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:03:53.612506 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:53.612618 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:53.881064 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:03:53.882453 (Thread-1): 16:03:53 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:53.887834 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:53.887953 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:54.060894 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:03:54.061078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:54.061166 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:57.091970 (Thread-1): SQL status: SUCCESS 1 in 3.03 seconds
2021-04-27 16:03:57.097628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:57.097738 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:57.311887 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-04-27 16:03:57.316275 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:57.316391 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:57.519366 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 16:03:57.521680 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:57.521788 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:03:57.911772 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-04-27 16:03:57.913401 (Thread-1): 16:03:57 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:57.913606 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:57.913779 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:57.913867 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:03:58.149471 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:03:58.150586 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:58.150693 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:03:58.286842 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:03:58.288355 (Thread-1): 16:03:58 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:03:58.294245 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:58.294361 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:03:58.526839 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:03:58.527036 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:58.527161 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:03:59.407780 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-04-27 16:03:59.411794 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:59.411908 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:03:59.566107 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:03:59.570703 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:59.570822 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:03:59.910447 (Thread-1): SQL status: SUCCESS 12 in 0.34 seconds
2021-04-27 16:03:59.912848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:03:59.912960 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:01.039019 (Thread-1): SQL status: SUCCESS 0 in 1.13 seconds
2021-04-27 16:04:01.040353 (Thread-1): 16:04:01 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:01.040557 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:01.040736 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:01.040823 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:01.777681 (Thread-1): SQL status: SUCCESS 1 in 0.74 seconds
2021-04-27 16:04:01.778793 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:01.778896 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:04:02.109599 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-04-27 16:04:02.111515 (Thread-1): 16:04:02 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:02.117140 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:02.117249 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:04:02.262789 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:04:02.262973 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:02.263058 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:04:03.178163 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-04-27 16:04:03.182201 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:03.182322 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:04:03.337299 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:04:03.341781 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:03.341897 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:04:04.172286 (Thread-1): SQL status: SUCCESS 12 in 0.83 seconds
2021-04-27 16:04:04.174575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:04.174686 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:04.518106 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 16:04:04.519737 (Thread-1): 16:04:04 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:04.519940 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:04.520112 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:04.520209 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:04.730336 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:04:04.731467 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:04.731572 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:04:05.594435 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-04-27 16:04:05.595864 (Thread-1): 16:04:05 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:05.603572 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:05.603741 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:04:05.766743 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:04:05.766924 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:05.767007 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:04:06.721335 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:04:06.725221 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:06.725340 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:04:06.876038 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:04:06.880522 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:06.880642 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:04:07.013088 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:04:07.015423 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:07.015538 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:08.631236 (Thread-1): SQL status: SUCCESS 0 in 1.62 seconds
2021-04-27 16:04:08.632535 (Thread-1): 16:04:08 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:08.632737 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:08.632901 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:08.632986 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:09.057297 (Thread-1): SQL status: SUCCESS 1 in 0.42 seconds
2021-04-27 16:04:09.058397 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:09.058511 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:04:09.205024 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:04:09.206863 (Thread-1): 16:04:09 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:09.212681 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:09.212796 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:04:09.366858 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:04:09.367045 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:09.367155 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:04:10.295949 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-04-27 16:04:10.300173 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:10.300311 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:04:10.470185 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:04:10.474672 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:10.474789 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:04:10.998870 (Thread-1): SQL status: SUCCESS 12 in 0.52 seconds
2021-04-27 16:04:11.001170 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:11.001290 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:11.932937 (Thread-1): SQL status: SUCCESS 0 in 0.93 seconds
2021-04-27 16:04:11.934575 (Thread-1): 16:04:11 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:11.934784 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:11.934961 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:11.935052 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:12.256993 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 16:04:12.258094 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:12.258197 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:04:12.394136 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:04:12.395574 (Thread-1): 16:04:12 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:12.401285 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:12.401395 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:04:12.548871 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:04:12.549052 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:12.549137 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:04:13.780233 (Thread-1): SQL status: SUCCESS 1 in 1.23 seconds
2021-04-27 16:04:13.784111 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:13.784225 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:04:13.958106 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:04:13.962506 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:13.962618 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:04:14.410884 (Thread-1): SQL status: SUCCESS 12 in 0.45 seconds
2021-04-27 16:04:14.413203 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:14.413309 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:15.751799 (Thread-1): SQL status: SUCCESS 0 in 1.34 seconds
2021-04-27 16:04:15.753059 (Thread-1): 16:04:15 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:15.753277 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:15.753457 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:15.753544 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:15.998131 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:04:15.999274 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:15.999379 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:04:16.134560 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:04:16.135984 (Thread-1): 16:04:16 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:16.141859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:16.141972 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:04:16.310212 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:04:16.310400 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:16.310490 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:04:17.605611 (Thread-1): SQL status: SUCCESS 1 in 1.29 seconds
2021-04-27 16:04:17.609602 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:17.609716 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:04:17.780615 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:04:17.785222 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:17.785343 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:04:17.930605 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:04:17.932931 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:17.933037 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:18.250863 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:04:18.252155 (Thread-1): 16:04:18 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:18.252354 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:18.252541 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:18.252628 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:18.473404 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:04:18.474895 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:18.475006 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:04:18.602963 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:04:18.604431 (Thread-1): 16:04:18 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:18.609899 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:18.610017 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:04:19.021825 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-04-27 16:04:19.022006 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:19.022095 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:04:20.270926 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-04-27 16:04:20.274921 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:20.275040 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:04:20.435070 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:04:20.439543 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:20.439661 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:04:20.573478 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:04:20.576039 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:20.576150 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:21.189692 (Thread-1): SQL status: SUCCESS 0 in 0.61 seconds
2021-04-27 16:04:21.191006 (Thread-1): 16:04:21 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:21.191239 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:21.191420 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:21.191509 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:21.686548 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-04-27 16:04:21.687705 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:21.687810 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:04:21.814164 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:04:21.816002 (Thread-1): 16:04:21 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:21.821363 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:21.821470 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:04:22.276878 (Thread-1): SQL status: SUCCESS 1 in 0.46 seconds
2021-04-27 16:04:22.277057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:22.277142 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:04:23.289297 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:04:23.293241 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:23.293351 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:04:23.442963 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:04:23.448856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:23.448969 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:04:23.585502 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:04:23.587827 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:23.587937 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:04:23.826451 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-04-27 16:04:23.828122 (Thread-1): 16:04:23 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:04:23.828323 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:23.828500 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:04:23.828589 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:04:24.039264 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:04:24.039686 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_suppliers"
2021-04-27 16:04:24.042717 (Thread-1): finished collecting timing info
2021-04-27 16:04:24.042988 (Thread-1): On model.Dbt_demo.sat_suppliers: Close
2021-04-27 16:04:24.295475 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14aafbd1-698b-4f9e-9ade-39838ebab1d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a3425460>]}
2021-04-27 16:04:24.296992 (Thread-1): 16:04:24 | 23 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_suppliers [INSERT 0 in 83.28s]
2021-04-27 16:04:24.297162 (Thread-1): Finished running node model.Dbt_demo.sat_suppliers
2021-04-27 16:04:24.298662 (MainThread): Acquiring new snowflake connection "master".
2021-04-27 16:04:24.298894 (MainThread): Using snowflake connection "master".
2021-04-27 16:04:24.298987 (MainThread): On master: BEGIN
2021-04-27 16:04:24.299081 (MainThread): Opening a new connection, currently in state closed
2021-04-27 16:04:25.262558 (MainThread): SQL status: SUCCESS 1 in 0.96 seconds
2021-04-27 16:04:25.262772 (MainThread): On master: COMMIT
2021-04-27 16:04:25.262933 (MainThread): Using snowflake connection "master".
2021-04-27 16:04:25.263017 (MainThread): On master: COMMIT
2021-04-27 16:04:25.480098 (MainThread): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:04:25.480306 (MainThread): On master: Close
2021-04-27 16:04:25.706708 (MainThread): 16:04:25 | 
2021-04-27 16:04:25.706928 (MainThread): 16:04:25 | Finished running 10 view models, 8 incremental models, 5 vault_insert_by_period models in 511.07s.
2021-04-27 16:04:25.707052 (MainThread): Connection 'master' was properly closed.
2021-04-27 16:04:25.707190 (MainThread): Connection 'model.Dbt_demo.sat_suppliers' was properly closed.
2021-04-27 16:04:25.845282 (MainThread): 
2021-04-27 16:04:25.845485 (MainThread): Completed successfully
2021-04-27 16:04:25.845665 (MainThread): 
Done. PASS=23 WARN=0 ERROR=0 SKIP=0 TOTAL=23
2021-04-27 16:04:25.845908 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a344afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a346c370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f16a33eb1f0>]}
2021-04-27 16:04:25.846128 (MainThread): Flushing usage events
2021-04-27 16:53:10.655492 (MainThread): Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3, and in 3.9 it will stop working
2021-04-27 16:53:10.658055 (MainThread): Running with dbt=0.19.0
2021-04-27 16:53:11.438631 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/ubuntu/dvdemo2/dvdemo', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-04-27 16:53:11.439459 (MainThread): Tracking: tracking
2021-04-27 16:53:11.439797 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f297eeac8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29719cfc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29719cfcd0>]}
2021-04-27 16:53:11.510840 (MainThread): Partial parsing not enabled
2021-04-27 16:53:11.512064 (MainThread): Parsing macros/adapters.sql
2021-04-27 16:53:11.549944 (MainThread): Parsing macros/catalog.sql
2021-04-27 16:53:11.552598 (MainThread): Parsing macros/materializations/incremental.sql
2021-04-27 16:53:11.565033 (MainThread): Parsing macros/materializations/view.sql
2021-04-27 16:53:11.566952 (MainThread): Parsing macros/materializations/merge.sql
2021-04-27 16:53:11.569542 (MainThread): Parsing macros/materializations/table.sql
2021-04-27 16:53:11.575427 (MainThread): Parsing macros/core.sql
2021-04-27 16:53:11.580392 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-04-27 16:53:11.582833 (MainThread): Parsing macros/schema_tests/unique.sql
2021-04-27 16:53:11.585144 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-04-27 16:53:11.588655 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-04-27 16:53:11.590680 (MainThread): Parsing macros/adapters/common.sql
2021-04-27 16:53:11.646739 (MainThread): Parsing macros/etc/datetime.sql
2021-04-27 16:53:11.658333 (MainThread): Parsing macros/etc/query.sql
2021-04-27 16:53:11.659761 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-04-27 16:53:11.662345 (MainThread): Parsing macros/etc/is_incremental.sql
2021-04-27 16:53:11.664482 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-04-27 16:53:11.665716 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-04-27 16:53:11.667872 (MainThread): Parsing macros/materializations/helpers.sql
2021-04-27 16:53:11.679414 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-04-27 16:53:11.705895 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-04-27 16:53:11.713730 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-04-27 16:53:11.716150 (MainThread): Parsing macros/materializations/table/table.sql
2021-04-27 16:53:11.724602 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-04-27 16:53:11.763324 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-04-27 16:53:11.786362 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-04-27 16:53:11.788744 (MainThread): Parsing macros/materializations/view/view.sql
2021-04-27 16:53:11.796757 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-04-27 16:53:11.803203 (MainThread): Parsing macros/materializations/common/merge.sql
2021-04-27 16:53:11.821911 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2021-04-27 16:53:11.847486 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2021-04-27 16:53:11.856734 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2021-04-27 16:53:11.858374 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2021-04-27 16:53:11.882913 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2021-04-27 16:53:11.903329 (MainThread): Parsing macros/supporting/hash.sql
2021-04-27 16:53:11.912728 (MainThread): Parsing macros/supporting/prefix.sql
2021-04-27 16:53:11.920159 (MainThread): Parsing macros/staging/rank_columns.sql
2021-04-27 16:53:11.923321 (MainThread): Parsing macros/staging/source_columns.sql
2021-04-27 16:53:11.925048 (MainThread): Parsing macros/staging/hash_columns.sql
2021-04-27 16:53:11.930118 (MainThread): Parsing macros/staging/derive_columns.sql
2021-04-27 16:53:11.938266 (MainThread): Parsing macros/staging/stage.sql
2021-04-27 16:53:11.953320 (MainThread): Parsing macros/internal/expand_column_list.sql
2021-04-27 16:53:11.957617 (MainThread): Parsing macros/internal/as_constant.sql
2021-04-27 16:53:11.960666 (MainThread): Parsing macros/internal/multikey.sql
2021-04-27 16:53:11.967329 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2021-04-27 16:53:11.980006 (MainThread): Parsing macros/internal/alias_all.sql
2021-04-27 16:53:11.983410 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2021-04-27 16:53:11.984497 (MainThread): Parsing macros/internal/alias.sql
2021-04-27 16:53:11.989328 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2021-04-27 16:53:11.989907 (MainThread): Parsing macros/internal/is_checks.sql
2021-04-27 16:53:11.994133 (MainThread): Parsing macros/tables/sat.sql
2021-04-27 16:53:12.005246 (MainThread): Parsing macros/tables/link.sql
2021-04-27 16:53:12.018997 (MainThread): Parsing macros/tables/eff_sat.sql
2021-04-27 16:53:12.035230 (MainThread): Parsing macros/tables/t_link.sql
2021-04-27 16:53:12.040629 (MainThread): Parsing macros/tables/hub.sql
2021-04-27 16:53:12.055335 (MainThread): Parsing macros/schema_tests/not_constant.sql
2021-04-27 16:53:12.057684 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2021-04-27 16:53:12.060802 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2021-04-27 16:53:12.064423 (MainThread): Parsing macros/schema_tests/equality.sql
2021-04-27 16:53:12.069855 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-04-27 16:53:12.074178 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2021-04-27 16:53:12.076594 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-04-27 16:53:12.085030 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2021-04-27 16:53:12.087738 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2021-04-27 16:53:12.090609 (MainThread): Parsing macros/schema_tests/recency.sql
2021-04-27 16:53:12.093231 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2021-04-27 16:53:12.095737 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2021-04-27 16:53:12.097941 (MainThread): Parsing macros/cross_db_utils/literal.sql
2021-04-27 16:53:12.099406 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2021-04-27 16:53:12.101175 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2021-04-27 16:53:12.103835 (MainThread): Parsing macros/cross_db_utils/replace.sql
2021-04-27 16:53:12.105667 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2021-04-27 16:53:12.108090 (MainThread): Parsing macros/cross_db_utils/concat.sql
2021-04-27 16:53:12.111266 (MainThread): Parsing macros/cross_db_utils/position.sql
2021-04-27 16:53:12.113572 (MainThread): Parsing macros/cross_db_utils/except.sql
2021-04-27 16:53:12.115272 (MainThread): Parsing macros/cross_db_utils/length.sql
2021-04-27 16:53:12.117432 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2021-04-27 16:53:12.130094 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2021-04-27 16:53:12.134159 (MainThread): Parsing macros/cross_db_utils/hash.sql
2021-04-27 16:53:12.136348 (MainThread): Parsing macros/cross_db_utils/right.sql
2021-04-27 16:53:12.139584 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-04-27 16:53:12.140712 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2021-04-27 16:53:12.143504 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2021-04-27 16:53:12.152743 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-04-27 16:53:12.155367 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2021-04-27 16:53:12.158690 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2021-04-27 16:53:12.163587 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2021-04-27 16:53:12.165811 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2021-04-27 16:53:12.167457 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2021-04-27 16:53:12.174336 (MainThread): Parsing macros/logger/pretty_time.sql
2021-04-27 16:53:12.176186 (MainThread): Parsing macros/logger/pretty_log_format.sql
2021-04-27 16:53:12.177861 (MainThread): Parsing macros/logger/log_info.sql
2021-04-27 16:53:12.179794 (MainThread): Parsing macros/web/get_url_path.sql
2021-04-27 16:53:12.183382 (MainThread): Parsing macros/web/get_url_host.sql
2021-04-27 16:53:12.185931 (MainThread): Parsing macros/web/get_url_parameter.sql
2021-04-27 16:53:12.188272 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2021-04-27 16:53:12.220867 (MainThread): Parsing macros/geo/haversine_distance.sql
2021-04-27 16:53:12.223234 (MainThread): Parsing macros/datetime/date_spine.sql
2021-04-27 16:53:12.229833 (MainThread): Parsing macros/sql/surrogate_key.sql
2021-04-27 16:53:12.234739 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-04-27 16:53:12.243060 (MainThread): Parsing macros/sql/pivot.sql
2021-04-27 16:53:12.248705 (MainThread): Parsing macros/sql/get_column_values.sql
2021-04-27 16:53:12.254898 (MainThread): Parsing macros/sql/unpivot.sql
2021-04-27 16:53:12.264745 (MainThread): Parsing macros/sql/groupby.sql
2021-04-27 16:53:12.266749 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-04-27 16:53:12.269174 (MainThread): Parsing macros/sql/star.sql
2021-04-27 16:53:12.273951 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2021-04-27 16:53:12.278729 (MainThread): Parsing macros/sql/union.sql
2021-04-27 16:53:12.290444 (MainThread): Parsing macros/sql/generate_series.sql
2021-04-27 16:53:12.296671 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2021-04-27 16:53:12.299979 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2021-04-27 16:53:12.304724 (MainThread): Parsing macros/sql/nullcheck_table.sql
2021-04-27 16:53:12.307088 (MainThread): Parsing macros/sql/safe_add.sql
2021-04-27 16:53:12.309461 (MainThread): Parsing macros/sql/nullcheck.sql
2021-04-27 16:53:12.319224 (MainThread): Partial parsing not enabled
2021-04-27 16:53:12.380960 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:12.469878 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:53:12.490822 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:53:12.511764 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:53:12.532537 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:53:12.553177 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:53:12.595802 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:12.617139 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:12.637905 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:53:12.704258 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:53:12.734825 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:53:12.764385 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:53:12.793959 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:53:12.820523 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 16:53:12.831331 (MainThread): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-04-27 16:53:12.831506 (MainThread): source_model: raw_suppliers
2021-04-27 16:53:12.831625 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:12.831738 (MainThread): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-04-27 16:53:12.945775 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 16:53:12.956369 (MainThread): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-04-27 16:53:12.956580 (MainThread): source_model: raw_customers
2021-04-27 16:53:12.956709 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:12.956822 (MainThread): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-04-27 16:53:12.975450 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 16:53:12.988365 (MainThread): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-04-27 16:53:12.988584 (MainThread): source_model: raw_products
2021-04-27 16:53:12.988717 (MainThread): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:12.988874 (MainThread): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-04-27 16:53:13.009711 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 16:53:13.020416 (MainThread): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-04-27 16:53:13.020622 (MainThread): source_model: raw_shippers
2021-04-27 16:53:13.020741 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:13.020852 (MainThread): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-04-27 16:53:13.037732 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 16:53:13.049851 (MainThread): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-04-27 16:53:13.050073 (MainThread): source_model: raw_orders
2021-04-27 16:53:13.050197 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:13.050316 (MainThread): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-04-27 16:53:13.073340 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 16:53:13.170268 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 16:53:13.187855 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 16:53:13.205550 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 16:53:13.223327 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 16:53:14.169723 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f297195cbe0>]}
2021-04-27 16:53:14.308734 (MainThread): Found 23 models, 0 tests, 0 snapshots, 0 analyses, 372 macros, 0 operations, 0 seed files, 5 sources, 0 exposures
2021-04-27 16:53:14.310735 (MainThread): 
2021-04-27 16:53:14.311138 (MainThread): Acquiring new snowflake connection "master".
2021-04-27 16:53:14.345241 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 16:53:14.362185 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 16:53:14.362356 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-04-27 16:53:14.362473 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-04-27 16:53:16.189266 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 1.83 seconds
2021-04-27 16:53:16.193859 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-04-27 16:53:16.577406 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 16:53:16.581378 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 16:53:16.581511 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-04-27 16:53:16.581621 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-04-27 16:53:18.073045 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 1.49 seconds
2021-04-27 16:53:18.074100 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-04-27 16:53:18.485209 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 16:53:18.488520 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-04-27 16:53:18.488628 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-04-27 16:53:18.488728 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-04-27 16:53:19.198650 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 0.71 seconds
2021-04-27 16:53:19.199700 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-04-27 16:53:19.941626 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-04-27 16:53:19.951005 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-04-27 16:53:19.951182 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_STG"} */

    show terse objects in DATAVAULTDEMO_DB.SS_STG
2021-04-27 16:53:19.951291 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-04-27 16:53:20.937333 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 0.99 seconds
2021-04-27 16:53:20.943070 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: Close
2021-04-27 16:53:21.554007 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-04-27 16:53:21.557599 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-04-27 16:53:21.557715 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW
2021-04-27 16:53:21.557819 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-04-27 16:53:22.578949 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 1.02 seconds
2021-04-27 16:53:22.584617 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: Close
2021-04-27 16:53:23.038779 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-04-27 16:53:23.042214 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-04-27 16:53:23.042327 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW_VLT"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW_VLT
2021-04-27 16:53:23.042436 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-04-27 16:53:23.727844 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 13 in 0.69 seconds
2021-04-27 16:53:23.741041 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: Close
2021-04-27 16:53:23.969256 (MainThread): Using snowflake connection "master".
2021-04-27 16:53:23.969433 (MainThread): On master: BEGIN
2021-04-27 16:53:23.969539 (MainThread): Opening a new connection, currently in state init
2021-04-27 16:53:25.146726 (MainThread): SQL status: SUCCESS 1 in 1.18 seconds
2021-04-27 16:53:25.147013 (MainThread): On master: COMMIT
2021-04-27 16:53:25.147230 (MainThread): Using snowflake connection "master".
2021-04-27 16:53:25.147325 (MainThread): On master: COMMIT
2021-04-27 16:53:25.370396 (MainThread): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:53:25.370615 (MainThread): On master: Close
2021-04-27 16:53:25.580315 (MainThread): 16:53:25 | Concurrency: 1 threads (target='dev')
2021-04-27 16:53:25.580566 (MainThread): 16:53:25 | 
2021-04-27 16:53:25.582142 (Thread-1): Began running node model.Dbt_demo.raw_orders
2021-04-27 16:53:25.583701 (Thread-1): 16:53:25 | 1 of 23 START view model SS_RAW.raw_orders........................... [RUN]
2021-04-27 16:53:25.584059 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 16:53:25.584219 (Thread-1): Compiling model.Dbt_demo.raw_orders
2021-04-27 16:53:25.607252 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_orders"
2021-04-27 16:53:25.607675 (Thread-1): finished collecting timing info
2021-04-27 16:53:25.641733 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_orders"
2021-04-27 16:53:25.642501 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 16:53:25.642608 (Thread-1): On model.Dbt_demo.raw_orders: BEGIN
2021-04-27 16:53:25.642712 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:26.479925 (Thread-1): SQL status: SUCCESS 1 in 0.84 seconds
2021-04-27 16:53:26.480116 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 16:53:26.480204 (Thread-1): On model.Dbt_demo.raw_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_orders  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.ORDERS 
--FROM DATAVAULTDEMO_DB.SS.ORDERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 16:53:26.845446 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-04-27 16:53:26.846765 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-04-27 16:53:26.846942 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-04-27 16:53:26.847031 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-04-27 16:53:27.006119 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:53:27.018273 (Thread-1): finished collecting timing info
2021-04-27 16:53:27.018613 (Thread-1): On model.Dbt_demo.raw_orders: Close
2021-04-27 16:53:27.416650 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971510730>]}
2021-04-27 16:53:27.418135 (Thread-1): 16:53:27 | 1 of 23 OK created view model SS_RAW.raw_orders...................... [SUCCESS 1 in 1.83s]
2021-04-27 16:53:27.418313 (Thread-1): Finished running node model.Dbt_demo.raw_orders
2021-04-27 16:53:27.418489 (Thread-1): Began running node model.Dbt_demo.raw_products
2021-04-27 16:53:27.419667 (Thread-1): 16:53:27 | 2 of 23 START view model SS_RAW.raw_products......................... [RUN]
2021-04-27 16:53:27.420196 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 16:53:27.420473 (Thread-1): Compiling model.Dbt_demo.raw_products
2021-04-27 16:53:27.431683 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_products"
2021-04-27 16:53:27.432042 (Thread-1): finished collecting timing info
2021-04-27 16:53:27.438865 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_products"
2021-04-27 16:53:27.439537 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 16:53:27.439641 (Thread-1): On model.Dbt_demo.raw_products: BEGIN
2021-04-27 16:53:27.439739 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:28.724340 (Thread-1): SQL status: SUCCESS 1 in 1.28 seconds
2021-04-27 16:53:28.724545 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 16:53:28.724640 (Thread-1): On model.Dbt_demo.raw_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_products  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.PRODUCTS 
--FROM DATAVAULTDEMO_DB.SS.PRODUCTS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 16:53:29.074532 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 16:53:29.075736 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-04-27 16:53:29.075914 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-04-27 16:53:29.076006 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-04-27 16:53:29.191511 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:53:29.195676 (Thread-1): finished collecting timing info
2021-04-27 16:53:29.195955 (Thread-1): On model.Dbt_demo.raw_products: Close
2021-04-27 16:53:29.486361 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f297178f790>]}
2021-04-27 16:53:29.487826 (Thread-1): 16:53:29 | 2 of 23 OK created view model SS_RAW.raw_products.................... [SUCCESS 1 in 2.07s]
2021-04-27 16:53:29.488008 (Thread-1): Finished running node model.Dbt_demo.raw_products
2021-04-27 16:53:29.488190 (Thread-1): Began running node model.Dbt_demo.raw_customers
2021-04-27 16:53:29.489322 (Thread-1): 16:53:29 | 3 of 23 START view model SS_RAW.raw_customers........................ [RUN]
2021-04-27 16:53:29.490035 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 16:53:29.490181 (Thread-1): Compiling model.Dbt_demo.raw_customers
2021-04-27 16:53:29.501615 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_customers"
2021-04-27 16:53:29.501972 (Thread-1): finished collecting timing info
2021-04-27 16:53:29.507419 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_customers"
2021-04-27 16:53:29.508061 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 16:53:29.508163 (Thread-1): On model.Dbt_demo.raw_customers: BEGIN
2021-04-27 16:53:29.508261 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:30.214603 (Thread-1): SQL status: SUCCESS 1 in 0.71 seconds
2021-04-27 16:53:30.214800 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 16:53:30.214888 (Thread-1): On model.Dbt_demo.raw_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_customers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.CUSTOMERS 
--FROM DATAVAULTDEMO_DB.SS.CUSTOMERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 16:53:30.539526 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 16:53:30.540726 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-04-27 16:53:30.540908 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-04-27 16:53:30.541002 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-04-27 16:53:30.668625 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:53:30.672795 (Thread-1): finished collecting timing info
2021-04-27 16:53:30.673065 (Thread-1): On model.Dbt_demo.raw_customers: Close
2021-04-27 16:53:30.882859 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29712e8a60>]}
2021-04-27 16:53:30.884346 (Thread-1): 16:53:30 | 3 of 23 OK created view model SS_RAW.raw_customers................... [SUCCESS 1 in 1.39s]
2021-04-27 16:53:30.884521 (Thread-1): Finished running node model.Dbt_demo.raw_customers
2021-04-27 16:53:30.884692 (Thread-1): Began running node model.Dbt_demo.raw_shippers
2021-04-27 16:53:30.885799 (Thread-1): 16:53:30 | 4 of 23 START view model SS_RAW.raw_shippers......................... [RUN]
2021-04-27 16:53:30.886288 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 16:53:30.886568 (Thread-1): Compiling model.Dbt_demo.raw_shippers
2021-04-27 16:53:30.897875 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_shippers"
2021-04-27 16:53:30.898246 (Thread-1): finished collecting timing info
2021-04-27 16:53:30.903925 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_shippers"
2021-04-27 16:53:30.904563 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 16:53:30.904664 (Thread-1): On model.Dbt_demo.raw_shippers: BEGIN
2021-04-27 16:53:30.904771 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:32.150015 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-04-27 16:53:32.150228 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 16:53:32.150323 (Thread-1): On model.Dbt_demo.raw_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_shippers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SHIPPERS 
--FROM DATAVAULTDEMO_DB.SS.SHIPPERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 16:53:32.473564 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 16:53:32.474756 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-04-27 16:53:32.474944 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-04-27 16:53:32.475032 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-04-27 16:53:32.598913 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:53:32.602998 (Thread-1): finished collecting timing info
2021-04-27 16:53:32.603287 (Thread-1): On model.Dbt_demo.raw_shippers: Close
2021-04-27 16:53:33.403918 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29713360a0>]}
2021-04-27 16:53:33.405361 (Thread-1): 16:53:33 | 4 of 23 OK created view model SS_RAW.raw_shippers.................... [SUCCESS 1 in 2.52s]
2021-04-27 16:53:33.405530 (Thread-1): Finished running node model.Dbt_demo.raw_shippers
2021-04-27 16:53:33.405691 (Thread-1): Began running node model.Dbt_demo.raw_suppliers
2021-04-27 16:53:33.406959 (Thread-1): 16:53:33 | 5 of 23 START view model SS_RAW.raw_suppliers........................ [RUN]
2021-04-27 16:53:33.407438 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 16:53:33.407605 (Thread-1): Compiling model.Dbt_demo.raw_suppliers
2021-04-27 16:53:33.418901 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_suppliers"
2021-04-27 16:53:33.419293 (Thread-1): finished collecting timing info
2021-04-27 16:53:33.424898 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_suppliers"
2021-04-27 16:53:33.425529 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 16:53:33.425630 (Thread-1): On model.Dbt_demo.raw_suppliers: BEGIN
2021-04-27 16:53:33.425728 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:34.521493 (Thread-1): SQL status: SUCCESS 1 in 1.10 seconds
2021-04-27 16:53:34.521698 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 16:53:34.521804 (Thread-1): On model.Dbt_demo.raw_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_suppliers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SUPPLIERS 
--FROM DATAVAULTDEMO_DB.SS.SUPPLIERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-04-27 16:53:34.908277 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-04-27 16:53:34.909471 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-04-27 16:53:34.909655 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-04-27 16:53:34.909745 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-04-27 16:53:35.053611 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:53:35.057768 (Thread-1): finished collecting timing info
2021-04-27 16:53:35.058063 (Thread-1): On model.Dbt_demo.raw_suppliers: Close
2021-04-27 16:53:35.521246 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29717ee130>]}
2021-04-27 16:53:35.522703 (Thread-1): 16:53:35 | 5 of 23 OK created view model SS_RAW.raw_suppliers................... [SUCCESS 1 in 2.11s]
2021-04-27 16:53:35.522886 (Thread-1): Finished running node model.Dbt_demo.raw_suppliers
2021-04-27 16:53:35.523065 (Thread-1): Began running node model.Dbt_demo.v_stg_orders
2021-04-27 16:53:35.524366 (Thread-1): 16:53:35 | 6 of 23 START view model SS_STG.v_stg_orders......................... [RUN]
2021-04-27 16:53:35.524827 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 16:53:35.524974 (Thread-1): Compiling model.Dbt_demo.v_stg_orders
2021-04-27 16:53:35.540142 (Thread-1): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-04-27 16:53:35.540383 (Thread-1): source_model: raw_orders
2021-04-27 16:53:35.540501 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:35.540654 (Thread-1): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-04-27 16:53:35.553762 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 16:53:35.553912 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-04-27 16:53:35.554014 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:36.436355 (Thread-1): SQL status: SUCCESS 13 in 0.88 seconds
2021-04-27 16:53:36.443235 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 16:53:36.443369 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-04-27 16:53:36.778802 (Thread-1): SQL status: SUCCESS 13 in 0.34 seconds
2021-04-27 16:53:36.791383 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_orders"
2021-04-27 16:53:36.791774 (Thread-1): finished collecting timing info
2021-04-27 16:53:36.797698 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_orders"
2021-04-27 16:53:36.802897 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 16:53:36.803025 (Thread-1): On model.Dbt_demo.v_stg_orders: BEGIN
2021-04-27 16:53:36.950544 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:53:36.950731 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 16:53:36.950816 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_orders  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_orders
),

derived_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-ORDERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''))) AS BINARY(16)) AS ORDER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS ORDER_PRODUCT_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^')
    ), '^^||^^||^^')) AS BINARY(16)) AS ORDER_SHIPPER_CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCOUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPOSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPREGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    ORDER_PK,
    PRODUCT_PK,
    SHIPPER_PK,
    CUSTOMER_PK,
    ORDER_PRODUCT_PK,
    ORDER_SHIPPER_CUSTOMER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 16:53:37.379695 (Thread-1): SQL status: SUCCESS 1 in 0.43 seconds
2021-04-27 16:53:37.380884 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-04-27 16:53:37.381058 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-04-27 16:53:37.381157 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-04-27 16:53:37.500963 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:53:37.505033 (Thread-1): finished collecting timing info
2021-04-27 16:53:37.505304 (Thread-1): On model.Dbt_demo.v_stg_orders: Close
2021-04-27 16:53:37.695017 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971308a00>]}
2021-04-27 16:53:37.696479 (Thread-1): 16:53:37 | 6 of 23 OK created view model SS_STG.v_stg_orders.................... [SUCCESS 1 in 2.17s]
2021-04-27 16:53:37.696652 (Thread-1): Finished running node model.Dbt_demo.v_stg_orders
2021-04-27 16:53:37.696826 (Thread-1): Began running node model.Dbt_demo.v_stg_products
2021-04-27 16:53:37.697918 (Thread-1): 16:53:37 | 7 of 23 START view model SS_STG.v_stg_products....................... [RUN]
2021-04-27 16:53:37.698410 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 16:53:37.698749 (Thread-1): Compiling model.Dbt_demo.v_stg_products
2021-04-27 16:53:37.713119 (Thread-1): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-04-27 16:53:37.713330 (Thread-1): source_model: raw_products
2021-04-27 16:53:37.713446 (Thread-1): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:37.713588 (Thread-1): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-04-27 16:53:37.717804 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 16:53:37.717911 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-04-27 16:53:37.718011 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:38.629032 (Thread-1): SQL status: SUCCESS 11 in 0.91 seconds
2021-04-27 16:53:38.635329 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 16:53:38.635454 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-04-27 16:53:38.941764 (Thread-1): SQL status: SUCCESS 11 in 0.31 seconds
2021-04-27 16:53:38.951335 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_products"
2021-04-27 16:53:38.951674 (Thread-1): finished collecting timing info
2021-04-27 16:53:38.957594 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_products"
2021-04-27 16:53:38.961656 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 16:53:38.961771 (Thread-1): On model.Dbt_demo.v_stg_products: BEGIN
2021-04-27 16:53:39.186445 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:53:39.186632 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 16:53:39.186718 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_products  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_products
),

derived_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORYID AS CATEGORY,
    'TPCH-PRODUCTS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS PRODUCT_SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CATEGORYID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(QUANTITYPERUNIT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REORDERLEVEL AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITPRICE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSINSTOCK AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSONORDER AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS PRODUCT_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,
    PRODUCT_PK,
    SUPPLIER_PK,
    PRODUCT_SUPPLIER_PK,
    PRODUCT_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 16:53:40.198931 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:53:40.200127 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-04-27 16:53:40.200302 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-04-27 16:53:40.200393 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-04-27 16:53:40.324171 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:53:40.328215 (Thread-1): finished collecting timing info
2021-04-27 16:53:40.328483 (Thread-1): On model.Dbt_demo.v_stg_products: Close
2021-04-27 16:53:40.537357 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29717a0dc0>]}
2021-04-27 16:53:40.538812 (Thread-1): 16:53:40 | 7 of 23 OK created view model SS_STG.v_stg_products.................. [SUCCESS 1 in 2.84s]
2021-04-27 16:53:40.539004 (Thread-1): Finished running node model.Dbt_demo.v_stg_products
2021-04-27 16:53:40.539199 (Thread-1): Began running node model.Dbt_demo.v_stg_customers
2021-04-27 16:53:40.540343 (Thread-1): 16:53:40 | 8 of 23 START view model SS_STG.v_stg_customers...................... [RUN]
2021-04-27 16:53:40.540843 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 16:53:40.541174 (Thread-1): Compiling model.Dbt_demo.v_stg_customers
2021-04-27 16:53:40.554888 (Thread-1): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-04-27 16:53:40.555132 (Thread-1): source_model: raw_customers
2021-04-27 16:53:40.555254 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:40.555389 (Thread-1): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-04-27 16:53:40.559721 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 16:53:40.559832 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-04-27 16:53:40.559933 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:41.706950 (Thread-1): SQL status: SUCCESS 10 in 1.15 seconds
2021-04-27 16:53:41.713170 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 16:53:41.713306 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-04-27 16:53:41.891600 (Thread-1): SQL status: SUCCESS 10 in 0.18 seconds
2021-04-27 16:53:41.899223 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_customers"
2021-04-27 16:53:41.899571 (Thread-1): finished collecting timing info
2021-04-27 16:53:41.905318 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_customers"
2021-04-27 16:53:41.908421 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 16:53:41.908526 (Thread-1): On model.Dbt_demo.v_stg_customers: BEGIN
2021-04-27 16:53:42.066612 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:53:42.066798 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 16:53:42.066885 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_customers  as (
    










    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_customers
),

derived_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-CUSTOMERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 16:53:42.411505 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-04-27 16:53:42.412679 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-04-27 16:53:42.412862 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-04-27 16:53:42.412954 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-04-27 16:53:42.546571 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:53:42.550915 (Thread-1): finished collecting timing info
2021-04-27 16:53:42.551208 (Thread-1): On model.Dbt_demo.v_stg_customers: Close
2021-04-27 16:53:42.765205 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971632070>]}
2021-04-27 16:53:42.766634 (Thread-1): 16:53:42 | 8 of 23 OK created view model SS_STG.v_stg_customers................. [SUCCESS 1 in 2.22s]
2021-04-27 16:53:42.766809 (Thread-1): Finished running node model.Dbt_demo.v_stg_customers
2021-04-27 16:53:42.766973 (Thread-1): Began running node model.Dbt_demo.v_stg_shippers
2021-04-27 16:53:42.768263 (Thread-1): 16:53:42 | 9 of 23 START view model SS_STG.v_stg_shippers....................... [RUN]
2021-04-27 16:53:42.768596 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 16:53:42.768730 (Thread-1): Compiling model.Dbt_demo.v_stg_shippers
2021-04-27 16:53:42.782109 (Thread-1): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-04-27 16:53:42.782344 (Thread-1): source_model: raw_shippers
2021-04-27 16:53:42.782464 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:42.782605 (Thread-1): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-04-27 16:53:42.787050 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 16:53:42.787192 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-04-27 16:53:42.787297 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:43.464202 (Thread-1): SQL status: SUCCESS 5 in 0.68 seconds
2021-04-27 16:53:43.471163 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 16:53:43.471299 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-04-27 16:53:43.608263 (Thread-1): SQL status: SUCCESS 5 in 0.14 seconds
2021-04-27 16:53:43.613800 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_shippers"
2021-04-27 16:53:43.614141 (Thread-1): finished collecting timing info
2021-04-27 16:53:43.620370 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_shippers"
2021-04-27 16:53:43.622674 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 16:53:43.622781 (Thread-1): On model.Dbt_demo.v_stg_shippers: BEGIN
2021-04-27 16:53:43.775561 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:53:43.775751 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 16:53:43.775838 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_shippers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_shippers
),

derived_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SHIPPERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PHONE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SHIPPER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SHIPPER_PK,
    SHIPPER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 16:53:44.113185 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-04-27 16:53:44.114386 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-04-27 16:53:44.114566 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-04-27 16:53:44.114661 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-04-27 16:53:44.263741 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:53:44.267784 (Thread-1): finished collecting timing info
2021-04-27 16:53:44.268067 (Thread-1): On model.Dbt_demo.v_stg_shippers: Close
2021-04-27 16:53:44.469366 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971440400>]}
2021-04-27 16:53:44.470770 (Thread-1): 16:53:44 | 9 of 23 OK created view model SS_STG.v_stg_shippers.................. [SUCCESS 1 in 1.70s]
2021-04-27 16:53:44.470947 (Thread-1): Finished running node model.Dbt_demo.v_stg_shippers
2021-04-27 16:53:44.471136 (Thread-1): Began running node model.Dbt_demo.v_stg_suppliers
2021-04-27 16:53:44.472425 (Thread-1): 16:53:44 | 10 of 23 START view model SS_STG.v_stg_suppliers..................... [RUN]
2021-04-27 16:53:44.472774 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 16:53:44.472939 (Thread-1): Compiling model.Dbt_demo.v_stg_suppliers
2021-04-27 16:53:44.487035 (Thread-1): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-04-27 16:53:44.487274 (Thread-1): source_model: raw_suppliers
2021-04-27 16:53:44.487393 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-04-27 16:53:44.487542 (Thread-1): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-04-27 16:53:44.491975 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 16:53:44.492134 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-04-27 16:53:44.492236 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:45.464175 (Thread-1): SQL status: SUCCESS 10 in 0.97 seconds
2021-04-27 16:53:45.470439 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 16:53:45.470607 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-04-27 16:53:45.819007 (Thread-1): SQL status: SUCCESS 10 in 0.35 seconds
2021-04-27 16:53:45.828050 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-04-27 16:53:45.828432 (Thread-1): finished collecting timing info
2021-04-27 16:53:45.834020 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-04-27 16:53:45.837229 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 16:53:45.837336 (Thread-1): On model.Dbt_demo.v_stg_suppliers: BEGIN
2021-04-27 16:53:45.983416 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:53:45.983608 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 16:53:45.983694 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
),

derived_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SUPPLIERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTTITLE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SUPPLIER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SUPPLIER_PK,
    SUPPLIER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-04-27 16:53:46.382807 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:53:46.383999 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-04-27 16:53:46.384176 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-04-27 16:53:46.384265 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-04-27 16:53:46.512643 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:53:46.517000 (Thread-1): finished collecting timing info
2021-04-27 16:53:46.517286 (Thread-1): On model.Dbt_demo.v_stg_suppliers: Close
2021-04-27 16:53:46.727015 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29714baa90>]}
2021-04-27 16:53:46.728465 (Thread-1): 16:53:46 | 10 of 23 OK created view model SS_STG.v_stg_suppliers................ [SUCCESS 1 in 2.25s]
2021-04-27 16:53:46.728640 (Thread-1): Finished running node model.Dbt_demo.v_stg_suppliers
2021-04-27 16:53:46.728811 (Thread-1): Began running node model.Dbt_demo.hub_orders
2021-04-27 16:53:46.729906 (Thread-1): 16:53:46 | 11 of 23 START incremental model SS_RAW_VLT.hub_orders............... [RUN]
2021-04-27 16:53:46.730396 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:46.730532 (Thread-1): Compiling model.Dbt_demo.hub_orders
2021-04-27 16:53:46.746759 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_orders"
2021-04-27 16:53:46.747154 (Thread-1): finished collecting timing info
2021-04-27 16:53:46.790806 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:46.790996 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PK, ORDERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:53:46.791123 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:49.259715 (Thread-1): SQL status: SUCCESS 1 in 2.47 seconds
2021-04-27 16:53:49.263293 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:49.263408 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
2021-04-27 16:53:50.165619 (Thread-1): SQL status: SUCCESS 4 in 0.90 seconds
2021-04-27 16:53:50.169516 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:50.169628 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-04-27 16:53:50.308282 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-04-27 16:53:50.401034 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:50.401215 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-04-27 16:53:50.530952 (Thread-1): SQL status: SUCCESS 4 in 0.13 seconds
2021-04-27 16:53:50.546336 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_orders"
2021-04-27 16:53:50.547233 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:50.547339 (Thread-1): On model.Dbt_demo.hub_orders: BEGIN
2021-04-27 16:53:51.094138 (Thread-1): SQL status: SUCCESS 1 in 0.55 seconds
2021-04-27 16:53:51.094332 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:51.094426 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders ("ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
        );
2021-04-27 16:53:51.442359 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 16:53:51.443586 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-04-27 16:53:51.443775 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-04-27 16:53:51.443866 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-04-27 16:53:52.278448 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-04-27 16:53:52.287148 (Thread-1): finished collecting timing info
2021-04-27 16:53:52.287430 (Thread-1): On model.Dbt_demo.hub_orders: Close
2021-04-27 16:53:52.520925 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971240340>]}
2021-04-27 16:53:52.522376 (Thread-1): 16:53:52 | 11 of 23 OK created incremental model SS_RAW_VLT.hub_orders.......... [SUCCESS 0 in 5.79s]
2021-04-27 16:53:52.522563 (Thread-1): Finished running node model.Dbt_demo.hub_orders
2021-04-27 16:53:52.522741 (Thread-1): Began running node model.Dbt_demo.link_order_prod
2021-04-27 16:53:52.524011 (Thread-1): 16:53:52 | 12 of 23 START incremental model SS_RAW_VLT.link_order_prod.......... [RUN]
2021-04-27 16:53:52.524346 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:52.524468 (Thread-1): Compiling model.Dbt_demo.link_order_prod
2021-04-27 16:53:52.537644 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_prod"
2021-04-27 16:53:52.538029 (Thread-1): finished collecting timing info
2021-04-27 16:53:52.545916 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:52.546032 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PRODUCT_PK, PRODUCT_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PRODUCT_PK, a.PRODUCT_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod AS d
    ON a.ORDER_PRODUCT_PK = d.ORDER_PRODUCT_PK
    WHERE d.ORDER_PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:53:52.546136 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:54.809904 (Thread-1): SQL status: SUCCESS 1 in 2.26 seconds
2021-04-27 16:53:54.813534 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:54.813657 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
2021-04-27 16:53:54.972374 (Thread-1): SQL status: SUCCESS 5 in 0.16 seconds
2021-04-27 16:53:54.977601 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:54.977759 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-04-27 16:53:55.127472 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-04-27 16:53:55.131527 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:55.131658 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-04-27 16:53:55.496137 (Thread-1): SQL status: SUCCESS 5 in 0.36 seconds
2021-04-27 16:53:55.497908 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_prod"
2021-04-27 16:53:55.498928 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:55.499041 (Thread-1): On model.Dbt_demo.link_order_prod: BEGIN
2021-04-27 16:53:55.640517 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:53:55.640707 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:55.640792 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod ("ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
        );
2021-04-27 16:53:55.913307 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:53:55.914487 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-04-27 16:53:55.914662 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-04-27 16:53:55.914750 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-04-27 16:53:56.153912 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:53:56.158054 (Thread-1): finished collecting timing info
2021-04-27 16:53:56.158325 (Thread-1): On model.Dbt_demo.link_order_prod: Close
2021-04-27 16:53:56.401446 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29713d6460>]}
2021-04-27 16:53:56.402854 (Thread-1): 16:53:56 | 12 of 23 OK created incremental model SS_RAW_VLT.link_order_prod..... [SUCCESS 0 in 3.88s]
2021-04-27 16:53:56.403024 (Thread-1): Finished running node model.Dbt_demo.link_order_prod
2021-04-27 16:53:56.403210 (Thread-1): Began running node model.Dbt_demo.link_order_ship_cust
2021-04-27 16:53:56.404615 (Thread-1): 16:53:56 | 13 of 23 START incremental model SS_RAW_VLT.link_order_ship_cust..... [RUN]
2021-04-27 16:53:56.405081 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:56.405206 (Thread-1): Compiling model.Dbt_demo.link_order_ship_cust
2021-04-27 16:53:56.418782 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-04-27 16:53:56.419167 (Thread-1): finished collecting timing info
2021-04-27 16:53:56.427177 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:56.427307 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_SHIPPER_CUSTOMER_PK, SHIPPER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_SHIPPER_CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_SHIPPER_CUSTOMER_PK, a.SHIPPER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust AS d
    ON a.ORDER_SHIPPER_CUSTOMER_PK = d.ORDER_SHIPPER_CUSTOMER_PK
    WHERE d.ORDER_SHIPPER_CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:53:56.427421 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:53:58.102543 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2021-04-27 16:53:58.106054 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:58.106164 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
2021-04-27 16:53:58.287826 (Thread-1): SQL status: SUCCESS 6 in 0.18 seconds
2021-04-27 16:53:58.292948 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:58.293059 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-04-27 16:53:58.431403 (Thread-1): SQL status: SUCCESS 6 in 0.14 seconds
2021-04-27 16:53:58.435433 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:58.435548 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-04-27 16:53:58.586946 (Thread-1): SQL status: SUCCESS 6 in 0.15 seconds
2021-04-27 16:53:58.588789 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-04-27 16:53:58.589593 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:58.589698 (Thread-1): On model.Dbt_demo.link_order_ship_cust: BEGIN
2021-04-27 16:53:59.218531 (Thread-1): SQL status: SUCCESS 1 in 0.63 seconds
2021-04-27 16:53:59.218731 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:59.220106 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust ("ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
        );
2021-04-27 16:53:59.505732 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:53:59.507296 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-04-27 16:53:59.507485 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-04-27 16:53:59.507581 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-04-27 16:53:59.939805 (Thread-1): SQL status: SUCCESS 1 in 0.43 seconds
2021-04-27 16:53:59.944090 (Thread-1): finished collecting timing info
2021-04-27 16:53:59.944421 (Thread-1): On model.Dbt_demo.link_order_ship_cust: Close
2021-04-27 16:54:00.190441 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971853040>]}
2021-04-27 16:54:00.191949 (Thread-1): 16:54:00 | 13 of 23 OK created incremental model SS_RAW_VLT.link_order_ship_cust [SUCCESS 0 in 3.79s]
2021-04-27 16:54:00.192142 (Thread-1): Finished running node model.Dbt_demo.link_order_ship_cust
2021-04-27 16:54:00.192326 (Thread-1): Began running node model.Dbt_demo.sat_orders
2021-04-27 16:54:00.193474 (Thread-1): 16:54:00 | 14 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_orders.... [RUN]
2021-04-27 16:54:00.193819 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:00.193958 (Thread-1): Compiling model.Dbt_demo.sat_orders
2021-04-27 16:54:00.216996 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_orders"
2021-04-27 16:54:00.217397 (Thread-1): finished collecting timing info
2021-04-27 16:54:00.284709 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:00.284896 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 16:54:00.285007 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:54:02.079800 (Thread-1): SQL status: SUCCESS 1 in 1.79 seconds
2021-04-27 16:54:02.109686 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:02.109862 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 09:54:01.783000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 09:54:01.783000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_orders
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 16:54:02.284380 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:54:02.288156 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:02.288287 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:02.405639 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 16:54:02.414414 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:02.414544 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:02.527216 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:54:02.540473 (Thread-1): 16:54:02 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:02.559342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:02.559516 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:02.694968 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:54:02.695209 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:02.695300 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:07.583018 (Thread-1): SQL status: SUCCESS 1 in 4.89 seconds
2021-04-27 16:54:07.587276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:07.587416 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:07.747909 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:54:07.752260 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:07.752370 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:07.878182 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:54:07.880760 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:07.880870 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:08.420568 (Thread-1): SQL status: SUCCESS 0 in 0.54 seconds
2021-04-27 16:54:08.421896 (Thread-1): 16:54:08 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:08.422120 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:08.422305 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:08.422399 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:09.273445 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-04-27 16:54:09.274554 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:09.274657 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:09.632280 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-04-27 16:54:09.634029 (Thread-1): 16:54:09 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:09.639724 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:09.639836 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:10.000358 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-04-27 16:54:10.000542 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:10.000628 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:11.565593 (Thread-1): SQL status: SUCCESS 1 in 1.56 seconds
2021-04-27 16:54:11.571019 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:11.571184 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:11.731760 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:54:11.736086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:11.736206 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:11.863207 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:54:11.865509 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:11.865615 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:12.145325 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:54:12.146938 (Thread-1): 16:54:12 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:12.147182 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:12.147362 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:12.147451 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:12.361536 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:54:12.362636 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:12.362741 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:13.358401 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 16:54:13.359832 (Thread-1): 16:54:13 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:13.365687 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:13.365848 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:13.616009 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:54:13.616196 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:13.616282 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:14.585898 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:54:14.589783 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:14.589894 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:14.768041 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:54:14.772567 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:14.772677 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:14.912712 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:54:14.915070 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:14.915218 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:15.313104 (Thread-1): SQL status: SUCCESS 0 in 0.40 seconds
2021-04-27 16:54:15.314408 (Thread-1): 16:54:15 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:15.314625 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:15.314812 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:15.314912 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:15.527009 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:54:15.528156 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:15.528263 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:15.646346 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:15.647760 (Thread-1): 16:54:15 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:15.653137 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:15.653258 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:15.794845 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:54:15.795040 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:15.795150 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:16.736640 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 16:54:16.741008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:16.741148 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:16.901107 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:54:16.905462 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:16.905583 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:17.068580 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:54:17.070852 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:17.070963 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:18.100516 (Thread-1): SQL status: SUCCESS 0 in 1.03 seconds
2021-04-27 16:54:18.101758 (Thread-1): 16:54:18 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:18.101968 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:18.102144 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:18.102245 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:18.356728 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:54:18.357823 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:18.357927 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:18.476626 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:18.478008 (Thread-1): 16:54:18 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:18.483656 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:18.483765 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:19.194577 (Thread-1): SQL status: SUCCESS 1 in 0.71 seconds
2021-04-27 16:54:19.194772 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:19.194864 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:20.197991 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 16:54:20.201886 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:20.201998 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:20.349548 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:54:20.354173 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:20.354333 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:20.488390 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:54:20.490681 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:20.490789 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:21.873317 (Thread-1): SQL status: SUCCESS 0 in 1.38 seconds
2021-04-27 16:54:21.874653 (Thread-1): 16:54:21 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:21.874871 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:21.875068 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:21.875185 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:22.361065 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-04-27 16:54:22.362529 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:22.362640 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:23.450424 (Thread-1): SQL status: SUCCESS 1 in 1.09 seconds
2021-04-27 16:54:23.451846 (Thread-1): 16:54:23 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:23.457224 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:23.457342 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:24.716155 (Thread-1): SQL status: SUCCESS 1 in 1.26 seconds
2021-04-27 16:54:24.716340 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:24.716428 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:28.206760 (Thread-1): SQL status: SUCCESS 1 in 3.49 seconds
2021-04-27 16:54:28.210749 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:28.210887 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:28.656728 (Thread-1): SQL status: SUCCESS 12 in 0.45 seconds
2021-04-27 16:54:28.661529 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:28.661652 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:29.021580 (Thread-1): SQL status: SUCCESS 12 in 0.36 seconds
2021-04-27 16:54:29.023899 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:29.024012 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:29.380215 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-04-27 16:54:29.381581 (Thread-1): 16:54:29 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:29.381803 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:29.381989 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:29.382082 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:30.015307 (Thread-1): SQL status: SUCCESS 1 in 0.63 seconds
2021-04-27 16:54:30.016433 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:30.016543 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:30.196781 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:54:30.198663 (Thread-1): 16:54:30 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:30.204489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:30.204630 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:30.621590 (Thread-1): SQL status: SUCCESS 1 in 0.42 seconds
2021-04-27 16:54:30.621776 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:30.621864 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:31.855044 (Thread-1): SQL status: SUCCESS 1 in 1.23 seconds
2021-04-27 16:54:31.859007 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:31.859134 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:32.033981 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:54:32.038418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:32.038547 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:32.183775 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:54:32.186108 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:32.186227 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:32.625587 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-04-27 16:54:32.627232 (Thread-1): 16:54:32 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:32.627450 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:32.627624 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:32.627711 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:32.977518 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 16:54:32.978635 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:32.978739 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:33.095226 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:33.096639 (Thread-1): 16:54:33 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:33.102768 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:33.102903 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:33.246899 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:54:33.247086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:33.247206 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:34.485237 (Thread-1): SQL status: SUCCESS 1 in 1.24 seconds
2021-04-27 16:54:34.489228 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:34.489345 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:34.638198 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:54:34.642866 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:34.643011 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:34.761399 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 16:54:34.763699 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:34.763807 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:35.114460 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 16:54:35.115827 (Thread-1): 16:54:35 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:35.116050 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:35.116238 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:35.116327 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:35.417415 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-04-27 16:54:35.418836 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:35.418950 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:35.529294 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:54:35.530690 (Thread-1): 16:54:35 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:35.535980 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:35.536092 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:35.677449 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:54:35.677644 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:35.677730 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:37.631811 (Thread-1): SQL status: SUCCESS 1 in 1.95 seconds
2021-04-27 16:54:37.636032 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:37.636151 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:37.822611 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:54:37.909949 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:37.910118 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:38.057088 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:54:38.059359 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:38.059467 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:38.442928 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-04-27 16:54:38.444581 (Thread-1): 16:54:38 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:38.444806 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:38.444982 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:38.445070 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:38.736204 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 16:54:38.737291 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:38.737394 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:38.852811 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:38.854229 (Thread-1): 16:54:38 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:38.861613 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:38.861722 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:39.083514 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:54:39.083706 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:39.083792 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:40.765747 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2021-04-27 16:54:40.769624 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:40.769732 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:40.959332 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:54:40.963854 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:40.963980 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:41.102637 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:54:41.104989 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:41.105101 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:41.466977 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-04-27 16:54:41.468265 (Thread-1): 16:54:41 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:41.468473 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:41.468647 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:41.468735 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:41.685139 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:54:41.686227 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:41.686338 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:42.214178 (Thread-1): SQL status: SUCCESS 1 in 0.53 seconds
2021-04-27 16:54:42.215627 (Thread-1): 16:54:42 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:42.220929 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:42.221041 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:42.364914 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:54:42.365130 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:42.365221 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:43.355350 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 16:54:43.359493 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:43.359605 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:43.526590 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:54:43.530978 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:43.531090 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:43.664616 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:54:43.667175 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:43.667284 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:43.944824 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:54:43.946154 (Thread-1): 16:54:43 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:43.946363 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:43.946543 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:43.946635 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:44.155475 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:54:44.156599 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:44.156704 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:44.277707 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:44.279501 (Thread-1): 16:54:44 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:44.284775 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:44.284881 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:44.432163 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:54:44.432354 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:44.432441 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:45.614341 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-04-27 16:54:45.618323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:45.618444 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:45.791024 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:54:45.796952 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:45.797064 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:45.923141 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:54:45.925424 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:45.925530 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:46.411956 (Thread-1): SQL status: SUCCESS 0 in 0.49 seconds
2021-04-27 16:54:46.413561 (Thread-1): 16:54:46 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:46.413774 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:46.413946 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:46.414035 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:46.631740 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:54:46.632843 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:46.632945 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:46.760275 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:54:46.761657 (Thread-1): 16:54:46 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:46.767391 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:46.767505 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:46.914331 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:54:46.914519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:46.914612 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:47.926934 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:54:47.930927 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:47.931067 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:48.136816 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-04-27 16:54:48.141388 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:48.141530 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:48.274267 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:54:48.276576 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:48.276705 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:48.570984 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:54:48.572305 (Thread-1): 16:54:48 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:48.572525 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:48.572706 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:48.572798 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:48.787542 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:54:48.788617 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:48.788720 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:48.911478 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:48.912893 (Thread-1): 16:54:48 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:48.918323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:48.918440 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:49.096579 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:54:49.096781 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:49.096869 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:50.160242 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-04-27 16:54:50.164676 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:50.164848 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:50.326873 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:54:50.331254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:50.331392 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:50.476632 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:54:50.478957 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:50.479067 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:50.741047 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 16:54:50.742317 (Thread-1): 16:54:50 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:50.742542 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:50.742724 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:50.742818 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:50.933392 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:54:50.934499 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:50.934605 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:51.052845 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:51.054326 (Thread-1): 16:54:51 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:51.060146 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:51.060274 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:51.202968 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:54:51.203171 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:51.203260 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:52.196595 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 16:54:52.201993 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:52.202103 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:52.356240 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:54:52.360706 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:52.360813 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:52.509975 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:54:52.512267 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:52.512373 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:52.797600 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:54:52.798873 (Thread-1): 16:54:52 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:52.799079 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:52.799280 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:52.799372 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:53.002582 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:54:53.003666 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:53.003776 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:53.120137 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:53.121537 (Thread-1): 16:54:53 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:53.126893 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:53.127016 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:53.742438 (Thread-1): SQL status: SUCCESS 1 in 0.62 seconds
2021-04-27 16:54:53.742630 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:53.742719 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:54:56.813583 (Thread-1): SQL status: SUCCESS 1 in 3.07 seconds
2021-04-27 16:54:56.817489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:56.817599 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:54:57.437427 (Thread-1): SQL status: SUCCESS 12 in 0.62 seconds
2021-04-27 16:54:57.441830 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:57.442062 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:54:57.571822 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:54:57.574097 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:57.574209 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:54:57.852154 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:54:57.853450 (Thread-1): 16:54:57 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:54:57.853663 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:57.853840 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:57.853927 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:54:58.286631 (Thread-1): SQL status: SUCCESS 1 in 0.43 seconds
2021-04-27 16:54:58.287798 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:58.287908 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:54:58.405068 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:54:58.406541 (Thread-1): 16:54:58 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_orders]
2021-04-27 16:54:58.412004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:58.412121 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:54:58.556908 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:54:58.557100 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:54:58.557189 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:00.475197 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2021-04-27 16:55:00.479383 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:00.479517 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:00.752229 (Thread-1): SQL status: SUCCESS 12 in 0.27 seconds
2021-04-27 16:55:00.756603 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:00.756723 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:00.904345 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:55:00.906647 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:00.906757 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:01.178124 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:55:01.179509 (Thread-1): 16:55:01 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:01.179755 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:01.179955 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:01.180048 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:01.377024 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:55:01.378137 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:01.378239 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:01.854903 (Thread-1): SQL status: SUCCESS 1 in 0.48 seconds
2021-04-27 16:55:01.856393 (Thread-1): 16:55:01 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:01.862199 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:01.862334 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:02.097846 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:55:02.098042 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:02.098127 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:05.006459 (Thread-1): SQL status: SUCCESS 1 in 2.91 seconds
2021-04-27 16:55:05.010572 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:05.010714 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:05.196103 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:55:05.200632 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:05.200749 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:05.487892 (Thread-1): SQL status: SUCCESS 12 in 0.29 seconds
2021-04-27 16:55:05.490171 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:05.490274 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:05.790262 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:55:05.791560 (Thread-1): 16:55:05 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:05.791763 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:05.791940 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:05.792027 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:06.160670 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-04-27 16:55:06.161760 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:06.161862 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:06.348679 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:55:06.350638 (Thread-1): 16:55:06 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:06.356042 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:06.356171 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:06.537218 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:55:06.537411 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:06.537495 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:07.854574 (Thread-1): SQL status: SUCCESS 1 in 1.32 seconds
2021-04-27 16:55:07.858612 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:07.858734 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:08.023720 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:55:08.028132 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:08.028246 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:08.824705 (Thread-1): SQL status: SUCCESS 12 in 0.80 seconds
2021-04-27 16:55:08.826968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:08.827084 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:10.793471 (Thread-1): SQL status: SUCCESS 0 in 1.97 seconds
2021-04-27 16:55:10.795061 (Thread-1): 16:55:10 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:10.795292 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:10.795472 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:10.795559 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:11.009035 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:55:11.010132 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:11.010234 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:11.144939 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:55:11.146356 (Thread-1): 16:55:11 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:11.152230 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:11.152401 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:11.295306 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:55:11.295492 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:11.295577 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:12.534575 (Thread-1): SQL status: SUCCESS 1 in 1.24 seconds
2021-04-27 16:55:12.538593 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:12.538708 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:12.727598 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:55:12.733851 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:12.733989 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:12.856802 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 16:55:12.859068 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:12.859202 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:13.115689 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 16:55:13.117050 (Thread-1): 16:55:13 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:13.117268 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:13.117458 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:13.117549 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:13.326690 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:55:13.328256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:13.328382 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:13.574682 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:55:13.576171 (Thread-1): 16:55:13 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:13.581777 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:13.581908 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:13.857571 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:55:13.857763 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:13.857847 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:14.872557 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:55:14.876742 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:14.876859 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:15.026341 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:55:15.030790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:15.030895 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:15.150320 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-04-27 16:55:15.152956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:15.153117 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:15.866703 (Thread-1): SQL status: SUCCESS 0 in 0.71 seconds
2021-04-27 16:55:15.868039 (Thread-1): 16:55:15 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:15.868250 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:15.868425 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:15.868511 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:16.076906 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:55:16.078019 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:16.078121 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:16.248687 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:55:16.250073 (Thread-1): 16:55:16 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:16.255810 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:16.255925 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:16.401364 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:55:16.401547 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:16.401632 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:17.845874 (Thread-1): SQL status: SUCCESS 1 in 1.44 seconds
2021-04-27 16:55:17.849912 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:17.850034 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:18.037442 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:55:18.041985 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:18.042128 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:18.191044 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:55:18.193352 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:18.193456 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:18.497308 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:55:18.498910 (Thread-1): 16:55:18 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:18.499152 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:18.499333 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:18.499421 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:18.713198 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:55:18.714316 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:18.714419 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:18.841971 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:55:18.843379 (Thread-1): 16:55:18 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:18.850621 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:18.850742 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:19.030731 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:55:19.030914 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:19.030998 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:20.151060 (Thread-1): SQL status: SUCCESS 1 in 1.12 seconds
2021-04-27 16:55:20.154987 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:20.155121 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:20.361343 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-04-27 16:55:20.365983 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:20.366096 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:20.522435 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:55:20.524800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:20.524932 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:20.840758 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:55:20.842086 (Thread-1): 16:55:20 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:20.842300 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:20.842482 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:20.842579 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:21.088753 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:55:21.089902 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:21.090014 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:21.235877 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:55:21.237264 (Thread-1): 16:55:21 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:21.242631 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:21.242772 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:21.396653 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:55:21.396838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:21.396922 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:22.703942 (Thread-1): SQL status: SUCCESS 1 in 1.31 seconds
2021-04-27 16:55:22.708148 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:22.708261 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:22.862994 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:55:22.867449 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:22.867572 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:23.002117 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:55:23.004408 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:23.004513 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:23.336941 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-04-27 16:55:23.338153 (Thread-1): 16:55:23 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:23.338365 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:23.338537 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:23.338623 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:23.536982 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:55:23.538078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:23.538180 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-04-27 16:55:23.654701 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:55:23.656129 (Thread-1): 16:55:23 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_orders]
2021-04-27 16:55:23.661815 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:23.661922 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-04-27 16:55:23.799421 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:55:23.799608 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:23.799693 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:24.861410 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-04-27 16:55:24.865397 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:24.865515 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-04-27 16:55:25.020464 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:55:25.026623 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:25.026751 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-04-27 16:55:25.168292 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:55:25.170572 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:25.170675 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-04-27 16:55:25.501521 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-04-27 16:55:25.502820 (Thread-1): 16:55:25 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_orders]
2021-04-27 16:55:25.503023 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:25.503220 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-04-27 16:55:25.503308 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-04-27 16:55:25.701785 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:55:25.707218 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_orders"
2021-04-27 16:55:25.710456 (Thread-1): finished collecting timing info
2021-04-27 16:55:25.710755 (Thread-1): On model.Dbt_demo.sat_orders: Close
2021-04-27 16:55:25.929115 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29718c8b80>]}
2021-04-27 16:55:25.930544 (Thread-1): 16:55:25 | 14 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_orders [INSERT 0 in 85.74s]
2021-04-27 16:55:25.930723 (Thread-1): Finished running node model.Dbt_demo.sat_orders
2021-04-27 16:55:25.930897 (Thread-1): Began running node model.Dbt_demo.hub_products
2021-04-27 16:55:25.932030 (Thread-1): 16:55:25 | 15 of 23 START incremental model SS_RAW_VLT.hub_products............. [RUN]
2021-04-27 16:55:25.932468 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:25.932602 (Thread-1): Compiling model.Dbt_demo.hub_products
2021-04-27 16:55:25.945421 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_products"
2021-04-27 16:55:25.945785 (Thread-1): finished collecting timing info
2021-04-27 16:55:25.953378 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:25.953494 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_PK, PRODUCTID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_PK, a.PRODUCTID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products AS d
    ON a.PRODUCT_PK = d.PRODUCT_PK
    WHERE d.PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:55:25.953610 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:55:27.740836 (Thread-1): SQL status: SUCCESS 1 in 1.79 seconds
2021-04-27 16:55:27.744451 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:27.744570 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
2021-04-27 16:55:27.897593 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-04-27 16:55:27.901612 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:27.901723 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-04-27 16:55:28.193857 (Thread-1): SQL status: SUCCESS 4 in 0.29 seconds
2021-04-27 16:55:28.197979 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:28.198106 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-04-27 16:55:28.483819 (Thread-1): SQL status: SUCCESS 4 in 0.29 seconds
2021-04-27 16:55:28.485506 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_products"
2021-04-27 16:55:28.486298 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:28.486399 (Thread-1): On model.Dbt_demo.hub_products: BEGIN
2021-04-27 16:55:28.630237 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:55:28.630423 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:28.630507 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products ("PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
        );
2021-04-27 16:55:28.896551 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:55:28.897753 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-04-27 16:55:28.897931 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-04-27 16:55:28.898019 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-04-27 16:55:29.358571 (Thread-1): SQL status: SUCCESS 1 in 0.46 seconds
2021-04-27 16:55:29.364786 (Thread-1): finished collecting timing info
2021-04-27 16:55:29.365094 (Thread-1): On model.Dbt_demo.hub_products: Close
2021-04-27 16:55:29.694334 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29718c8b80>]}
2021-04-27 16:55:29.695831 (Thread-1): 16:55:29 | 15 of 23 OK created incremental model SS_RAW_VLT.hub_products........ [SUCCESS 0 in 3.76s]
2021-04-27 16:55:29.696004 (Thread-1): Finished running node model.Dbt_demo.hub_products
2021-04-27 16:55:29.696174 (Thread-1): Began running node model.Dbt_demo.link_prod_supp
2021-04-27 16:55:29.697406 (Thread-1): 16:55:29 | 16 of 23 START incremental model SS_RAW_VLT.link_prod_supp........... [RUN]
2021-04-27 16:55:29.697771 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:29.697895 (Thread-1): Compiling model.Dbt_demo.link_prod_supp
2021-04-27 16:55:29.710935 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_prod_supp"
2021-04-27 16:55:29.711286 (Thread-1): finished collecting timing info
2021-04-27 16:55:29.719090 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:29.719261 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_SUPPLIER_PK, PRODUCT_PK, SUPPLIER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_SUPPLIER_PK, a.PRODUCT_PK, a.SUPPLIER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp AS d
    ON a.PRODUCT_SUPPLIER_PK = d.PRODUCT_SUPPLIER_PK
    WHERE d.PRODUCT_SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:55:29.719365 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:55:34.146890 (Thread-1): SQL status: SUCCESS 1 in 4.43 seconds
2021-04-27 16:55:34.150643 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:34.150789 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
2021-04-27 16:55:35.393228 (Thread-1): SQL status: SUCCESS 5 in 1.24 seconds
2021-04-27 16:55:35.397312 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:35.397421 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-04-27 16:55:35.690743 (Thread-1): SQL status: SUCCESS 5 in 0.29 seconds
2021-04-27 16:55:35.694871 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:35.694988 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-04-27 16:55:35.888754 (Thread-1): SQL status: SUCCESS 5 in 0.19 seconds
2021-04-27 16:55:35.890508 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_prod_supp"
2021-04-27 16:55:35.891337 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:35.891439 (Thread-1): On model.Dbt_demo.link_prod_supp: BEGIN
2021-04-27 16:55:36.050381 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:55:36.050570 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:36.050654 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp ("PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
        );
2021-04-27 16:55:37.235181 (Thread-1): SQL status: SUCCESS 0 in 1.18 seconds
2021-04-27 16:55:37.236380 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-04-27 16:55:37.236555 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-04-27 16:55:37.236643 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-04-27 16:55:37.722029 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-04-27 16:55:37.726697 (Thread-1): finished collecting timing info
2021-04-27 16:55:37.727017 (Thread-1): On model.Dbt_demo.link_prod_supp: Close
2021-04-27 16:55:38.224301 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971465640>]}
2021-04-27 16:55:38.225723 (Thread-1): 16:55:38 | 16 of 23 OK created incremental model SS_RAW_VLT.link_prod_supp...... [SUCCESS 0 in 8.53s]
2021-04-27 16:55:38.225893 (Thread-1): Finished running node model.Dbt_demo.link_prod_supp
2021-04-27 16:55:38.226080 (Thread-1): Began running node model.Dbt_demo.sat_products
2021-04-27 16:55:38.227366 (Thread-1): 16:55:38 | 17 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_products.. [RUN]
2021-04-27 16:55:38.227708 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:38.227830 (Thread-1): Compiling model.Dbt_demo.sat_products
2021-04-27 16:55:38.251446 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_products"
2021-04-27 16:55:38.251836 (Thread-1): finished collecting timing info
2021-04-27 16:55:38.259528 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:38.259680 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 16:55:38.259795 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:55:39.585015 (Thread-1): SQL status: SUCCESS 1 in 1.33 seconds
2021-04-27 16:55:39.588490 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:39.588602 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 09:55:39.270000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 09:55:39.270000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_products
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 16:55:40.095610 (Thread-1): SQL status: SUCCESS 1 in 0.51 seconds
2021-04-27 16:55:40.099507 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:40.099619 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:55:40.443822 (Thread-1): SQL status: SUCCESS 12 in 0.34 seconds
2021-04-27 16:55:40.446323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:40.446440 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:55:40.573303 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:55:40.574713 (Thread-1): 16:55:40 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_products]
2021-04-27 16:55:40.580304 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:40.580418 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:55:40.733274 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:55:40.733460 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:40.733545 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:42.874122 (Thread-1): SQL status: SUCCESS 1 in 2.14 seconds
2021-04-27 16:55:42.878063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:42.878182 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:55:43.691542 (Thread-1): SQL status: SUCCESS 12 in 0.81 seconds
2021-04-27 16:55:43.697195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:43.697357 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:55:43.860398 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:55:43.862711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:43.862814 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:55:45.260458 (Thread-1): SQL status: SUCCESS 0 in 1.40 seconds
2021-04-27 16:55:45.261734 (Thread-1): 16:55:45 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:55:45.261942 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:45.262120 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:45.262208 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:45.723474 (Thread-1): SQL status: SUCCESS 1 in 0.46 seconds
2021-04-27 16:55:45.724599 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:45.724702 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:55:45.971526 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:55:45.972930 (Thread-1): 16:55:45 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_products]
2021-04-27 16:55:45.978783 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:45.978919 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:55:46.234453 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:55:46.234635 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:46.234720 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:47.866732 (Thread-1): SQL status: SUCCESS 1 in 1.63 seconds
2021-04-27 16:55:47.870769 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:47.870886 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:55:48.777340 (Thread-1): SQL status: SUCCESS 12 in 0.91 seconds
2021-04-27 16:55:48.781906 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:48.782035 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:55:49.307323 (Thread-1): SQL status: SUCCESS 12 in 0.53 seconds
2021-04-27 16:55:49.309614 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:49.309725 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:55:49.627639 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:55:49.628935 (Thread-1): 16:55:49 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:55:49.629141 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:49.629319 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:49.629406 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:49.862984 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:55:49.864454 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:49.864563 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:55:50.383936 (Thread-1): SQL status: SUCCESS 1 in 0.52 seconds
2021-04-27 16:55:50.385359 (Thread-1): 16:55:50 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_products]
2021-04-27 16:55:50.390801 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:50.390911 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:55:50.550372 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:55:50.550555 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:50.550645 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:51.536223 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 16:55:51.540183 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:51.540299 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:55:52.408863 (Thread-1): SQL status: SUCCESS 12 in 0.87 seconds
2021-04-27 16:55:52.413346 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:52.413471 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:55:52.562653 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:55:52.564975 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:52.565090 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:55:53.624743 (Thread-1): SQL status: SUCCESS 0 in 1.06 seconds
2021-04-27 16:55:53.626072 (Thread-1): 16:55:53 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:55:53.626292 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:53.626478 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:53.626574 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:53.865853 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:55:53.866954 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:53.867055 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:55:54.010812 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:55:54.012589 (Thread-1): 16:55:54 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_products]
2021-04-27 16:55:54.017971 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:54.018097 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:55:54.420446 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:55:54.420628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:54.420715 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:56.903345 (Thread-1): SQL status: SUCCESS 1 in 2.48 seconds
2021-04-27 16:55:56.908795 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:56.908937 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:55:57.092176 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:55:57.096626 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:57.096735 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:55:57.249533 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:55:57.251880 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:57.252002 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:55:57.540809 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:55:57.542403 (Thread-1): 16:55:57 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:55:57.542619 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:57.542793 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:57.542880 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:57.761252 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:55:57.762378 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:57.762482 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:55:57.895332 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:55:57.896778 (Thread-1): 16:55:57 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_products]
2021-04-27 16:55:57.902936 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:57.903051 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:55:58.061829 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:55:58.062031 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:58.062121 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:55:59.000806 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 16:55:59.004816 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:59.004937 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:55:59.180585 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:55:59.185065 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:59.185185 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:55:59.327706 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:55:59.329992 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:59.330094 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:55:59.636400 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:55:59.637700 (Thread-1): 16:55:59 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:55:59.637919 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:59.638106 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:59.638198 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:55:59.854805 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:55:59.855940 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:59.856043 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:55:59.989721 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:55:59.991555 (Thread-1): 16:55:59 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_products]
2021-04-27 16:55:59.997000 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:55:59.997106 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:00.158762 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:56:00.158960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:00.159045 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:01.072028 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-04-27 16:56:01.076002 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:01.076117 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:01.291775 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-04-27 16:56:01.296169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:01.296277 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:01.513460 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-04-27 16:56:01.515761 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:01.515870 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:01.796589 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:56:01.799988 (Thread-1): 16:56:01 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:01.800220 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:01.800397 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:01.800481 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:02.018979 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:56:02.020101 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:02.020203 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:02.159309 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:02.160757 (Thread-1): 16:56:02 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_products]
2021-04-27 16:56:02.166954 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:02.167067 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:02.410002 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:56:02.410194 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:02.410280 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:03.787394 (Thread-1): SQL status: SUCCESS 1 in 1.38 seconds
2021-04-27 16:56:03.791356 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:03.791474 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:03.963167 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:03.967628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:03.967737 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:04.138617 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:04.140976 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:04.141080 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:04.439576 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:56:04.440852 (Thread-1): 16:56:04 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:04.441057 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:04.441229 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:04.441315 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:04.977796 (Thread-1): SQL status: SUCCESS 1 in 0.54 seconds
2021-04-27 16:56:04.978897 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:04.979000 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:05.191844 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:56:05.193674 (Thread-1): 16:56:05 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_products]
2021-04-27 16:56:05.199553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:05.199677 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:05.376125 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:56:05.376312 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:05.376398 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:06.799730 (Thread-1): SQL status: SUCCESS 1 in 1.42 seconds
2021-04-27 16:56:06.803720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:06.803850 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:07.612405 (Thread-1): SQL status: SUCCESS 12 in 0.81 seconds
2021-04-27 16:56:07.616954 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:07.617103 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:07.763170 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:56:07.765444 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:07.765554 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:08.387426 (Thread-1): SQL status: SUCCESS 0 in 0.62 seconds
2021-04-27 16:56:08.389020 (Thread-1): 16:56:08 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:08.389238 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:08.389418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:08.389508 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:08.600330 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:56:08.601425 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:08.601528 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:08.743750 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:08.745167 (Thread-1): 16:56:08 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_products]
2021-04-27 16:56:08.750961 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:08.751072 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:08.916925 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:56:08.917109 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:08.917193 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:13.745888 (Thread-1): SQL status: SUCCESS 1 in 4.83 seconds
2021-04-27 16:56:13.749842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:13.749965 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:14.456092 (Thread-1): SQL status: SUCCESS 12 in 0.71 seconds
2021-04-27 16:56:14.563266 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:14.563437 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:14.764570 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 16:56:14.766862 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:14.766973 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:15.535934 (Thread-1): SQL status: SUCCESS 0 in 0.77 seconds
2021-04-27 16:56:15.537538 (Thread-1): 16:56:15 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:15.537751 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:15.537939 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:15.538029 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:15.802393 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:56:15.803514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:15.803618 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:15.937199 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:56:15.938628 (Thread-1): 16:56:15 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_products]
2021-04-27 16:56:15.944563 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:15.944678 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:16.102870 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:56:16.103069 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:16.103200 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:18.097274 (Thread-1): SQL status: SUCCESS 1 in 1.99 seconds
2021-04-27 16:56:18.101256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:18.101379 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:18.266751 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:18.271319 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:18.271431 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:18.447336 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:56:18.449637 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:18.449739 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:19.212148 (Thread-1): SQL status: SUCCESS 0 in 0.76 seconds
2021-04-27 16:56:19.213421 (Thread-1): 16:56:19 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:19.213628 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:19.213804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:19.213891 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:19.439157 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:56:19.440274 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:19.440381 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:19.849678 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-04-27 16:56:19.851486 (Thread-1): 16:56:19 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_products]
2021-04-27 16:56:19.856959 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:19.857098 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:20.020362 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:56:20.020542 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:20.020628 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:20.994966 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:56:20.998934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:20.999044 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:21.181820 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:56:21.186273 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:21.186381 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:21.324417 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:21.326743 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:21.326860 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:21.878279 (Thread-1): SQL status: SUCCESS 0 in 0.55 seconds
2021-04-27 16:56:21.879885 (Thread-1): 16:56:21 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:21.880090 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:21.880261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:21.880346 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:22.099793 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:56:22.100912 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:22.101024 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:22.239645 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:22.241074 (Thread-1): 16:56:22 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_products]
2021-04-27 16:56:22.246934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:22.247124 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:22.415393 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:56:22.415592 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:22.415695 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:23.366008 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:56:23.371651 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:23.371810 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:23.542582 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:23.547246 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:23.547365 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:23.702856 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:56:23.705198 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:23.705303 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:24.053889 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 16:56:24.055233 (Thread-1): 16:56:24 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:24.055446 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:24.055627 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:24.055718 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:24.325499 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:56:24.326600 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:24.326701 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:24.461161 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:56:24.463031 (Thread-1): 16:56:24 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_products]
2021-04-27 16:56:24.468522 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:24.468647 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:24.640259 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:56:24.640447 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:24.640531 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:25.637319 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 16:56:25.641364 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:25.641506 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:25.798730 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:56:25.803250 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:25.803375 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:25.946592 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:25.948901 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:25.949005 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:26.206694 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 16:56:26.208325 (Thread-1): 16:56:26 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:26.208532 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:26.208705 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:26.208792 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:26.420165 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:56:26.421255 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:26.421363 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:26.562727 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:26.564130 (Thread-1): 16:56:26 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_products]
2021-04-27 16:56:26.569581 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:26.569686 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:26.734456 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:56:26.734636 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:26.734721 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:27.675886 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 16:56:27.679714 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:27.679833 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:27.840968 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:56:27.845399 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:27.845525 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:27.984538 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:27.986849 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:27.986955 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:28.297669 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:56:28.298953 (Thread-1): 16:56:28 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:28.299185 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:28.299375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:28.299463 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:28.523978 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:56:28.525110 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:28.525218 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:28.671016 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:56:28.674684 (Thread-1): 16:56:28 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_products]
2021-04-27 16:56:28.680175 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:28.680332 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:28.832373 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:56:28.832562 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:28.832646 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:29.836961 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 16:56:29.840919 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:29.841034 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:30.038303 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 16:56:30.042835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:30.042980 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:30.178594 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:30.180908 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:30.181014 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:30.486703 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:56:30.488406 (Thread-1): 16:56:30 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:30.488621 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:30.488801 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:30.488892 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:30.708091 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:56:30.709198 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:30.709305 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:30.843952 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:56:30.845372 (Thread-1): 16:56:30 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_products]
2021-04-27 16:56:30.850967 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:30.851118 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:31.060432 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:56:31.060624 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:31.060714 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:32.122284 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-04-27 16:56:32.126171 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:32.126300 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:32.316678 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:56:32.321084 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:32.321201 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:32.456283 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:56:32.458589 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:32.458697 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:32.805239 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 16:56:32.806540 (Thread-1): 16:56:32 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:32.806753 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:32.806932 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:32.807021 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:33.038541 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:56:33.039691 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:33.039796 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:33.177631 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:33.179057 (Thread-1): 16:56:33 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_products]
2021-04-27 16:56:33.184962 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:33.185080 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:33.343543 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:56:33.343725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:33.343809 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:34.323391 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-04-27 16:56:34.327463 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:34.327594 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:34.560893 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-04-27 16:56:34.567377 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:34.567536 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:34.707889 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:34.710176 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:34.710279 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:35.102873 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-04-27 16:56:35.104150 (Thread-1): 16:56:35 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:35.104356 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:35.104530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:35.104615 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:35.471888 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-04-27 16:56:35.473387 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:35.473493 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:35.615551 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:35.616973 (Thread-1): 16:56:35 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_products]
2021-04-27 16:56:35.622508 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:35.622660 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:35.880423 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:56:35.880607 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:35.880691 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:36.876406 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 16:56:36.880620 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:36.880730 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:37.058283 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:56:37.062669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:37.062776 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:37.337259 (Thread-1): SQL status: SUCCESS 12 in 0.27 seconds
2021-04-27 16:56:37.339628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:37.339739 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:37.641648 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:56:37.642931 (Thread-1): 16:56:37 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:37.643160 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:37.643335 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:37.643421 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:37.897667 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:56:37.898779 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:37.898881 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:38.038314 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:38.040152 (Thread-1): 16:56:38 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_products]
2021-04-27 16:56:38.045547 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:38.045655 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:38.297124 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:56:38.297304 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:38.297390 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:39.480194 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-04-27 16:56:39.484195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:39.484316 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:39.657025 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:39.661542 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:39.661663 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:39.809182 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:56:39.811462 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:39.811568 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:40.175036 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-04-27 16:56:40.176645 (Thread-1): 16:56:40 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:40.176857 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:40.177032 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:40.177120 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:40.429575 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:56:40.430700 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:40.430810 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:40.562393 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:56:40.563826 (Thread-1): 16:56:40 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_products]
2021-04-27 16:56:40.569667 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:40.569783 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:40.768673 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:56:40.768857 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:40.768940 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:42.469037 (Thread-1): SQL status: SUCCESS 1 in 1.70 seconds
2021-04-27 16:56:42.474411 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:42.474527 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:42.641725 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:42.646205 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:42.646337 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:42.811490 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:42.813782 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:42.813885 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:43.066285 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-04-27 16:56:43.067608 (Thread-1): 16:56:43 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:43.067814 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:43.067989 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:43.068076 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:43.287013 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:56:43.288168 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:43.288271 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:43.516360 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:56:43.518156 (Thread-1): 16:56:43 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_products]
2021-04-27 16:56:43.523701 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:43.523809 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:43.702134 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:56:43.702327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:43.702414 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:44.650026 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:56:44.654092 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:44.654222 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:44.822525 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:44.827097 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:44.827228 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:44.964907 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:44.967241 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:44.967346 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:45.258358 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:56:45.260085 (Thread-1): 16:56:45 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:45.260331 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:45.260510 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:45.260597 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:45.495596 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:56:45.496725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:45.496828 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:45.628106 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:56:45.629524 (Thread-1): 16:56:45 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_products]
2021-04-27 16:56:45.635004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:45.635147 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:46.167637 (Thread-1): SQL status: SUCCESS 1 in 0.53 seconds
2021-04-27 16:56:46.167817 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:46.167910 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:47.162307 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 16:56:47.166282 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:47.166404 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:47.625607 (Thread-1): SQL status: SUCCESS 12 in 0.46 seconds
2021-04-27 16:56:47.630004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:47.630110 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:47.771289 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:47.773562 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:47.773666 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:48.070899 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:56:48.072199 (Thread-1): 16:56:48 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:48.072405 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:48.072582 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:48.072669 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:48.280487 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:56:48.281590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:48.281692 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:48.542825 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:56:48.546471 (Thread-1): 16:56:48 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_products]
2021-04-27 16:56:48.551951 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:48.552080 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:48.713202 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:56:48.713394 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:48.713477 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:49.742460 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 16:56:49.746417 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:49.746533 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:49.920230 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:49.924634 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:49.924742 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:50.236774 (Thread-1): SQL status: SUCCESS 12 in 0.31 seconds
2021-04-27 16:56:50.239048 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:50.239177 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:50.518141 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:56:50.519454 (Thread-1): 16:56:50 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:50.519668 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:50.519842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:50.519927 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:50.758684 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:56:50.759880 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:50.760010 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:50.901086 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:56:50.902530 (Thread-1): 16:56:50 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_products]
2021-04-27 16:56:50.908192 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:50.908316 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:51.062306 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:56:51.062494 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:51.062591 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:53.549665 (Thread-1): SQL status: SUCCESS 1 in 2.49 seconds
2021-04-27 16:56:53.553533 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:53.553649 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:53.740383 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:56:53.744848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:53.744992 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:53.891838 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:56:53.894115 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:53.894219 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:54.177729 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:56:54.178999 (Thread-1): 16:56:54 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:54.179241 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:54.179425 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:54.179517 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:54.419333 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:56:54.420450 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:54.420553 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-04-27 16:56:54.642564 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:56:54.644453 (Thread-1): 16:56:54 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_products]
2021-04-27 16:56:54.649988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:54.650119 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-04-27 16:56:54.802714 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:56:54.802907 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:54.802994 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:56:55.744378 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 16:56:55.748387 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:55.748509 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-04-27 16:56:55.919816 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:56:55.925861 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:55.925972 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-04-27 16:56:56.064345 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:56:56.066626 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:56.066729 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-04-27 16:56:56.498361 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-04-27 16:56:56.499637 (Thread-1): 16:56:56 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_products]
2021-04-27 16:56:56.499851 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:56.500026 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-04-27 16:56:56.500112 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-04-27 16:56:56.720625 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:56:56.721092 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_products"
2021-04-27 16:56:56.724603 (Thread-1): finished collecting timing info
2021-04-27 16:56:56.724880 (Thread-1): On model.Dbt_demo.sat_products: Close
2021-04-27 16:56:56.958270 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29718c8b80>]}
2021-04-27 16:56:56.959726 (Thread-1): 16:56:56 | 17 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_products [INSERT 0 in 78.73s]
2021-04-27 16:56:56.959908 (Thread-1): Finished running node model.Dbt_demo.sat_products
2021-04-27 16:56:56.960079 (Thread-1): Began running node model.Dbt_demo.hub_customers
2021-04-27 16:56:56.961323 (Thread-1): 16:56:56 | 18 of 23 START incremental model SS_RAW_VLT.hub_customers............ [RUN]
2021-04-27 16:56:56.961630 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:56.961750 (Thread-1): Compiling model.Dbt_demo.hub_customers
2021-04-27 16:56:56.974472 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_customers"
2021-04-27 16:56:56.974806 (Thread-1): finished collecting timing info
2021-04-27 16:56:56.982487 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:56.982637 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT CUSTOMER_PK, CUSTOMERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:56:56.982740 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:56:58.605287 (Thread-1): SQL status: SUCCESS 1 in 1.62 seconds
2021-04-27 16:56:58.608888 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:58.609030 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
2021-04-27 16:56:58.843565 (Thread-1): SQL status: SUCCESS 4 in 0.23 seconds
2021-04-27 16:56:58.847554 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:58.847692 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-04-27 16:56:59.027980 (Thread-1): SQL status: SUCCESS 4 in 0.18 seconds
2021-04-27 16:56:59.032007 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:59.032115 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-04-27 16:56:59.169582 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-04-27 16:56:59.171303 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_customers"
2021-04-27 16:56:59.172069 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:59.172167 (Thread-1): On model.Dbt_demo.hub_customers: BEGIN
2021-04-27 16:56:59.325874 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:56:59.326063 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:59.326148 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers ("CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
        );
2021-04-27 16:56:59.611862 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:56:59.613040 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-04-27 16:56:59.613214 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-04-27 16:56:59.613302 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-04-27 16:56:59.851869 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:56:59.858322 (Thread-1): finished collecting timing info
2021-04-27 16:56:59.858640 (Thread-1): On model.Dbt_demo.hub_customers: Close
2021-04-27 16:57:00.086578 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971510400>]}
2021-04-27 16:57:00.088054 (Thread-1): 16:57:00 | 18 of 23 OK created incremental model SS_RAW_VLT.hub_customers....... [SUCCESS 0 in 3.12s]
2021-04-27 16:57:00.088227 (Thread-1): Finished running node model.Dbt_demo.hub_customers
2021-04-27 16:57:00.088407 (Thread-1): Began running node model.Dbt_demo.sat_customers
2021-04-27 16:57:00.089650 (Thread-1): 16:57:00 | 19 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_customers. [RUN]
2021-04-27 16:57:00.089964 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:00.090084 (Thread-1): Compiling model.Dbt_demo.sat_customers
2021-04-27 16:57:00.112141 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_customers"
2021-04-27 16:57:00.112518 (Thread-1): finished collecting timing info
2021-04-27 16:57:00.120170 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:00.120290 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 16:57:00.120392 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:57:00.953050 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-04-27 16:57:00.956415 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:00.956524 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 09:57:00.562000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 09:57:00.562000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_customers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 16:57:01.145705 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:57:01.149785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:01.149901 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:01.317876 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:57:01.320319 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:01.320424 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:01.463157 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:57:01.464564 (Thread-1): 16:57:01 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:01.470071 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:01.470215 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:01.613360 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:57:01.613558 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:01.613645 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:02.491943 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-04-27 16:57:02.496935 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:02.497086 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:02.652094 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:02.656637 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:02.656788 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:02.867010 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-04-27 16:57:02.869614 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:02.869732 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:03.188924 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:57:03.190217 (Thread-1): 16:57:03 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:03.190427 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:03.190606 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:03.190697 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:03.504908 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 16:57:03.506041 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:03.506150 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:03.630330 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:57:03.631844 (Thread-1): 16:57:03 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:03.637748 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:03.637906 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:03.860190 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:57:03.860380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:03.860468 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:05.631273 (Thread-1): SQL status: SUCCESS 1 in 1.77 seconds
2021-04-27 16:57:05.635230 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:05.635339 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:05.815679 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:57:05.820228 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:05.820349 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:06.023551 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 16:57:06.025853 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:06.025972 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:06.656661 (Thread-1): SQL status: SUCCESS 0 in 0.63 seconds
2021-04-27 16:57:06.657921 (Thread-1): 16:57:06 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:06.658144 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:06.658326 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:06.658414 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:07.195605 (Thread-1): SQL status: SUCCESS 1 in 0.54 seconds
2021-04-27 16:57:07.197063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:07.197171 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:07.381436 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:57:07.382825 (Thread-1): 16:57:07 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:07.388313 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:07.388435 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:07.571764 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:57:07.571956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:07.572046 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:10.315267 (Thread-1): SQL status: SUCCESS 1 in 2.74 seconds
2021-04-27 16:57:10.319376 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:10.319486 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:10.492254 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:57:10.496612 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:10.496725 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:10.634293 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:57:10.636879 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:10.637009 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:11.030123 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-04-27 16:57:11.031422 (Thread-1): 16:57:11 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:11.031631 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:11.031804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:11.031890 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:11.496600 (Thread-1): SQL status: SUCCESS 1 in 0.46 seconds
2021-04-27 16:57:11.497701 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:11.497803 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:11.674197 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:57:11.677566 (Thread-1): 16:57:11 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:11.682882 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:11.683036 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:11.842953 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:57:11.843165 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:11.843270 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:13.516349 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2021-04-27 16:57:13.520279 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:13.520387 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:13.798224 (Thread-1): SQL status: SUCCESS 12 in 0.28 seconds
2021-04-27 16:57:13.802678 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:13.802783 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:14.033595 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-04-27 16:57:14.035913 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:14.036017 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:14.333697 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:57:14.334970 (Thread-1): 16:57:14 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:14.335217 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:14.335391 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:14.335477 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:14.615745 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:57:14.616800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:14.616902 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:14.857054 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:57:14.858493 (Thread-1): 16:57:14 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:14.863892 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:14.864001 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:15.018336 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:15.018517 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:15.018601 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:15.987012 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:57:15.990951 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:15.991064 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:16.151879 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:57:16.156329 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:16.156464 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:16.312036 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:57:16.314317 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:16.314431 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:16.587701 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:57:16.589022 (Thread-1): 16:57:16 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:16.589261 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:16.589453 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:16.589542 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:16.792245 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:57:16.793362 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:16.793472 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:16.925218 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:16.927046 (Thread-1): 16:57:16 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:16.932415 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:16.932526 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:17.115919 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:57:17.116106 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:17.116191 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:18.462419 (Thread-1): SQL status: SUCCESS 1 in 1.35 seconds
2021-04-27 16:57:18.466546 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:18.466662 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:18.637639 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:57:18.643894 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:18.644046 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:18.778344 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:18.780727 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:18.780837 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:19.170762 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-04-27 16:57:19.172056 (Thread-1): 16:57:19 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:19.172262 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:19.172443 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:19.172536 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:19.400153 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:57:19.401709 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:19.401823 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:19.523999 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:57:19.525421 (Thread-1): 16:57:19 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:19.530811 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:19.530950 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:19.704106 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:57:19.704301 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:19.704389 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:20.743817 (Thread-1): SQL status: SUCCESS 1 in 1.04 seconds
2021-04-27 16:57:20.748145 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:20.748279 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:20.899797 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:20.904321 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:20.904444 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:21.053735 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:21.056345 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:21.056492 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:21.368685 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:57:21.370002 (Thread-1): 16:57:21 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:21.370221 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:21.370396 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:21.370500 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:21.577114 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:57:21.578208 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:21.578310 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:21.714550 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:57:21.716019 (Thread-1): 16:57:21 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:21.721885 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:21.722006 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:21.887678 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:57:21.887870 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:21.887959 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:22.855800 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:57:22.859860 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:22.859977 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:23.050923 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:57:23.055380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:23.055487 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:23.201094 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:23.203375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:23.203487 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:23.521977 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:57:23.523279 (Thread-1): 16:57:23 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:23.523489 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:23.523663 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:23.523749 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:23.751443 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:57:23.752927 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:23.753035 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:23.880550 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:23.881985 (Thread-1): 16:57:23 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:23.887491 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:23.887611 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:24.047651 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:57:24.047839 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:24.047929 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:25.178850 (Thread-1): SQL status: SUCCESS 1 in 1.13 seconds
2021-04-27 16:57:25.184420 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:25.184544 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:25.337344 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:25.435513 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:25.435686 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:25.570474 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:25.572819 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:25.572924 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:25.873048 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:57:25.874307 (Thread-1): 16:57:25 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:25.874514 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:25.874690 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:25.874780 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:26.081255 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:57:26.082762 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:26.082867 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:26.210708 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:26.212144 (Thread-1): 16:57:26 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:26.217540 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:26.217679 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:26.391452 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:57:26.391637 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:26.391722 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:27.299603 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-04-27 16:57:27.303858 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:27.303980 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:27.470592 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:57:27.475351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:27.475467 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:27.609535 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:27.612132 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:27.612248 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:27.899490 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:57:27.900806 (Thread-1): 16:57:27 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:27.901038 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:27.901218 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:27.901305 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:28.136642 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:57:28.137759 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:28.137868 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:28.268415 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:28.270213 (Thread-1): 16:57:28 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:28.275542 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:28.275656 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:28.426134 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:28.426316 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:28.426401 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:29.321577 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-04-27 16:57:29.325612 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:29.325748 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:29.482288 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:57:29.486717 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:29.486822 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:29.621242 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:29.623601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:29.623717 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:29.929370 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:57:29.930946 (Thread-1): 16:57:29 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:29.931177 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:29.931351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:29.931438 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:30.145624 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:57:30.146699 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:30.146806 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:30.274524 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:30.275983 (Thread-1): 16:57:30 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:30.283412 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:30.283533 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:30.566773 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:57:30.566957 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:30.567042 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:32.260946 (Thread-1): SQL status: SUCCESS 1 in 1.69 seconds
2021-04-27 16:57:32.264790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:32.264907 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:32.414903 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:32.419403 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:32.419527 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:32.559905 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:57:32.562190 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:32.562309 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:32.898793 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 16:57:32.900128 (Thread-1): 16:57:32 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:32.900346 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:32.900523 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:32.900611 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:33.140463 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:57:33.141571 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:33.141675 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:33.262247 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:57:33.264049 (Thread-1): 16:57:33 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:33.269295 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:33.269407 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:33.416074 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:33.416253 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:33.416337 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:35.462056 (Thread-1): SQL status: SUCCESS 1 in 2.05 seconds
2021-04-27 16:57:35.466145 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:35.466274 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:35.629848 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:57:35.634327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:35.634446 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:35.780098 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:57:35.782369 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:35.782475 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:36.045829 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 16:57:36.047425 (Thread-1): 16:57:36 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:36.047632 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:36.047805 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:36.047903 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:36.257193 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:57:36.258345 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:36.258454 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:36.469134 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:57:36.470535 (Thread-1): 16:57:36 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:36.475898 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:36.476011 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:36.626300 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:36.626493 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:36.626581 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:37.577666 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:57:37.581615 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:37.581736 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:37.890637 (Thread-1): SQL status: SUCCESS 12 in 0.31 seconds
2021-04-27 16:57:37.895088 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:37.895224 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:38.040790 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:38.043146 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:38.043287 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:38.337930 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:57:38.339294 (Thread-1): 16:57:38 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:38.339526 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:38.339713 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:38.339804 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:38.540031 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:57:38.541184 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:38.541292 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:38.663062 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:57:38.665012 (Thread-1): 16:57:38 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:38.670849 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:38.671014 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:38.832624 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:57:38.832811 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:38.832895 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:39.992380 (Thread-1): SQL status: SUCCESS 1 in 1.16 seconds
2021-04-27 16:57:39.996479 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:39.996625 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:40.188546 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:57:40.193114 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:40.193234 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:40.325369 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:40.327699 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:40.327803 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:40.748546 (Thread-1): SQL status: SUCCESS 0 in 0.42 seconds
2021-04-27 16:57:40.750149 (Thread-1): 16:57:40 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:40.750367 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:40.750544 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:40.750635 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:40.961846 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:57:40.962960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:40.963061 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:41.093702 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:41.095134 (Thread-1): 16:57:41 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:41.100528 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:41.100637 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:41.294142 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:57:41.294334 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:41.294419 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:42.432883 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-04-27 16:57:42.436876 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:42.436995 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:42.635634 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 16:57:42.640119 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:42.640240 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:42.806244 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:57:42.808578 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:42.808682 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:43.123743 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:57:43.125064 (Thread-1): 16:57:43 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:43.125279 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:43.125461 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:43.125551 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:43.526971 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:57:43.528096 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:43.528199 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:43.683077 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:43.684889 (Thread-1): 16:57:43 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:43.690268 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:43.690383 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:43.836984 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:43.837179 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:43.837263 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:44.757849 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-04-27 16:57:44.761881 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:44.762004 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:44.940838 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:57:44.946783 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:44.946898 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:45.083156 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:57:45.085451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:45.085555 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:45.352647 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:57:45.353987 (Thread-1): 16:57:45 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:45.354204 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:45.354386 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:45.354479 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:45.556018 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:57:45.557081 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:45.557182 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:45.687403 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:45.688816 (Thread-1): 16:57:45 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:45.694333 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:45.694439 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:45.856234 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:57:45.856416 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:45.856500 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:46.829989 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:57:46.833907 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:46.834016 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:47.000947 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:57:47.005383 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:47.005494 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:47.236973 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-04-27 16:57:47.239360 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:47.239468 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:47.525311 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:57:47.526685 (Thread-1): 16:57:47 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:47.526903 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:47.527094 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:47.527220 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:47.746486 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:57:47.747648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:47.747755 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:47.873218 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:47.875135 (Thread-1): 16:57:47 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:47.880531 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:47.880642 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:48.043920 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:57:48.044109 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:48.044194 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:48.941809 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-04-27 16:57:48.945822 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:48.945932 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:49.106864 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:57:49.111444 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:49.111566 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:49.240787 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:49.243056 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:49.243191 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:49.527685 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:57:49.529292 (Thread-1): 16:57:49 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:49.529501 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:49.529677 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:49.529769 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:49.751464 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:57:49.752569 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:49.752672 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:49.884005 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:49.885421 (Thread-1): 16:57:49 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:49.892971 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:49.893123 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:50.048988 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:57:50.049173 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:50.049270 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:50.949540 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-04-27 16:57:50.953468 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:50.953584 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:51.104050 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:57:51.108483 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:51.108611 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:51.240656 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:51.242978 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:51.243081 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:51.657381 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-04-27 16:57:51.658669 (Thread-1): 16:57:51 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:51.658882 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:51.659057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:51.659182 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:52.032597 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-04-27 16:57:52.033725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:52.033832 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:52.165020 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:52.166838 (Thread-1): 16:57:52 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:52.172615 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:52.172733 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:52.332704 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:57:52.332892 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:52.332985 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:53.299301 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:57:53.303270 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:53.303380 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:53.462550 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:57:53.467088 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:53.467228 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:53.600983 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:53.603283 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:53.603395 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:53.881898 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:57:53.883493 (Thread-1): 16:57:53 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:53.883701 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:53.883874 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:53.883962 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:54.100913 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:57:54.102021 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:54.102124 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:54.630876 (Thread-1): SQL status: SUCCESS 1 in 0.53 seconds
2021-04-27 16:57:54.632316 (Thread-1): 16:57:54 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:54.638008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:54.638130 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:54.790118 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:54.790308 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:54.790394 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:55.707440 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-04-27 16:57:55.711296 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:55.711408 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:55.872712 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:57:55.877103 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:55.877212 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:56.012270 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:56.014594 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:56.014721 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:56.327008 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:57:56.328324 (Thread-1): 16:57:56 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:56.328541 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:56.328722 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:56.328818 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:56.540837 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:57:56.541977 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:56.542085 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:56.679347 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:57:56.680815 (Thread-1): 16:57:56 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:56.686809 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:56.686967 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:56.860553 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:57:56.860753 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:56.860844 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:57.751313 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-04-27 16:57:57.755272 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:57.755383 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:57:57.944891 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:57:57.949487 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:57.949610 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:57:58.083355 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:57:58.085638 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:58.085742 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:57:58.355913 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:57:58.357195 (Thread-1): 16:57:58 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:57:58.357407 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:58.357596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:58.357682 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:57:58.595728 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:57:58.597199 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:58.597305 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:57:58.724758 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:57:58.726169 (Thread-1): 16:57:58 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_customers]
2021-04-27 16:57:58.731594 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:58.731715 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:57:58.883478 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:57:58.883668 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:58.883752 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:57:59.899060 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-04-27 16:57:59.903412 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:57:59.903546 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:58:00.076586 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:58:00.080973 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:00.081080 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:58:00.216081 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:58:00.218349 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:00.218459 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:58:00.528133 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:58:00.529510 (Thread-1): 16:58:00 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:58:00.529728 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:58:00.529918 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:00.530009 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:58:00.755585 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:58:00.756733 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:00.756841 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-04-27 16:58:00.889599 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:58:00.890993 (Thread-1): 16:58:00 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_customers]
2021-04-27 16:58:00.896757 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:00.896867 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-04-27 16:58:01.055604 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:58:01.055790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:01.055875 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:02.007333 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:58:02.011440 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:02.011596 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-04-27 16:58:02.171800 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:58:02.177737 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:02.177847 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-04-27 16:58:02.306336 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-04-27 16:58:02.308660 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:02.308763 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-04-27 16:58:02.615621 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:58:02.616913 (Thread-1): 16:58:02 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_customers]
2021-04-27 16:58:02.617123 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:58:02.617298 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-04-27 16:58:02.617386 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-04-27 16:58:02.833981 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:58:02.834420 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_customers"
2021-04-27 16:58:02.837900 (Thread-1): finished collecting timing info
2021-04-27 16:58:02.838177 (Thread-1): On model.Dbt_demo.sat_customers: Close
2021-04-27 16:58:03.077888 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29714a8fa0>]}
2021-04-27 16:58:03.079497 (Thread-1): 16:58:03 | 19 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_customers [INSERT 0 in 62.99s]
2021-04-27 16:58:03.079692 (Thread-1): Finished running node model.Dbt_demo.sat_customers
2021-04-27 16:58:03.079874 (Thread-1): Began running node model.Dbt_demo.hub_shippers
2021-04-27 16:58:03.081149 (Thread-1): 16:58:03 | 20 of 23 START incremental model SS_RAW_VLT.hub_shippers............. [RUN]
2021-04-27 16:58:03.081463 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:03.081589 (Thread-1): Compiling model.Dbt_demo.hub_shippers
2021-04-27 16:58:03.094816 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_shippers"
2021-04-27 16:58:03.095208 (Thread-1): finished collecting timing info
2021-04-27 16:58:03.103012 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:03.103181 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SHIPPER_PK, SHIPPERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SHIPPER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SHIPPER_PK, a.SHIPPERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers AS d
    ON a.SHIPPER_PK = d.SHIPPER_PK
    WHERE d.SHIPPER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:58:03.103293 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:58:05.036401 (Thread-1): SQL status: SUCCESS 1 in 1.93 seconds
2021-04-27 16:58:05.039936 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:05.040050 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
2021-04-27 16:58:05.203425 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-04-27 16:58:05.207372 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:05.207504 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-04-27 16:58:05.365059 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-04-27 16:58:05.370581 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:05.370746 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-04-27 16:58:05.525701 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-04-27 16:58:05.527401 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_shippers"
2021-04-27 16:58:05.528179 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:05.528279 (Thread-1): On model.Dbt_demo.hub_shippers: BEGIN
2021-04-27 16:58:05.672152 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:05.672347 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:05.673666 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers ("SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
        );
2021-04-27 16:58:06.006452 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-04-27 16:58:06.007627 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-04-27 16:58:06.007800 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-04-27 16:58:06.007887 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-04-27 16:58:06.316561 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 16:58:06.408707 (Thread-1): finished collecting timing info
2021-04-27 16:58:06.409066 (Thread-1): On model.Dbt_demo.hub_shippers: Close
2021-04-27 16:58:06.674481 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29719bbd90>]}
2021-04-27 16:58:06.676114 (Thread-1): 16:58:06 | 20 of 23 OK created incremental model SS_RAW_VLT.hub_shippers........ [SUCCESS 0 in 3.59s]
2021-04-27 16:58:06.676301 (Thread-1): Finished running node model.Dbt_demo.hub_shippers
2021-04-27 16:58:06.676487 (Thread-1): Began running node model.Dbt_demo.sat_shippers
2021-04-27 16:58:06.677744 (Thread-1): 16:58:06 | 21 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_shippers.. [RUN]
2021-04-27 16:58:06.678096 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:06.678224 (Thread-1): Compiling model.Dbt_demo.sat_shippers
2021-04-27 16:58:06.698322 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_shippers"
2021-04-27 16:58:06.698742 (Thread-1): finished collecting timing info
2021-04-27 16:58:06.706846 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:06.707039 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 16:58:06.707186 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:58:07.433227 (Thread-1): SQL status: SUCCESS 1 in 0.73 seconds
2021-04-27 16:58:07.436597 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:07.436725 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 09:58:07.141000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 09:58:07.141000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_shippers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 16:58:07.647371 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:58:07.651981 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:07.652112 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:07.775066 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-27 16:58:07.777213 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:07.777335 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:07.888973 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:58:07.890443 (Thread-1): 16:58:07 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:07.896074 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:07.896217 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:08.156641 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:58:08.156851 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:08.156942 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:09.795963 (Thread-1): SQL status: SUCCESS 1 in 1.64 seconds
2021-04-27 16:58:09.800004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:09.800139 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:09.947193 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:58:09.951246 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:09.951390 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:10.077591 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:10.079538 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:10.079643 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:10.565496 (Thread-1): SQL status: SUCCESS 0 in 0.49 seconds
2021-04-27 16:58:10.567018 (Thread-1): 16:58:10 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:10.567250 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:10.567418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:10.567512 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:10.842021 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:58:10.843213 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:10.843325 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:10.991010 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:58:10.992471 (Thread-1): 16:58:10 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:10.998175 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:10.998299 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:11.175323 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:58:11.175506 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:11.175591 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:12.500502 (Thread-1): SQL status: SUCCESS 1 in 1.32 seconds
2021-04-27 16:58:12.504643 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:12.504763 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:12.644407 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:58:12.648541 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:12.648667 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:12.824254 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-04-27 16:58:12.826158 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:12.826275 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:13.142626 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:58:13.144178 (Thread-1): 16:58:13 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:13.144380 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:13.144553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:13.144638 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:13.424450 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:58:13.425538 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:13.425639 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:13.547041 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:13.548465 (Thread-1): 16:58:13 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:13.554177 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:13.554310 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:13.710330 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:58:13.710514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:13.710598 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:14.590025 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-04-27 16:58:14.595266 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:14.595384 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:14.745739 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:58:14.749949 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:14.750099 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:14.876009 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:14.877934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:14.878042 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:15.176864 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:58:15.178122 (Thread-1): 16:58:15 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:15.178331 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:15.178511 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:15.178604 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:15.404299 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:58:15.405338 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:15.405448 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:15.519488 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:58:15.520903 (Thread-1): 16:58:15 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:15.526262 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:15.526371 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:15.674825 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:58:15.675005 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:15.675089 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:16.559642 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-04-27 16:58:16.563587 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:16.563705 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:16.717080 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:58:16.721390 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:16.721549 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:16.846916 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:16.848844 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:16.848947 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:17.125727 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:58:17.126986 (Thread-1): 16:58:17 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:17.127216 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:17.127399 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:17.127490 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:17.353643 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:58:17.355126 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:17.355240 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:17.481181 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:58:17.482612 (Thread-1): 16:58:17 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:17.488014 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:17.488127 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:17.630110 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:17.630300 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:17.630385 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:18.594608 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-04-27 16:58:18.598316 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:18.598423 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:18.749265 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:58:18.753332 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:18.753446 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:18.881132 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:18.883052 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:18.883181 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:19.148211 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-04-27 16:58:19.149486 (Thread-1): 16:58:19 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:19.149710 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:19.149890 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:19.149990 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:19.372943 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:58:19.374076 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:19.374182 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:19.494343 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:19.496182 (Thread-1): 16:58:19 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:19.501241 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:19.501355 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:19.636543 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:19.636731 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:19.636817 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:20.435599 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-04-27 16:58:20.439655 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:20.439772 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:20.603182 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:20.607149 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:20.607258 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:20.729568 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-27 16:58:20.731554 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:20.731666 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:21.050485 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:58:21.052242 (Thread-1): 16:58:21 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:21.052457 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:21.052636 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:21.052726 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:21.266501 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:58:21.267618 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:21.267727 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:21.387150 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:21.388555 (Thread-1): 16:58:21 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:21.393963 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:21.394079 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:21.533815 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:21.533997 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:21.534082 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:23.095630 (Thread-1): SQL status: SUCCESS 1 in 1.56 seconds
2021-04-27 16:58:23.099479 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:23.099601 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:23.726476 (Thread-1): SQL status: SUCCESS 7 in 0.63 seconds
2021-04-27 16:58:23.730560 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:23.730780 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:23.860342 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:23.862245 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:23.862348 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:24.269160 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-04-27 16:58:24.270426 (Thread-1): 16:58:24 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:24.270627 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:24.270800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:24.270887 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:24.523708 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:58:24.524826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:24.524933 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:24.752850 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:58:24.754214 (Thread-1): 16:58:24 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:24.759342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:24.759448 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:24.933122 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:58:24.933317 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:24.933403 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:25.749162 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-04-27 16:58:25.754694 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:25.754801 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:25.917908 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:25.921958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:25.922072 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:26.280384 (Thread-1): SQL status: SUCCESS 7 in 0.36 seconds
2021-04-27 16:58:26.282338 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:26.282447 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:26.566006 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:58:26.567684 (Thread-1): 16:58:26 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:26.567905 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:26.568087 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:26.568179 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:26.782511 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:58:26.783670 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:26.783777 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:26.925901 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:26.927320 (Thread-1): 16:58:26 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:26.932736 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:26.932843 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:27.078456 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:58:27.078642 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:27.078739 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:29.757717 (Thread-1): SQL status: SUCCESS 1 in 2.68 seconds
2021-04-27 16:58:29.761596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:29.761707 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:30.104003 (Thread-1): SQL status: SUCCESS 7 in 0.34 seconds
2021-04-27 16:58:30.226519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:30.226689 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:30.389605 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:30.391546 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:30.391650 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:30.819981 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-04-27 16:58:30.821580 (Thread-1): 16:58:30 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:30.821786 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:30.821960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:30.822046 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:31.264582 (Thread-1): SQL status: SUCCESS 1 in 0.44 seconds
2021-04-27 16:58:31.265696 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:31.265798 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:31.484263 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:58:31.485659 (Thread-1): 16:58:31 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:31.491137 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:31.491281 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:31.651088 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:58:31.651316 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:31.651407 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:32.478953 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-04-27 16:58:32.482969 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:32.483134 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:32.687223 (Thread-1): SQL status: SUCCESS 7 in 0.20 seconds
2021-04-27 16:58:32.691551 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:32.691672 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:32.822835 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:32.824767 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:32.824871 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:33.700279 (Thread-1): SQL status: SUCCESS 0 in 0.88 seconds
2021-04-27 16:58:33.701576 (Thread-1): 16:58:33 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:33.701789 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:33.701969 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:33.702064 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:33.900996 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:58:33.902102 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:33.902208 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:34.021290 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:34.022678 (Thread-1): 16:58:34 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:34.027750 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:34.027863 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:34.289892 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:58:34.290072 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:34.290156 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:35.237343 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:58:35.243168 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:35.243278 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:35.514582 (Thread-1): SQL status: SUCCESS 7 in 0.27 seconds
2021-04-27 16:58:35.518750 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:35.518895 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:35.717991 (Thread-1): SQL status: SUCCESS 7 in 0.20 seconds
2021-04-27 16:58:35.719954 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:35.720059 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:36.161267 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-04-27 16:58:36.162530 (Thread-1): 16:58:36 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:36.162741 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:36.162917 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:36.163004 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:36.378784 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:58:36.379928 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:36.380032 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:36.574007 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:58:36.575480 (Thread-1): 16:58:36 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:36.581218 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:36.581370 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:36.738582 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:58:36.738769 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:36.738855 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:37.612255 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-04-27 16:58:37.616285 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:37.616428 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:37.807964 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-04-27 16:58:37.812230 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:37.812360 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:37.975584 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:37.977483 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:37.977587 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:38.592387 (Thread-1): SQL status: SUCCESS 0 in 0.61 seconds
2021-04-27 16:58:38.593696 (Thread-1): 16:58:38 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:38.593904 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:38.594085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:38.594173 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:38.796411 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:58:38.797904 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:38.798015 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:38.949603 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:58:38.951055 (Thread-1): 16:58:38 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:38.956259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:38.956402 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:39.179807 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:58:39.180001 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:39.180087 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:40.267632 (Thread-1): SQL status: SUCCESS 1 in 1.09 seconds
2021-04-27 16:58:40.271873 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:40.271993 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:40.453540 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-04-27 16:58:40.457658 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:40.457803 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:40.578300 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-27 16:58:40.581972 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:40.582092 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:40.920328 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 16:58:40.921707 (Thread-1): 16:58:40 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:40.921936 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:40.922184 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:40.922288 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:41.121341 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:58:41.122489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:41.122597 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:41.245526 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:41.247439 (Thread-1): 16:58:41 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:41.252627 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:41.252745 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:41.393405 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:41.393590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:41.393674 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:42.380929 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 16:58:42.385001 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:42.385161 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:42.540319 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:42.544424 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:42.544576 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:42.673276 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:42.675302 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:42.675414 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:42.960303 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:58:42.961952 (Thread-1): 16:58:42 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:42.962180 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:42.962371 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:42.962467 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:43.156797 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:58:43.157959 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:43.158066 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:43.270287 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:58:43.271710 (Thread-1): 16:58:43 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:43.276729 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:43.276837 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:43.421866 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:43.422057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:43.422143 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:44.697987 (Thread-1): SQL status: SUCCESS 1 in 1.28 seconds
2021-04-27 16:58:44.701995 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:44.702143 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:44.863484 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:44.867673 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:44.867786 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:45.324985 (Thread-1): SQL status: SUCCESS 7 in 0.46 seconds
2021-04-27 16:58:45.326905 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:45.327015 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:45.629984 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:58:45.631343 (Thread-1): 16:58:45 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:45.631561 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:45.631745 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:45.631832 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:45.832467 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:58:45.833561 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:45.833663 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:45.947645 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:58:45.949443 (Thread-1): 16:58:45 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:45.954581 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:45.954741 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:46.104396 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:58:46.104579 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:46.104663 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:46.971557 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-04-27 16:58:46.975540 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:46.975659 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:47.118499 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:58:47.122579 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:47.122692 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:47.270547 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:58:47.272500 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:47.272603 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:47.546073 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:58:47.547708 (Thread-1): 16:58:47 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:47.547919 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:47.548094 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:47.548180 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:47.838804 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 16:58:47.839951 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:47.840053 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:47.964415 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:47.965835 (Thread-1): 16:58:47 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:47.970859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:47.970967 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:48.115987 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:48.116170 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:48.116254 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:48.978827 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-04-27 16:58:48.982777 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:48.982889 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:49.151153 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-04-27 16:58:49.155371 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:49.155531 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:49.283444 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:49.285341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:49.285443 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:49.575589 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:58:49.576846 (Thread-1): 16:58:49 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:49.577053 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:49.577226 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:49.577312 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:49.813968 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 16:58:49.815049 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:49.815175 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:49.929900 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:58:49.931741 (Thread-1): 16:58:49 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:49.936722 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:49.936829 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:50.080967 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:50.081153 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:50.081236 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:50.927382 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-04-27 16:58:50.931399 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:50.931523 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:51.086030 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:58:51.089998 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:51.090104 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:51.291215 (Thread-1): SQL status: SUCCESS 7 in 0.20 seconds
2021-04-27 16:58:51.293145 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:51.293256 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:51.547876 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-04-27 16:58:51.549149 (Thread-1): 16:58:51 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:51.549363 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:51.549541 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:51.549640 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:51.778846 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:58:51.780006 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:51.780108 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:51.899193 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:51.900606 (Thread-1): 16:58:51 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:51.905700 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:51.905810 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:52.088887 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:58:52.089074 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:52.089161 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:52.890571 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-04-27 16:58:52.896641 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:52.896758 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:53.052784 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:53.056900 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:53.057009 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:53.195633 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:58:53.197512 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:53.197615 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:53.534129 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-04-27 16:58:53.535355 (Thread-1): 16:58:53 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:53.535563 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:53.535735 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:53.535822 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:53.756776 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:58:53.757890 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:53.757999 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:54.392342 (Thread-1): SQL status: SUCCESS 1 in 0.63 seconds
2021-04-27 16:58:54.393752 (Thread-1): 16:58:54 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:54.399143 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:54.399254 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:54.535288 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:58:54.535471 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:54.535556 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:55.407716 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-04-27 16:58:55.411903 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:55.412030 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:55.552900 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-04-27 16:58:55.557103 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:55.557210 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:55.671702 (Thread-1): SQL status: SUCCESS 7 in 0.11 seconds
2021-04-27 16:58:55.673637 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:55.673740 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:55.906318 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-04-27 16:58:55.907613 (Thread-1): 16:58:55 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:55.907815 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:55.907996 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:55.908081 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:56.116833 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:58:56.118273 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:56.118377 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:56.232587 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:58:56.233997 (Thread-1): 16:58:56 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:56.239129 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:56.239249 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:56.385651 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:58:56.385845 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:56.385933 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:57.219592 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-04-27 16:58:57.223824 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:57.223948 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:57.388895 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:58:57.392953 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:57.393060 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:57.515144 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-27 16:58:57.516998 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:57.517108 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:57.770600 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-04-27 16:58:57.771928 (Thread-1): 16:58:57 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:57.772131 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:57.772306 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:57.772392 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:57.972193 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:58:57.973306 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:57.973411 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:58:58.093030 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:58:58.094433 (Thread-1): 16:58:58 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:58.099940 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:58.100053 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:58:58.255331 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:58:58.255514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:58.255600 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:58:59.127417 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-04-27 16:58:59.131376 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:59.131492 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:58:59.278655 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:58:59.282861 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:59.282977 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:58:59.416787 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:58:59.418700 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:59.418803 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:58:59.885101 (Thread-1): SQL status: SUCCESS 0 in 0.47 seconds
2021-04-27 16:58:59.886678 (Thread-1): 16:58:59 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:58:59.886882 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:58:59.887058 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:58:59.887167 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:59:00.090125 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 16:59:00.091294 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:00.091402 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:59:00.203778 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-04-27 16:59:00.205156 (Thread-1): 16:59:00 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_shippers]
2021-04-27 16:59:00.210160 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:00.210269 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:59:00.356351 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:59:00.356534 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:00.356618 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:01.249319 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-04-27 16:59:01.253474 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:01.253604 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:59:01.402816 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:59:01.406977 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:01.407121 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:59:01.528225 (Thread-1): SQL status: SUCCESS 7 in 0.12 seconds
2021-04-27 16:59:01.530160 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:01.530265 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:59:01.802441 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:59:01.803756 (Thread-1): 16:59:01 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:59:01.803969 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:59:01.804143 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:01.804229 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:59:02.012437 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:59:02.013578 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:02.013683 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:59:02.135329 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:59:02.137105 (Thread-1): 16:59:02 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_shippers]
2021-04-27 16:59:02.142163 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:02.142312 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:59:02.283987 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:02.284169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:02.284254 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:03.193420 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-04-27 16:59:03.197377 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:03.197485 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:59:03.346670 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-04-27 16:59:03.350737 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:03.350861 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:59:03.476360 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:59:03.478292 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:03.478395 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:59:03.759994 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:59:03.761563 (Thread-1): 16:59:03 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:59:03.761776 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:59:03.761962 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:03.762065 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:59:03.968429 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:59:03.969527 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:03.969637 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-04-27 16:59:04.086092 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-04-27 16:59:04.087555 (Thread-1): 16:59:04 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_shippers]
2021-04-27 16:59:04.093086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:04.093247 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-04-27 16:59:04.243401 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:59:04.243590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:04.243681 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:05.125829 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-04-27 16:59:05.129726 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:05.129840 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-04-27 16:59:05.287685 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-04-27 16:59:05.291785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:05.291892 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-04-27 16:59:05.424481 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-04-27 16:59:05.426393 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:05.426498 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-04-27 16:59:05.731235 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:59:05.732530 (Thread-1): 16:59:05 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-04-27 16:59:05.732741 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:59:05.732932 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-04-27 16:59:05.733020 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-04-27 16:59:05.938406 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:59:05.938850 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_shippers"
2021-04-27 16:59:05.941878 (Thread-1): finished collecting timing info
2021-04-27 16:59:05.942154 (Thread-1): On model.Dbt_demo.sat_shippers: Close
2021-04-27 16:59:06.163514 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971189fa0>]}
2021-04-27 16:59:06.164931 (Thread-1): 16:59:06 | 21 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_shippers [INSERT 0 in 59.49s]
2021-04-27 16:59:06.165100 (Thread-1): Finished running node model.Dbt_demo.sat_shippers
2021-04-27 16:59:06.165270 (Thread-1): Began running node model.Dbt_demo.hub_suppliers
2021-04-27 16:59:06.166648 (Thread-1): 16:59:06 | 22 of 23 START incremental model SS_RAW_VLT.hub_suppliers............ [RUN]
2021-04-27 16:59:06.166997 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:06.167152 (Thread-1): Compiling model.Dbt_demo.hub_suppliers
2021-04-27 16:59:06.180443 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_suppliers"
2021-04-27 16:59:06.180816 (Thread-1): finished collecting timing info
2021-04-27 16:59:06.188989 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:06.189122 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SUPPLIER_PK, SUPPLIERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers AS d
    ON a.SUPPLIER_PK = d.SUPPLIER_PK
    WHERE d.SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-04-27 16:59:06.189245 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:59:08.006063 (Thread-1): SQL status: SUCCESS 1 in 1.82 seconds
2021-04-27 16:59:08.009631 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:08.009741 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
2021-04-27 16:59:08.163884 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-04-27 16:59:08.167851 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:08.167969 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-04-27 16:59:08.325603 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-04-27 16:59:08.329635 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:08.329741 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-04-27 16:59:08.471712 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-04-27 16:59:08.473369 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_suppliers"
2021-04-27 16:59:08.474137 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:08.474239 (Thread-1): On model.Dbt_demo.hub_suppliers: BEGIN
2021-04-27 16:59:08.623240 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:59:08.623440 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:08.623529 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers ("SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
        );
2021-04-27 16:59:08.978181 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-04-27 16:59:08.979370 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-04-27 16:59:08.979546 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-04-27 16:59:08.979634 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-04-27 16:59:09.184947 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:59:09.189326 (Thread-1): finished collecting timing info
2021-04-27 16:59:09.189643 (Thread-1): On model.Dbt_demo.hub_suppliers: Close
2021-04-27 16:59:09.407262 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f297148ae50>]}
2021-04-27 16:59:09.408720 (Thread-1): 16:59:09 | 22 of 23 OK created incremental model SS_RAW_VLT.hub_suppliers....... [SUCCESS 0 in 3.24s]
2021-04-27 16:59:09.408909 (Thread-1): Finished running node model.Dbt_demo.hub_suppliers
2021-04-27 16:59:09.409090 (Thread-1): Began running node model.Dbt_demo.sat_suppliers
2021-04-27 16:59:09.410253 (Thread-1): 16:59:09 | 23 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_suppliers. [RUN]
2021-04-27 16:59:09.410625 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:09.410795 (Thread-1): Compiling model.Dbt_demo.sat_suppliers
2021-04-27 16:59:09.433535 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_suppliers"
2021-04-27 16:59:09.433928 (Thread-1): finished collecting timing info
2021-04-27 16:59:09.442351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:09.442531 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-04-27 16:59:09.442637 (Thread-1): Opening a new connection, currently in state closed
2021-04-27 16:59:10.481431 (Thread-1): SQL status: SUCCESS 1 in 1.04 seconds
2021-04-27 16:59:10.484796 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:10.484930 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-04-27 09:59:10.150000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-04-27 09:59:10.150000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_suppliers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-04-27 16:59:10.673417 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:59:10.677523 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:10.677661 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:10.823553 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:59:10.825944 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:10.826048 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:10.959593 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:59:10.961003 (Thread-1): 16:59:10 + Running for day 1 of 25 (2021-04-04) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:10.966792 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:10.966941 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:11.135613 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:59:11.135804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:11.135890 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:12.475441 (Thread-1): SQL status: SUCCESS 1 in 1.34 seconds
2021-04-27 16:59:12.479341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:12.479454 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:12.657604 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:59:12.662169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:12.662291 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:12.820552 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:59:12.822856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:12.822960 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:13.107809 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:59:13.109079 (Thread-1): 16:59:13 + Ran for day 1 of 25 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:13.109291 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:13.109477 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:13.109565 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:13.505459 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:59:13.506590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:13.506700 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:13.638276 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:59:13.639698 (Thread-1): 16:59:13 + Running for day 2 of 25 (2021-04-05) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:13.645085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:13.645199 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:13.814712 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:59:13.814895 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:13.814978 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:14.836830 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-04-27 16:59:14.841002 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:14.841129 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:15.018027 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:59:15.022394 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:15.022504 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:15.183969 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:59:15.186271 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:15.186386 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:15.506715 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:59:15.507986 (Thread-1): 16:59:15 + Ran for day 2 of 25 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:15.508196 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:15.508370 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:15.508457 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:15.923286 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-04-27 16:59:15.924379 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:15.924481 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:16.062831 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:16.064245 (Thread-1): 16:59:16 + Running for day 3 of 25 (2021-04-06) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:16.069954 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:16.070070 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:16.235017 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:59:16.235224 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:16.235309 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:17.201891 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-04-27 16:59:17.205835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:17.205952 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:17.374218 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:17.378695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:17.378803 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:17.522763 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:59:17.525104 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:17.525208 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:17.836967 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:59:17.838202 (Thread-1): 16:59:17 + Ran for day 3 of 25 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:17.838414 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:17.838588 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:17.838672 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:18.161111 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-04-27 16:59:18.162569 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:18.162676 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:18.303890 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:18.305283 (Thread-1): 16:59:18 + Running for day 4 of 25 (2021-04-07) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:18.310650 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:18.310758 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:18.487190 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:59:18.487382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:18.487470 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:19.673487 (Thread-1): SQL status: SUCCESS 1 in 1.19 seconds
2021-04-27 16:59:19.677724 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:19.677845 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:19.846682 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:19.851271 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:19.851411 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:19.992211 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:59:19.994626 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:19.994731 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:20.280097 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:59:20.281450 (Thread-1): 16:59:20 + Ran for day 4 of 25 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:20.281695 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:20.281882 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:20.281974 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:20.504448 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:20.505563 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:20.505665 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:20.636200 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:59:20.638035 (Thread-1): 16:59:20 + Running for day 5 of 25 (2021-04-08) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:20.643505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:20.643634 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:20.796335 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:59:20.796525 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:20.796615 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:21.774323 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-04-27 16:59:21.778293 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:21.778407 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:21.992756 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-04-27 16:59:21.996974 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:21.997097 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:22.162059 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:59:22.164372 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:22.164475 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:22.450554 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:59:22.452195 (Thread-1): 16:59:22 + Ran for day 5 of 25 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:22.452408 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:22.452588 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:22.452674 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:22.861005 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-04-27 16:59:22.862102 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:22.862205 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:22.998256 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:22.999680 (Thread-1): 16:59:22 + Running for day 6 of 25 (2021-04-09) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:23.005537 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:23.005666 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:23.254541 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:59:23.254725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:23.254810 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:24.517248 (Thread-1): SQL status: SUCCESS 1 in 1.26 seconds
2021-04-27 16:59:24.521170 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:24.521277 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:24.699685 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:59:24.704105 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:24.704213 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:24.845404 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:59:24.847860 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:24.847966 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:25.138467 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:59:25.139784 (Thread-1): 16:59:25 + Ran for day 6 of 25 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:25.139994 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:25.140172 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:25.140259 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:25.370697 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:59:25.371805 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:25.371907 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:25.511292 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:25.513091 (Thread-1): 16:59:25 + Running for day 7 of 25 (2021-04-10) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:25.518506 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:25.518641 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:25.709617 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-04-27 16:59:25.709801 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:25.709886 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:26.847497 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-04-27 16:59:26.851489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:26.851600 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:27.045379 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:59:27.049932 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:27.050049 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:27.198012 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:59:27.200363 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:27.200484 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:27.590644 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-04-27 16:59:27.592277 (Thread-1): 16:59:27 + Ran for day 7 of 25 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:27.592509 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:27.592686 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:27.592773 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:27.817456 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:27.818532 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:27.818633 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:27.954146 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:27.955618 (Thread-1): 16:59:27 + Running for day 8 of 25 (2021-04-11) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:27.963514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:27.963626 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:28.363008 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-04-27 16:59:28.363231 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:28.363321 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:29.505651 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-04-27 16:59:29.509477 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:29.509586 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:29.679437 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:29.683861 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:29.683980 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:29.840179 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:59:29.842500 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:29.842610 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:30.111707 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-04-27 16:59:30.112977 (Thread-1): 16:59:30 + Ran for day 8 of 25 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:30.113184 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:30.113357 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:30.113443 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:30.594045 (Thread-1): SQL status: SUCCESS 1 in 0.48 seconds
2021-04-27 16:59:30.595179 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:30.595290 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:30.805371 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 16:59:30.807254 (Thread-1): 16:59:30 + Running for day 9 of 25 (2021-04-12) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:30.812735 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:30.812867 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:30.997719 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-04-27 16:59:30.997909 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:30.998000 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:32.467808 (Thread-1): SQL status: SUCCESS 1 in 1.47 seconds
2021-04-27 16:59:32.471875 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:32.471988 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:32.633661 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-04-27 16:59:32.735058 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:32.735252 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:32.873817 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:59:32.876168 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:32.876279 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:33.193313 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 16:59:33.194929 (Thread-1): 16:59:33 + Ran for day 9 of 25 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:33.195169 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:33.195342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:33.195427 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:33.427768 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-04-27 16:59:33.428847 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:33.428950 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:33.573247 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:33.574662 (Thread-1): 16:59:33 + Running for day 10 of 25 (2021-04-13) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:33.580515 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:33.580642 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:33.735824 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:59:33.736002 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:33.736099 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:34.686949 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:59:34.690832 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:34.690948 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:34.890658 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 16:59:34.895053 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:34.895190 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:35.037719 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 16:59:35.040015 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:35.040118 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:35.334399 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:59:35.335716 (Thread-1): 16:59:35 + Ran for day 10 of 25 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:35.335921 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:35.336095 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:35.336181 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:35.553247 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:35.554389 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:35.554497 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:35.701437 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:59:35.703409 (Thread-1): 16:59:35 + Running for day 11 of 25 (2021-04-14) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:35.709253 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:35.709387 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:35.870739 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:59:35.870977 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:35.872230 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:36.858855 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-04-27 16:59:36.862857 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:36.862970 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:37.036277 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:37.040815 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:37.040951 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:37.194200 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:59:37.196559 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:37.196671 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:37.485031 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:59:37.486659 (Thread-1): 16:59:37 + Ran for day 11 of 25 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:37.486880 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:37.487058 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:37.487172 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:37.709504 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:37.710613 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:37.710716 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:37.878216 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 16:59:37.879643 (Thread-1): 16:59:37 + Running for day 12 of 25 (2021-04-15) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:37.885356 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:37.885464 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:38.045568 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:59:38.045751 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:38.045836 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:39.195488 (Thread-1): SQL status: SUCCESS 1 in 1.15 seconds
2021-04-27 16:59:39.199389 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:39.199511 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:39.368457 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:39.372881 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:39.372998 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:39.550279 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:59:39.552611 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:39.552720 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:40.239410 (Thread-1): SQL status: SUCCESS 0 in 0.69 seconds
2021-04-27 16:59:40.240676 (Thread-1): 16:59:40 + Ran for day 12 of 25 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:40.240880 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:40.241072 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:40.241164 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:40.547077 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-04-27 16:59:40.548231 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:40.548339 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:40.691533 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:40.693384 (Thread-1): 16:59:40 + Running for day 13 of 25 (2021-04-16) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:40.698830 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:40.698948 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:40.983319 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-04-27 16:59:40.983517 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:40.983609 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:42.985751 (Thread-1): SQL status: SUCCESS 1 in 2.00 seconds
2021-04-27 16:59:42.989771 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:42.989893 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:43.248747 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-04-27 16:59:43.255194 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:43.255357 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:43.610622 (Thread-1): SQL status: SUCCESS 12 in 0.36 seconds
2021-04-27 16:59:43.612929 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:43.613036 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:44.097697 (Thread-1): SQL status: SUCCESS 0 in 0.48 seconds
2021-04-27 16:59:44.099352 (Thread-1): 16:59:44 + Ran for day 13 of 25 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:44.099558 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:44.099731 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:44.099817 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:44.323945 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:44.325060 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:44.325162 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:44.457850 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 16:59:44.459273 (Thread-1): 16:59:44 + Running for day 14 of 25 (2021-04-17) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:44.464747 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:44.464862 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:44.720222 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 16:59:44.720428 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:44.720516 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:46.982329 (Thread-1): SQL status: SUCCESS 1 in 2.26 seconds
2021-04-27 16:59:46.986452 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:46.986609 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:47.195070 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-04-27 16:59:47.199511 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:47.199616 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:47.394445 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:59:47.396740 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:47.396845 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:48.345644 (Thread-1): SQL status: SUCCESS 0 in 0.95 seconds
2021-04-27 16:59:48.346897 (Thread-1): 16:59:48 + Ran for day 14 of 25 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:48.347127 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:48.347310 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:48.347402 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:48.620364 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 16:59:48.621505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:48.621613 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:48.764959 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:48.766738 (Thread-1): 16:59:48 + Running for day 15 of 25 (2021-04-18) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:48.772210 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:48.772336 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:49.066518 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-04-27 16:59:49.066706 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:49.066792 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:50.012472 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-04-27 16:59:50.016553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:50.016680 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:50.190146 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:50.194618 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:50.194725 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:50.342476 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:59:50.344840 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:50.344956 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:50.628904 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-04-27 16:59:50.630516 (Thread-1): 16:59:50 + Ran for day 15 of 25 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:50.630719 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:50.630894 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:50.630981 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:50.849295 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:50.850380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:50.850483 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:51.009825 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:59:51.011251 (Thread-1): 16:59:51 + Running for day 16 of 25 (2021-04-19) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:51.016665 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:51.016781 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:51.171835 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-04-27 16:59:51.172019 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:51.172113 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:52.474928 (Thread-1): SQL status: SUCCESS 1 in 1.30 seconds
2021-04-27 16:59:52.478773 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:52.478883 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:52.658278 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 16:59:52.662791 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:52.662928 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:52.815612 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 16:59:52.818105 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:52.818216 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:53.117094 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-04-27 16:59:53.118417 (Thread-1): 16:59:53 + Ran for day 16 of 25 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:53.118630 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:53.118815 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:53.118906 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:53.342240 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:53.343362 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:53.343470 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:53.488111 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:53.489497 (Thread-1): 16:59:53 + Running for day 17 of 25 (2021-04-20) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:53.495380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:53.495538 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:53.658312 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:59:53.658491 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:53.658574 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:54.594157 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-04-27 16:59:54.598171 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:54.598285 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:54.786915 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-04-27 16:59:54.791568 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:54.791680 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:54.959018 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:54.961371 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:54.961481 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:55.272892 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-04-27 16:59:55.274165 (Thread-1): 16:59:55 + Ran for day 17 of 25 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:55.274374 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:55.274553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:55.274644 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:55.524969 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-04-27 16:59:55.526492 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:55.526596 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 16:59:55.671562 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 16:59:55.673034 (Thread-1): 16:59:55 + Running for day 18 of 25 (2021-04-21) [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:55.678532 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:55.678647 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 16:59:55.835693 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 16:59:55.835888 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:55.835977 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 16:59:56.841849 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-04-27 16:59:56.845858 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:56.846005 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 16:59:57.015271 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 16:59:57.019750 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:57.019866 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 16:59:59.399385 (Thread-1): SQL status: SUCCESS 12 in 2.38 seconds
2021-04-27 16:59:59.401745 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:59.401855 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 16:59:59.692150 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 16:59:59.693429 (Thread-1): 16:59:59 + Ran for day 18 of 25 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 16:59:59.693635 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:59.693819 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:59.693911 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 16:59:59.916589 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 16:59:59.917696 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 16:59:59.917810 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 17:00:00.056632 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 17:00:00.058468 (Thread-1): 17:00:00 + Running for day 19 of 25 (2021-04-22) [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:00.064057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:00.064194 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 17:00:00.223674 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 17:00:00.223863 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:00.223948 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 17:00:01.207556 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-04-27 17:00:01.211642 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:01.211755 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 17:00:01.414741 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 17:00:01.419267 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:01.419383 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 17:00:01.909803 (Thread-1): SQL status: SUCCESS 12 in 0.49 seconds
2021-04-27 17:00:01.912157 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:01.912284 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 17:00:02.204099 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-04-27 17:00:02.205713 (Thread-1): 17:00:02 + Ran for day 19 of 25 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:02.205927 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:02.206109 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:02.206201 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:02.419834 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-04-27 17:00:02.420976 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:02.421087 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 17:00:02.553618 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-04-27 17:00:02.555052 (Thread-1): 17:00:02 + Running for day 20 of 25 (2021-04-23) [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:02.560635 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:02.560785 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 17:00:02.857395 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-04-27 17:00:02.857588 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:02.857676 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 17:00:03.857293 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-04-27 17:00:03.861339 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:03.861492 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 17:00:04.029089 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-04-27 17:00:04.033581 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:04.033698 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 17:00:04.175341 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-04-27 17:00:04.177630 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:04.177734 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 17:00:05.070204 (Thread-1): SQL status: SUCCESS 0 in 0.89 seconds
2021-04-27 17:00:05.071520 (Thread-1): 17:00:05 + Ran for day 20 of 25 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:05.071728 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:05.071909 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:05.072001 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:05.311003 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 17:00:05.312141 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:05.312246 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 17:00:05.510743 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-04-27 17:00:05.512557 (Thread-1): 17:00:05 + Running for day 21 of 25 (2021-04-24) [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:05.518001 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:05.518132 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 17:00:05.685916 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-04-27 17:00:05.686102 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:05.686187 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 17:00:10.780278 (Thread-1): SQL status: SUCCESS 1 in 5.09 seconds
2021-04-27 17:00:10.784309 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:10.784423 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 17:00:11.165263 (Thread-1): SQL status: SUCCESS 12 in 0.38 seconds
2021-04-27 17:00:11.171712 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:11.171856 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 17:00:11.413904 (Thread-1): SQL status: SUCCESS 12 in 0.24 seconds
2021-04-27 17:00:11.416235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:11.416347 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 17:00:11.843639 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-04-27 17:00:11.845296 (Thread-1): 17:00:11 + Ran for day 21 of 25 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:11.845510 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:11.845688 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:11.845775 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:12.084515 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-04-27 17:00:12.085634 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:12.085736 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 17:00:12.230470 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 17:00:12.231895 (Thread-1): 17:00:12 + Running for day 22 of 25 (2021-04-25) [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:12.237379 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:12.237530 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 17:00:12.392756 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-04-27 17:00:12.392948 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:12.393033 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 17:00:13.700062 (Thread-1): SQL status: SUCCESS 1 in 1.31 seconds
2021-04-27 17:00:13.704090 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:13.704239 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 17:00:13.885619 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-04-27 17:00:13.890028 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:13.890134 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 17:00:14.035288 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-04-27 17:00:14.037605 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:14.037716 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 17:00:14.353302 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-04-27 17:00:14.354594 (Thread-1): 17:00:14 + Ran for day 22 of 25 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:14.354807 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:14.354988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:14.355079 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:14.573748 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-04-27 17:00:14.574857 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:14.574959 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 17:00:15.127232 (Thread-1): SQL status: SUCCESS 1 in 0.55 seconds
2021-04-27 17:00:15.128657 (Thread-1): 17:00:15 + Running for day 23 of 25 (2021-04-26) [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:15.134526 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:15.134691 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 17:00:15.405207 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 17:00:15.405410 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:15.405500 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 17:00:17.884714 (Thread-1): SQL status: SUCCESS 1 in 2.48 seconds
2021-04-27 17:00:17.888850 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:17.888981 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 17:00:18.805840 (Thread-1): SQL status: SUCCESS 12 in 0.92 seconds
2021-04-27 17:00:18.810353 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:18.810465 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 17:00:20.237459 (Thread-1): SQL status: SUCCESS 12 in 1.43 seconds
2021-04-27 17:00:20.239769 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:20.239874 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 17:00:21.418316 (Thread-1): SQL status: SUCCESS 0 in 1.18 seconds
2021-04-27 17:00:21.419650 (Thread-1): 17:00:21 + Ran for day 23 of 25 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:21.419866 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:21.420049 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:21.420137 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:23.172806 (Thread-1): SQL status: SUCCESS 1 in 1.75 seconds
2021-04-27 17:00:23.174316 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:23.174427 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 17:00:23.431138 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-04-27 17:00:23.432600 (Thread-1): 17:00:23 + Running for day 24 of 25 (2021-04-27) [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:23.438127 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:23.438248 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 17:00:23.861980 (Thread-1): SQL status: SUCCESS 1 in 0.42 seconds
2021-04-27 17:00:23.862166 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:23.862249 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 17:00:28.476694 (Thread-1): SQL status: SUCCESS 1 in 4.61 seconds
2021-04-27 17:00:28.480603 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:28.480741 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 17:00:28.683285 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 17:00:28.687791 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:28.687920 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 17:00:29.148313 (Thread-1): SQL status: SUCCESS 12 in 0.46 seconds
2021-04-27 17:00:29.150840 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:29.150950 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 17:00:29.568534 (Thread-1): SQL status: SUCCESS 0 in 0.42 seconds
2021-04-27 17:00:29.569808 (Thread-1): 17:00:29 + Ran for day 24 of 25 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:29.570017 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:29.570192 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:29.570279 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:29.915427 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-04-27 17:00:29.916559 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:29.916671 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-04-27 17:00:30.055393 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-04-27 17:00:30.057192 (Thread-1): 17:00:30 + Running for day 25 of 25 (2021-04-28) [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:30.062560 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:30.062676 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-04-27 17:00:30.660101 (Thread-1): SQL status: SUCCESS 1 in 0.60 seconds
2021-04-27 17:00:30.660367 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:30.660462 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-04-27 17:00:32.721322 (Thread-1): SQL status: SUCCESS 1 in 2.06 seconds
2021-04-27 17:00:32.725375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:32.725492 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-04-27 17:00:33.222511 (Thread-1): SQL status: SUCCESS 12 in 0.50 seconds
2021-04-27 17:00:33.227052 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:33.227178 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-04-27 17:00:33.423413 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-04-27 17:00:33.425698 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:33.425802 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-04-27 17:00:34.795160 (Thread-1): SQL status: SUCCESS 0 in 1.37 seconds
2021-04-27 17:00:34.796835 (Thread-1): 17:00:34 + Ran for day 25 of 25 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-04-27 17:00:34.797052 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:34.797235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-04-27 17:00:34.797327 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-04-27 17:00:35.442515 (Thread-1): SQL status: SUCCESS 1 in 0.65 seconds
2021-04-27 17:00:35.442950 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_suppliers"
2021-04-27 17:00:35.446018 (Thread-1): finished collecting timing info
2021-04-27 17:00:35.446289 (Thread-1): On model.Dbt_demo.sat_suppliers: Close
2021-04-27 17:00:35.741243 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d832937-4c66-4455-83da-8f52d8c7a295', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971326490>]}
2021-04-27 17:00:35.742730 (Thread-1): 17:00:35 | 23 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_suppliers [INSERT 0 in 86.33s]
2021-04-27 17:00:35.742907 (Thread-1): Finished running node model.Dbt_demo.sat_suppliers
2021-04-27 17:00:35.744340 (MainThread): Acquiring new snowflake connection "master".
2021-04-27 17:00:35.744573 (MainThread): Using snowflake connection "master".
2021-04-27 17:00:35.744663 (MainThread): On master: BEGIN
2021-04-27 17:00:35.744755 (MainThread): Opening a new connection, currently in state closed
2021-04-27 17:00:36.774769 (MainThread): SQL status: SUCCESS 1 in 1.03 seconds
2021-04-27 17:00:36.774978 (MainThread): On master: COMMIT
2021-04-27 17:00:36.775216 (MainThread): Using snowflake connection "master".
2021-04-27 17:00:36.775318 (MainThread): On master: COMMIT
2021-04-27 17:00:37.049214 (MainThread): SQL status: SUCCESS 1 in 0.27 seconds
2021-04-27 17:00:37.049426 (MainThread): On master: Close
2021-04-27 17:00:37.329698 (MainThread): 17:00:37 | 
2021-04-27 17:00:37.329915 (MainThread): 17:00:37 | Finished running 10 view models, 8 incremental models, 5 vault_insert_by_period models in 443.02s.
2021-04-27 17:00:37.330037 (MainThread): Connection 'master' was properly closed.
2021-04-27 17:00:37.330125 (MainThread): Connection 'model.Dbt_demo.sat_suppliers' was properly closed.
2021-04-27 17:00:37.472456 (MainThread): 
2021-04-27 17:00:37.472671 (MainThread): Completed successfully
2021-04-27 17:00:37.472837 (MainThread): 
Done. PASS=23 WARN=0 ERROR=0 SKIP=0 TOTAL=23
2021-04-27 17:00:37.473082 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29717a6610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2971709fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f29718186a0>]}
2021-04-27 17:00:37.473338 (MainThread): Flushing usage events
2021-05-03 12:24:17.220460 (MainThread): Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3, and in 3.9 it will stop working
2021-05-03 12:24:17.222906 (MainThread): Running with dbt=0.19.0
2021-05-03 12:24:19.183704 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/ubuntu/dvdemo2/dvdemo/', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-05-03 12:24:19.187090 (MainThread): Tracking: tracking
2021-05-03 12:24:19.187403 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc539591880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52d0cbbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52d0cbc70>]}
2021-05-03 12:24:19.261957 (MainThread): Partial parsing not enabled
2021-05-03 12:24:19.266026 (MainThread): Parsing macros/adapters.sql
2021-05-03 12:24:19.304402 (MainThread): Parsing macros/catalog.sql
2021-05-03 12:24:19.307504 (MainThread): Parsing macros/materializations/incremental.sql
2021-05-03 12:24:19.320335 (MainThread): Parsing macros/materializations/view.sql
2021-05-03 12:24:19.322942 (MainThread): Parsing macros/materializations/merge.sql
2021-05-03 12:24:19.326124 (MainThread): Parsing macros/materializations/table.sql
2021-05-03 12:24:19.339633 (MainThread): Parsing macros/core.sql
2021-05-03 12:24:19.345359 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-05-03 12:24:19.348423 (MainThread): Parsing macros/schema_tests/unique.sql
2021-05-03 12:24:19.351423 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-05-03 12:24:19.355490 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-05-03 12:24:19.358352 (MainThread): Parsing macros/adapters/common.sql
2021-05-03 12:24:19.413659 (MainThread): Parsing macros/etc/datetime.sql
2021-05-03 12:24:19.425629 (MainThread): Parsing macros/etc/query.sql
2021-05-03 12:24:19.427646 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-05-03 12:24:19.430810 (MainThread): Parsing macros/etc/is_incremental.sql
2021-05-03 12:24:19.433468 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-05-03 12:24:19.435508 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-05-03 12:24:19.438480 (MainThread): Parsing macros/materializations/helpers.sql
2021-05-03 12:24:19.450610 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-05-03 12:24:19.477653 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-05-03 12:24:19.486280 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-05-03 12:24:19.489295 (MainThread): Parsing macros/materializations/table/table.sql
2021-05-03 12:24:19.498468 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-05-03 12:24:19.537041 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-05-03 12:24:19.560547 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-05-03 12:24:19.563601 (MainThread): Parsing macros/materializations/view/view.sql
2021-05-03 12:24:19.572217 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-05-03 12:24:19.579278 (MainThread): Parsing macros/materializations/common/merge.sql
2021-05-03 12:24:19.602787 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2021-05-03 12:24:19.628704 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2021-05-03 12:24:19.638621 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2021-05-03 12:24:19.641133 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2021-05-03 12:24:19.666035 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2021-05-03 12:24:19.687096 (MainThread): Parsing macros/supporting/hash.sql
2021-05-03 12:24:19.696968 (MainThread): Parsing macros/supporting/prefix.sql
2021-05-03 12:24:19.705195 (MainThread): Parsing macros/staging/rank_columns.sql
2021-05-03 12:24:19.709073 (MainThread): Parsing macros/staging/source_columns.sql
2021-05-03 12:24:19.711503 (MainThread): Parsing macros/staging/hash_columns.sql
2021-05-03 12:24:19.717304 (MainThread): Parsing macros/staging/derive_columns.sql
2021-05-03 12:24:19.726159 (MainThread): Parsing macros/staging/stage.sql
2021-05-03 12:24:19.743642 (MainThread): Parsing macros/internal/expand_column_list.sql
2021-05-03 12:24:19.748408 (MainThread): Parsing macros/internal/as_constant.sql
2021-05-03 12:24:19.752109 (MainThread): Parsing macros/internal/multikey.sql
2021-05-03 12:24:19.759497 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2021-05-03 12:24:19.772846 (MainThread): Parsing macros/internal/alias_all.sql
2021-05-03 12:24:19.776835 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2021-05-03 12:24:19.778640 (MainThread): Parsing macros/internal/alias.sql
2021-05-03 12:24:19.784105 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2021-05-03 12:24:19.785372 (MainThread): Parsing macros/internal/is_checks.sql
2021-05-03 12:24:19.790493 (MainThread): Parsing macros/tables/sat.sql
2021-05-03 12:24:19.802304 (MainThread): Parsing macros/tables/link.sql
2021-05-03 12:24:19.817555 (MainThread): Parsing macros/tables/eff_sat.sql
2021-05-03 12:24:19.834134 (MainThread): Parsing macros/tables/t_link.sql
2021-05-03 12:24:19.840112 (MainThread): Parsing macros/tables/hub.sql
2021-05-03 12:24:19.861021 (MainThread): Parsing macros/schema_tests/not_constant.sql
2021-05-03 12:24:19.863890 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2021-05-03 12:24:19.867664 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2021-05-03 12:24:19.871963 (MainThread): Parsing macros/schema_tests/equality.sql
2021-05-03 12:24:19.877947 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-05-03 12:24:19.882920 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2021-05-03 12:24:19.886020 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-05-03 12:24:19.895105 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2021-05-03 12:24:19.898508 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2021-05-03 12:24:19.902045 (MainThread): Parsing macros/schema_tests/recency.sql
2021-05-03 12:24:19.905316 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2021-05-03 12:24:19.908480 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2021-05-03 12:24:19.911399 (MainThread): Parsing macros/cross_db_utils/literal.sql
2021-05-03 12:24:19.913658 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2021-05-03 12:24:19.916851 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2021-05-03 12:24:19.920608 (MainThread): Parsing macros/cross_db_utils/replace.sql
2021-05-03 12:24:19.923452 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2021-05-03 12:24:19.926588 (MainThread): Parsing macros/cross_db_utils/concat.sql
2021-05-03 12:24:19.930390 (MainThread): Parsing macros/cross_db_utils/position.sql
2021-05-03 12:24:19.933386 (MainThread): Parsing macros/cross_db_utils/except.sql
2021-05-03 12:24:19.935750 (MainThread): Parsing macros/cross_db_utils/length.sql
2021-05-03 12:24:19.938520 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2021-05-03 12:24:19.951319 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2021-05-03 12:24:19.955796 (MainThread): Parsing macros/cross_db_utils/hash.sql
2021-05-03 12:24:19.958559 (MainThread): Parsing macros/cross_db_utils/right.sql
2021-05-03 12:24:19.962375 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-05-03 12:24:19.964119 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2021-05-03 12:24:19.967486 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2021-05-03 12:24:19.977229 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-05-03 12:24:19.980431 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2021-05-03 12:24:19.984434 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2021-05-03 12:24:19.989774 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2021-05-03 12:24:19.992597 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2021-05-03 12:24:19.994929 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2021-05-03 12:24:20.002509 (MainThread): Parsing macros/logger/pretty_time.sql
2021-05-03 12:24:20.004930 (MainThread): Parsing macros/logger/pretty_log_format.sql
2021-05-03 12:24:20.007292 (MainThread): Parsing macros/logger/log_info.sql
2021-05-03 12:24:20.009780 (MainThread): Parsing macros/web/get_url_path.sql
2021-05-03 12:24:20.014345 (MainThread): Parsing macros/web/get_url_host.sql
2021-05-03 12:24:20.017492 (MainThread): Parsing macros/web/get_url_parameter.sql
2021-05-03 12:24:20.020428 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2021-05-03 12:24:20.053081 (MainThread): Parsing macros/geo/haversine_distance.sql
2021-05-03 12:24:20.055983 (MainThread): Parsing macros/datetime/date_spine.sql
2021-05-03 12:24:20.063123 (MainThread): Parsing macros/sql/surrogate_key.sql
2021-05-03 12:24:20.068616 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-05-03 12:24:20.077552 (MainThread): Parsing macros/sql/pivot.sql
2021-05-03 12:24:20.084008 (MainThread): Parsing macros/sql/get_column_values.sql
2021-05-03 12:24:20.090707 (MainThread): Parsing macros/sql/unpivot.sql
2021-05-03 12:24:20.100846 (MainThread): Parsing macros/sql/groupby.sql
2021-05-03 12:24:20.103409 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-05-03 12:24:20.106629 (MainThread): Parsing macros/sql/star.sql
2021-05-03 12:24:20.111822 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2021-05-03 12:24:20.117081 (MainThread): Parsing macros/sql/union.sql
2021-05-03 12:24:20.129230 (MainThread): Parsing macros/sql/generate_series.sql
2021-05-03 12:24:20.135813 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2021-05-03 12:24:20.139876 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2021-05-03 12:24:20.145370 (MainThread): Parsing macros/sql/nullcheck_table.sql
2021-05-03 12:24:20.148352 (MainThread): Parsing macros/sql/safe_add.sql
2021-05-03 12:24:20.151368 (MainThread): Parsing macros/sql/nullcheck.sql
2021-05-03 12:24:20.160870 (MainThread): Partial parsing not enabled
2021-05-03 12:24:20.227152 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:20.313034 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:24:20.333675 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:24:20.353877 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:24:20.374063 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:24:20.394457 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:24:20.435896 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:24:20.456545 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:20.477050 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:24:20.541657 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:24:20.571614 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:24:20.600463 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:24:20.629240 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:24:20.655201 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:24:20.665394 (MainThread): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-05-03 12:24:20.665588 (MainThread): source_model: raw_suppliers
2021-05-03 12:24:20.665717 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:20.665830 (MainThread): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-05-03 12:24:20.777428 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:24:20.787502 (MainThread): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-05-03 12:24:20.787668 (MainThread): source_model: raw_customers
2021-05-03 12:24:20.787783 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:20.787899 (MainThread): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-05-03 12:24:20.806206 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:24:20.817909 (MainThread): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-05-03 12:24:20.818090 (MainThread): source_model: raw_products
2021-05-03 12:24:20.818208 (MainThread): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:20.818322 (MainThread): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-05-03 12:24:20.838590 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:24:20.848344 (MainThread): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-05-03 12:24:20.848493 (MainThread): source_model: raw_shippers
2021-05-03 12:24:20.848610 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:20.848721 (MainThread): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-05-03 12:24:20.865465 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:24:20.876728 (MainThread): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-05-03 12:24:20.876890 (MainThread): source_model: raw_orders
2021-05-03 12:24:20.877008 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:20.877123 (MainThread): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-05-03 12:24:20.899871 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:24:20.979370 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:24:20.997179 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:24:21.014589 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:24:21.031911 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:24:21.957760 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52d0b3460>]}
2021-05-03 12:24:22.095476 (MainThread): Found 23 models, 0 tests, 0 snapshots, 0 analyses, 372 macros, 0 operations, 0 seed files, 5 sources, 0 exposures
2021-05-03 12:24:22.097444 (MainThread): 
2021-05-03 12:24:22.097815 (MainThread): Acquiring new snowflake connection "master".
2021-05-03 12:24:22.131644 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:24:22.148251 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:24:22.148376 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-05-03 12:24:22.148477 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-05-03 12:24:23.384625 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 1.24 seconds
2021-05-03 12:24:23.389165 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-05-03 12:24:23.592852 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:24:23.596606 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:24:23.596742 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-05-03 12:24:23.596939 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-05-03 12:24:24.472648 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 0.88 seconds
2021-05-03 12:24:24.473645 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-05-03 12:24:24.705550 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:24:24.708861 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:24:24.708985 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-05-03 12:24:24.709091 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-05-03 12:24:25.343378 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 0.63 seconds
2021-05-03 12:24:25.344379 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-05-03 12:24:25.582122 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-05-03 12:24:25.591142 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-05-03 12:24:25.591266 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW_VLT"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW_VLT
2021-05-03 12:24:25.591376 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-05-03 12:24:26.550997 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 13 in 0.96 seconds
2021-05-03 12:24:26.564557 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: Close
2021-05-03 12:24:26.783440 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-05-03 12:24:26.786432 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-05-03 12:24:26.786555 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW
2021-05-03 12:24:26.786675 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-05-03 12:24:27.749195 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 0.96 seconds
2021-05-03 12:24:27.754839 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: Close
2021-05-03 12:24:27.973337 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-05-03 12:24:27.976818 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-05-03 12:24:27.976929 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_STG"} */

    show terse objects in DATAVAULTDEMO_DB.SS_STG
2021-05-03 12:24:27.977028 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-05-03 12:24:28.709277 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 0.73 seconds
2021-05-03 12:24:28.714928 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: Close
2021-05-03 12:24:28.962824 (MainThread): Using snowflake connection "master".
2021-05-03 12:24:28.963019 (MainThread): On master: BEGIN
2021-05-03 12:24:28.963130 (MainThread): Opening a new connection, currently in state init
2021-05-03 12:24:29.642885 (MainThread): SQL status: SUCCESS 1 in 0.68 seconds
2021-05-03 12:24:29.643095 (MainThread): On master: COMMIT
2021-05-03 12:24:29.643254 (MainThread): Using snowflake connection "master".
2021-05-03 12:24:29.643341 (MainThread): On master: COMMIT
2021-05-03 12:24:29.834435 (MainThread): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:24:29.834667 (MainThread): On master: Close
2021-05-03 12:24:30.033607 (MainThread): 12:24:30 | Concurrency: 1 threads (target='dev')
2021-05-03 12:24:30.033853 (MainThread): 12:24:30 | 
2021-05-03 12:24:30.035380 (Thread-1): Began running node model.Dbt_demo.raw_orders
2021-05-03 12:24:30.036830 (Thread-1): 12:24:30 | 1 of 23 START view model SS_RAW.raw_orders........................... [RUN]
2021-05-03 12:24:30.037163 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:24:30.037316 (Thread-1): Compiling model.Dbt_demo.raw_orders
2021-05-03 12:24:30.059390 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_orders"
2021-05-03 12:24:30.062240 (Thread-1): finished collecting timing info
2021-05-03 12:24:30.094666 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_orders"
2021-05-03 12:24:30.097812 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:24:30.097919 (Thread-1): On model.Dbt_demo.raw_orders: BEGIN
2021-05-03 12:24:30.098052 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:30.832785 (Thread-1): SQL status: SUCCESS 1 in 0.73 seconds
2021-05-03 12:24:30.832988 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:24:30.833077 (Thread-1): On model.Dbt_demo.raw_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_orders  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.ORDERS 
--FROM DATAVAULTDEMO_DB.SS.ORDERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:24:31.191682 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-05-03 12:24:31.192981 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-05-03 12:24:31.193156 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:24:31.193248 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-05-03 12:24:31.311639 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:24:31.323427 (Thread-1): finished collecting timing info
2021-05-03 12:24:31.323708 (Thread-1): On model.Dbt_demo.raw_orders: Close
2021-05-03 12:24:31.548030 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bbd5220>]}
2021-05-03 12:24:31.549479 (Thread-1): 12:24:31 | 1 of 23 OK created view model SS_RAW.raw_orders...................... [SUCCESS 1 in 1.51s]
2021-05-03 12:24:31.549659 (Thread-1): Finished running node model.Dbt_demo.raw_orders
2021-05-03 12:24:31.549832 (Thread-1): Began running node model.Dbt_demo.raw_products
2021-05-03 12:24:31.551168 (Thread-1): 12:24:31 | 2 of 23 START view model SS_RAW.raw_products......................... [RUN]
2021-05-03 12:24:31.551636 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:24:31.551762 (Thread-1): Compiling model.Dbt_demo.raw_products
2021-05-03 12:24:31.563062 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_products"
2021-05-03 12:24:31.563378 (Thread-1): finished collecting timing info
2021-05-03 12:24:31.568800 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_products"
2021-05-03 12:24:31.569409 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:24:31.569513 (Thread-1): On model.Dbt_demo.raw_products: BEGIN
2021-05-03 12:24:31.569611 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:32.502272 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-05-03 12:24:32.502476 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:24:32.502570 (Thread-1): On model.Dbt_demo.raw_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_products  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.PRODUCTS 
--FROM DATAVAULTDEMO_DB.SS.PRODUCTS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:24:32.863156 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-05-03 12:24:32.864344 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-05-03 12:24:32.864527 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:24:32.864621 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-05-03 12:24:32.991127 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:24:32.995308 (Thread-1): finished collecting timing info
2021-05-03 12:24:32.995586 (Thread-1): On model.Dbt_demo.raw_products: Close
2021-05-03 12:24:33.210688 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52be97e80>]}
2021-05-03 12:24:33.212114 (Thread-1): 12:24:33 | 2 of 23 OK created view model SS_RAW.raw_products.................... [SUCCESS 1 in 1.66s]
2021-05-03 12:24:33.212303 (Thread-1): Finished running node model.Dbt_demo.raw_products
2021-05-03 12:24:33.212478 (Thread-1): Began running node model.Dbt_demo.raw_customers
2021-05-03 12:24:33.213604 (Thread-1): 12:24:33 | 3 of 23 START view model SS_RAW.raw_customers........................ [RUN]
2021-05-03 12:24:33.214125 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:24:33.214423 (Thread-1): Compiling model.Dbt_demo.raw_customers
2021-05-03 12:24:33.225592 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_customers"
2021-05-03 12:24:33.225912 (Thread-1): finished collecting timing info
2021-05-03 12:24:33.231360 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_customers"
2021-05-03 12:24:33.231982 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:24:33.232088 (Thread-1): On model.Dbt_demo.raw_customers: BEGIN
2021-05-03 12:24:33.232190 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:33.947487 (Thread-1): SQL status: SUCCESS 1 in 0.72 seconds
2021-05-03 12:24:33.947693 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:24:33.947789 (Thread-1): On model.Dbt_demo.raw_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_customers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.CUSTOMERS 
--FROM DATAVAULTDEMO_DB.SS.CUSTOMERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:24:34.616329 (Thread-1): SQL status: SUCCESS 1 in 0.67 seconds
2021-05-03 12:24:34.617503 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-05-03 12:24:34.617684 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:24:34.617778 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-05-03 12:24:34.742499 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:24:34.746687 (Thread-1): finished collecting timing info
2021-05-03 12:24:34.746972 (Thread-1): On model.Dbt_demo.raw_customers: Close
2021-05-03 12:24:34.997638 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52be9f040>]}
2021-05-03 12:24:34.999080 (Thread-1): 12:24:34 | 3 of 23 OK created view model SS_RAW.raw_customers................... [SUCCESS 1 in 1.78s]
2021-05-03 12:24:34.999252 (Thread-1): Finished running node model.Dbt_demo.raw_customers
2021-05-03 12:24:34.999419 (Thread-1): Began running node model.Dbt_demo.raw_shippers
2021-05-03 12:24:35.000674 (Thread-1): 12:24:34 | 4 of 23 START view model SS_RAW.raw_shippers......................... [RUN]
2021-05-03 12:24:35.001120 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:24:35.001284 (Thread-1): Compiling model.Dbt_demo.raw_shippers
2021-05-03 12:24:35.012238 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_shippers"
2021-05-03 12:24:35.012547 (Thread-1): finished collecting timing info
2021-05-03 12:24:35.017823 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_shippers"
2021-05-03 12:24:35.018448 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:24:35.018551 (Thread-1): On model.Dbt_demo.raw_shippers: BEGIN
2021-05-03 12:24:35.018655 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:35.828719 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-05-03 12:24:35.828924 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:24:35.829013 (Thread-1): On model.Dbt_demo.raw_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_shippers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SHIPPERS 
--FROM DATAVAULTDEMO_DB.SS.SHIPPERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:24:36.144804 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:24:36.146000 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-05-03 12:24:36.146180 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:24:36.146271 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-05-03 12:24:36.287231 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:24:36.291316 (Thread-1): finished collecting timing info
2021-05-03 12:24:36.291586 (Thread-1): On model.Dbt_demo.raw_shippers: Close
2021-05-03 12:24:36.482573 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bef3820>]}
2021-05-03 12:24:36.483956 (Thread-1): 12:24:36 | 4 of 23 OK created view model SS_RAW.raw_shippers.................... [SUCCESS 1 in 1.48s]
2021-05-03 12:24:36.484131 (Thread-1): Finished running node model.Dbt_demo.raw_shippers
2021-05-03 12:24:36.484297 (Thread-1): Began running node model.Dbt_demo.raw_suppliers
2021-05-03 12:24:36.485542 (Thread-1): 12:24:36 | 5 of 23 START view model SS_RAW.raw_suppliers........................ [RUN]
2021-05-03 12:24:36.486039 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:24:36.486168 (Thread-1): Compiling model.Dbt_demo.raw_suppliers
2021-05-03 12:24:36.497078 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_suppliers"
2021-05-03 12:24:36.497395 (Thread-1): finished collecting timing info
2021-05-03 12:24:36.502756 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_suppliers"
2021-05-03 12:24:36.503370 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:24:36.503470 (Thread-1): On model.Dbt_demo.raw_suppliers: BEGIN
2021-05-03 12:24:36.503574 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:37.382012 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 12:24:37.382211 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:24:37.382302 (Thread-1): On model.Dbt_demo.raw_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_suppliers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SUPPLIERS 
--FROM DATAVAULTDEMO_DB.SS.SUPPLIERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:24:37.677874 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:24:37.679074 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-05-03 12:24:37.679251 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:24:37.679343 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-05-03 12:24:37.792954 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:24:37.797012 (Thread-1): finished collecting timing info
2021-05-03 12:24:37.797282 (Thread-1): On model.Dbt_demo.raw_suppliers: Close
2021-05-03 12:24:37.999305 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52b9c9cd0>]}
2021-05-03 12:24:38.000708 (Thread-1): 12:24:37 | 5 of 23 OK created view model SS_RAW.raw_suppliers................... [SUCCESS 1 in 1.51s]
2021-05-03 12:24:38.000885 (Thread-1): Finished running node model.Dbt_demo.raw_suppliers
2021-05-03 12:24:38.001054 (Thread-1): Began running node model.Dbt_demo.v_stg_orders
2021-05-03 12:24:38.002343 (Thread-1): 12:24:37 | 6 of 23 START view model SS_STG.v_stg_orders......................... [RUN]
2021-05-03 12:24:38.002809 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:24:38.002974 (Thread-1): Compiling model.Dbt_demo.v_stg_orders
2021-05-03 12:24:38.017843 (Thread-1): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-05-03 12:24:38.018039 (Thread-1): source_model: raw_orders
2021-05-03 12:24:38.018164 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:38.018304 (Thread-1): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-05-03 12:24:38.029808 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:24:38.029927 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-05-03 12:24:38.030052 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:38.691243 (Thread-1): SQL status: SUCCESS 13 in 0.66 seconds
2021-05-03 12:24:38.698059 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:24:38.698195 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-05-03 12:24:38.853447 (Thread-1): SQL status: SUCCESS 13 in 0.16 seconds
2021-05-03 12:24:38.865836 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_orders"
2021-05-03 12:24:38.866965 (Thread-1): finished collecting timing info
2021-05-03 12:24:38.872921 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_orders"
2021-05-03 12:24:38.878668 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:24:38.878784 (Thread-1): On model.Dbt_demo.v_stg_orders: BEGIN
2021-05-03 12:24:39.024114 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:24:39.024307 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:24:39.024394 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_orders  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_orders
),

derived_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-ORDERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''))) AS BINARY(16)) AS ORDER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS ORDER_PRODUCT_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^')
    ), '^^||^^||^^')) AS BINARY(16)) AS ORDER_SHIPPER_CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCOUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPOSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPREGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    ORDER_PK,
    PRODUCT_PK,
    SHIPPER_PK,
    CUSTOMER_PK,
    ORDER_PRODUCT_PK,
    ORDER_SHIPPER_CUSTOMER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:24:39.436341 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-05-03 12:24:39.437477 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-05-03 12:24:39.437648 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:24:39.437740 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-05-03 12:24:39.554774 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:24:39.558765 (Thread-1): finished collecting timing info
2021-05-03 12:24:39.559030 (Thread-1): On model.Dbt_demo.v_stg_orders: Close
2021-05-03 12:24:39.780400 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bb80dc0>]}
2021-05-03 12:24:39.781815 (Thread-1): 12:24:39 | 6 of 23 OK created view model SS_STG.v_stg_orders.................... [SUCCESS 1 in 1.78s]
2021-05-03 12:24:39.782014 (Thread-1): Finished running node model.Dbt_demo.v_stg_orders
2021-05-03 12:24:39.782194 (Thread-1): Began running node model.Dbt_demo.v_stg_products
2021-05-03 12:24:39.783475 (Thread-1): 12:24:39 | 7 of 23 START view model SS_STG.v_stg_products....................... [RUN]
2021-05-03 12:24:39.784061 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:24:39.784234 (Thread-1): Compiling model.Dbt_demo.v_stg_products
2021-05-03 12:24:39.798325 (Thread-1): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-05-03 12:24:39.798494 (Thread-1): source_model: raw_products
2021-05-03 12:24:39.798621 (Thread-1): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:39.798763 (Thread-1): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-05-03 12:24:39.802715 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:24:39.802829 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-05-03 12:24:39.802930 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:40.519002 (Thread-1): SQL status: SUCCESS 11 in 0.72 seconds
2021-05-03 12:24:40.525167 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:24:40.525280 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-05-03 12:24:40.691349 (Thread-1): SQL status: SUCCESS 11 in 0.17 seconds
2021-05-03 12:24:40.700835 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_products"
2021-05-03 12:24:40.701160 (Thread-1): finished collecting timing info
2021-05-03 12:24:40.707004 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_products"
2021-05-03 12:24:40.710950 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:24:40.711054 (Thread-1): On model.Dbt_demo.v_stg_products: BEGIN
2021-05-03 12:24:40.920246 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:24:40.920438 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:24:40.920526 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_products  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_products
),

derived_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORYID AS CATEGORY,
    'TPCH-PRODUCTS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS PRODUCT_SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CATEGORYID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(QUANTITYPERUNIT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REORDERLEVEL AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITPRICE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSINSTOCK AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSONORDER AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS PRODUCT_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,
    PRODUCT_PK,
    SUPPLIER_PK,
    PRODUCT_SUPPLIER_PK,
    PRODUCT_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:24:41.710159 (Thread-1): SQL status: SUCCESS 1 in 0.79 seconds
2021-05-03 12:24:41.711305 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-05-03 12:24:41.711479 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:24:41.711570 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-05-03 12:24:41.874551 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:24:41.878546 (Thread-1): finished collecting timing info
2021-05-03 12:24:41.878816 (Thread-1): On model.Dbt_demo.v_stg_products: Close
2021-05-03 12:24:42.246695 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bf119a0>]}
2021-05-03 12:24:42.248094 (Thread-1): 12:24:42 | 7 of 23 OK created view model SS_STG.v_stg_products.................. [SUCCESS 1 in 2.46s]
2021-05-03 12:24:42.248267 (Thread-1): Finished running node model.Dbt_demo.v_stg_products
2021-05-03 12:24:42.248437 (Thread-1): Began running node model.Dbt_demo.v_stg_customers
2021-05-03 12:24:42.249703 (Thread-1): 12:24:42 | 8 of 23 START view model SS_STG.v_stg_customers...................... [RUN]
2021-05-03 12:24:42.250253 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:24:42.250381 (Thread-1): Compiling model.Dbt_demo.v_stg_customers
2021-05-03 12:24:42.263831 (Thread-1): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-05-03 12:24:42.263986 (Thread-1): source_model: raw_customers
2021-05-03 12:24:42.264112 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:42.264231 (Thread-1): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-05-03 12:24:42.268201 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:24:42.268313 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-05-03 12:24:42.268413 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:43.147163 (Thread-1): SQL status: SUCCESS 10 in 0.88 seconds
2021-05-03 12:24:43.154514 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:24:43.154642 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-05-03 12:24:43.444049 (Thread-1): SQL status: SUCCESS 10 in 0.29 seconds
2021-05-03 12:24:43.451579 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_customers"
2021-05-03 12:24:43.451900 (Thread-1): finished collecting timing info
2021-05-03 12:24:43.457523 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_customers"
2021-05-03 12:24:43.460548 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:24:43.460652 (Thread-1): On model.Dbt_demo.v_stg_customers: BEGIN
2021-05-03 12:24:43.949151 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-05-03 12:24:43.949343 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:24:43.949431 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_customers  as (
    










    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_customers
),

derived_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-CUSTOMERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:24:44.358056 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-05-03 12:24:44.359200 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-05-03 12:24:44.359376 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:24:44.359472 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-05-03 12:24:44.498346 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:24:44.502696 (Thread-1): finished collecting timing info
2021-05-03 12:24:44.502965 (Thread-1): On model.Dbt_demo.v_stg_customers: Close
2021-05-03 12:24:44.725831 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bebf5b0>]}
2021-05-03 12:24:44.727264 (Thread-1): 12:24:44 | 8 of 23 OK created view model SS_STG.v_stg_customers................. [SUCCESS 1 in 2.48s]
2021-05-03 12:24:44.727449 (Thread-1): Finished running node model.Dbt_demo.v_stg_customers
2021-05-03 12:24:44.727626 (Thread-1): Began running node model.Dbt_demo.v_stg_shippers
2021-05-03 12:24:44.729072 (Thread-1): 12:24:44 | 9 of 23 START view model SS_STG.v_stg_shippers....................... [RUN]
2021-05-03 12:24:44.729425 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:24:44.729549 (Thread-1): Compiling model.Dbt_demo.v_stg_shippers
2021-05-03 12:24:44.742359 (Thread-1): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-05-03 12:24:44.742515 (Thread-1): source_model: raw_shippers
2021-05-03 12:24:44.742645 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:44.742764 (Thread-1): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-05-03 12:24:44.746843 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:24:44.746955 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-05-03 12:24:44.747056 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:46.185617 (Thread-1): SQL status: SUCCESS 5 in 1.44 seconds
2021-05-03 12:24:46.191356 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:24:46.191474 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-05-03 12:24:46.339235 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-05-03 12:24:46.344864 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_shippers"
2021-05-03 12:24:46.345203 (Thread-1): finished collecting timing info
2021-05-03 12:24:46.353152 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_shippers"
2021-05-03 12:24:46.355500 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:24:46.355617 (Thread-1): On model.Dbt_demo.v_stg_shippers: BEGIN
2021-05-03 12:24:46.506093 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:24:46.506293 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:24:46.506385 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_shippers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_shippers
),

derived_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SHIPPERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PHONE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SHIPPER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SHIPPER_PK,
    SHIPPER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:24:46.895816 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-05-03 12:24:46.896992 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-05-03 12:24:46.897173 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:24:46.897268 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-05-03 12:24:47.023185 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:24:47.027213 (Thread-1): finished collecting timing info
2021-05-03 12:24:47.027491 (Thread-1): On model.Dbt_demo.v_stg_shippers: Close
2021-05-03 12:24:47.241232 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bb344c0>]}
2021-05-03 12:24:47.242773 (Thread-1): 12:24:47 | 9 of 23 OK created view model SS_STG.v_stg_shippers.................. [SUCCESS 1 in 2.51s]
2021-05-03 12:24:47.242954 (Thread-1): Finished running node model.Dbt_demo.v_stg_shippers
2021-05-03 12:24:47.243129 (Thread-1): Began running node model.Dbt_demo.v_stg_suppliers
2021-05-03 12:24:47.244244 (Thread-1): 12:24:47 | 10 of 23 START view model SS_STG.v_stg_suppliers..................... [RUN]
2021-05-03 12:24:47.244894 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:24:47.245021 (Thread-1): Compiling model.Dbt_demo.v_stg_suppliers
2021-05-03 12:24:47.258488 (Thread-1): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-05-03 12:24:47.258639 (Thread-1): source_model: raw_suppliers
2021-05-03 12:24:47.258764 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:24:47.258881 (Thread-1): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-05-03 12:24:47.262857 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:24:47.262969 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-05-03 12:24:47.263068 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:47.990982 (Thread-1): SQL status: SUCCESS 10 in 0.73 seconds
2021-05-03 12:24:47.997497 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:24:47.997614 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-05-03 12:24:48.146434 (Thread-1): SQL status: SUCCESS 10 in 0.15 seconds
2021-05-03 12:24:48.153918 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-05-03 12:24:48.154271 (Thread-1): finished collecting timing info
2021-05-03 12:24:48.159877 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-05-03 12:24:48.162995 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:24:48.163102 (Thread-1): On model.Dbt_demo.v_stg_suppliers: BEGIN
2021-05-03 12:24:48.312820 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:24:48.313008 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:24:48.313113 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
),

derived_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SUPPLIERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTTITLE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SUPPLIER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SUPPLIER_PK,
    SUPPLIER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:24:48.695986 (Thread-1): SQL status: SUCCESS 1 in 0.38 seconds
2021-05-03 12:24:48.697131 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-05-03 12:24:48.697305 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:24:48.697395 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-05-03 12:24:48.829581 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:24:48.835259 (Thread-1): finished collecting timing info
2021-05-03 12:24:48.835522 (Thread-1): On model.Dbt_demo.v_stg_suppliers: Close
2021-05-03 12:24:49.394090 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bb6cb20>]}
2021-05-03 12:24:49.395497 (Thread-1): 12:24:49 | 10 of 23 OK created view model SS_STG.v_stg_suppliers................ [SUCCESS 1 in 2.15s]
2021-05-03 12:24:49.395671 (Thread-1): Finished running node model.Dbt_demo.v_stg_suppliers
2021-05-03 12:24:49.395845 (Thread-1): Began running node model.Dbt_demo.hub_orders
2021-05-03 12:24:49.397100 (Thread-1): 12:24:49 | 11 of 23 START incremental model SS_RAW_VLT.hub_orders............... [RUN]
2021-05-03 12:24:49.397635 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:49.397761 (Thread-1): Compiling model.Dbt_demo.hub_orders
2021-05-03 12:24:49.482531 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_orders"
2021-05-03 12:24:49.484307 (Thread-1): finished collecting timing info
2021-05-03 12:24:49.526033 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:49.526204 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PK, ORDERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:24:49.526330 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:52.955682 (Thread-1): SQL status: SUCCESS 1 in 3.43 seconds
2021-05-03 12:24:52.959187 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:52.959300 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
2021-05-03 12:24:53.210597 (Thread-1): SQL status: SUCCESS 4 in 0.25 seconds
2021-05-03 12:24:53.214570 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:53.214684 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-05-03 12:24:53.363418 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-05-03 12:24:53.367308 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:53.367422 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-05-03 12:24:53.530991 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-05-03 12:24:53.547246 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_orders"
2021-05-03 12:24:53.549449 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:53.549558 (Thread-1): On model.Dbt_demo.hub_orders: BEGIN
2021-05-03 12:24:53.696984 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:24:53.697192 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:53.697313 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders ("ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
        );
2021-05-03 12:24:54.592796 (Thread-1): SQL status: SUCCESS 0 in 0.90 seconds
2021-05-03 12:24:54.594000 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-05-03 12:24:54.594188 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:24:54.594292 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-05-03 12:24:54.815096 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:24:54.823773 (Thread-1): finished collecting timing info
2021-05-03 12:24:54.824057 (Thread-1): On model.Dbt_demo.hub_orders: Close
2021-05-03 12:24:55.040786 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52d0cb430>]}
2021-05-03 12:24:55.042220 (Thread-1): 12:24:55 | 11 of 23 OK created incremental model SS_RAW_VLT.hub_orders.......... [SUCCESS 0 in 5.64s]
2021-05-03 12:24:55.042412 (Thread-1): Finished running node model.Dbt_demo.hub_orders
2021-05-03 12:24:55.042583 (Thread-1): Began running node model.Dbt_demo.link_order_prod
2021-05-03 12:24:55.043823 (Thread-1): 12:24:55 | 12 of 23 START incremental model SS_RAW_VLT.link_order_prod.......... [RUN]
2021-05-03 12:24:55.044134 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:55.044259 (Thread-1): Compiling model.Dbt_demo.link_order_prod
2021-05-03 12:24:55.057121 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_prod"
2021-05-03 12:24:55.058193 (Thread-1): finished collecting timing info
2021-05-03 12:24:55.066131 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:55.066259 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PRODUCT_PK, PRODUCT_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PRODUCT_PK, a.PRODUCT_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod AS d
    ON a.ORDER_PRODUCT_PK = d.ORDER_PRODUCT_PK
    WHERE d.ORDER_PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:24:55.066369 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:24:57.141432 (Thread-1): SQL status: SUCCESS 1 in 2.08 seconds
2021-05-03 12:24:57.144933 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:57.145044 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
2021-05-03 12:24:57.289611 (Thread-1): SQL status: SUCCESS 5 in 0.14 seconds
2021-05-03 12:24:57.293835 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:57.293948 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-05-03 12:24:57.450153 (Thread-1): SQL status: SUCCESS 5 in 0.16 seconds
2021-05-03 12:24:57.455424 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:57.455538 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-05-03 12:24:57.606533 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-05-03 12:24:57.608488 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_prod"
2021-05-03 12:24:57.610100 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:57.610214 (Thread-1): On model.Dbt_demo.link_order_prod: BEGIN
2021-05-03 12:24:57.748372 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:24:57.748562 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:57.748650 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod ("ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
        );
2021-05-03 12:24:58.284639 (Thread-1): SQL status: SUCCESS 0 in 0.54 seconds
2021-05-03 12:24:58.285781 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-05-03 12:24:58.285954 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:24:58.286075 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-05-03 12:24:58.477405 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:24:58.481494 (Thread-1): finished collecting timing info
2021-05-03 12:24:58.481763 (Thread-1): On model.Dbt_demo.link_order_prod: Close
2021-05-03 12:24:58.695210 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5395a7d00>]}
2021-05-03 12:24:58.696615 (Thread-1): 12:24:58 | 12 of 23 OK created incremental model SS_RAW_VLT.link_order_prod..... [SUCCESS 0 in 3.65s]
2021-05-03 12:24:58.696788 (Thread-1): Finished running node model.Dbt_demo.link_order_prod
2021-05-03 12:24:58.696961 (Thread-1): Began running node model.Dbt_demo.link_order_ship_cust
2021-05-03 12:24:58.698220 (Thread-1): 12:24:58 | 13 of 23 START incremental model SS_RAW_VLT.link_order_ship_cust..... [RUN]
2021-05-03 12:24:58.698530 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:24:58.698654 (Thread-1): Compiling model.Dbt_demo.link_order_ship_cust
2021-05-03 12:24:58.712076 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-05-03 12:24:58.712390 (Thread-1): finished collecting timing info
2021-05-03 12:24:58.719900 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:24:58.720032 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_SHIPPER_CUSTOMER_PK, SHIPPER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_SHIPPER_CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_SHIPPER_CUSTOMER_PK, a.SHIPPER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust AS d
    ON a.ORDER_SHIPPER_CUSTOMER_PK = d.ORDER_SHIPPER_CUSTOMER_PK
    WHERE d.ORDER_SHIPPER_CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:24:58.720150 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:25:01.227225 (Thread-1): SQL status: SUCCESS 1 in 2.51 seconds
2021-05-03 12:25:01.230715 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:25:01.230828 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
2021-05-03 12:25:01.378734 (Thread-1): SQL status: SUCCESS 6 in 0.15 seconds
2021-05-03 12:25:01.382796 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:25:01.382924 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-05-03 12:25:01.522358 (Thread-1): SQL status: SUCCESS 6 in 0.14 seconds
2021-05-03 12:25:01.527648 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:25:01.527763 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-05-03 12:25:01.678236 (Thread-1): SQL status: SUCCESS 6 in 0.15 seconds
2021-05-03 12:25:01.680089 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-05-03 12:25:01.680923 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:25:01.681031 (Thread-1): On model.Dbt_demo.link_order_ship_cust: BEGIN
2021-05-03 12:25:01.830753 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:25:01.830953 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:25:01.831046 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust ("ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
        );
2021-05-03 12:25:02.113865 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:25:02.115114 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-05-03 12:25:02.115299 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:25:02.115396 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-05-03 12:25:02.312496 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:25:02.316934 (Thread-1): finished collecting timing info
2021-05-03 12:25:02.317205 (Thread-1): On model.Dbt_demo.link_order_ship_cust: Close
2021-05-03 12:25:02.534937 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bd64f40>]}
2021-05-03 12:25:02.536357 (Thread-1): 12:25:02 | 13 of 23 OK created incremental model SS_RAW_VLT.link_order_ship_cust [SUCCESS 0 in 3.84s]
2021-05-03 12:25:02.536531 (Thread-1): Finished running node model.Dbt_demo.link_order_ship_cust
2021-05-03 12:25:02.536703 (Thread-1): Began running node model.Dbt_demo.sat_orders
2021-05-03 12:25:02.537933 (Thread-1): 12:25:02 | 14 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_orders.... [RUN]
2021-05-03 12:25:02.538265 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:02.538390 (Thread-1): Compiling model.Dbt_demo.sat_orders
2021-05-03 12:25:02.559967 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_orders"
2021-05-03 12:25:02.561098 (Thread-1): finished collecting timing info
2021-05-03 12:25:02.628268 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:02.628467 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:25:02.628584 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:25:03.531424 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:25:03.560782 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:03.560938 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:25:03.177000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:25:03.177000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_orders
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:25:03.909118 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-05-03 12:25:03.912808 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:03.912926 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:04.060173 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:04.068925 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:04.069046 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:04.179144 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:04.191994 (Thread-1): 12:25:04 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:04.210478 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:04.210599 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:04.340418 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:04.340613 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:04.340702 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:05.555179 (Thread-1): SQL status: SUCCESS 1 in 1.21 seconds
2021-05-03 12:25:05.559283 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:05.559396 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:05.684877 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:05.689213 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:05.689330 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:05.858534 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:25:05.861041 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:05.861153 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:06.124000 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:25:06.125269 (Thread-1): 12:25:06 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:06.125471 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:06.125648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:06.125737 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:06.313591 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:25:06.314715 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:06.314829 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:06.429701 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:06.431499 (Thread-1): 12:25:06 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:06.436781 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:06.436892 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:06.588421 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:25:06.588618 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:06.588708 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:07.619726 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-05-03 12:25:07.623654 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:07.623771 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:07.755357 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:07.761185 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:07.761318 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:07.877156 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:07.879519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:07.879635 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:08.248924 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-05-03 12:25:08.250641 (Thread-1): 12:25:08 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:08.250854 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:08.251035 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:08.251129 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:08.452184 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:25:08.453283 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:08.453391 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:08.571575 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:08.572991 (Thread-1): 12:25:08 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:08.578311 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:08.578431 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:08.718843 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:25:08.719039 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:08.719128 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:09.735899 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-05-03 12:25:09.739742 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:09.739859 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:09.885187 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:09.889707 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:09.889829 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:10.013272 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:10.015584 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:10.015692 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:10.285317 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:25:10.286641 (Thread-1): 12:25:10 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:10.286843 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:10.287017 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:10.287113 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:10.489602 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:25:10.490739 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:10.490846 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:10.666146 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:25:10.667534 (Thread-1): 12:25:10 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:10.672827 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:10.672950 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:10.804636 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:10.804824 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:10.804912 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:11.765419 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 12:25:11.769535 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:11.769648 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:11.900434 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:11.904790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:11.904902 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:12.021475 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:12.023752 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:12.023861 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:12.460391 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-05-03 12:25:12.461672 (Thread-1): 12:25:12 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:12.461881 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:12.462074 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:12.462166 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:12.651129 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:25:12.652246 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:12.652359 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:12.764980 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:12.766467 (Thread-1): 12:25:12 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:12.772319 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:12.772438 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:12.906943 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:12.907141 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:12.907235 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:14.004364 (Thread-1): SQL status: SUCCESS 1 in 1.10 seconds
2021-05-03 12:25:14.009996 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:14.010126 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:14.144688 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:14.149311 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:14.149431 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:14.298638 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:14.300962 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:14.301079 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:14.997465 (Thread-1): SQL status: SUCCESS 0 in 0.70 seconds
2021-05-03 12:25:14.998852 (Thread-1): 12:25:14 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:14.999069 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:14.999259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:14.999355 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:15.322823 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:25:15.323904 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:15.324024 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:15.439796 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:15.441271 (Thread-1): 12:25:15 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:15.446728 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:15.446846 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:15.581934 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:15.582167 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:15.582262 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:16.520683 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-05-03 12:25:16.524700 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:16.524826 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:16.687160 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:25:16.691659 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:16.691780 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:16.837628 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:16.839988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:16.840103 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:17.103689 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:25:17.105024 (Thread-1): 12:25:17 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:17.105243 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:17.105429 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:17.105522 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:17.292608 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:25:17.293733 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:17.293844 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:17.412372 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:17.414234 (Thread-1): 12:25:17 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:17.419605 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:17.419725 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:17.559586 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:25:17.559785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:17.559874 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:18.692074 (Thread-1): SQL status: SUCCESS 1 in 1.13 seconds
2021-05-03 12:25:18.696040 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:18.696154 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:18.863637 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:25:18.867880 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:18.867992 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:18.989733 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:18.991990 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:18.992099 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:19.300954 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:25:19.304245 (Thread-1): 12:25:19 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:19.304452 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:19.304630 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:19.304722 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:19.504426 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:25:19.505515 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:19.505621 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:19.628517 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:19.629895 (Thread-1): 12:25:19 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:19.635644 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:19.635755 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:19.772435 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:25:19.772628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:19.772717 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:20.763931 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-05-03 12:25:20.767754 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:20.767869 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:20.917643 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:20.922169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:20.922284 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:21.040880 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:21.043193 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:21.043303 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:21.549033 (Thread-1): SQL status: SUCCESS 0 in 0.51 seconds
2021-05-03 12:25:21.550342 (Thread-1): 12:25:21 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:21.550547 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:21.550725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:21.550818 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:21.878887 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-05-03 12:25:21.880339 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:21.880458 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:22.057105 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:25:22.058533 (Thread-1): 12:25:22 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:22.063847 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:22.063960 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:22.301547 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:25:22.301756 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:22.301846 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:23.432752 (Thread-1): SQL status: SUCCESS 1 in 1.13 seconds
2021-05-03 12:25:23.436907 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:23.437022 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:23.593565 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:25:23.680196 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:23.680363 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:23.799475 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:23.801773 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:23.801882 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:24.258366 (Thread-1): SQL status: SUCCESS 0 in 0.46 seconds
2021-05-03 12:25:24.260009 (Thread-1): 12:25:24 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:24.260212 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:24.260386 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:24.260476 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:24.513227 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:25:24.514401 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:24.514509 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:24.737022 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:25:24.738432 (Thread-1): 12:25:24 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:24.744107 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:24.744220 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:24.957017 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:25:24.957211 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:24.957300 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:26.352970 (Thread-1): SQL status: SUCCESS 1 in 1.40 seconds
2021-05-03 12:25:26.356866 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:26.356980 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:26.501736 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:26.507859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:26.508010 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:26.630000 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:26.632472 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:26.632585 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:26.976818 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 12:25:26.978092 (Thread-1): 12:25:26 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:26.978294 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:26.978472 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:26.978562 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:27.152547 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:25:27.153640 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:27.153746 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:27.268363 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:27.269735 (Thread-1): 12:25:27 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:27.275101 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:27.275218 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:27.407359 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:27.407550 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:27.407642 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:28.814476 (Thread-1): SQL status: SUCCESS 1 in 1.41 seconds
2021-05-03 12:25:28.818612 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:28.818727 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:28.964642 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:28.969010 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:28.969122 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:29.097862 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:29.100162 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:29.100272 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:29.346634 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:25:29.347898 (Thread-1): 12:25:29 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:29.348102 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:29.348276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:29.348367 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:29.521873 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:25:29.522986 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:29.523097 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:29.640609 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:29.641982 (Thread-1): 12:25:29 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:29.647592 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:29.647705 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:29.807999 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:25:29.808192 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:29.808290 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:30.710609 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:25:30.714534 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:30.714649 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:30.879561 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:25:30.884044 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:30.884157 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:31.003886 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:31.006197 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:31.006307 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:31.241280 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-05-03 12:25:31.242630 (Thread-1): 12:25:31 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:31.242844 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:31.243025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:31.243133 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:31.421126 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:25:31.422624 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:31.422736 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:31.535293 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:31.536756 (Thread-1): 12:25:31 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:31.542162 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:31.542282 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:31.693674 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:25:31.693875 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:31.693992 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:32.665366 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 12:25:32.669261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:32.669383 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:32.801334 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:32.805841 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:32.805982 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:32.933395 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:32.935779 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:32.935895 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:33.191638 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:25:33.192903 (Thread-1): 12:25:33 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:33.193104 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:33.193277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:33.193369 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:33.692428 (Thread-1): SQL status: SUCCESS 1 in 0.50 seconds
2021-05-03 12:25:33.693518 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:33.693623 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:33.814830 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:33.816614 (Thread-1): 12:25:33 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:33.821887 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:33.822017 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:34.066240 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:25:34.066432 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:34.066521 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:35.018141 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-05-03 12:25:35.022098 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:35.022218 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:35.170751 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:35.175107 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:35.175228 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:35.371640 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:25:35.373986 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:35.374106 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:35.631963 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:25:35.633597 (Thread-1): 12:25:35 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:35.633806 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:35.634010 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:35.634105 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:35.837068 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:25:35.838185 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:35.838292 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:35.957911 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:35.959332 (Thread-1): 12:25:35 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:35.965002 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:35.965115 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:36.128446 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:25:36.128636 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:36.128724 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:37.288104 (Thread-1): SQL status: SUCCESS 1 in 1.16 seconds
2021-05-03 12:25:37.291984 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:37.292104 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:37.502043 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-05-03 12:25:37.508161 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:37.508280 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:37.622758 (Thread-1): SQL status: SUCCESS 12 in 0.11 seconds
2021-05-03 12:25:37.624996 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:37.625105 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:38.350451 (Thread-1): SQL status: SUCCESS 0 in 0.73 seconds
2021-05-03 12:25:38.351762 (Thread-1): 12:25:38 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:38.351965 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:38.352140 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:38.352230 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:38.537241 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:25:38.538368 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:38.538488 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:38.666454 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:38.668283 (Thread-1): 12:25:38 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:38.673507 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:38.673620 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:38.833835 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:25:38.834049 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:38.834140 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:40.049485 (Thread-1): SQL status: SUCCESS 1 in 1.22 seconds
2021-05-03 12:25:40.053612 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:40.053728 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:40.197478 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:40.201855 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:40.201986 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:40.330132 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:40.332420 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:40.332531 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:40.680897 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:25:40.682202 (Thread-1): 12:25:40 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:40.682403 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:40.682579 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:40.682668 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:40.898884 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:25:40.899968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:40.900075 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:41.011652 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:41.013056 (Thread-1): 12:25:41 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:41.018708 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:41.018827 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:41.208063 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:25:41.208256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:41.208346 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:42.110287 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:25:42.114261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:42.114385 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:42.276414 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:25:42.280908 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:42.281023 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:42.400232 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:25:42.402531 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:42.402641 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:42.675619 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:25:42.676951 (Thread-1): 12:25:42 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:42.677161 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:42.677341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:42.677435 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:42.853013 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:25:42.854482 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:42.854588 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:42.975697 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:42.977143 (Thread-1): 12:25:42 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:42.982877 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:42.983000 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:43.115575 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:43.115772 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:43.115864 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:44.011327 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:25:44.016579 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:44.016697 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:44.337076 (Thread-1): SQL status: SUCCESS 12 in 0.32 seconds
2021-05-03 12:25:44.341534 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:44.341648 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:44.559400 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:25:44.561746 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:44.561856 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:44.813525 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:25:44.814878 (Thread-1): 12:25:44 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:44.815088 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:44.815268 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:44.815358 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:45.043931 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:25:45.045013 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:45.045117 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:45.156510 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:45.158348 (Thread-1): 12:25:45 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:45.163599 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:45.163708 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:45.313830 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:25:45.314041 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:45.314132 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:46.497010 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-05-03 12:25:46.501000 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:46.501118 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:46.641924 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:46.646230 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:46.646343 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:46.776927 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:46.779235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:46.779344 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:47.033769 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:25:47.035384 (Thread-1): 12:25:47 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:47.035587 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:47.035768 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:47.035858 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:47.218656 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:25:47.219747 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:47.219852 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:47.337880 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:47.339293 (Thread-1): 12:25:47 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:47.344924 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:47.345035 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:47.487880 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:25:47.488073 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:47.488166 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:48.418755 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-05-03 12:25:48.422678 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:48.422806 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:48.560965 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:48.565341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:48.565451 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:48.716648 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:25:48.718954 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:48.719062 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:49.009026 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:25:49.010338 (Thread-1): 12:25:49 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:49.010540 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:49.010713 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:49.010802 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:49.210631 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:25:49.211734 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:49.211838 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:49.327964 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:49.331471 (Thread-1): 12:25:49 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:49.336718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:49.336828 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:49.469592 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:25:49.469774 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:49.469860 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:50.365710 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:25:50.369659 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:50.369771 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:50.507472 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:50.511719 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:50.511833 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:50.652857 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:50.655163 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:50.655273 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:50.968640 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:25:50.970259 (Thread-1): 12:25:50 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:50.970463 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:50.970640 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:50.970729 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:51.162356 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:25:51.163438 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:51.163545 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:51.310355 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:25:51.311745 (Thread-1): 12:25:51 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:51.317044 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:51.317170 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:51.457227 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:25:51.457424 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:51.457510 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:52.393333 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-05-03 12:25:52.397207 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:52.397320 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:52.539544 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:52.543941 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:52.544050 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:52.675683 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:52.677948 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:52.678090 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:52.940094 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:25:52.941373 (Thread-1): 12:25:52 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:52.941577 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:52.941752 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:52.941841 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:53.143878 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:25:53.144974 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:53.145078 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:53.262989 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:25:53.264764 (Thread-1): 12:25:53 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:53.270012 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:53.270129 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:53.527875 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 12:25:53.528063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:53.528149 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:55.956764 (Thread-1): SQL status: SUCCESS 1 in 2.43 seconds
2021-05-03 12:25:55.960811 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:55.960929 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:56.119270 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:25:56.125312 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:56.125429 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:56.257282 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:25:56.259622 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:56.259734 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:56.607590 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:25:56.608852 (Thread-1): 12:25:56 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:56.609057 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:56.609227 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:56.609314 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:56.910518 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:25:56.911958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:56.912062 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:57.021823 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:57.023194 (Thread-1): 12:25:57 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:57.028469 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:57.028580 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:57.172654 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:25:57.172849 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:57.172937 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:25:58.426175 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 12:25:58.429943 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:58.430073 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:25:58.568711 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:25:58.573068 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:58.573177 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:25:58.821338 (Thread-1): SQL status: SUCCESS 12 in 0.25 seconds
2021-05-03 12:25:58.823653 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:58.823761 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:25:59.135190 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:25:59.136454 (Thread-1): 12:25:59 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:25:59.136652 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:59.136826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:59.136914 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:25:59.317307 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:25:59.318418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:59.318522 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:25:59.433469 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:25:59.435282 (Thread-1): 12:25:59 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_orders]
2021-05-03 12:25:59.440518 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:59.440629 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:25:59.583800 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:25:59.583983 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:25:59.584080 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:00.487497 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:26:00.491433 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:00.491545 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:26:00.647599 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:26:00.651828 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:00.651937 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:26:00.796547 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:00.798842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:00.798949 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:26:01.089641 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:26:01.091249 (Thread-1): 12:26:01 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:26:01.091470 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:01.091647 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:01.091736 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:01.352636 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 12:26:01.353722 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:01.353825 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:26:01.463887 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:26:01.465280 (Thread-1): 12:26:01 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_orders]
2021-05-03 12:26:01.470928 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:01.471041 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:26:01.694235 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:26:01.694430 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:01.694515 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:03.974211 (Thread-1): SQL status: SUCCESS 1 in 2.28 seconds
2021-05-03 12:26:03.979548 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:03.979666 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:26:04.334830 (Thread-1): SQL status: SUCCESS 12 in 0.36 seconds
2021-05-03 12:26:04.339209 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:04.339334 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:26:04.457360 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:26:04.459697 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:04.459804 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:26:05.262212 (Thread-1): SQL status: SUCCESS 0 in 0.80 seconds
2021-05-03 12:26:05.263490 (Thread-1): 12:26:05 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:26:05.263696 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:05.263869 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:05.263963 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:05.449409 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:26:05.450526 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:05.450632 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:26:05.976431 (Thread-1): SQL status: SUCCESS 1 in 0.53 seconds
2021-05-03 12:26:05.978227 (Thread-1): 12:26:05 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_orders]
2021-05-03 12:26:05.983486 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:05.983597 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:26:06.395483 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-05-03 12:26:06.395680 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:06.395768 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:08.180405 (Thread-1): SQL status: SUCCESS 1 in 1.78 seconds
2021-05-03 12:26:08.184369 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:08.184483 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:26:08.327643 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:08.331914 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:08.332029 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:26:08.468378 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:08.564307 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:08.564480 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:26:08.930316 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-05-03 12:26:08.931672 (Thread-1): 12:26:08 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:26:08.931886 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:08.932066 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:08.932161 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:09.150423 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:26:09.151553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:09.151664 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:26:09.312499 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:26:09.313883 (Thread-1): 12:26:09 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_orders]
2021-05-03 12:26:09.319266 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:09.319375 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:26:09.470378 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:26:09.470569 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:09.470656 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:10.387182 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-05-03 12:26:10.391298 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:10.391412 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:26:10.580924 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 12:26:10.585238 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:10.585348 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:26:10.702394 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:26:10.704656 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:10.704763 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:26:11.023282 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:26:11.024888 (Thread-1): 12:26:11 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:26:11.025098 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:11.025274 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:11.025368 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:11.279862 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:26:11.280952 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:11.281055 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:26:11.414256 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:26:11.415620 (Thread-1): 12:26:11 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_orders]
2021-05-03 12:26:11.422960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:11.423070 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:26:11.603738 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:26:11.603924 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:11.604011 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:12.875359 (Thread-1): SQL status: SUCCESS 1 in 1.27 seconds
2021-05-03 12:26:12.879301 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:12.879421 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:26:13.022039 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:13.026685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:13.026804 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:26:13.213301 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 12:26:13.215670 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:13.215802 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:26:13.439238 (Thread-1): SQL status: SUCCESS 0 in 0.22 seconds
2021-05-03 12:26:13.440567 (Thread-1): 12:26:13 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:26:13.440781 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:13.440963 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:13.441057 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:13.669347 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:26:13.670486 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:13.670592 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:26:13.790077 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:13.791458 (Thread-1): 12:26:13 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_orders]
2021-05-03 12:26:13.796761 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:13.796875 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:26:14.270380 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-05-03 12:26:14.270572 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:14.270660 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:15.242357 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 12:26:15.246475 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:15.246596 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:26:15.405384 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:26:15.409720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:15.409834 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:26:15.540284 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:15.542593 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:15.542701 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:26:15.822020 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:26:15.823666 (Thread-1): 12:26:15 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:26:15.823883 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:15.824064 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:15.824156 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:16.006097 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:26:16.007174 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:16.007277 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:26:16.126159 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:16.127534 (Thread-1): 12:26:16 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_orders]
2021-05-03 12:26:16.133181 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:16.133294 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:26:16.282638 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:26:16.282831 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:16.282916 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:17.142372 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:26:17.146247 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:17.146362 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:26:17.724883 (Thread-1): SQL status: SUCCESS 12 in 0.58 seconds
2021-05-03 12:26:17.730982 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:17.731094 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:26:17.871563 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:17.873824 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:17.873931 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:26:18.132340 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:26:18.133605 (Thread-1): 12:26:18 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:26:18.133813 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:18.134012 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:26:18.134103 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:26:18.330598 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:26:18.335557 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_orders"
2021-05-03 12:26:18.339376 (Thread-1): finished collecting timing info
2021-05-03 12:26:18.339656 (Thread-1): On model.Dbt_demo.sat_orders: Close
2021-05-03 12:26:18.538147 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bc89040>]}
2021-05-03 12:26:18.539578 (Thread-1): 12:26:18 | 14 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_orders [INSERT 0 in 76.00s]
2021-05-03 12:26:18.539747 (Thread-1): Finished running node model.Dbt_demo.sat_orders
2021-05-03 12:26:18.539920 (Thread-1): Began running node model.Dbt_demo.hub_products
2021-05-03 12:26:18.541028 (Thread-1): 12:26:18 | 15 of 23 START incremental model SS_RAW_VLT.hub_products............. [RUN]
2021-05-03 12:26:18.541597 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:18.541746 (Thread-1): Compiling model.Dbt_demo.hub_products
2021-05-03 12:26:18.554892 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_products"
2021-05-03 12:26:18.555242 (Thread-1): finished collecting timing info
2021-05-03 12:26:18.562918 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:18.563051 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_PK, PRODUCTID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_PK, a.PRODUCTID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products AS d
    ON a.PRODUCT_PK = d.PRODUCT_PK
    WHERE d.PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:26:18.563162 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:26:20.767840 (Thread-1): SQL status: SUCCESS 1 in 2.20 seconds
2021-05-03 12:26:20.771327 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:20.771439 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
2021-05-03 12:26:20.913675 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-05-03 12:26:20.917622 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:20.917733 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-05-03 12:26:21.038112 (Thread-1): SQL status: SUCCESS 4 in 0.12 seconds
2021-05-03 12:26:21.042195 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:21.042307 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-05-03 12:26:21.179471 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-05-03 12:26:21.181124 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_products"
2021-05-03 12:26:21.181890 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:21.182025 (Thread-1): On model.Dbt_demo.hub_products: BEGIN
2021-05-03 12:26:21.348193 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:26:21.348379 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:21.348466 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products ("PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
        );
2021-05-03 12:26:21.648357 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:26:21.649541 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-05-03 12:26:21.649717 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:26:21.649807 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-05-03 12:26:21.834085 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:26:21.840154 (Thread-1): finished collecting timing info
2021-05-03 12:26:21.840419 (Thread-1): On model.Dbt_demo.hub_products: Close
2021-05-03 12:26:22.047148 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bb6dfd0>]}
2021-05-03 12:26:22.048610 (Thread-1): 12:26:22 | 15 of 23 OK created incremental model SS_RAW_VLT.hub_products........ [SUCCESS 0 in 3.51s]
2021-05-03 12:26:22.048793 (Thread-1): Finished running node model.Dbt_demo.hub_products
2021-05-03 12:26:22.048968 (Thread-1): Began running node model.Dbt_demo.link_prod_supp
2021-05-03 12:26:22.050245 (Thread-1): 12:26:22 | 16 of 23 START incremental model SS_RAW_VLT.link_prod_supp........... [RUN]
2021-05-03 12:26:22.050567 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:22.050695 (Thread-1): Compiling model.Dbt_demo.link_prod_supp
2021-05-03 12:26:22.063883 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_prod_supp"
2021-05-03 12:26:22.064207 (Thread-1): finished collecting timing info
2021-05-03 12:26:22.071816 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:22.071939 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_SUPPLIER_PK, PRODUCT_PK, SUPPLIER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_SUPPLIER_PK, a.PRODUCT_PK, a.SUPPLIER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp AS d
    ON a.PRODUCT_SUPPLIER_PK = d.PRODUCT_SUPPLIER_PK
    WHERE d.PRODUCT_SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:26:22.072045 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:26:23.803197 (Thread-1): SQL status: SUCCESS 1 in 1.73 seconds
2021-05-03 12:26:23.806885 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:23.807009 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
2021-05-03 12:26:23.967911 (Thread-1): SQL status: SUCCESS 5 in 0.16 seconds
2021-05-03 12:26:23.971919 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:23.972032 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-05-03 12:26:24.117732 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-05-03 12:26:24.121892 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:24.122023 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-05-03 12:26:24.267408 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-05-03 12:26:24.269148 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_prod_supp"
2021-05-03 12:26:24.269944 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:24.270080 (Thread-1): On model.Dbt_demo.link_prod_supp: BEGIN
2021-05-03 12:26:24.411877 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:26:24.412073 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:24.412157 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp ("PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
        );
2021-05-03 12:26:24.762620 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:26:24.763779 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-05-03 12:26:24.763957 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:26:24.764047 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-05-03 12:26:24.946252 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:26:24.950676 (Thread-1): finished collecting timing info
2021-05-03 12:26:24.950951 (Thread-1): On model.Dbt_demo.link_prod_supp: Close
2021-05-03 12:26:25.277293 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bea28e0>]}
2021-05-03 12:26:25.278734 (Thread-1): 12:26:25 | 16 of 23 OK created incremental model SS_RAW_VLT.link_prod_supp...... [SUCCESS 0 in 3.23s]
2021-05-03 12:26:25.278905 (Thread-1): Finished running node model.Dbt_demo.link_prod_supp
2021-05-03 12:26:25.279074 (Thread-1): Began running node model.Dbt_demo.sat_products
2021-05-03 12:26:25.280311 (Thread-1): 12:26:25 | 17 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_products.. [RUN]
2021-05-03 12:26:25.280617 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:25.280739 (Thread-1): Compiling model.Dbt_demo.sat_products
2021-05-03 12:26:25.303671 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_products"
2021-05-03 12:26:25.303993 (Thread-1): finished collecting timing info
2021-05-03 12:26:25.311254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:25.311371 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:26:25.311472 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:26:26.301809 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-05-03 12:26:26.305148 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:26.305260 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:26:26.076000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:26:26.076000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_products
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:26:26.606103 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:26:26.610045 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:26.610172 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:26.779011 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:26:26.781492 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:26.781605 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:26.942144 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:26:26.943530 (Thread-1): 12:26:26 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_products]
2021-05-03 12:26:26.948981 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:26.949092 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:27.090793 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:26:27.090978 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:27.091066 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:28.758563 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2021-05-03 12:26:28.762519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:28.762640 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:28.962611 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:26:28.968345 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:28.968473 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:29.108802 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:29.111191 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:29.111311 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:29.470049 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:26:29.471311 (Thread-1): 12:26:29 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:29.471515 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:29.471687 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:29.471776 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:29.671685 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:26:29.672786 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:29.672891 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:29.788393 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:29.790217 (Thread-1): 12:26:29 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_products]
2021-05-03 12:26:29.795609 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:29.795719 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:29.939938 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:26:29.940126 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:29.940213 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:31.090787 (Thread-1): SQL status: SUCCESS 1 in 1.15 seconds
2021-05-03 12:26:31.094729 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:31.094845 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:31.233930 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:31.238501 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:31.238615 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:31.369331 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:31.371647 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:31.371756 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:31.725841 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:26:31.727495 (Thread-1): 12:26:31 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:31.727702 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:31.727874 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:31.727961 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:31.979289 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:26:31.980387 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:31.980493 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:32.104472 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:32.105850 (Thread-1): 12:26:32 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_products]
2021-05-03 12:26:32.111225 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:32.111341 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:32.288632 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:26:32.288819 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:32.288906 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:33.159137 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 12:26:33.162940 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:33.163060 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:33.323638 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:26:33.327990 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:33.328101 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:33.444474 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:26:33.446777 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:33.446890 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:33.752213 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:26:33.753495 (Thread-1): 12:26:33 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:33.753695 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:33.753867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:33.753955 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:33.946185 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:26:33.947272 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:33.947377 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:34.066330 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:34.068111 (Thread-1): 12:26:34 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_products]
2021-05-03 12:26:34.073468 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:34.073585 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:34.224370 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:26:34.224553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:34.224639 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:35.131191 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:26:35.136601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:35.136715 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:35.294344 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:26:35.298772 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:35.298883 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:35.431183 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:35.433479 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:35.433586 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:35.714638 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:26:35.716257 (Thread-1): 12:26:35 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:35.716461 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:35.716633 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:35.716721 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:35.904749 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:26:35.905843 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:35.905948 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:36.026724 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:36.028116 (Thread-1): 12:26:36 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_products]
2021-05-03 12:26:36.033855 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:36.033984 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:36.184929 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:26:36.185120 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:36.185207 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:37.061907 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 12:26:37.065800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:37.065934 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:37.214840 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:26:37.219228 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:37.219345 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:37.351998 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:37.354325 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:37.354433 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:37.663334 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:26:37.664601 (Thread-1): 12:26:37 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:37.664802 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:37.664985 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:37.665074 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:37.862016 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:26:37.863122 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:37.863228 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:37.985313 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:37.987124 (Thread-1): 12:26:37 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_products]
2021-05-03 12:26:37.992476 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:37.992591 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:38.144763 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:26:38.144958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:38.145045 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:39.310579 (Thread-1): SQL status: SUCCESS 1 in 1.17 seconds
2021-05-03 12:26:39.314503 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:39.314616 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:39.460436 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:26:39.464868 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:39.464980 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:39.602217 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:39.604508 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:39.604615 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:39.850505 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:26:39.853996 (Thread-1): 12:26:39 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:39.854210 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:39.854388 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:39.854485 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:40.060285 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:26:40.061375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:40.061481 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:40.184858 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:40.186275 (Thread-1): 12:26:40 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_products]
2021-05-03 12:26:40.191994 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:40.192105 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:40.350231 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:26:40.350422 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:40.350510 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:41.688610 (Thread-1): SQL status: SUCCESS 1 in 1.34 seconds
2021-05-03 12:26:41.692466 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:41.692582 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:41.908002 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:26:41.912458 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:41.912571 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:42.053255 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:42.055581 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:42.055690 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:42.370130 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:26:42.371394 (Thread-1): 12:26:42 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:42.371597 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:42.371771 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:42.371859 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:42.704327 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-05-03 12:26:42.705423 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:42.705528 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:42.827813 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:42.829644 (Thread-1): 12:26:42 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_products]
2021-05-03 12:26:42.835073 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:42.835190 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:42.978860 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:26:42.979054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:42.979141 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:44.006196 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-05-03 12:26:44.010161 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:44.010280 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:44.232196 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:26:44.236639 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:44.236750 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:44.367498 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:44.369768 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:44.369878 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:44.761764 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-05-03 12:26:44.763401 (Thread-1): 12:26:44 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:44.763606 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:44.763782 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:44.763873 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:44.953189 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:26:44.954322 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:44.954430 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:45.079925 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:26:45.081324 (Thread-1): 12:26:45 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_products]
2021-05-03 12:26:45.086753 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:45.086864 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:45.235525 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:26:45.235708 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:45.235792 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:46.126990 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 12:26:46.130796 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:46.130908 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:46.276015 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:46.377351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:46.377513 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:46.549583 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:26:46.551899 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:46.552006 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:46.876370 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:26:46.877990 (Thread-1): 12:26:46 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:46.878194 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:46.878367 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:46.878455 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:47.090093 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:26:47.091186 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:47.091289 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:47.222876 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:26:47.224274 (Thread-1): 12:26:47 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_products]
2021-05-03 12:26:47.230030 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:47.230139 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:47.373380 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:26:47.373563 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:47.373656 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:49.285285 (Thread-1): SQL status: SUCCESS 1 in 1.91 seconds
2021-05-03 12:26:49.289147 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:49.289273 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:49.430231 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:49.434680 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:49.434793 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:49.565704 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:49.568036 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:49.568144 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:49.832946 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:26:49.834242 (Thread-1): 12:26:49 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:49.834449 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:49.834623 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:49.834711 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:50.018862 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:26:50.019972 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:50.020078 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:50.146780 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:26:50.148554 (Thread-1): 12:26:50 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_products]
2021-05-03 12:26:50.153942 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:50.154070 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:50.309607 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:26:50.309797 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:50.309885 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:51.229995 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-05-03 12:26:51.233920 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:51.234058 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:51.405525 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:26:51.409937 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:51.410074 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:51.548023 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:26:51.550326 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:51.550434 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:51.816720 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:26:51.818305 (Thread-1): 12:26:51 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:51.818503 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:51.818673 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:51.818759 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:52.005175 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:26:52.006274 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:52.006380 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:52.128430 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:52.129814 (Thread-1): 12:26:52 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_products]
2021-05-03 12:26:52.135545 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:52.135655 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:52.278541 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:26:52.278721 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:52.278807 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:53.231058 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-05-03 12:26:53.236454 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:53.236569 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:53.405802 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:26:53.410215 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:53.410328 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:53.556646 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:26:53.558982 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:53.559092 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:53.837166 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:26:53.838467 (Thread-1): 12:26:53 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:53.838680 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:53.838853 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:53.838941 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:54.050012 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:26:54.051126 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:54.051233 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:54.172446 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:26:54.174274 (Thread-1): 12:26:54 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_products]
2021-05-03 12:26:54.179646 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:54.179758 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:54.340303 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:26:54.340497 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:54.340584 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:55.651478 (Thread-1): SQL status: SUCCESS 1 in 1.31 seconds
2021-05-03 12:26:55.655668 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:55.655800 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:55.811909 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:26:55.816434 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:55.816548 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:55.944702 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:55.946975 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:55.947083 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:56.311294 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:26:56.312977 (Thread-1): 12:26:56 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:56.313191 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:56.313372 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:56.313466 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:56.541709 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:26:56.542868 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:56.542980 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:56.673128 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:26:56.674644 (Thread-1): 12:26:56 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_products]
2021-05-03 12:26:56.680347 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:56.680465 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:56.816841 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:26:56.817043 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:56.817135 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:57.930317 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-05-03 12:26:57.934169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:57.934281 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:26:58.098653 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:26:58.103041 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:58.103155 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:26:58.232533 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:26:58.234826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:58.234933 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:26:58.514939 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:26:58.516226 (Thread-1): 12:26:58 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:26:58.516424 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:58.516598 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:58.516687 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:26:58.713567 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:26:58.714696 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:58.714807 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:26:58.846886 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:26:58.850457 (Thread-1): 12:26:58 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_products]
2021-05-03 12:26:58.855793 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:58.855903 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:26:59.035521 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:26:59.035710 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:59.035804 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:26:59.896762 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:26:59.900693 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:26:59.900807 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:00.061854 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:27:00.066332 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:00.066445 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:00.203417 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:00.205698 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:00.205806 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:00.458625 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:27:00.460223 (Thread-1): 12:27:00 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:00.460428 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:00.460600 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:00.460688 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:00.688306 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:27:00.689401 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:00.689504 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:00.809952 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:00.811368 (Thread-1): 12:27:00 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_products]
2021-05-03 12:27:00.816775 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:00.816892 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:00.991488 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:27:00.991683 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:00.991770 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:01.912666 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-05-03 12:27:01.916609 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:01.916726 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:02.057980 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:02.062407 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:02.062521 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:02.198965 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:02.201264 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:02.201371 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:02.527062 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:27:02.528347 (Thread-1): 12:27:02 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:02.528548 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:02.528722 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:02.528811 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:02.724158 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:02.725256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:02.725361 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:02.844088 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:02.845503 (Thread-1): 12:27:02 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_products]
2021-05-03 12:27:02.851271 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:02.851382 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:03.005212 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:27:03.005410 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:03.005498 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:03.911009 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:27:03.914934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:03.915056 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:04.084819 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:27:04.090934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:04.091051 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:04.216657 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:04.218989 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:04.219099 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:04.653556 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-05-03 12:27:04.654844 (Thread-1): 12:27:04 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:04.655046 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:04.655218 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:04.655311 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:04.891913 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:27:04.893397 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:04.893505 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:05.031694 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:05.033085 (Thread-1): 12:27:05 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_products]
2021-05-03 12:27:05.038531 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:05.038643 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:05.187594 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:27:05.187780 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:05.187866 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:06.257025 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-05-03 12:27:06.261171 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:06.261284 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:06.407183 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:06.411572 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:06.411683 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:06.662937 (Thread-1): SQL status: SUCCESS 12 in 0.25 seconds
2021-05-03 12:27:06.665247 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:06.665354 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:06.910565 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:27:06.911821 (Thread-1): 12:27:06 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:06.912021 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:06.912194 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:06.912282 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:07.111591 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:07.113178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:07.113283 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:07.282615 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:27:07.284014 (Thread-1): 12:27:07 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_products]
2021-05-03 12:27:07.289393 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:07.289504 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:07.457450 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:27:07.457638 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:07.457724 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:09.043443 (Thread-1): SQL status: SUCCESS 1 in 1.59 seconds
2021-05-03 12:27:09.047802 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:09.047930 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:09.188275 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:09.192682 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:09.192797 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:09.406350 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-05-03 12:27:09.408619 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:09.408725 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:09.914092 (Thread-1): SQL status: SUCCESS 0 in 0.51 seconds
2021-05-03 12:27:09.915358 (Thread-1): 12:27:09 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:09.915564 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:09.915738 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:09.915826 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:10.307248 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-05-03 12:27:10.308347 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:10.308465 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:10.454097 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:27:10.455508 (Thread-1): 12:27:10 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_products]
2021-05-03 12:27:10.461261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:10.461372 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:10.603492 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:10.603687 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:10.603774 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:11.747764 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-05-03 12:27:11.751671 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:11.751787 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:11.908241 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:27:11.914276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:11.914390 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:12.169816 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-05-03 12:27:12.172125 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:12.172252 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:12.589824 (Thread-1): SQL status: SUCCESS 0 in 0.42 seconds
2021-05-03 12:27:12.591129 (Thread-1): 12:27:12 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:12.591333 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:12.591509 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:12.591598 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:12.867783 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 12:27:12.869229 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:12.869340 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:13.010247 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:13.011669 (Thread-1): 12:27:13 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_products]
2021-05-03 12:27:13.017140 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:13.017251 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:13.268803 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:27:13.268988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:13.269075 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:14.289518 (Thread-1): SQL status: SUCCESS 1 in 1.02 seconds
2021-05-03 12:27:14.293716 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:14.293830 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:14.459839 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:27:14.464229 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:14.464341 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:14.585294 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:27:14.587600 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:14.587707 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:14.916097 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:27:14.917371 (Thread-1): 12:27:14 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:14.917574 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:14.917749 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:14.917838 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:15.110831 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:27:15.111927 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:15.112033 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:15.231287 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:15.232673 (Thread-1): 12:27:15 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_products]
2021-05-03 12:27:15.238451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:15.238562 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:15.405852 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:27:15.406071 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:15.406160 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:16.379400 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 12:27:16.383342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:16.383456 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:16.533780 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:16.538325 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:16.538437 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:16.679645 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:16.681949 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:16.682086 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:16.960327 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:27:16.961662 (Thread-1): 12:27:16 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:16.961863 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:16.962054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:16.962145 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:17.177383 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:27:17.178853 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:17.178960 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:17.301638 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:17.303077 (Thread-1): 12:27:17 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_products]
2021-05-03 12:27:17.308482 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:17.308593 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:17.449103 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:17.449298 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:17.449389 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:18.369281 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-05-03 12:27:18.374873 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:18.374991 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:18.539054 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:27:18.543445 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:18.543566 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:18.670789 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:18.673354 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:18.673474 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:18.972393 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:27:18.973683 (Thread-1): 12:27:18 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:18.973886 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:18.974086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:18.974176 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:19.175718 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:19.176826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:19.176936 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:19.299650 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:19.301044 (Thread-1): 12:27:19 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_products]
2021-05-03 12:27:19.306840 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:19.306951 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:19.450353 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:19.450539 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:19.450627 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:20.701485 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 12:27:20.705507 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:20.705622 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:20.868940 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:27:20.873463 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:20.873575 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:21.002365 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:21.004664 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:21.004771 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:21.266028 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:27:21.267312 (Thread-1): 12:27:21 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:21.267514 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:21.267690 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:21.267777 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:21.499408 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:27:21.500860 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:21.500965 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:21.623745 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:21.625138 (Thread-1): 12:27:21 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_products]
2021-05-03 12:27:21.630577 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:21.630687 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:21.786223 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:27:21.786412 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:21.786499 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:22.588959 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-05-03 12:27:22.593243 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:22.593359 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:22.757407 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:27:22.761865 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:22.762001 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:22.887804 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:22.890127 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:22.890241 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:23.230152 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 12:27:23.231410 (Thread-1): 12:27:23 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:23.231622 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:23.231799 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:23.231892 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:23.415925 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:27:23.416997 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:23.417106 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:23.545451 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:27:23.546868 (Thread-1): 12:27:23 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_products]
2021-05-03 12:27:23.552528 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:23.552637 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:23.695770 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:23.695961 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:23.696046 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:24.570543 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 12:27:24.574428 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:24.574540 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:24.746200 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:27:24.750708 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:24.750831 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:24.891069 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:24.893344 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:24.893451 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:25.249600 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:27:25.250901 (Thread-1): 12:27:25 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:25.251101 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:25.251273 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:25.251368 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:25.454011 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:25.455489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:25.455596 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:25.578785 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:25.580187 (Thread-1): 12:27:25 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_products]
2021-05-03 12:27:25.585585 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:25.585696 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:25.729553 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:25.729745 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:25.729843 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:26.849799 (Thread-1): SQL status: SUCCESS 1 in 1.12 seconds
2021-05-03 12:27:26.854007 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:26.854120 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:27.008427 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:27.012825 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:27.012939 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:27.179889 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:27:27.271345 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:27.271517 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:27.607444 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 12:27:27.608732 (Thread-1): 12:27:27 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:27.608933 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:27.609106 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:27.609194 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:27.817320 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:27:27.818452 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:27.818565 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:27.995182 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:27:27.997006 (Thread-1): 12:27:27 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_products]
2021-05-03 12:27:28.002446 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:28.002557 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:28.176267 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:27:28.176465 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:28.176553 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:29.204516 (Thread-1): SQL status: SUCCESS 1 in 1.03 seconds
2021-05-03 12:27:29.208478 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:29.208593 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:29.355642 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:29.361401 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:29.361512 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:29.482747 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:27:29.485024 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:29.485131 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:29.727847 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:27:29.729434 (Thread-1): 12:27:29 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:29.729636 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:29.729808 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:29.729896 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:29.941329 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:27:29.942445 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:29.942550 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:30.064170 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:30.065576 (Thread-1): 12:27:30 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_products]
2021-05-03 12:27:30.070989 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:30.071100 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:30.238879 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:27:30.239073 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:30.239160 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:31.108954 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 12:27:31.112874 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:31.112999 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:31.263301 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:31.267720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:31.267832 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:31.412992 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:31.415335 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:31.415442 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:31.703489 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:27:31.704780 (Thread-1): 12:27:31 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:31.704982 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:31.705153 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:31.705242 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:31.906357 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:31.907449 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:31.907552 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:32.036124 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:27:32.037527 (Thread-1): 12:27:32 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_products]
2021-05-03 12:27:32.043332 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:32.043448 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:32.207959 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:27:32.208145 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:32.208231 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:33.432388 (Thread-1): SQL status: SUCCESS 1 in 1.22 seconds
2021-05-03 12:27:33.436320 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:33.436433 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:33.581353 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:33.586008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:33.586131 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:33.720820 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:33.723146 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:33.723255 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:33.993910 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:27:33.995236 (Thread-1): 12:27:33 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:33.995436 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:33.995617 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:33.995705 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:34.183800 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:27:34.185238 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:34.185345 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:27:34.303138 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:34.304543 (Thread-1): 12:27:34 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_products]
2021-05-03 12:27:34.309898 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:34.310040 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:27:34.456646 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:27:34.456835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:34.456922 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:35.351917 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 12:27:35.357602 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:35.357715 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:27:35.512759 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:35.517180 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:35.517305 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:27:35.648493 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:35.650999 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:35.651112 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:27:35.970770 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:27:35.972051 (Thread-1): 12:27:35 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:27:35.972258 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:35.972436 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:27:35.972526 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:27:36.195170 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:27:36.195605 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_products"
2021-05-03 12:27:36.198709 (Thread-1): finished collecting timing info
2021-05-03 12:27:36.198985 (Thread-1): On model.Dbt_demo.sat_products: Close
2021-05-03 12:27:36.420633 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bf11ee0>]}
2021-05-03 12:27:36.422114 (Thread-1): 12:27:36 | 17 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_products [INSERT 0 in 71.14s]
2021-05-03 12:27:36.422284 (Thread-1): Finished running node model.Dbt_demo.sat_products
2021-05-03 12:27:36.422455 (Thread-1): Began running node model.Dbt_demo.hub_customers
2021-05-03 12:27:36.423612 (Thread-1): 12:27:36 | 18 of 23 START incremental model SS_RAW_VLT.hub_customers............ [RUN]
2021-05-03 12:27:36.424096 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:36.424233 (Thread-1): Compiling model.Dbt_demo.hub_customers
2021-05-03 12:27:36.437084 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_customers"
2021-05-03 12:27:36.437416 (Thread-1): finished collecting timing info
2021-05-03 12:27:36.445045 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:36.445164 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT CUSTOMER_PK, CUSTOMERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:27:36.445273 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:27:38.664904 (Thread-1): SQL status: SUCCESS 1 in 2.22 seconds
2021-05-03 12:27:38.668418 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:38.668531 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
2021-05-03 12:27:38.808177 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-05-03 12:27:38.812089 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:38.812201 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-05-03 12:27:38.979193 (Thread-1): SQL status: SUCCESS 4 in 0.17 seconds
2021-05-03 12:27:38.984850 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:38.984963 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-05-03 12:27:39.133140 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-05-03 12:27:39.134856 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_customers"
2021-05-03 12:27:39.135637 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:39.135739 (Thread-1): On model.Dbt_demo.hub_customers: BEGIN
2021-05-03 12:27:39.348807 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:27:39.349011 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:39.349106 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers ("CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
        );
2021-05-03 12:27:39.628252 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:27:39.629458 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-05-03 12:27:39.629642 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:27:39.629738 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-05-03 12:27:39.832056 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:39.836720 (Thread-1): finished collecting timing info
2021-05-03 12:27:39.837008 (Thread-1): On model.Dbt_demo.hub_customers: Close
2021-05-03 12:27:40.059550 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bc2b3a0>]}
2021-05-03 12:27:40.061059 (Thread-1): 12:27:40 | 18 of 23 OK created incremental model SS_RAW_VLT.hub_customers....... [SUCCESS 0 in 3.64s]
2021-05-03 12:27:40.061240 (Thread-1): Finished running node model.Dbt_demo.hub_customers
2021-05-03 12:27:40.061422 (Thread-1): Began running node model.Dbt_demo.sat_customers
2021-05-03 12:27:40.062730 (Thread-1): 12:27:40 | 19 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_customers. [RUN]
2021-05-03 12:27:40.063058 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:40.063195 (Thread-1): Compiling model.Dbt_demo.sat_customers
2021-05-03 12:27:40.085976 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_customers"
2021-05-03 12:27:40.086370 (Thread-1): finished collecting timing info
2021-05-03 12:27:40.094161 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:40.094288 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:27:40.094398 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:27:41.366550 (Thread-1): SQL status: SUCCESS 1 in 1.27 seconds
2021-05-03 12:27:41.369956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:41.370090 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:27:41.073000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:27:41.073000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_customers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:27:41.856570 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-05-03 12:27:41.860471 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:41.860591 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:42.027262 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:27:42.029731 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:42.029842 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:42.181758 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:27:42.183237 (Thread-1): 12:27:42 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:42.188738 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:42.188854 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:42.387903 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:42.388102 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:42.388196 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:43.471543 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-05-03 12:27:43.475407 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:43.475520 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:27:43.636583 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:27:43.640910 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:43.641024 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:43.857434 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:27:43.859731 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:43.859838 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:27:44.174414 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:27:44.175678 (Thread-1): 12:27:44 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:27:44.175880 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:44.176053 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:44.176142 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:44.370678 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:27:44.371781 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:44.371888 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:44.505640 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:27:44.507090 (Thread-1): 12:27:44 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:44.512843 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:44.512965 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:44.767998 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:27:44.768196 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:44.768287 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:45.813918 (Thread-1): SQL status: SUCCESS 1 in 1.05 seconds
2021-05-03 12:27:45.817893 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:45.818026 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:27:45.967815 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:45.972294 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:45.972416 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:46.118903 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:46.121189 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:46.121297 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:27:46.394863 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:27:46.396158 (Thread-1): 12:27:46 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:27:46.396360 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:46.396532 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:46.396619 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:46.695747 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:27:46.697172 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:46.697279 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:46.821322 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:46.822743 (Thread-1): 12:27:46 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:46.828001 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:46.828117 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:46.980492 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:27:46.980686 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:46.980777 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:48.616390 (Thread-1): SQL status: SUCCESS 1 in 1.64 seconds
2021-05-03 12:27:48.620504 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:48.620615 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:27:48.780940 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:27:48.786715 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:48.786825 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:48.938954 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:27:48.941206 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:48.941312 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:27:49.217645 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:27:49.218936 (Thread-1): 12:27:49 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:27:49.219135 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:49.219306 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:49.219398 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:49.463574 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:27:49.464678 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:49.464783 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:49.592503 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:27:49.593907 (Thread-1): 12:27:49 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:49.599513 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:49.599622 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:49.917453 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:27:49.917640 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:49.917726 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:51.806961 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2021-05-03 12:27:51.810844 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:51.810956 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:27:51.979364 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:27:51.983848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:51.983958 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:52.122383 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:52.124657 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:52.124763 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:27:52.388112 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:27:52.389365 (Thread-1): 12:27:52 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:27:52.389565 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:52.389737 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:52.389825 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:52.652310 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 12:27:52.653732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:52.653836 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:52.782903 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:27:52.784277 (Thread-1): 12:27:52 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:52.789556 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:52.789671 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:52.941680 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:27:52.941878 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:52.941989 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:54.056753 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-05-03 12:27:54.061057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:54.061177 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:27:54.247191 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 12:27:54.251685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:54.251820 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:54.396192 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:27:54.398505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:54.398612 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:27:54.735475 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 12:27:54.736767 (Thread-1): 12:27:54 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:27:54.736970 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:54.737144 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:54.737231 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:54.938942 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:54.940021 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:54.940127 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:55.063352 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:27:55.064750 (Thread-1): 12:27:55 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:55.070348 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:55.070459 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:55.247894 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:27:55.248080 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:55.248170 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:56.497108 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 12:27:56.502327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:56.502444 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:27:56.705443 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:27:56.774386 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:56.774564 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:56.904847 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:56.907304 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:56.907414 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:27:57.257515 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:27:57.258800 (Thread-1): 12:27:57 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:27:57.259000 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:57.259174 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:57.259261 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:57.455441 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:27:57.456530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:57.456635 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:57.588227 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:27:57.589545 (Thread-1): 12:27:57 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:57.594771 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:57.594883 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:57.758468 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:27:57.758656 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:57.758744 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:27:58.821056 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-05-03 12:27:58.824891 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:58.825002 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:27:58.992976 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:27:58.997421 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:58.997532 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:27:59.129816 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:27:59.132116 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:59.132222 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:27:59.415139 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:27:59.416411 (Thread-1): 12:27:59 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:27:59.416615 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:59.416790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:59.416877 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:27:59.629284 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:27:59.630708 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:59.630814 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:27:59.766694 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:27:59.768088 (Thread-1): 12:27:59 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_customers]
2021-05-03 12:27:59.773396 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:59.773508 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:27:59.933163 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:27:59.933352 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:27:59.933439 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:00.785187 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:28:00.789025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:00.789137 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:00.945748 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:00.951231 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:00.951341 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:01.099139 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:01.101409 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:01.101520 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:01.383247 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:28:01.384523 (Thread-1): 12:28:01 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:01.384724 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:01.384886 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:01.384984 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:01.744255 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-05-03 12:28:01.745717 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:01.745822 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:01.896862 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:01.898297 (Thread-1): 12:28:01 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:01.903555 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:01.903671 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:02.052595 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:02.052787 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:02.052883 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:02.992621 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-05-03 12:28:02.996455 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:02.996565 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:03.163278 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:28:03.260728 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:03.260899 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:03.392357 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:03.394852 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:03.394959 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:03.673264 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:28:03.674568 (Thread-1): 12:28:03 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:03.674771 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:03.674944 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:03.675031 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:03.888086 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:28:03.889183 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:03.889288 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:04.012603 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:28:04.014409 (Thread-1): 12:28:04 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:04.019628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:04.019739 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:04.572912 (Thread-1): SQL status: SUCCESS 1 in 0.55 seconds
2021-05-03 12:28:04.573106 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:04.573192 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:05.429120 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:28:05.433136 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:05.433246 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:05.604071 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:28:05.608467 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:05.608582 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:05.740490 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:05.742977 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:05.743086 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:06.006728 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:28:06.007992 (Thread-1): 12:28:06 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:06.008201 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:06.008373 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:06.008461 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:06.250524 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:28:06.251614 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:06.251719 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:06.380751 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:28:06.382562 (Thread-1): 12:28:06 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:06.388075 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:06.388192 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:06.594873 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:28:06.595067 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:06.595155 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:07.726866 (Thread-1): SQL status: SUCCESS 1 in 1.13 seconds
2021-05-03 12:28:07.732195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:07.732315 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:07.891757 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:07.896101 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:07.896211 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:08.032895 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:28:08.035182 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:08.035288 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:08.317578 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:28:08.318892 (Thread-1): 12:28:08 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:08.319094 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:08.319266 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:08.319355 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:08.505239 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:08.506360 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:08.506467 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:08.628233 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:28:08.630059 (Thread-1): 12:28:08 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:08.635286 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:08.635396 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:08.795061 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:08.795249 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:08.795344 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:09.674662 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 12:28:09.678685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:09.678801 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:09.836282 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:09.840617 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:09.840730 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:10.013142 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:28:10.015630 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:10.015737 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:10.350451 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:28:10.351719 (Thread-1): 12:28:10 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:10.351919 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:10.352093 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:10.352181 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:10.566642 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:28:10.567746 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:10.567853 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:10.693628 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:28:10.695442 (Thread-1): 12:28:10 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:10.700658 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:10.700768 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:10.851920 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:10.852111 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:10.852196 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:11.826113 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 12:28:11.830116 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:11.830230 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:11.988561 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:11.994328 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:11.994439 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:12.218537 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:28:12.220842 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:12.220953 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:12.537424 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:28:12.538717 (Thread-1): 12:28:12 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:12.538920 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:12.539091 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:12.539178 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:12.863145 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:28:12.864228 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:12.864332 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:13.060884 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:28:13.062320 (Thread-1): 12:28:13 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:13.067938 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:13.068051 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:13.345322 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 12:28:13.345514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:13.345602 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:14.312471 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 12:28:14.316362 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:14.316475 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:14.513153 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:28:14.517648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:14.517760 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:14.715701 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:28:14.717984 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:14.718096 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:15.160148 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-05-03 12:28:15.161427 (Thread-1): 12:28:15 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:15.161642 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:15.161819 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:15.161906 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:15.388645 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:28:15.389667 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:15.389770 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:15.515473 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:28:15.516860 (Thread-1): 12:28:15 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:15.522169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:15.522302 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:15.682435 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:15.682619 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:15.682711 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:16.783110 (Thread-1): SQL status: SUCCESS 1 in 1.10 seconds
2021-05-03 12:28:16.786934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:16.787048 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:17.041249 (Thread-1): SQL status: SUCCESS 12 in 0.25 seconds
2021-05-03 12:28:17.045625 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:17.045852 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:17.234518 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 12:28:17.236826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:17.236933 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:17.612071 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-05-03 12:28:17.613328 (Thread-1): 12:28:17 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:17.613532 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:17.613704 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:17.613792 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:17.958062 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-05-03 12:28:17.959133 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:17.959238 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:18.086480 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:28:18.087870 (Thread-1): 12:28:18 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:18.093165 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:18.093280 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:18.244955 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:18.245152 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:18.245237 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:19.424807 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-05-03 12:28:19.430302 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:19.430422 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:19.574819 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:28:19.579108 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:19.579218 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:19.852823 (Thread-1): SQL status: SUCCESS 12 in 0.27 seconds
2021-05-03 12:28:19.855136 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:19.855243 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:20.131824 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:28:20.133074 (Thread-1): 12:28:20 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:20.133270 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:20.133449 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:20.133538 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:20.423335 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-05-03 12:28:20.424410 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:20.424515 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:20.608270 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:28:20.609732 (Thread-1): 12:28:20 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:20.615748 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:20.615862 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:20.817645 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:28:20.817834 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:20.817923 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:21.984339 (Thread-1): SQL status: SUCCESS 1 in 1.17 seconds
2021-05-03 12:28:21.988275 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:21.988389 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:22.130381 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:28:22.134969 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:22.135079 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:22.361586 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 12:28:22.363912 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:22.364019 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:22.683438 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:28:22.684714 (Thread-1): 12:28:22 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:22.684925 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:22.685099 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:22.685189 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:22.878639 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:22.880057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:22.880163 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:23.017112 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:28:23.018549 (Thread-1): 12:28:23 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:23.023847 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:23.023963 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:23.215093 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:23.215296 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:23.215386 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:24.945990 (Thread-1): SQL status: SUCCESS 1 in 1.73 seconds
2021-05-03 12:28:24.949766 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:24.949878 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:25.108230 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:25.112577 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:25.112689 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:25.346896 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 12:28:25.349212 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:25.349318 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:25.735562 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-05-03 12:28:25.736893 (Thread-1): 12:28:25 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:25.737106 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:25.737287 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:25.737387 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:25.929578 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:25.930720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:25.930829 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:26.452324 (Thread-1): SQL status: SUCCESS 1 in 0.52 seconds
2021-05-03 12:28:26.454124 (Thread-1): 12:28:26 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:26.459344 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:26.459453 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:26.605995 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:26.606186 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:26.606273 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:27.669153 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-05-03 12:28:27.673118 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:27.673233 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:27.834592 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:27.838876 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:27.838986 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:27.973704 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:27.975960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:27.976068 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:28.362735 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-05-03 12:28:28.364308 (Thread-1): 12:28:28 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:28.364509 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:28.364685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:28.364773 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:28.570241 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:28:28.571334 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:28.571440 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:28.730894 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:28.732270 (Thread-1): 12:28:28 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:28.737890 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:28.738021 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:28.902716 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:28.902900 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:28.902987 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:29.783423 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 12:28:29.787394 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:29.787511 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:29.939293 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:29.943890 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:29.944007 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:30.114251 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:28:30.116537 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:30.116645 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:30.405386 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:28:30.406678 (Thread-1): 12:28:30 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:30.406881 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:30.407054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:30.407141 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:30.596862 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:30.598322 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:30.598428 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:30.720155 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:28:30.721590 (Thread-1): 12:28:30 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:30.726965 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:30.727074 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:30.879353 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:30.879541 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:30.879640 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:31.777609 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:28:31.783258 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:31.783372 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:31.984323 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:28:31.988712 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:31.988830 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:32.143643 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:32.146174 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:32.146288 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:32.444103 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:28:32.445388 (Thread-1): 12:28:32 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:32.445603 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:32.445774 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:32.445864 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:32.662329 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:28:32.663417 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:32.663521 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:32.793761 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:28:32.795187 (Thread-1): 12:28:32 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:32.800817 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:32.800932 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:32.961180 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:32.961370 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:32.961457 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:33.795083 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-05-03 12:28:33.799025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:33.799137 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:33.949262 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:33.953846 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:33.953984 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:34.079835 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:34.082150 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:34.082260 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:34.341938 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:28:34.343620 (Thread-1): 12:28:34 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:34.343828 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:34.344008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:34.344109 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:34.570400 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:28:34.571484 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:34.571588 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:34.710909 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:28:34.712317 (Thread-1): 12:28:34 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:34.717765 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:34.717878 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:34.873866 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:34.874074 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:34.874164 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:35.722904 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:28:35.726768 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:35.726885 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:35.881101 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:35.885590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:35.885703 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:36.054140 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:28:36.056428 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:36.056536 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:36.656517 (Thread-1): SQL status: SUCCESS 0 in 0.60 seconds
2021-05-03 12:28:36.657777 (Thread-1): 12:28:36 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:36.658002 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:36.658175 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:36.658262 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:36.848786 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:36.849870 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:36.849998 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:36.981094 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:28:36.982497 (Thread-1): 12:28:36 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:36.987785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:36.987896 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:37.166949 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:28:37.167141 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:37.167227 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:38.306551 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-05-03 12:28:38.310622 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:38.310734 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:38.457319 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:38.461642 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:38.461754 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:38.642517 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:28:38.644781 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:38.644888 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:38.903508 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:28:38.904772 (Thread-1): 12:28:38 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:38.904975 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:38.905160 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:38.905250 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:39.143251 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:28:39.144398 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:39.144508 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:39.300163 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:39.301576 (Thread-1): 12:28:39 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:39.307261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:39.307374 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:39.455701 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:39.455889 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:39.455976 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:40.314105 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:28:40.318043 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:40.318156 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:40.476276 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:40.480807 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:40.480918 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:40.610434 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:40.612732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:40.612838 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:40.900562 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:28:40.901857 (Thread-1): 12:28:40 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:40.902078 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:40.902253 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:40.902340 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:41.124099 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:28:41.125544 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:41.125650 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:41.267217 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:28:41.268595 (Thread-1): 12:28:41 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:41.273909 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:41.274044 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:41.425356 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:41.425546 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:41.425634 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:42.326329 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:28:42.330106 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:42.330223 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:42.478220 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:42.484111 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:42.484221 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:42.620025 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:28:42.622344 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:42.622454 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:42.877436 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:28:42.878715 (Thread-1): 12:28:42 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:42.878917 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:42.879087 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:42.879174 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:43.103910 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:28:43.104994 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:43.105097 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:43.226304 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:28:43.228089 (Thread-1): 12:28:43 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:43.233303 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:43.233414 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:43.389823 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:28:43.390042 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:43.390134 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:44.353686 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 12:28:44.357675 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:44.357792 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:44.504542 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:44.508859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:44.508971 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:44.652486 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:28:44.755056 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:44.755217 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:45.058143 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:28:45.059411 (Thread-1): 12:28:45 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:45.059614 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:45.059788 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:45.059887 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:45.272217 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:28:45.273755 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:45.273870 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:45.395518 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:28:45.396917 (Thread-1): 12:28:45 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:45.402279 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:45.402389 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:45.542107 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:28:45.542301 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:45.542389 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:46.440646 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:28:46.444867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:46.444984 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:46.597627 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:46.602014 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:46.602125 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:46.743165 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:28:46.745741 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:46.745853 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:47.001109 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:28:47.002417 (Thread-1): 12:28:47 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:47.002625 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:47.002799 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:47.002887 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:47.192708 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:47.193791 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:47.193895 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:47.319078 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:28:47.320839 (Thread-1): 12:28:47 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:47.326130 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:47.326241 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:47.562820 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:28:47.563016 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:47.563103 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:48.414248 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:28:48.419826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:48.419946 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:48.579302 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:28:48.583624 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:48.583737 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:48.715887 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:48.718214 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:48.718323 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:48.983307 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:28:48.984905 (Thread-1): 12:28:48 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:48.985106 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:48.985277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:48.985364 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:49.211880 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:28:49.212974 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:49.213080 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:49.378970 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:28:49.380367 (Thread-1): 12:28:49 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:49.386080 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:49.386192 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:49.535421 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:28:49.535606 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:49.535693 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:50.490832 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 12:28:50.494711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:50.494825 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:50.646176 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:50.650708 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:50.650839 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:50.782137 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:50.784413 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:50.784521 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:51.053361 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:28:51.054691 (Thread-1): 12:28:51 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:51.054896 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:51.055069 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:51.055156 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:51.261517 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:28:51.262674 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:51.262780 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:28:51.384968 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:28:51.386392 (Thread-1): 12:28:51 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_customers]
2021-05-03 12:28:51.391684 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:51.391803 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:28:51.535653 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:28:51.535843 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:51.535930 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:28:52.408006 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 12:28:52.412123 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:52.412236 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:28:52.557853 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:28:52.562208 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:52.562319 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:28:52.695375 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:28:52.697665 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:52.697773 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:28:53.052444 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:28:53.053710 (Thread-1): 12:28:53 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:28:53.053913 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:53.054113 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:28:53.054201 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:28:53.243629 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:53.244055 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_customers"
2021-05-03 12:28:53.247103 (Thread-1): finished collecting timing info
2021-05-03 12:28:53.247385 (Thread-1): On model.Dbt_demo.sat_customers: Close
2021-05-03 12:28:53.489203 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52beb3700>]}
2021-05-03 12:28:53.490650 (Thread-1): 12:28:53 | 19 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_customers [INSERT 0 in 73.43s]
2021-05-03 12:28:53.490818 (Thread-1): Finished running node model.Dbt_demo.sat_customers
2021-05-03 12:28:53.490978 (Thread-1): Began running node model.Dbt_demo.hub_shippers
2021-05-03 12:28:53.492197 (Thread-1): 12:28:53 | 20 of 23 START incremental model SS_RAW_VLT.hub_shippers............. [RUN]
2021-05-03 12:28:53.492509 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:53.492632 (Thread-1): Compiling model.Dbt_demo.hub_shippers
2021-05-03 12:28:53.505328 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_shippers"
2021-05-03 12:28:53.505640 (Thread-1): finished collecting timing info
2021-05-03 12:28:53.513088 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:53.513207 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SHIPPER_PK, SHIPPERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SHIPPER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SHIPPER_PK, a.SHIPPERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers AS d
    ON a.SHIPPER_PK = d.SHIPPER_PK
    WHERE d.SHIPPER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:28:53.513308 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:28:55.596990 (Thread-1): SQL status: SUCCESS 1 in 2.08 seconds
2021-05-03 12:28:55.600421 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:55.600531 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
2021-05-03 12:28:55.757757 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-05-03 12:28:55.761681 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:55.761791 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-05-03 12:28:56.074693 (Thread-1): SQL status: SUCCESS 4 in 0.31 seconds
2021-05-03 12:28:56.079131 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:56.079242 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-05-03 12:28:56.221082 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-05-03 12:28:56.222778 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_shippers"
2021-05-03 12:28:56.223543 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:56.223650 (Thread-1): On model.Dbt_demo.hub_shippers: BEGIN
2021-05-03 12:28:56.364641 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:28:56.364830 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:56.364922 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers ("SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
        );
2021-05-03 12:28:56.769781 (Thread-1): SQL status: SUCCESS 0 in 0.40 seconds
2021-05-03 12:28:56.770952 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-05-03 12:28:56.771124 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:28:56.771214 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-05-03 12:28:56.965996 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:28:56.970011 (Thread-1): finished collecting timing info
2021-05-03 12:28:56.970289 (Thread-1): On model.Dbt_demo.hub_shippers: Close
2021-05-03 12:28:57.206332 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52b8a4fa0>]}
2021-05-03 12:28:57.207769 (Thread-1): 12:28:57 | 20 of 23 OK created incremental model SS_RAW_VLT.hub_shippers........ [SUCCESS 0 in 3.71s]
2021-05-03 12:28:57.207938 (Thread-1): Finished running node model.Dbt_demo.hub_shippers
2021-05-03 12:28:57.208099 (Thread-1): Began running node model.Dbt_demo.sat_shippers
2021-05-03 12:28:57.209329 (Thread-1): 12:28:57 | 21 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_shippers.. [RUN]
2021-05-03 12:28:57.209634 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:28:57.209757 (Thread-1): Compiling model.Dbt_demo.sat_shippers
2021-05-03 12:28:57.228763 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_shippers"
2021-05-03 12:28:57.229079 (Thread-1): finished collecting timing info
2021-05-03 12:28:57.236235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:28:57.236352 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:28:57.236461 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:28:58.499141 (Thread-1): SQL status: SUCCESS 1 in 1.26 seconds
2021-05-03 12:28:58.502464 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:28:58.502576 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:28:58.104000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:28:58.104000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_shippers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:28:58.917868 (Thread-1): SQL status: SUCCESS 1 in 0.42 seconds
2021-05-03 12:28:58.921825 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:28:58.921955 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:28:59.080438 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:28:59.082572 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:28:59.082679 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:28:59.218693 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:28:59.220095 (Thread-1): 12:28:59 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_shippers]
2021-05-03 12:28:59.225474 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:28:59.225585 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:28:59.390776 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:28:59.390966 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:28:59.391053 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:00.917300 (Thread-1): SQL status: SUCCESS 1 in 1.53 seconds
2021-05-03 12:29:00.922539 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:00.922660 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:01.085416 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:01.089772 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:01.089890 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:01.284413 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-05-03 12:29:01.286356 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:01.286472 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:01.593193 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:29:01.594496 (Thread-1): 12:29:01 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:01.594698 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:01.594870 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:01.594959 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:01.800810 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:01.802305 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:01.802412 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:01.954853 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:01.956240 (Thread-1): 12:29:01 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:01.961240 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:01.961351 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:02.122616 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:29:02.122805 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:02.122892 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:03.192346 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-05-03 12:29:03.196733 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:03.196847 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:03.361347 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:03.365417 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:03.365527 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:03.499569 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 12:29:03.501696 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:03.501811 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:03.783069 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:29:03.784323 (Thread-1): 12:29:03 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:03.784529 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:03.784701 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:03.784788 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:03.975980 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:29:03.977065 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:03.977169 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:04.116375 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:04.117779 (Thread-1): 12:29:04 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:04.123164 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:04.123275 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:04.294075 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:29:04.294259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:04.294345 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:05.351715 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-05-03 12:29:05.355699 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:05.355813 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:05.511028 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:05.515176 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:05.515292 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:05.658599 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:05.660474 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:05.660580 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:05.968348 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:29:05.969614 (Thread-1): 12:29:05 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:05.969826 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:05.970020 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:05.970110 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:06.176772 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:06.179881 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:06.179989 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:06.320767 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:06.322199 (Thread-1): 12:29:06 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:06.327129 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:06.327238 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:06.476190 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:06.476381 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:06.476469 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:07.475700 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-05-03 12:29:07.479830 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:07.479942 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:07.638343 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:07.642366 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:07.642477 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:07.774577 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 12:29:07.776476 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:07.776584 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:08.905767 (Thread-1): SQL status: SUCCESS 0 in 1.13 seconds
2021-05-03 12:29:08.907060 (Thread-1): 12:29:08 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:08.907261 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:08.907437 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:08.907531 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:09.092571 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:29:09.093669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:09.093774 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:09.282436 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:29:09.283835 (Thread-1): 12:29:09 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:09.289164 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:09.289279 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:09.439585 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:09.439777 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:09.439868 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:10.252273 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-05-03 12:29:10.256178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:10.256292 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:10.408701 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:10.412889 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:10.413005 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:10.550383 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:10.552289 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:10.552396 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:10.928807 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-05-03 12:29:10.930098 (Thread-1): 12:29:10 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:10.930303 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:10.930475 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:10.930564 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:11.138471 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:11.139927 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:11.140032 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:11.292880 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:11.294284 (Thread-1): 12:29:11 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:11.299260 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:11.299369 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:11.456306 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:29:11.456494 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:11.456580 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:12.225242 (Thread-1): SQL status: SUCCESS 1 in 0.77 seconds
2021-05-03 12:29:12.229474 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:12.229586 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:12.463087 (Thread-1): SQL status: SUCCESS 7 in 0.23 seconds
2021-05-03 12:29:12.468635 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:12.468748 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:12.772933 (Thread-1): SQL status: SUCCESS 7 in 0.30 seconds
2021-05-03 12:29:12.774859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:12.774968 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:13.446282 (Thread-1): SQL status: SUCCESS 0 in 0.67 seconds
2021-05-03 12:29:13.447543 (Thread-1): 12:29:13 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:13.447743 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:13.447913 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:13.448001 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:13.648267 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:13.649349 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:13.649460 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:13.780664 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:13.782088 (Thread-1): 12:29:13 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:13.787425 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:13.787536 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:13.942551 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:13.942747 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:13.942848 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:14.705909 (Thread-1): SQL status: SUCCESS 1 in 0.76 seconds
2021-05-03 12:29:14.709856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:14.709988 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:14.858485 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:14.862683 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:14.862796 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:15.009288 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:15.011297 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:15.011407 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:15.282498 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:29:15.283767 (Thread-1): 12:29:15 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:15.283968 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:15.284142 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:15.284230 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:15.675452 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-05-03 12:29:15.676902 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:15.677008 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:15.802100 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:29:15.803472 (Thread-1): 12:29:15 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:15.808530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:15.808640 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:16.020440 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:16.020631 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:16.020722 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:16.824162 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-05-03 12:29:16.828290 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:16.828403 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:16.996759 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 12:29:17.000788 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:17.000897 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:17.142437 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:17.144342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:17.144448 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:17.424043 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:29:17.425352 (Thread-1): 12:29:17 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:17.425565 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:17.425745 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:17.425845 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:17.638475 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:17.639608 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:17.639723 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:17.796995 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:29:17.798462 (Thread-1): 12:29:17 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:17.803934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:17.804053 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:17.958671 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:17.958865 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:17.958962 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:18.741571 (Thread-1): SQL status: SUCCESS 1 in 0.78 seconds
2021-05-03 12:29:18.746907 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:18.747020 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:18.901114 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:19.010150 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:19.010318 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:19.137260 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 12:29:19.139253 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:19.139362 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:19.434706 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:29:19.435979 (Thread-1): 12:29:19 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:19.436180 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:19.436354 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:19.436444 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:19.688781 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:29:19.690278 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:19.690385 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:19.818297 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:19.819679 (Thread-1): 12:29:19 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:19.824671 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:19.824781 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:20.036149 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:20.036341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:20.036427 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:20.835277 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-05-03 12:29:20.839194 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:20.839319 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:20.994575 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:20.998761 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:20.998879 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:21.147615 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:21.149780 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:21.149889 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:21.446477 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:29:21.447761 (Thread-1): 12:29:21 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:21.447961 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:21.448133 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:21.448222 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:21.653197 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:21.654321 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:21.654427 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:21.786441 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:21.788238 (Thread-1): 12:29:21 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:21.793187 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:21.793298 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:22.032134 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:29:22.032327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:22.032415 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:22.891957 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:29:22.895945 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:22.896063 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:23.057096 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:23.061254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:23.061372 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:23.198901 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:23.200793 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:23.200900 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:23.543110 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 12:29:23.544389 (Thread-1): 12:29:23 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:23.544592 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:23.544766 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:23.544859 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:23.745548 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:23.746632 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:23.746747 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:23.889079 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:23.890481 (Thread-1): 12:29:23 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:23.895454 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:23.895564 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:24.044789 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:24.044981 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:24.045067 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:24.800630 (Thread-1): SQL status: SUCCESS 1 in 0.76 seconds
2021-05-03 12:29:24.804470 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:24.804583 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:25.008775 (Thread-1): SQL status: SUCCESS 7 in 0.20 seconds
2021-05-03 12:29:25.012871 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:25.012982 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:25.156947 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:25.159117 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:25.159226 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:25.564065 (Thread-1): SQL status: SUCCESS 0 in 0.40 seconds
2021-05-03 12:29:25.565354 (Thread-1): 12:29:25 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:25.565558 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:25.565735 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:25.565828 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:25.760991 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:25.762119 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:25.762225 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:25.889870 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:25.891709 (Thread-1): 12:29:25 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:25.896678 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:25.896789 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:26.071785 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:29:26.071969 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:26.072056 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:27.156555 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-05-03 12:29:27.160478 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:27.160597 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:27.322698 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:27.326890 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:27.327002 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:27.458009 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 12:29:27.459901 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:27.460007 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:27.846346 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-05-03 12:29:27.847627 (Thread-1): 12:29:27 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:27.847828 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:27.847999 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:27.848085 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:28.047969 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:28.048998 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:28.049102 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:28.181229 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:28.182644 (Thread-1): 12:29:28 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:28.187648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:28.187759 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:28.332638 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:28.332834 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:28.332919 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:29.223596 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 12:29:29.227405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:29.227519 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:29.372395 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:29.378040 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:29.378151 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:29.515354 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:29.517486 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:29.517593 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:29.837525 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:29:29.838820 (Thread-1): 12:29:29 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:29.839023 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:29.839196 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:29.839285 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:30.040226 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:30.041317 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:30.041422 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:30.193876 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:30.195686 (Thread-1): 12:29:30 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:30.200689 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:30.200801 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:30.358783 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:29:30.358975 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:30.359063 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:31.151314 (Thread-1): SQL status: SUCCESS 1 in 0.79 seconds
2021-05-03 12:29:31.155249 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:31.155362 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:31.554003 (Thread-1): SQL status: SUCCESS 7 in 0.40 seconds
2021-05-03 12:29:31.558167 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:31.558278 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:31.708826 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:31.710764 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:31.710872 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:32.148775 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-05-03 12:29:32.150076 (Thread-1): 12:29:32 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:32.150286 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:32.150465 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:32.150558 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:32.375355 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:29:32.376407 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:32.376516 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:32.509892 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:32.511331 (Thread-1): 12:29:32 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:32.516339 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:32.516458 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:32.712059 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:32.712250 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:32.712336 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:34.008836 (Thread-1): SQL status: SUCCESS 1 in 1.30 seconds
2021-05-03 12:29:34.012679 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:34.012794 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:34.190685 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-05-03 12:29:34.194740 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:34.194853 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:34.474426 (Thread-1): SQL status: SUCCESS 7 in 0.28 seconds
2021-05-03 12:29:34.476527 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:34.476635 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:34.852320 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-05-03 12:29:34.853581 (Thread-1): 12:29:34 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:34.853787 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:34.853980 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:34.854074 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:35.256679 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-05-03 12:29:35.257755 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:35.257860 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:35.492114 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:29:35.493861 (Thread-1): 12:29:35 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:35.498837 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:35.498952 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:35.698853 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:35.699041 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:35.699127 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:37.070670 (Thread-1): SQL status: SUCCESS 1 in 1.37 seconds
2021-05-03 12:29:37.076290 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:37.076406 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:37.260789 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-05-03 12:29:37.264968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:37.265079 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:37.399801 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 12:29:37.401715 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:37.401823 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:38.074517 (Thread-1): SQL status: SUCCESS 0 in 0.67 seconds
2021-05-03 12:29:38.075788 (Thread-1): 12:29:38 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:38.075992 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:38.076171 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:38.076262 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:38.470811 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-05-03 12:29:38.472272 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:38.472377 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:38.600190 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:38.601592 (Thread-1): 12:29:38 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:38.606628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:38.606738 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:38.832685 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:29:38.832877 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:38.832964 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:39.832652 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-05-03 12:29:39.836568 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:39.836689 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:39.993215 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:39.997361 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:39.997477 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:40.241796 (Thread-1): SQL status: SUCCESS 7 in 0.24 seconds
2021-05-03 12:29:40.243804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:40.243914 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:40.542196 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:29:40.543500 (Thread-1): 12:29:40 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:40.543709 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:40.543888 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:40.543980 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:40.884459 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-05-03 12:29:40.885564 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:40.885669 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:41.027499 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:41.029340 (Thread-1): 12:29:41 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:41.034335 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:41.034446 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:41.179317 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:41.179509 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:41.179597 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:42.158256 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-05-03 12:29:42.162215 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:42.162328 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:42.307925 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:42.312085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:42.312200 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:42.454494 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:42.456388 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:42.456495 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:42.730981 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:29:42.732266 (Thread-1): 12:29:42 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:42.732469 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:42.732642 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:42.732730 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:42.929772 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:29:42.930818 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:42.930932 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:43.055386 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:29:43.056762 (Thread-1): 12:29:43 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:43.061745 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:43.061856 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:43.215768 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:43.215960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:43.216049 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:44.006827 (Thread-1): SQL status: SUCCESS 1 in 0.79 seconds
2021-05-03 12:29:44.010587 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:44.010699 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:44.177142 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 12:29:44.181182 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:44.181293 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:44.317352 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:44.319457 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:44.319563 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:44.637521 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:29:44.638811 (Thread-1): 12:29:44 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:44.639011 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:44.639186 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:44.639274 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:44.863017 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:29:44.864163 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:44.864273 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:45.008953 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:45.010899 (Thread-1): 12:29:45 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:45.016081 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:45.016214 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:45.174725 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:29:45.174915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:45.175001 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:46.423183 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 12:29:46.427141 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:46.427262 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:46.582597 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:46.586786 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:46.586904 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:46.726843 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:46.728717 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:46.728822 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:46.995910 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:29:46.997165 (Thread-1): 12:29:46 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:46.997367 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:46.997538 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:46.997625 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:47.215955 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:29:47.216980 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:47.217090 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:47.358016 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:29:47.359401 (Thread-1): 12:29:47 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:47.364375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:47.364491 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:47.511662 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:47.511853 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:47.511939 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:48.312885 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-05-03 12:29:48.316677 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:48.316790 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:48.469312 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:29:48.475006 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:48.475130 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:48.618279 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:48.620389 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:48.620498 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:48.898749 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:29:48.900005 (Thread-1): 12:29:48 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:48.900207 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:48.900380 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:48.900469 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:49.112427 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:49.113531 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:49.113635 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:49.246203 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:49.247578 (Thread-1): 12:29:49 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:49.252943 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:49.253058 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:49.403100 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:49.403284 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:49.403369 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:50.163032 (Thread-1): SQL status: SUCCESS 1 in 0.76 seconds
2021-05-03 12:29:50.167000 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:50.167115 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:50.324268 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:50.328506 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:50.328620 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:50.471297 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:50.473185 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:50.473292 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:50.765837 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:29:50.767157 (Thread-1): 12:29:50 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:50.767364 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:50.767537 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:50.767626 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:50.962354 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:29:50.963852 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:50.963960 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:51.090025 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:51.091410 (Thread-1): 12:29:51 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:51.096426 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:51.096537 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:51.248012 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:51.248199 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:51.248285 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:52.059306 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-05-03 12:29:52.063510 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:52.063632 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:52.235156 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 12:29:52.239185 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:52.239296 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:52.371358 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 12:29:52.373249 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:52.373356 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:52.670535 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:29:52.671768 (Thread-1): 12:29:52 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:52.671965 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:52.672163 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:52.672253 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:52.938236 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-05-03 12:29:52.939346 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:52.939452 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:53.064093 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:29:53.065504 (Thread-1): 12:29:53 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:53.070884 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:53.071008 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:53.220135 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:29:53.220331 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:53.220419 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:54.262080 (Thread-1): SQL status: SUCCESS 1 in 1.04 seconds
2021-05-03 12:29:54.267672 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:54.267790 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:54.450996 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-05-03 12:29:54.455195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:54.455306 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:54.592934 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:54.594902 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:54.595011 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:54.929839 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:29:54.931144 (Thread-1): 12:29:54 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:54.931342 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:54.931533 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:54.931622 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:55.139082 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:55.140539 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:55.140646 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:55.353479 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:29:55.354887 (Thread-1): 12:29:55 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:55.359876 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:55.359986 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:55.588362 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:29:55.588549 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:55.588644 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:56.836173 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 12:29:56.840354 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:56.840468 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:56.996127 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:29:57.000213 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:57.000333 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:57.145394 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:57.147332 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:57.147450 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:29:57.500939 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:29:57.502566 (Thread-1): 12:29:57 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:57.502765 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:57.502944 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:57.503039 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:29:57.745854 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:29:57.746988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:57.747094 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:29:57.873691 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:29:57.875127 (Thread-1): 12:29:57 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_shippers]
2021-05-03 12:29:57.880498 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:57.880609 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:29:58.122445 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:29:58.122643 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:58.122731 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:29:59.170649 (Thread-1): SQL status: SUCCESS 1 in 1.05 seconds
2021-05-03 12:29:59.174550 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:59.174661 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:29:59.340006 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 12:29:59.344063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:59.344173 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:29:59.480681 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 12:29:59.581119 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:29:59.581283 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:30:00.067785 (Thread-1): SQL status: SUCCESS 0 in 0.49 seconds
2021-05-03 12:30:00.069081 (Thread-1): 12:30:00 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:00.069281 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:00.069456 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:00.069545 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:00.281751 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:00.282880 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:00.282986 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:30:00.426092 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:30:00.429679 (Thread-1): 12:30:00 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:00.434679 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:00.434791 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:30:00.614357 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:30:00.614559 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:00.614650 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:01.439105 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-05-03 12:30:01.443132 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:01.443251 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:30:01.601995 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:30:01.606200 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:01.606316 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:30:01.753309 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 12:30:01.755254 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:01.755361 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:30:02.105606 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:30:02.106916 (Thread-1): 12:30:02 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:02.107118 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:02.107294 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:02.107385 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:02.337887 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:30:02.338951 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:02.339056 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:30:02.468580 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:02.470010 (Thread-1): 12:30:02 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:02.475078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:02.475188 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:30:02.683373 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:02.683563 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:02.683650 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:03.446040 (Thread-1): SQL status: SUCCESS 1 in 0.76 seconds
2021-05-03 12:30:03.449827 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:03.449940 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:30:03.639184 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-05-03 12:30:03.643277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:03.643390 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:30:03.801657 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 12:30:03.803803 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:03.803912 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:30:04.072717 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:30:04.074013 (Thread-1): 12:30:04 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:04.074218 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:04.074396 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:04.074485 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:04.286076 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:04.287150 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:04.287265 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:30:04.426598 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:30:04.427994 (Thread-1): 12:30:04 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:04.433331 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:04.433445 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:30:04.618248 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:30:04.618440 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:04.618526 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:05.467733 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:30:05.471662 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:05.471777 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:30:05.693392 (Thread-1): SQL status: SUCCESS 7 in 0.22 seconds
2021-05-03 12:30:05.699160 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:05.699270 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:30:05.884664 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-05-03 12:30:05.886590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:05.886697 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:30:06.360158 (Thread-1): SQL status: SUCCESS 0 in 0.47 seconds
2021-05-03 12:30:06.361421 (Thread-1): 12:30:06 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:06.361632 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:06.361804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:06.361892 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:06.586671 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:30:06.587768 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:06.587874 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 12:30:06.715393 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:06.716781 (Thread-1): 12:30:06 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:06.721777 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:06.721888 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 12:30:06.897830 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:30:06.898042 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:06.898131 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:07.771233 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 12:30:07.775388 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:07.775501 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 12:30:07.946541 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 12:30:07.950582 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:07.950701 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 12:30:08.286177 (Thread-1): SQL status: SUCCESS 7 in 0.34 seconds
2021-05-03 12:30:08.288111 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:08.288220 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 12:30:08.545442 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:30:08.547095 (Thread-1): 12:30:08 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 12:30:08.547299 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:08.547471 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:30:08.547561 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 12:30:08.747068 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:30:08.747495 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_shippers"
2021-05-03 12:30:08.750572 (Thread-1): finished collecting timing info
2021-05-03 12:30:08.750849 (Thread-1): On model.Dbt_demo.sat_shippers: Close
2021-05-03 12:30:09.047991 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bcba460>]}
2021-05-03 12:30:09.049420 (Thread-1): 12:30:09 | 21 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_shippers [INSERT 0 in 71.84s]
2021-05-03 12:30:09.049591 (Thread-1): Finished running node model.Dbt_demo.sat_shippers
2021-05-03 12:30:09.049755 (Thread-1): Began running node model.Dbt_demo.hub_suppliers
2021-05-03 12:30:09.051035 (Thread-1): 12:30:09 | 22 of 23 START incremental model SS_RAW_VLT.hub_suppliers............ [RUN]
2021-05-03 12:30:09.051349 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:09.051473 (Thread-1): Compiling model.Dbt_demo.hub_suppliers
2021-05-03 12:30:09.064426 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_suppliers"
2021-05-03 12:30:09.064749 (Thread-1): finished collecting timing info
2021-05-03 12:30:09.072139 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:09.072257 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SUPPLIER_PK, SUPPLIERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers AS d
    ON a.SUPPLIER_PK = d.SUPPLIER_PK
    WHERE d.SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:30:09.072374 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:30:11.779645 (Thread-1): SQL status: SUCCESS 1 in 2.71 seconds
2021-05-03 12:30:11.784566 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:11.784679 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
2021-05-03 12:30:11.937226 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-05-03 12:30:11.941164 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:11.941275 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-05-03 12:30:12.077249 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-05-03 12:30:12.081441 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:12.081559 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-05-03 12:30:12.222371 (Thread-1): SQL status: SUCCESS 4 in 0.14 seconds
2021-05-03 12:30:12.224053 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_suppliers"
2021-05-03 12:30:12.224841 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:12.224941 (Thread-1): On model.Dbt_demo.hub_suppliers: BEGIN
2021-05-03 12:30:12.361917 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:30:12.362134 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:12.362221 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers ("SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
        );
2021-05-03 12:30:13.527632 (Thread-1): SQL status: SUCCESS 0 in 1.17 seconds
2021-05-03 12:30:13.528801 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-05-03 12:30:13.528982 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:30:13.529074 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-05-03 12:30:13.958123 (Thread-1): SQL status: SUCCESS 1 in 0.43 seconds
2021-05-03 12:30:13.962653 (Thread-1): finished collecting timing info
2021-05-03 12:30:13.962927 (Thread-1): On model.Dbt_demo.hub_suppliers: Close
2021-05-03 12:30:14.171738 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bebb520>]}
2021-05-03 12:30:14.173195 (Thread-1): 12:30:14 | 22 of 23 OK created incremental model SS_RAW_VLT.hub_suppliers....... [SUCCESS 0 in 5.12s]
2021-05-03 12:30:14.173371 (Thread-1): Finished running node model.Dbt_demo.hub_suppliers
2021-05-03 12:30:14.173547 (Thread-1): Began running node model.Dbt_demo.sat_suppliers
2021-05-03 12:30:14.174691 (Thread-1): 12:30:14 | 23 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_suppliers. [RUN]
2021-05-03 12:30:14.175127 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:14.175255 (Thread-1): Compiling model.Dbt_demo.sat_suppliers
2021-05-03 12:30:14.197686 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_suppliers"
2021-05-03 12:30:14.198038 (Thread-1): finished collecting timing info
2021-05-03 12:30:14.206037 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:14.206166 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:30:14.206273 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:30:15.709498 (Thread-1): SQL status: SUCCESS 1 in 1.50 seconds
2021-05-03 12:30:15.712923 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:15.713037 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:30:15.283000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:30:15.283000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_suppliers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:30:16.425457 (Thread-1): SQL status: SUCCESS 1 in 0.71 seconds
2021-05-03 12:30:16.429342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:16.429458 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:16.747954 (Thread-1): SQL status: SUCCESS 12 in 0.32 seconds
2021-05-03 12:30:16.750446 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:16.750558 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:16.908601 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:30:16.910071 (Thread-1): 12:30:16 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:16.915598 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:16.915714 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:17.052395 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:30:17.052587 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:17.052678 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:18.204119 (Thread-1): SQL status: SUCCESS 1 in 1.15 seconds
2021-05-03 12:30:18.208303 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:18.208424 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:18.369936 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:30:18.374481 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:18.374599 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:18.523080 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:18.525401 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:18.525511 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:18.898845 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-05-03 12:30:18.900138 (Thread-1): 12:30:18 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:18.900338 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:18.900512 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:18.900599 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:19.091174 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:30:19.092405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:19.092524 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:19.212489 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:30:19.213931 (Thread-1): 12:30:19 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:19.219879 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:19.219996 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:19.352866 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:19.353061 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:19.353152 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:20.392606 (Thread-1): SQL status: SUCCESS 1 in 1.04 seconds
2021-05-03 12:30:20.396675 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:20.396797 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:20.549703 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:20.554277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:20.554394 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:20.685407 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:30:20.687711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:20.687818 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:20.980936 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:30:20.982235 (Thread-1): 12:30:20 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:20.982437 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:20.982610 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:20.982699 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:21.186308 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:30:21.187738 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:21.187844 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:21.313795 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:21.315216 (Thread-1): 12:30:21 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:21.320528 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:21.320643 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:21.472300 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:21.472485 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:21.472574 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:23.521263 (Thread-1): SQL status: SUCCESS 1 in 2.05 seconds
2021-05-03 12:30:23.524905 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:23.525030 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:23.865036 (Thread-1): SQL status: SUCCESS 12 in 0.34 seconds
2021-05-03 12:30:23.869469 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:23.869592 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:24.024012 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:24.026311 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:24.026418 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:24.305277 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:30:24.306581 (Thread-1): 12:30:24 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:24.306783 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:24.306956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:24.307044 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:24.504170 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:30:24.505276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:24.505382 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:24.637211 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:24.638630 (Thread-1): 12:30:24 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:24.644338 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:24.644449 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:24.789955 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:24.790172 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:24.790261 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:26.482671 (Thread-1): SQL status: SUCCESS 1 in 1.69 seconds
2021-05-03 12:30:26.486659 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:26.486773 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:26.873030 (Thread-1): SQL status: SUCCESS 12 in 0.39 seconds
2021-05-03 12:30:26.877673 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:26.877790 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:27.021291 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:30:27.023658 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:27.023770 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:27.372861 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:30:27.374259 (Thread-1): 12:30:27 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:27.374479 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:27.374665 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:27.374759 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:27.560993 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:30:27.562459 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:27.562566 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:27.785806 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:30:27.787222 (Thread-1): 12:30:27 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:27.792538 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:27.792656 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:27.943759 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:27.943961 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:27.945228 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:29.212651 (Thread-1): SQL status: SUCCESS 1 in 1.27 seconds
2021-05-03 12:30:29.216838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:29.216957 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:29.363925 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:29.368277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:29.368390 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:29.504565 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:30:29.506859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:29.508935 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:29.798609 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:30:29.799875 (Thread-1): 12:30:29 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:29.800074 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:29.800247 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:29.800335 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:30.187694 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-05-03 12:30:30.188794 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:30.188899 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:30.316302 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:30.317710 (Thread-1): 12:30:30 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:30.323742 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:30.323854 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:30.533808 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:30.534027 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:30.534118 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:31.869440 (Thread-1): SQL status: SUCCESS 1 in 1.34 seconds
2021-05-03 12:30:31.873385 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:31.873499 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:32.019605 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:32.024153 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:32.024276 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:32.148362 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:30:32.150673 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:32.150781 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:32.414492 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:30:32.415781 (Thread-1): 12:30:32 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:32.415990 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:32.416164 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:32.416253 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:32.625370 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:32.626943 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:32.627055 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:32.743698 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:30:32.745148 (Thread-1): 12:30:32 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:32.750640 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:32.750756 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:32.911813 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:30:32.912017 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:32.912115 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:34.107810 (Thread-1): SQL status: SUCCESS 1 in 1.20 seconds
2021-05-03 12:30:34.111998 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:34.112110 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:34.257847 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:34.262330 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:34.262447 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:34.390411 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:30:34.392718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:34.392832 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:34.647052 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:30:34.648364 (Thread-1): 12:30:34 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:34.648579 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:34.648759 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:34.648851 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:34.840937 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:30:34.842100 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:34.842212 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:34.964439 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:30:34.965860 (Thread-1): 12:30:34 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:34.971697 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:34.971814 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:35.118666 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:35.118860 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:35.118951 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:35.969993 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:30:35.973995 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:35.974115 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:36.125928 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:36.132129 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:36.132248 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:36.270084 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:30:36.272414 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:36.272528 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:36.492088 (Thread-1): SQL status: SUCCESS 0 in 0.22 seconds
2021-05-03 12:30:36.493358 (Thread-1): 12:30:36 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:36.493566 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:36.493741 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:36.493829 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:36.700274 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:36.701763 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:36.701875 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:36.824667 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:30:36.826105 (Thread-1): 12:30:36 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:36.831472 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:36.831583 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:37.069116 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:30:37.069314 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:37.069401 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:38.340447 (Thread-1): SQL status: SUCCESS 1 in 1.27 seconds
2021-05-03 12:30:38.344651 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:38.344764 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:38.571687 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 12:30:38.666496 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:38.666660 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:38.793491 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:30:38.795806 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:38.795913 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:39.063012 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:30:39.064313 (Thread-1): 12:30:39 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:39.064514 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:39.064694 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:39.064785 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:39.341278 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 12:30:39.342817 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:39.342926 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:39.465232 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:30:39.466670 (Thread-1): 12:30:39 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:39.472039 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:39.472151 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:39.655250 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:30:39.655442 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:39.655528 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:40.565787 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:30:40.569703 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:40.569825 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:40.711613 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:30:40.716063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:40.716197 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:40.847080 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:30:40.849596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:40.849708 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:41.174867 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:30:41.176235 (Thread-1): 12:30:41 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:41.176452 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:41.176636 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:41.176732 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:41.428638 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:30:41.429755 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:41.429864 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:41.550745 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:30:41.552572 (Thread-1): 12:30:41 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:41.557949 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:41.558084 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:41.762410 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:30:41.762617 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:41.762717 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:42.949675 (Thread-1): SQL status: SUCCESS 1 in 1.19 seconds
2021-05-03 12:30:42.955575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:42.955701 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:43.138273 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:30:43.142815 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:43.142931 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:43.398467 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-05-03 12:30:43.400779 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:43.400895 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:43.746260 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:30:43.747911 (Thread-1): 12:30:43 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:43.748126 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:43.748304 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:43.748395 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:43.956673 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:43.957792 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:43.957901 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:44.077826 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:30:44.079281 (Thread-1): 12:30:44 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:44.085048 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:44.085162 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:44.237593 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:44.237783 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:44.237879 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:45.201947 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 12:30:45.205868 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:45.206007 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:45.364181 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:30:45.368601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:45.368711 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:45.518834 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:45.521128 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:45.521234 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:45.808454 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:30:45.809749 (Thread-1): 12:30:45 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:45.809950 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:45.810146 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:45.810234 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:46.008394 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:30:46.009493 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:46.009599 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:46.142334 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:46.144203 (Thread-1): 12:30:46 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:46.149585 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:46.149701 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:46.300173 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:46.300366 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:46.300452 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:47.236433 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-05-03 12:30:47.240362 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:47.240474 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:47.389006 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:47.393434 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:47.393548 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:47.524636 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:30:47.526944 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:47.527051 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:47.789809 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:30:47.793340 (Thread-1): 12:30:47 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:47.793552 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:47.793731 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:47.793824 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:47.999339 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:30:48.000451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:48.000558 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:48.167755 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:30:48.169189 (Thread-1): 12:30:48 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:48.174659 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:48.174773 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:48.374898 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:30:48.375091 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:48.375181 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:49.511936 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-05-03 12:30:49.515747 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:49.515859 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:49.680859 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:30:49.685250 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:49.685364 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:49.820981 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:30:49.823311 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:49.823420 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:50.180482 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:30:50.181760 (Thread-1): 12:30:50 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:50.181980 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:50.182154 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:50.182242 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:50.423621 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:30:50.424722 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:50.424826 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:50.574056 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:50.575872 (Thread-1): 12:30:50 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:50.581195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:50.581305 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:50.732991 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:50.733181 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:50.733266 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:51.587615 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:30:51.591581 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:51.591695 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:51.737231 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:51.741695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:51.741805 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:51.892545 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:30:51.894838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:51.894946 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:52.190546 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:30:52.192130 (Thread-1): 12:30:52 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:52.192338 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:52.192524 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:52.192616 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:52.386030 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:30:52.387122 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:52.387226 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:52.516574 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:52.518010 (Thread-1): 12:30:52 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:52.523321 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:52.523439 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:52.677651 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:52.677841 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:52.677927 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:53.567473 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 12:30:53.571365 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:53.571496 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:53.749103 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:30:53.755079 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:53.755193 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:53.887148 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:30:53.889451 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:53.889559 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:54.200896 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:30:54.202194 (Thread-1): 12:30:54 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:54.202395 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:54.202567 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:54.202655 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:55.648976 (Thread-1): SQL status: SUCCESS 1 in 1.45 seconds
2021-05-03 12:30:55.650089 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:55.650194 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:55.793570 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:30:55.794984 (Thread-1): 12:30:55 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:55.800697 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:55.800810 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:55.958283 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:30:55.958474 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:55.958559 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:57.068172 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-05-03 12:30:57.072180 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:57.072310 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:57.336207 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-05-03 12:30:57.340839 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:57.340953 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:30:57.473763 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:30:57.476085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:57.476195 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:30:57.825845 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:30:57.827167 (Thread-1): 12:30:57 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:57.827373 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:57.827551 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:57.827641 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:30:58.027497 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:30:58.028981 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:58.029089 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:30:58.158083 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:30:58.159482 (Thread-1): 12:30:58 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:30:58.164845 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:58.164959 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:30:58.311717 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:30:58.311911 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:58.311998 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:30:59.371604 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-05-03 12:30:59.375840 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:59.375953 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:30:59.912497 (Thread-1): SQL status: SUCCESS 12 in 0.54 seconds
2021-05-03 12:30:59.916864 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:30:59.916976 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:00.135060 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:31:00.137362 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:00.137470 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:00.823023 (Thread-1): SQL status: SUCCESS 0 in 0.69 seconds
2021-05-03 12:31:00.824314 (Thread-1): 12:31:00 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:00.824522 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:00.824701 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:00.824788 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:01.020648 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:31:01.021755 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:01.021860 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:01.140545 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:01.142434 (Thread-1): 12:31:01 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:01.147753 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:01.147865 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:01.338287 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:31:01.338477 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:01.338573 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:03.947801 (Thread-1): SQL status: SUCCESS 1 in 2.61 seconds
2021-05-03 12:31:03.953441 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:03.953564 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:04.108654 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:31:04.113151 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:04.113265 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:04.238982 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:31:04.241259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:04.241365 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:04.487546 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:31:04.489172 (Thread-1): 12:31:04 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:04.489381 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:04.489553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:04.489641 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:04.690119 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:31:04.691213 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:04.691331 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:04.812850 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:04.814278 (Thread-1): 12:31:04 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:04.819987 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:04.820099 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:04.964771 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:31:04.964963 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:04.965049 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:05.884832 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-05-03 12:31:05.888744 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:05.888857 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:06.042784 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:31:06.047225 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:06.047345 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:06.283191 (Thread-1): SQL status: SUCCESS 12 in 0.24 seconds
2021-05-03 12:31:06.285502 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:06.285620 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:06.553265 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:31:06.554578 (Thread-1): 12:31:06 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:06.554781 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:06.554955 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:06.555044 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:06.744904 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:31:06.746008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:06.746114 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:06.870333 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:06.872144 (Thread-1): 12:31:06 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:06.877508 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:06.877621 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:07.023167 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:31:07.023354 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:07.023441 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:07.840781 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-05-03 12:31:07.844725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:07.844845 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:07.997176 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:31:08.001579 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:08.001690 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:08.132402 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:31:08.134691 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:08.134798 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:08.360672 (Thread-1): SQL status: SUCCESS 0 in 0.23 seconds
2021-05-03 12:31:08.364136 (Thread-1): 12:31:08 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:08.364342 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:08.364514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:08.364603 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:11.932106 (Thread-1): SQL status: SUCCESS 1 in 3.57 seconds
2021-05-03 12:31:11.933194 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:11.933300 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:12.074093 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:31:12.075504 (Thread-1): 12:31:12 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:12.080827 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:12.080940 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:12.224079 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:31:12.224272 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:12.224359 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:13.059590 (Thread-1): SQL status: SUCCESS 1 in 0.84 seconds
2021-05-03 12:31:13.063437 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:13.063551 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:13.228758 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:31:13.233176 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:13.233291 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:16.485286 (Thread-1): SQL status: SUCCESS 12 in 3.25 seconds
2021-05-03 12:31:16.487599 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:16.487706 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:16.796895 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:31:16.798178 (Thread-1): 12:31:16 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:16.798385 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:16.798561 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:16.798650 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:16.997632 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:31:16.998761 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:16.998867 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:17.124105 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:31:17.125924 (Thread-1): 12:31:17 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:17.131259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:17.131369 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:17.282413 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:31:17.282605 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:17.282691 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:19.039025 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2021-05-03 12:31:19.043043 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:19.043162 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:19.186190 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:31:19.190727 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:19.190853 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:21.555695 (Thread-1): SQL status: SUCCESS 12 in 2.36 seconds
2021-05-03 12:31:21.558004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:21.558114 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:21.806137 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:31:21.807718 (Thread-1): 12:31:21 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:21.807920 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:21.808092 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:21.808180 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:22.003429 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:31:22.004540 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:22.004649 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:22.483649 (Thread-1): SQL status: SUCCESS 1 in 0.48 seconds
2021-05-03 12:31:22.485085 (Thread-1): 12:31:22 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:22.490846 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:22.490960 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:22.789227 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:31:22.789423 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:22.789514 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:23.590868 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-05-03 12:31:23.594678 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:23.594789 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:23.772411 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:31:23.778458 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:23.778570 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:23.906585 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:31:23.908859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:23.908964 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:24.160523 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:31:24.161781 (Thread-1): 12:31:24 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:24.162008 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:24.162182 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:24.162269 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:24.390989 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:31:24.392069 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:24.392178 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:24.509902 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:24.511759 (Thread-1): 12:31:24 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:24.517166 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:24.517282 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:24.682490 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:31:24.682691 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:24.682784 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:26.659466 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2021-05-03 12:31:26.663559 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:26.663686 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:26.799254 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:31:26.803893 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:26.804010 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:26.941087 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:31:26.943421 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:26.943543 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:27.375502 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-05-03 12:31:27.377142 (Thread-1): 12:31:27 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:27.377356 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:27.377537 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:27.377629 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:27.882503 (Thread-1): SQL status: SUCCESS 1 in 0.50 seconds
2021-05-03 12:31:27.883605 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:27.883711 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:28.009583 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:31:28.011010 (Thread-1): 12:31:28 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:28.016366 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:28.016481 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:28.157758 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:31:28.157987 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:28.158956 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:30.665628 (Thread-1): SQL status: SUCCESS 1 in 2.51 seconds
2021-05-03 12:31:30.669528 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:30.669655 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:30.844731 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:31:30.849110 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:30.849226 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:31.098020 (Thread-1): SQL status: SUCCESS 12 in 0.25 seconds
2021-05-03 12:31:31.100317 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:31.100424 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:31.400981 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:31:31.402284 (Thread-1): 12:31:31 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:31.402497 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:31.402669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:31.402757 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:31.626959 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:31:31.628082 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:31.628192 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:31.753994 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:31:31.755785 (Thread-1): 12:31:31 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:31.761089 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:31.761202 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:31.906819 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:31:31.907008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:31.907096 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:32.755450 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:31:32.760998 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:32.761113 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:33.306198 (Thread-1): SQL status: SUCCESS 12 in 0.54 seconds
2021-05-03 12:31:33.311071 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:33.311191 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:33.720050 (Thread-1): SQL status: SUCCESS 12 in 0.41 seconds
2021-05-03 12:31:33.814087 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:33.814259 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:34.057508 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:31:34.058876 (Thread-1): 12:31:34 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:34.059094 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:34.059277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:34.059372 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:34.343722 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 12:31:34.344899 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:34.345012 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:34.468380 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:34.470417 (Thread-1): 12:31:34 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:34.476186 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:34.476306 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:36.699452 (Thread-1): SQL status: SUCCESS 1 in 2.22 seconds
2021-05-03 12:31:36.699654 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:36.699744 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:37.805176 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-05-03 12:31:37.809168 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:37.809280 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:40.638370 (Thread-1): SQL status: SUCCESS 12 in 2.83 seconds
2021-05-03 12:31:40.642694 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:40.642805 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:40.780126 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:31:40.782418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:40.782524 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:41.038647 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:31:41.040255 (Thread-1): 12:31:41 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:41.040457 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:41.040628 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:41.040729 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:41.235791 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:31:41.236871 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:41.236982 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:41.360724 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:41.362160 (Thread-1): 12:31:41 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:41.367856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:41.367965 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:41.514812 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:31:41.515005 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:41.515092 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:42.376233 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:31:42.380167 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:42.380285 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:42.523720 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:31:42.528205 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:42.528326 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:42.658691 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:31:42.661034 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:42.661150 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:42.925429 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:31:42.926780 (Thread-1): 12:31:42 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:42.926991 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:42.927174 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:42.927267 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:43.126827 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:31:43.127964 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:43.128072 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:43.251606 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:43.255224 (Thread-1): 12:31:43 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:43.260505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:43.260616 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:43.718745 (Thread-1): SQL status: SUCCESS 1 in 0.46 seconds
2021-05-03 12:31:43.718941 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:43.719030 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:44.722761 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-05-03 12:31:44.726685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:44.726803 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:45.016019 (Thread-1): SQL status: SUCCESS 12 in 0.29 seconds
2021-05-03 12:31:45.020537 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:45.020650 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:45.183165 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:31:45.185446 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:45.185552 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:45.983470 (Thread-1): SQL status: SUCCESS 0 in 0.80 seconds
2021-05-03 12:31:45.985080 (Thread-1): 12:31:45 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:45.985286 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:45.985457 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:45.985544 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:46.297862 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-05-03 12:31:46.298968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:46.299073 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 12:31:46.418654 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:31:46.420052 (Thread-1): 12:31:46 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:46.425401 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:46.425518 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 12:31:48.696862 (Thread-1): SQL status: SUCCESS 1 in 2.27 seconds
2021-05-03 12:31:48.697057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:48.697145 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:31:49.511798 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-05-03 12:31:49.515685 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:49.515801 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 12:31:49.666460 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:31:49.670883 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:49.670994 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 12:31:49.922342 (Thread-1): SQL status: SUCCESS 12 in 0.25 seconds
2021-05-03 12:31:49.924619 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:49.924726 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 12:31:50.178405 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:31:50.179677 (Thread-1): 12:31:50 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 12:31:50.179886 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:50.180073 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:31:50.180161 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 12:31:50.372229 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:31:50.372660 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_suppliers"
2021-05-03 12:31:50.375736 (Thread-1): finished collecting timing info
2021-05-03 12:31:50.376018 (Thread-1): On model.Dbt_demo.sat_suppliers: Close
2021-05-03 12:31:50.638169 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e043aec-caec-4b4e-be63-18641c7b733a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bda2640>]}
2021-05-03 12:31:50.639591 (Thread-1): 12:31:50 | 23 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_suppliers [INSERT 0 in 96.46s]
2021-05-03 12:31:50.639767 (Thread-1): Finished running node model.Dbt_demo.sat_suppliers
2021-05-03 12:31:50.641129 (MainThread): Acquiring new snowflake connection "master".
2021-05-03 12:31:50.641340 (MainThread): Using snowflake connection "master".
2021-05-03 12:31:50.641432 (MainThread): On master: BEGIN
2021-05-03 12:31:50.641522 (MainThread): Opening a new connection, currently in state closed
2021-05-03 12:31:51.600449 (MainThread): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 12:31:51.600661 (MainThread): On master: COMMIT
2021-05-03 12:31:51.600838 (MainThread): Using snowflake connection "master".
2021-05-03 12:31:51.600930 (MainThread): On master: COMMIT
2021-05-03 12:31:51.823634 (MainThread): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:31:51.823866 (MainThread): On master: Close
2021-05-03 12:31:52.083261 (MainThread): 12:31:52 | 
2021-05-03 12:31:52.083489 (MainThread): 12:31:52 | Finished running 10 view models, 8 incremental models, 5 vault_insert_by_period models in 449.99s.
2021-05-03 12:31:52.083613 (MainThread): Connection 'master' was properly closed.
2021-05-03 12:31:52.083702 (MainThread): Connection 'model.Dbt_demo.sat_suppliers' was properly closed.
2021-05-03 12:31:52.220022 (MainThread): 
2021-05-03 12:31:52.220230 (MainThread): Completed successfully
2021-05-03 12:31:52.220406 (MainThread): 
Done. PASS=23 WARN=0 ERROR=0 SKIP=0 TOTAL=23
2021-05-03 12:31:52.220642 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52b936370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc529f692b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc52bfb1430>]}
2021-05-03 12:31:52.220867 (MainThread): Flushing usage events
2021-05-03 12:54:25.599706 (MainThread): Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3, and in 3.9 it will stop working
2021-05-03 12:54:25.602139 (MainThread): Running with dbt=0.19.0
2021-05-03 12:54:26.339266 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='/home/ubuntu/dvdemo2/dvdemo/', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2021-05-03 12:54:26.339994 (MainThread): Tracking: tracking
2021-05-03 12:54:26.340302 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a33d1b730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a27855b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a27855be0>]}
2021-05-03 12:54:26.409952 (MainThread): Partial parsing not enabled
2021-05-03 12:54:26.411122 (MainThread): Parsing macros/adapters.sql
2021-05-03 12:54:26.447966 (MainThread): Parsing macros/catalog.sql
2021-05-03 12:54:26.450414 (MainThread): Parsing macros/materializations/incremental.sql
2021-05-03 12:54:26.462562 (MainThread): Parsing macros/materializations/view.sql
2021-05-03 12:54:26.464428 (MainThread): Parsing macros/materializations/merge.sql
2021-05-03 12:54:26.466932 (MainThread): Parsing macros/materializations/table.sql
2021-05-03 12:54:26.472642 (MainThread): Parsing macros/core.sql
2021-05-03 12:54:26.477555 (MainThread): Parsing macros/schema_tests/relationships.sql
2021-05-03 12:54:26.479980 (MainThread): Parsing macros/schema_tests/unique.sql
2021-05-03 12:54:26.482200 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2021-05-03 12:54:26.485616 (MainThread): Parsing macros/schema_tests/not_null.sql
2021-05-03 12:54:26.487640 (MainThread): Parsing macros/adapters/common.sql
2021-05-03 12:54:26.542768 (MainThread): Parsing macros/etc/datetime.sql
2021-05-03 12:54:26.554082 (MainThread): Parsing macros/etc/query.sql
2021-05-03 12:54:26.555421 (MainThread): Parsing macros/etc/get_custom_schema.sql
2021-05-03 12:54:26.557915 (MainThread): Parsing macros/etc/is_incremental.sql
2021-05-03 12:54:26.559951 (MainThread): Parsing macros/etc/get_custom_alias.sql
2021-05-03 12:54:26.561153 (MainThread): Parsing macros/etc/get_custom_database.sql
2021-05-03 12:54:26.563286 (MainThread): Parsing macros/materializations/helpers.sql
2021-05-03 12:54:26.574632 (MainThread): Parsing macros/materializations/seed/seed.sql
2021-05-03 12:54:26.600875 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2021-05-03 12:54:26.608574 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2021-05-03 12:54:26.610906 (MainThread): Parsing macros/materializations/table/table.sql
2021-05-03 12:54:26.619201 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2021-05-03 12:54:26.656995 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2021-05-03 12:54:26.679441 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2021-05-03 12:54:26.681647 (MainThread): Parsing macros/materializations/view/view.sql
2021-05-03 12:54:26.689444 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2021-05-03 12:54:26.695760 (MainThread): Parsing macros/materializations/common/merge.sql
2021-05-03 12:54:26.714111 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2021-05-03 12:54:26.739150 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2021-05-03 12:54:26.748119 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2021-05-03 12:54:26.749667 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2021-05-03 12:54:26.773704 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2021-05-03 12:54:26.793250 (MainThread): Parsing macros/supporting/hash.sql
2021-05-03 12:54:26.802337 (MainThread): Parsing macros/supporting/prefix.sql
2021-05-03 12:54:26.809642 (MainThread): Parsing macros/staging/rank_columns.sql
2021-05-03 12:54:26.812744 (MainThread): Parsing macros/staging/source_columns.sql
2021-05-03 12:54:26.814480 (MainThread): Parsing macros/staging/hash_columns.sql
2021-05-03 12:54:26.819542 (MainThread): Parsing macros/staging/derive_columns.sql
2021-05-03 12:54:26.827614 (MainThread): Parsing macros/staging/stage.sql
2021-05-03 12:54:26.842284 (MainThread): Parsing macros/internal/expand_column_list.sql
2021-05-03 12:54:26.846397 (MainThread): Parsing macros/internal/as_constant.sql
2021-05-03 12:54:26.849379 (MainThread): Parsing macros/internal/multikey.sql
2021-05-03 12:54:26.856093 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2021-05-03 12:54:26.869848 (MainThread): Parsing macros/internal/alias_all.sql
2021-05-03 12:54:26.873457 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2021-05-03 12:54:26.874619 (MainThread): Parsing macros/internal/alias.sql
2021-05-03 12:54:26.879397 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2021-05-03 12:54:26.879965 (MainThread): Parsing macros/internal/is_checks.sql
2021-05-03 12:54:26.884099 (MainThread): Parsing macros/tables/sat.sql
2021-05-03 12:54:26.895079 (MainThread): Parsing macros/tables/link.sql
2021-05-03 12:54:26.908470 (MainThread): Parsing macros/tables/eff_sat.sql
2021-05-03 12:54:26.924213 (MainThread): Parsing macros/tables/t_link.sql
2021-05-03 12:54:26.929515 (MainThread): Parsing macros/tables/hub.sql
2021-05-03 12:54:26.943705 (MainThread): Parsing macros/schema_tests/not_constant.sql
2021-05-03 12:54:26.945908 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2021-05-03 12:54:26.949005 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2021-05-03 12:54:26.952573 (MainThread): Parsing macros/schema_tests/equality.sql
2021-05-03 12:54:26.957866 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2021-05-03 12:54:26.962105 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2021-05-03 12:54:26.964473 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2021-05-03 12:54:26.972707 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2021-05-03 12:54:26.975336 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2021-05-03 12:54:26.978199 (MainThread): Parsing macros/schema_tests/recency.sql
2021-05-03 12:54:26.980771 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2021-05-03 12:54:26.983261 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2021-05-03 12:54:26.985399 (MainThread): Parsing macros/cross_db_utils/literal.sql
2021-05-03 12:54:26.986855 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2021-05-03 12:54:26.988546 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2021-05-03 12:54:26.991171 (MainThread): Parsing macros/cross_db_utils/replace.sql
2021-05-03 12:54:26.992999 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2021-05-03 12:54:26.995411 (MainThread): Parsing macros/cross_db_utils/concat.sql
2021-05-03 12:54:26.998601 (MainThread): Parsing macros/cross_db_utils/position.sql
2021-05-03 12:54:27.000840 (MainThread): Parsing macros/cross_db_utils/except.sql
2021-05-03 12:54:27.002492 (MainThread): Parsing macros/cross_db_utils/length.sql
2021-05-03 12:54:27.004577 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2021-05-03 12:54:27.016687 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2021-05-03 12:54:27.020509 (MainThread): Parsing macros/cross_db_utils/hash.sql
2021-05-03 12:54:27.022623 (MainThread): Parsing macros/cross_db_utils/right.sql
2021-05-03 12:54:27.025760 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2021-05-03 12:54:27.026896 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2021-05-03 12:54:27.029598 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2021-05-03 12:54:27.038685 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2021-05-03 12:54:27.041236 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2021-05-03 12:54:27.044566 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2021-05-03 12:54:27.049275 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2021-05-03 12:54:27.051470 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2021-05-03 12:54:27.053066 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2021-05-03 12:54:27.059921 (MainThread): Parsing macros/logger/pretty_time.sql
2021-05-03 12:54:27.061704 (MainThread): Parsing macros/logger/pretty_log_format.sql
2021-05-03 12:54:27.063386 (MainThread): Parsing macros/logger/log_info.sql
2021-05-03 12:54:27.065219 (MainThread): Parsing macros/web/get_url_path.sql
2021-05-03 12:54:27.068755 (MainThread): Parsing macros/web/get_url_host.sql
2021-05-03 12:54:27.071309 (MainThread): Parsing macros/web/get_url_parameter.sql
2021-05-03 12:54:27.073608 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2021-05-03 12:54:27.105197 (MainThread): Parsing macros/geo/haversine_distance.sql
2021-05-03 12:54:27.107369 (MainThread): Parsing macros/datetime/date_spine.sql
2021-05-03 12:54:27.113702 (MainThread): Parsing macros/sql/surrogate_key.sql
2021-05-03 12:54:27.118483 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2021-05-03 12:54:27.126753 (MainThread): Parsing macros/sql/pivot.sql
2021-05-03 12:54:27.132249 (MainThread): Parsing macros/sql/get_column_values.sql
2021-05-03 12:54:27.138363 (MainThread): Parsing macros/sql/unpivot.sql
2021-05-03 12:54:27.147854 (MainThread): Parsing macros/sql/groupby.sql
2021-05-03 12:54:27.149793 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2021-05-03 12:54:27.152185 (MainThread): Parsing macros/sql/star.sql
2021-05-03 12:54:27.156760 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2021-05-03 12:54:27.161358 (MainThread): Parsing macros/sql/union.sql
2021-05-03 12:54:27.172766 (MainThread): Parsing macros/sql/generate_series.sql
2021-05-03 12:54:27.178726 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2021-05-03 12:54:27.181948 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2021-05-03 12:54:27.186592 (MainThread): Parsing macros/sql/nullcheck_table.sql
2021-05-03 12:54:27.188902 (MainThread): Parsing macros/sql/safe_add.sql
2021-05-03 12:54:27.191240 (MainThread): Parsing macros/sql/nullcheck.sql
2021-05-03 12:54:27.200738 (MainThread): Partial parsing not enabled
2021-05-03 12:54:27.260803 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:54:27.346727 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:54:27.366677 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 12:54:27.386346 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 12:54:27.405689 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:54:27.425405 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:54:27.466021 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:54:27.486173 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:54:27.505753 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:54:27.571092 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:54:27.600159 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 12:54:27.628205 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:54:27.656372 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 12:54:27.681687 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:54:27.692043 (MainThread): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-05-03 12:54:27.692223 (MainThread): source_model: raw_suppliers
2021-05-03 12:54:27.692342 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:27.692457 (MainThread): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-05-03 12:54:27.803903 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:54:27.814406 (MainThread): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-05-03 12:54:27.814575 (MainThread): source_model: raw_customers
2021-05-03 12:54:27.814698 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:27.814816 (MainThread): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-05-03 12:54:27.833888 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:54:27.846250 (MainThread): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-05-03 12:54:27.846408 (MainThread): source_model: raw_products
2021-05-03 12:54:27.846525 (MainThread): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:27.846637 (MainThread): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-05-03 12:54:27.866163 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:54:27.876023 (MainThread): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-05-03 12:54:27.876172 (MainThread): source_model: raw_shippers
2021-05-03 12:54:27.876291 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:27.876403 (MainThread): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-05-03 12:54:27.892597 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:54:27.904190 (MainThread): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-05-03 12:54:27.904347 (MainThread): source_model: raw_orders
2021-05-03 12:54:27.904464 (MainThread): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:27.904580 (MainThread): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-05-03 12:54:27.926607 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:54:28.006647 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:54:28.023652 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:54:28.040334 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:54:28.057169 (MainThread): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:54:28.963227 (MainThread): Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2788eca0>]}
2021-05-03 12:54:29.101895 (MainThread): Found 23 models, 0 tests, 0 snapshots, 0 analyses, 372 macros, 0 operations, 0 seed files, 5 sources, 0 exposures
2021-05-03 12:54:29.103872 (MainThread): 
2021-05-03 12:54:29.104249 (MainThread): Acquiring new snowflake connection "master".
2021-05-03 12:54:29.138189 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:54:29.154747 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:54:29.154872 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-05-03 12:54:29.154973 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2021-05-03 12:54:30.588524 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 1.43 seconds
2021-05-03 12:54:30.593094 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-05-03 12:54:30.798344 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:54:30.802145 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:54:30.802259 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-05-03 12:54:30.802368 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-05-03 12:54:32.319404 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 1.52 seconds
2021-05-03 12:54:32.320412 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-05-03 12:54:32.629212 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:54:32.632482 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DATAVAULTDEMO_DB".
2021-05-03 12:54:32.632594 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB"} */

    show terse schemas in database DATAVAULTDEMO_DB
    limit 10000
2021-05-03 12:54:32.632695 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2021-05-03 12:54:33.549401 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 8 in 0.92 seconds
2021-05-03 12:54:33.550419 (ThreadPoolExecutor-0_0): On list_DATAVAULTDEMO_DB: Close
2021-05-03 12:54:33.923801 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-05-03 12:54:33.932876 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_STG".
2021-05-03 12:54:33.933001 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_STG"} */

    show terse objects in DATAVAULTDEMO_DB.SS_STG
2021-05-03 12:54:33.933103 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-05-03 12:54:34.834840 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 0.90 seconds
2021-05-03 12:54:34.840538 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_STG: Close
2021-05-03 12:54:35.073845 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-05-03 12:54:35.077533 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW".
2021-05-03 12:54:35.077658 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW
2021-05-03 12:54:35.077760 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-05-03 12:54:35.905286 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 5 in 0.83 seconds
2021-05-03 12:54:35.911081 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW: Close
2021-05-03 12:54:36.118416 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-05-03 12:54:36.121654 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DATAVAULTDEMO_DB_SS_RAW_VLT".
2021-05-03 12:54:36.122067 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "connection_name": "list_DATAVAULTDEMO_DB_SS_RAW_VLT"} */

    show terse objects in DATAVAULTDEMO_DB.SS_RAW_VLT
2021-05-03 12:54:36.122189 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2021-05-03 12:54:36.765268 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 13 in 0.64 seconds
2021-05-03 12:54:36.778528 (ThreadPoolExecutor-1_0): On list_DATAVAULTDEMO_DB_SS_RAW_VLT: Close
2021-05-03 12:54:36.971451 (MainThread): Using snowflake connection "master".
2021-05-03 12:54:36.971627 (MainThread): On master: BEGIN
2021-05-03 12:54:36.971731 (MainThread): Opening a new connection, currently in state init
2021-05-03 12:54:37.619591 (MainThread): SQL status: SUCCESS 1 in 0.65 seconds
2021-05-03 12:54:37.619795 (MainThread): On master: COMMIT
2021-05-03 12:54:37.619964 (MainThread): Using snowflake connection "master".
2021-05-03 12:54:37.620053 (MainThread): On master: COMMIT
2021-05-03 12:54:39.984305 (MainThread): SQL status: SUCCESS 1 in 2.36 seconds
2021-05-03 12:54:39.984522 (MainThread): On master: Close
2021-05-03 12:54:40.175061 (MainThread): 12:54:40 | Concurrency: 1 threads (target='dev')
2021-05-03 12:54:40.175313 (MainThread): 12:54:40 | 
2021-05-03 12:54:40.176947 (Thread-1): Began running node model.Dbt_demo.raw_orders
2021-05-03 12:54:40.178459 (Thread-1): 12:54:40 | 1 of 23 START view model SS_RAW.raw_orders........................... [RUN]
2021-05-03 12:54:40.178810 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:54:40.178971 (Thread-1): Compiling model.Dbt_demo.raw_orders
2021-05-03 12:54:40.201981 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_orders"
2021-05-03 12:54:40.202373 (Thread-1): finished collecting timing info
2021-05-03 12:54:40.235612 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_orders"
2021-05-03 12:54:40.236297 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:54:40.236407 (Thread-1): On model.Dbt_demo.raw_orders: BEGIN
2021-05-03 12:54:40.236514 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:40.972411 (Thread-1): SQL status: SUCCESS 1 in 0.74 seconds
2021-05-03 12:54:40.972609 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:54:40.972697 (Thread-1): On model.Dbt_demo.raw_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_orders  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.ORDERS 
--FROM DATAVAULTDEMO_DB.SS.ORDERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:54:41.310413 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-05-03 12:54:41.311724 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-05-03 12:54:41.311901 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_orders".
2021-05-03 12:54:41.311991 (Thread-1): On model.Dbt_demo.raw_orders: COMMIT
2021-05-03 12:54:41.459072 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:54:41.470923 (Thread-1): finished collecting timing info
2021-05-03 12:54:41.471220 (Thread-1): On model.Dbt_demo.raw_orders: Close
2021-05-03 12:54:41.673240 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a263676d0>]}
2021-05-03 12:54:41.674742 (Thread-1): 12:54:41 | 1 of 23 OK created view model SS_RAW.raw_orders...................... [SUCCESS 1 in 1.49s]
2021-05-03 12:54:41.674914 (Thread-1): Finished running node model.Dbt_demo.raw_orders
2021-05-03 12:54:41.675095 (Thread-1): Began running node model.Dbt_demo.raw_products
2021-05-03 12:54:41.676414 (Thread-1): 12:54:41 | 2 of 23 START view model SS_RAW.raw_products......................... [RUN]
2021-05-03 12:54:41.676867 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:54:41.677039 (Thread-1): Compiling model.Dbt_demo.raw_products
2021-05-03 12:54:41.688237 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_products"
2021-05-03 12:54:41.688579 (Thread-1): finished collecting timing info
2021-05-03 12:54:41.695270 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_products"
2021-05-03 12:54:41.695890 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:54:41.695993 (Thread-1): On model.Dbt_demo.raw_products: BEGIN
2021-05-03 12:54:41.696091 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:42.383412 (Thread-1): SQL status: SUCCESS 1 in 0.69 seconds
2021-05-03 12:54:42.383616 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:54:42.383706 (Thread-1): On model.Dbt_demo.raw_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_products  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.PRODUCTS 
--FROM DATAVAULTDEMO_DB.SS.PRODUCTS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:54:42.691073 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-05-03 12:54:42.692260 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-05-03 12:54:42.692442 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_products".
2021-05-03 12:54:42.692534 (Thread-1): On model.Dbt_demo.raw_products: COMMIT
2021-05-03 12:54:42.989449 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:54:42.993589 (Thread-1): finished collecting timing info
2021-05-03 12:54:42.993875 (Thread-1): On model.Dbt_demo.raw_products: Close
2021-05-03 12:54:43.196293 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a266ef9d0>]}
2021-05-03 12:54:43.197713 (Thread-1): 12:54:43 | 2 of 23 OK created view model SS_RAW.raw_products.................... [SUCCESS 1 in 1.52s]
2021-05-03 12:54:43.197890 (Thread-1): Finished running node model.Dbt_demo.raw_products
2021-05-03 12:54:43.198086 (Thread-1): Began running node model.Dbt_demo.raw_customers
2021-05-03 12:54:43.199197 (Thread-1): 12:54:43 | 3 of 23 START view model SS_RAW.raw_customers........................ [RUN]
2021-05-03 12:54:43.199697 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:54:43.199829 (Thread-1): Compiling model.Dbt_demo.raw_customers
2021-05-03 12:54:43.211270 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_customers"
2021-05-03 12:54:43.211580 (Thread-1): finished collecting timing info
2021-05-03 12:54:43.217038 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_customers"
2021-05-03 12:54:43.217669 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:54:43.217772 (Thread-1): On model.Dbt_demo.raw_customers: BEGIN
2021-05-03 12:54:43.217873 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:44.127689 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:54:44.127887 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:54:44.127977 (Thread-1): On model.Dbt_demo.raw_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_customers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.CUSTOMERS 
--FROM DATAVAULTDEMO_DB.SS.CUSTOMERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:54:44.431899 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:54:44.433092 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-05-03 12:54:44.433269 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_customers".
2021-05-03 12:54:44.433361 (Thread-1): On model.Dbt_demo.raw_customers: COMMIT
2021-05-03 12:54:44.574698 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:54:44.578928 (Thread-1): finished collecting timing info
2021-05-03 12:54:44.579207 (Thread-1): On model.Dbt_demo.raw_customers: Close
2021-05-03 12:54:44.800760 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a266ef2b0>]}
2021-05-03 12:54:44.802203 (Thread-1): 12:54:44 | 3 of 23 OK created view model SS_RAW.raw_customers................... [SUCCESS 1 in 1.60s]
2021-05-03 12:54:44.802379 (Thread-1): Finished running node model.Dbt_demo.raw_customers
2021-05-03 12:54:44.802550 (Thread-1): Began running node model.Dbt_demo.raw_shippers
2021-05-03 12:54:44.803837 (Thread-1): 12:54:44 | 4 of 23 START view model SS_RAW.raw_shippers......................... [RUN]
2021-05-03 12:54:44.804160 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:54:44.804442 (Thread-1): Compiling model.Dbt_demo.raw_shippers
2021-05-03 12:54:44.815955 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_shippers"
2021-05-03 12:54:44.816258 (Thread-1): finished collecting timing info
2021-05-03 12:54:44.821648 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_shippers"
2021-05-03 12:54:44.822280 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:54:44.822385 (Thread-1): On model.Dbt_demo.raw_shippers: BEGIN
2021-05-03 12:54:44.822482 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:45.484632 (Thread-1): SQL status: SUCCESS 1 in 0.66 seconds
2021-05-03 12:54:45.484830 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:54:45.484919 (Thread-1): On model.Dbt_demo.raw_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_shippers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SHIPPERS 
--FROM DATAVAULTDEMO_DB.SS.SHIPPERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:54:45.800515 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:54:45.801678 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-05-03 12:54:45.801865 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_shippers".
2021-05-03 12:54:45.801986 (Thread-1): On model.Dbt_demo.raw_shippers: COMMIT
2021-05-03 12:54:45.927120 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:54:45.931252 (Thread-1): finished collecting timing info
2021-05-03 12:54:45.931520 (Thread-1): On model.Dbt_demo.raw_shippers: Close
2021-05-03 12:54:46.133538 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a261956a0>]}
2021-05-03 12:54:46.135007 (Thread-1): 12:54:46 | 4 of 23 OK created view model SS_RAW.raw_shippers.................... [SUCCESS 1 in 1.33s]
2021-05-03 12:54:46.135189 (Thread-1): Finished running node model.Dbt_demo.raw_shippers
2021-05-03 12:54:46.135363 (Thread-1): Began running node model.Dbt_demo.raw_suppliers
2021-05-03 12:54:46.136636 (Thread-1): 12:54:46 | 5 of 23 START view model SS_RAW.raw_suppliers........................ [RUN]
2021-05-03 12:54:46.137151 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:54:46.137277 (Thread-1): Compiling model.Dbt_demo.raw_suppliers
2021-05-03 12:54:46.148390 (Thread-1): Writing injected SQL for node "model.Dbt_demo.raw_suppliers"
2021-05-03 12:54:46.148703 (Thread-1): finished collecting timing info
2021-05-03 12:54:46.154107 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.raw_suppliers"
2021-05-03 12:54:46.154720 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:54:46.154822 (Thread-1): On model.Dbt_demo.raw_suppliers: BEGIN
2021-05-03 12:54:46.154919 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:47.108811 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-05-03 12:54:47.109005 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:54:47.109093 (Thread-1): On model.Dbt_demo.raw_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.raw_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_RAW.raw_suppliers  as (
    SELECT
    *
FROM DATAVAULTDEMO_DB.SS.SUPPLIERS 
--FROM DATAVAULTDEMO_DB.SS.SUPPLIERS where UPDATE_TS > '2021-02-10 00:00:00.000'
  );
2021-05-03 12:54:47.431568 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:54:47.432735 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-05-03 12:54:47.432911 (Thread-1): Using snowflake connection "model.Dbt_demo.raw_suppliers".
2021-05-03 12:54:47.433002 (Thread-1): On model.Dbt_demo.raw_suppliers: COMMIT
2021-05-03 12:54:47.558740 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:54:47.562835 (Thread-1): finished collecting timing info
2021-05-03 12:54:47.563104 (Thread-1): On model.Dbt_demo.raw_suppliers: Close
2021-05-03 12:54:47.785301 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a26214040>]}
2021-05-03 12:54:47.786764 (Thread-1): 12:54:47 | 5 of 23 OK created view model SS_RAW.raw_suppliers................... [SUCCESS 1 in 1.65s]
2021-05-03 12:54:47.786935 (Thread-1): Finished running node model.Dbt_demo.raw_suppliers
2021-05-03 12:54:47.787106 (Thread-1): Began running node model.Dbt_demo.v_stg_orders
2021-05-03 12:54:47.788497 (Thread-1): 12:54:47 | 6 of 23 START view model SS_STG.v_stg_orders......................... [RUN]
2021-05-03 12:54:47.788845 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:54:47.788968 (Thread-1): Compiling model.Dbt_demo.v_stg_orders
2021-05-03 12:54:47.804158 (Thread-1): metadata dict: {'source_model': 'raw_orders', 'derived_columns': {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}}
2021-05-03 12:54:47.804338 (Thread-1): source_model: raw_orders
2021-05-03 12:54:47.804468 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-ORDERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:47.804591 (Thread-1): hashed_columns: {'ORDER_PK': 'ORDERID', 'PRODUCT_PK': 'PRODUCTID', 'SHIPPER_PK': 'SHIPPERID', 'CUSTOMER_PK': 'CUSTOMERID', 'ORDER_PRODUCT_PK': ['PRODUCTID', 'ORDERID'], 'ORDER_SHIPPER_CUSTOMER_PK': ['ORDERID', 'SHIPPERID', 'CUSTOMERID'], 'ORDER_HASHDIFF': {'is_hashdiff': True, 'columns': ['ORDERID', 'CUSTOMERID', 'SHIPPERID', 'PRODUCTID', 'ORDERDATE', 'SHIPDATE', 'SHIPCITY', 'SHIPADDRESS', 'SHIPREGION', 'SHIPCOUNTRY', 'SHIPPOSTALCODE']}}
2021-05-03 12:54:47.817035 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:54:47.817154 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-05-03 12:54:47.817258 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:48.489824 (Thread-1): SQL status: SUCCESS 13 in 0.67 seconds
2021-05-03 12:54:48.496652 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:54:48.496765 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_orders
2021-05-03 12:54:48.643127 (Thread-1): SQL status: SUCCESS 13 in 0.15 seconds
2021-05-03 12:54:48.655611 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_orders"
2021-05-03 12:54:48.655944 (Thread-1): finished collecting timing info
2021-05-03 12:54:48.661822 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_orders"
2021-05-03 12:54:48.666786 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:54:48.666891 (Thread-1): On model.Dbt_demo.v_stg_orders: BEGIN
2021-05-03 12:54:48.805102 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:54:48.805288 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:54:48.805377 (Thread-1): On model.Dbt_demo.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_orders"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_orders  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_orders
),

derived_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-ORDERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''))) AS BINARY(16)) AS ORDER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS ORDER_PRODUCT_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^')
    ), '^^||^^||^^')) AS BINARY(16)) AS ORDER_SHIPPER_CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(ORDERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPCOUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPDATE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPOSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPREGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ORDERID,
    CUSTOMERID,
    SHIPPERID,
    PRODUCTID,
    ORDERDATE,
    SHIPDATE,
    SHIPADDRESS,
    SHIPCITY,
    SHIPREGION,
    SHIPPOSTALCODE,
    SHIPCOUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    ORDER_PK,
    PRODUCT_PK,
    SHIPPER_PK,
    CUSTOMER_PK,
    ORDER_PRODUCT_PK,
    ORDER_SHIPPER_CUSTOMER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:54:49.275505 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-05-03 12:54:49.276640 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-05-03 12:54:49.276818 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_orders".
2021-05-03 12:54:49.276911 (Thread-1): On model.Dbt_demo.v_stg_orders: COMMIT
2021-05-03 12:54:49.400178 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:54:49.404229 (Thread-1): finished collecting timing info
2021-05-03 12:54:49.404494 (Thread-1): On model.Dbt_demo.v_stg_orders: Close
2021-05-03 12:54:49.607675 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a26160c40>]}
2021-05-03 12:54:49.609093 (Thread-1): 12:54:49 | 6 of 23 OK created view model SS_STG.v_stg_orders.................... [SUCCESS 1 in 1.82s]
2021-05-03 12:54:49.609265 (Thread-1): Finished running node model.Dbt_demo.v_stg_orders
2021-05-03 12:54:49.609437 (Thread-1): Began running node model.Dbt_demo.v_stg_products
2021-05-03 12:54:49.610759 (Thread-1): 12:54:49 | 7 of 23 START view model SS_STG.v_stg_products....................... [RUN]
2021-05-03 12:54:49.611311 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:54:49.611478 (Thread-1): Compiling model.Dbt_demo.v_stg_products
2021-05-03 12:54:49.625683 (Thread-1): metadata dict: {'source_model': 'raw_products', 'derived_columns': {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}}
2021-05-03 12:54:49.625839 (Thread-1): source_model: raw_products
2021-05-03 12:54:49.625986 (Thread-1): derived_columns: {'CATEGORY': 'CATEGORYID', 'RECORD_SOURCE': '!TPCH-PRODUCTS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:49.626104 (Thread-1): hashed_columns: {'PRODUCT_PK': 'PRODUCTID', 'SUPPLIER_PK': 'SUPPLIERID', 'PRODUCT_SUPPLIER_PK': ['PRODUCTID', 'SUPPLIERID'], 'PRODUCT_HASHDIFF': {'is_hashdiff': True, 'columns': ['PRODUCTID', 'SUPPLIERID', 'PRODUCTNAME', 'CATEGORYID', 'QUANTITYPERUNIT', 'UNITPRICE', 'UNITSINSTOCK', 'UNITSONORDER', 'REORDERLEVEL']}}
2021-05-03 12:54:49.630105 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:54:49.630216 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-05-03 12:54:49.630316 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:50.597489 (Thread-1): SQL status: SUCCESS 11 in 0.97 seconds
2021-05-03 12:54:50.603755 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:54:50.603871 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_products
2021-05-03 12:54:50.756289 (Thread-1): SQL status: SUCCESS 11 in 0.15 seconds
2021-05-03 12:54:50.765853 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_products"
2021-05-03 12:54:50.766207 (Thread-1): finished collecting timing info
2021-05-03 12:54:50.772105 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_products"
2021-05-03 12:54:50.776103 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:54:50.776208 (Thread-1): On model.Dbt_demo.v_stg_products: BEGIN
2021-05-03 12:54:51.117316 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-05-03 12:54:51.117504 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:54:51.117600 (Thread-1): On model.Dbt_demo.v_stg_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_products"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_products  as (
    






    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_products
),

derived_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORYID AS CATEGORY,
    'TPCH-PRODUCTS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''))) AS BINARY(16)) AS PRODUCT_PK,
    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(NULLIF(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS BINARY(16)) AS PRODUCT_SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(CATEGORYID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PRODUCTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(QUANTITYPERUNIT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REORDERLEVEL AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITPRICE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSINSTOCK AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(UNITSONORDER AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS PRODUCT_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    PRODUCTID,
    PRODUCTNAME,
    SUPPLIERID,
    CATEGORYID,
    QUANTITYPERUNIT,
    UNITPRICE,
    UNITSINSTOCK,
    UNITSONORDER,
    REORDERLEVEL,
    CREATE_TS,
    UPDATE_TS,
    CATEGORY,
    RECORD_SOURCE,
    LOAD_DATE,
    PRODUCT_PK,
    SUPPLIER_PK,
    PRODUCT_SUPPLIER_PK,
    PRODUCT_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:54:51.518496 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-05-03 12:54:51.519635 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-05-03 12:54:51.519807 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_products".
2021-05-03 12:54:51.519897 (Thread-1): On model.Dbt_demo.v_stg_products: COMMIT
2021-05-03 12:54:51.638275 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:54:51.642293 (Thread-1): finished collecting timing info
2021-05-03 12:54:51.642556 (Thread-1): On model.Dbt_demo.v_stg_products: Close
2021-05-03 12:54:51.845070 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a26391e50>]}
2021-05-03 12:54:51.846521 (Thread-1): 12:54:51 | 7 of 23 OK created view model SS_STG.v_stg_products.................. [SUCCESS 1 in 2.23s]
2021-05-03 12:54:51.846693 (Thread-1): Finished running node model.Dbt_demo.v_stg_products
2021-05-03 12:54:51.846863 (Thread-1): Began running node model.Dbt_demo.v_stg_customers
2021-05-03 12:54:51.848147 (Thread-1): 12:54:51 | 8 of 23 START view model SS_STG.v_stg_customers...................... [RUN]
2021-05-03 12:54:51.848658 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:54:51.848805 (Thread-1): Compiling model.Dbt_demo.v_stg_customers
2021-05-03 12:54:51.862438 (Thread-1): metadata dict: {'source_model': 'raw_customers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}}
2021-05-03 12:54:51.862602 (Thread-1): source_model: raw_customers
2021-05-03 12:54:51.862726 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-CUSTOMERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:51.862845 (Thread-1): hashed_columns: {'CUSTOMER_PK': 'CUSTOMERID', 'CUSTOMER_HASHDIFF': {'is_hashdiff': True, 'columns': ['CUSTOMERID', 'CUSTOMERNAME', 'CONTACT', 'ADDRESS', 'CITY', 'REGION', 'COUNTRY', 'POSTALCODE']}}
2021-05-03 12:54:51.866923 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:54:51.867033 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-05-03 12:54:51.867135 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:52.808610 (Thread-1): SQL status: SUCCESS 10 in 0.94 seconds
2021-05-03 12:54:52.814722 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:54:52.814834 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_customers
2021-05-03 12:54:52.969680 (Thread-1): SQL status: SUCCESS 10 in 0.15 seconds
2021-05-03 12:54:52.977240 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_customers"
2021-05-03 12:54:52.977579 (Thread-1): finished collecting timing info
2021-05-03 12:54:52.983305 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_customers"
2021-05-03 12:54:52.986342 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:54:52.986447 (Thread-1): On model.Dbt_demo.v_stg_customers: BEGIN
2021-05-03 12:54:53.162199 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:54:53.162389 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:54:53.162483 (Thread-1): On model.Dbt_demo.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_customers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_customers  as (
    










    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_customers
),

derived_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-CUSTOMERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''))) AS BINARY(16)) AS CUSTOMER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CITY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACT AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERID AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CUSTOMERNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    CUSTOMERID,
    CUSTOMERNAME,
    CONTACT,
    ADDRESS,
    CITY,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:54:53.503794 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-05-03 12:54:53.504937 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-05-03 12:54:53.505112 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_customers".
2021-05-03 12:54:53.505203 (Thread-1): On model.Dbt_demo.v_stg_customers: COMMIT
2021-05-03 12:54:53.636908 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:54:53.641268 (Thread-1): finished collecting timing info
2021-05-03 12:54:53.641536 (Thread-1): On model.Dbt_demo.v_stg_customers: Close
2021-05-03 12:54:53.871521 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2629ce80>]}
2021-05-03 12:54:53.872938 (Thread-1): 12:54:53 | 8 of 23 OK created view model SS_STG.v_stg_customers................. [SUCCESS 1 in 2.02s]
2021-05-03 12:54:53.873111 (Thread-1): Finished running node model.Dbt_demo.v_stg_customers
2021-05-03 12:54:53.873285 (Thread-1): Began running node model.Dbt_demo.v_stg_shippers
2021-05-03 12:54:53.874534 (Thread-1): 12:54:53 | 9 of 23 START view model SS_STG.v_stg_shippers....................... [RUN]
2021-05-03 12:54:53.875211 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:54:53.875383 (Thread-1): Compiling model.Dbt_demo.v_stg_shippers
2021-05-03 12:54:53.888392 (Thread-1): metadata dict: {'source_model': 'raw_shippers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}}
2021-05-03 12:54:53.888557 (Thread-1): source_model: raw_shippers
2021-05-03 12:54:53.888675 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SHIPPERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:53.888808 (Thread-1): hashed_columns: {'SHIPPER_PK': 'SHIPPERID', 'SHIPPER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SHIPPERID', 'COMPANYNAME', 'PHONE']}}
2021-05-03 12:54:53.892943 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:54:53.893054 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-05-03 12:54:53.893156 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:54.768420 (Thread-1): SQL status: SUCCESS 5 in 0.88 seconds
2021-05-03 12:54:54.775417 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:54:54.775552 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_shippers
2021-05-03 12:54:54.921099 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-05-03 12:54:54.926656 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_shippers"
2021-05-03 12:54:54.926995 (Thread-1): finished collecting timing info
2021-05-03 12:54:54.932945 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_shippers"
2021-05-03 12:54:54.935144 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:54:54.935249 (Thread-1): On model.Dbt_demo.v_stg_shippers: BEGIN
2021-05-03 12:54:55.097916 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:54:55.098128 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:54:55.098217 (Thread-1): On model.Dbt_demo.v_stg_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_shippers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_shippers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_shippers
),

derived_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SHIPPERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''))) AS BINARY(16)) AS SHIPPER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(PHONE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SHIPPERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SHIPPER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SHIPPERID,
    COMPANYNAME,
    PHONE,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SHIPPER_PK,
    SHIPPER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:54:55.402673 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:54:55.403844 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-05-03 12:54:55.404018 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_shippers".
2021-05-03 12:54:55.404110 (Thread-1): On model.Dbt_demo.v_stg_shippers: COMMIT
2021-05-03 12:54:55.535361 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:54:55.539358 (Thread-1): finished collecting timing info
2021-05-03 12:54:55.539623 (Thread-1): On model.Dbt_demo.v_stg_shippers: Close
2021-05-03 12:54:55.725480 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a262f92e0>]}
2021-05-03 12:54:55.726934 (Thread-1): 12:54:55 | 9 of 23 OK created view model SS_STG.v_stg_shippers.................. [SUCCESS 1 in 1.85s]
2021-05-03 12:54:55.727112 (Thread-1): Finished running node model.Dbt_demo.v_stg_shippers
2021-05-03 12:54:55.727283 (Thread-1): Began running node model.Dbt_demo.v_stg_suppliers
2021-05-03 12:54:55.728579 (Thread-1): 12:54:55 | 10 of 23 START view model SS_STG.v_stg_suppliers..................... [RUN]
2021-05-03 12:54:55.729063 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:54:55.729205 (Thread-1): Compiling model.Dbt_demo.v_stg_suppliers
2021-05-03 12:54:55.742996 (Thread-1): metadata dict: {'source_model': 'raw_suppliers', 'derived_columns': {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}, 'hashed_columns': {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}}
2021-05-03 12:54:55.743157 (Thread-1): source_model: raw_suppliers
2021-05-03 12:54:55.743290 (Thread-1): derived_columns: {'RECORD_SOURCE': '!TPCH-SUPPLIERS', 'LOAD_DATE': 'CURRENT_TIMESTAMP()'}
2021-05-03 12:54:55.743412 (Thread-1): hashed_columns: {'SUPPLIER_PK': 'SUPPLIERID', 'SUPPLIER_HASHDIFF': {'is_hashdiff': True, 'columns': ['SUPPLIERID', 'COMPANYNAME', 'ADDRESS', 'REGION', 'COUNTRY', 'POSTALCODE', 'CONTACTNAME', 'CONTACTTITLE']}}
2021-05-03 12:54:55.747453 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:54:55.747564 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-05-03 12:54:55.747665 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:56.385477 (Thread-1): SQL status: SUCCESS 10 in 0.64 seconds
2021-05-03 12:54:56.391562 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:54:56.391674 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
2021-05-03 12:54:56.532291 (Thread-1): SQL status: SUCCESS 10 in 0.14 seconds
2021-05-03 12:54:56.541297 (Thread-1): Writing injected SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-05-03 12:54:56.541662 (Thread-1): finished collecting timing info
2021-05-03 12:54:56.547210 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.v_stg_suppliers"
2021-05-03 12:54:56.550329 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:54:56.550435 (Thread-1): On model.Dbt_demo.v_stg_suppliers: BEGIN
2021-05-03 12:54:56.703180 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:54:56.703362 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:54:56.703447 (Thread-1): On model.Dbt_demo.v_stg_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.v_stg_suppliers"} */

  create or replace  view DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers  as (
    







    -- Generated by dbtvault.



WITH source_data AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS

    FROM DATAVAULTDEMO_DB.SS_RAW.raw_suppliers
),

derived_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    'TPCH-SUPPLIERS' AS RECORD_SOURCE,
    CURRENT_TIMESTAMP() AS LOAD_DATE

    FROM source_data
),

hashed_columns AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,

    CAST((MD5_BINARY(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''))) AS BINARY(16)) AS SUPPLIER_PK,
    CAST(MD5_BINARY(CONCAT_WS('||',
        IFNULL(NULLIF(UPPER(TRIM(CAST(ADDRESS AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COMPANYNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTNAME AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(CONTACTTITLE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(COUNTRY AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(POSTALCODE AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(REGION AS VARCHAR))), ''), '^^'),
        IFNULL(NULLIF(UPPER(TRIM(CAST(SUPPLIERID AS VARCHAR))), ''), '^^')
    )) AS BINARY(16)) AS SUPPLIER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    SUPPLIERID,
    COMPANYNAME,
    CONTACTNAME,
    CONTACTTITLE,
    ADDRESS,
    REGION,
    POSTALCODE,
    COUNTRY,
    CREATE_TS,
    UPDATE_TS,
    RECORD_SOURCE,
    LOAD_DATE,
    SUPPLIER_PK,
    SUPPLIER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
  );
2021-05-03 12:54:57.264976 (Thread-1): SQL status: SUCCESS 1 in 0.56 seconds
2021-05-03 12:54:57.266162 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-05-03 12:54:57.266337 (Thread-1): Using snowflake connection "model.Dbt_demo.v_stg_suppliers".
2021-05-03 12:54:57.266427 (Thread-1): On model.Dbt_demo.v_stg_suppliers: COMMIT
2021-05-03 12:54:57.375951 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:54:57.380233 (Thread-1): finished collecting timing info
2021-05-03 12:54:57.380499 (Thread-1): On model.Dbt_demo.v_stg_suppliers: Close
2021-05-03 12:54:57.568559 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2668b070>]}
2021-05-03 12:54:57.570007 (Thread-1): 12:54:57 | 10 of 23 OK created view model SS_STG.v_stg_suppliers................ [SUCCESS 1 in 1.84s]
2021-05-03 12:54:57.570180 (Thread-1): Finished running node model.Dbt_demo.v_stg_suppliers
2021-05-03 12:54:57.570346 (Thread-1): Began running node model.Dbt_demo.hub_orders
2021-05-03 12:54:57.571616 (Thread-1): 12:54:57 | 11 of 23 START incremental model SS_RAW_VLT.hub_orders............... [RUN]
2021-05-03 12:54:57.572141 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:54:57.572268 (Thread-1): Compiling model.Dbt_demo.hub_orders
2021-05-03 12:54:57.587606 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_orders"
2021-05-03 12:54:57.587929 (Thread-1): finished collecting timing info
2021-05-03 12:54:57.630367 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:54:57.630517 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PK, ORDERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:54:57.630632 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:54:59.328279 (Thread-1): SQL status: SUCCESS 1 in 1.70 seconds
2021-05-03 12:54:59.331811 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:54:59.331922 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
2021-05-03 12:54:59.483871 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-05-03 12:54:59.487852 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:54:59.487971 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-05-03 12:54:59.673167 (Thread-1): SQL status: SUCCESS 4 in 0.19 seconds
2021-05-03 12:54:59.750283 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:54:59.750459 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders
2021-05-03 12:54:59.881556 (Thread-1): SQL status: SUCCESS 4 in 0.13 seconds
2021-05-03 12:54:59.897447 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_orders"
2021-05-03 12:54:59.898254 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:54:59.898362 (Thread-1): On model.Dbt_demo.hub_orders: BEGIN
2021-05-03 12:55:00.045880 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:55:00.046102 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:55:00.046192 (Thread-1): On model.Dbt_demo.hub_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_orders"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders ("ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PK", "ORDERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_orders__dbt_tmp
        );
2021-05-03 12:55:00.402351 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:55:00.403542 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-05-03 12:55:00.403717 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_orders".
2021-05-03 12:55:00.403809 (Thread-1): On model.Dbt_demo.hub_orders: COMMIT
2021-05-03 12:55:00.808838 (Thread-1): SQL status: SUCCESS 1 in 0.40 seconds
2021-05-03 12:55:00.817530 (Thread-1): finished collecting timing info
2021-05-03 12:55:00.817799 (Thread-1): On model.Dbt_demo.hub_orders: Close
2021-05-03 12:55:01.037810 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a267e63d0>]}
2021-05-03 12:55:01.039260 (Thread-1): 12:55:01 | 11 of 23 OK created incremental model SS_RAW_VLT.hub_orders.......... [SUCCESS 0 in 3.47s]
2021-05-03 12:55:01.039430 (Thread-1): Finished running node model.Dbt_demo.hub_orders
2021-05-03 12:55:01.039592 (Thread-1): Began running node model.Dbt_demo.link_order_prod
2021-05-03 12:55:01.040711 (Thread-1): 12:55:01 | 12 of 23 START incremental model SS_RAW_VLT.link_order_prod.......... [RUN]
2021-05-03 12:55:01.041155 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:01.041280 (Thread-1): Compiling model.Dbt_demo.link_order_prod
2021-05-03 12:55:01.054227 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_prod"
2021-05-03 12:55:01.054538 (Thread-1): finished collecting timing info
2021-05-03 12:55:01.062060 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:01.062176 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_PRODUCT_PK, PRODUCT_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PRODUCT_PK, a.PRODUCT_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod AS d
    ON a.ORDER_PRODUCT_PK = d.ORDER_PRODUCT_PK
    WHERE d.ORDER_PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:55:01.062287 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:55:02.825261 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2021-05-03 12:55:02.828876 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:02.828994 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
2021-05-03 12:55:02.976381 (Thread-1): SQL status: SUCCESS 5 in 0.15 seconds
2021-05-03 12:55:02.981597 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:02.981716 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-05-03 12:55:03.927284 (Thread-1): SQL status: SUCCESS 5 in 0.95 seconds
2021-05-03 12:55:03.931391 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:03.931523 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod
2021-05-03 12:55:04.056146 (Thread-1): SQL status: SUCCESS 5 in 0.12 seconds
2021-05-03 12:55:04.057989 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_prod"
2021-05-03 12:55:04.059050 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:04.059172 (Thread-1): On model.Dbt_demo.link_order_prod: BEGIN
2021-05-03 12:55:04.278210 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:55:04.278408 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:04.278501 (Thread-1): On model.Dbt_demo.link_order_prod: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_prod"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod ("ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_PRODUCT_PK", "PRODUCT_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_prod__dbt_tmp
        );
2021-05-03 12:55:04.609008 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:55:04.610259 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-05-03 12:55:04.610455 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_prod".
2021-05-03 12:55:04.610552 (Thread-1): On model.Dbt_demo.link_order_prod: COMMIT
2021-05-03 12:55:04.835136 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:55:04.839399 (Thread-1): finished collecting timing info
2021-05-03 12:55:04.839683 (Thread-1): On model.Dbt_demo.link_order_prod: Close
2021-05-03 12:55:05.066588 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2665e850>]}
2021-05-03 12:55:05.068054 (Thread-1): 12:55:05 | 12 of 23 OK created incremental model SS_RAW_VLT.link_order_prod..... [SUCCESS 0 in 4.03s]
2021-05-03 12:55:05.068235 (Thread-1): Finished running node model.Dbt_demo.link_order_prod
2021-05-03 12:55:05.068415 (Thread-1): Began running node model.Dbt_demo.link_order_ship_cust
2021-05-03 12:55:05.070041 (Thread-1): 12:55:05 | 13 of 23 START incremental model SS_RAW_VLT.link_order_ship_cust..... [RUN]
2021-05-03 12:55:05.070369 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:05.070499 (Thread-1): Compiling model.Dbt_demo.link_order_ship_cust
2021-05-03 12:55:05.083698 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-05-03 12:55:05.084023 (Thread-1): finished collecting timing info
2021-05-03 12:55:05.091985 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:05.092110 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_SHIPPER_CUSTOMER_PK, SHIPPER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_SHIPPER_CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_SHIPPER_CUSTOMER_PK, a.SHIPPER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust AS d
    ON a.ORDER_SHIPPER_CUSTOMER_PK = d.ORDER_SHIPPER_CUSTOMER_PK
    WHERE d.ORDER_SHIPPER_CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:55:05.092221 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:55:06.621200 (Thread-1): SQL status: SUCCESS 1 in 1.53 seconds
2021-05-03 12:55:06.624738 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:06.624852 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
2021-05-03 12:55:06.774022 (Thread-1): SQL status: SUCCESS 6 in 0.15 seconds
2021-05-03 12:55:06.779150 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:06.779265 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-05-03 12:55:06.931650 (Thread-1): SQL status: SUCCESS 6 in 0.15 seconds
2021-05-03 12:55:06.935654 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:06.935764 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust
2021-05-03 12:55:07.088114 (Thread-1): SQL status: SUCCESS 6 in 0.15 seconds
2021-05-03 12:55:07.089943 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_order_ship_cust"
2021-05-03 12:55:07.090791 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:07.090900 (Thread-1): On model.Dbt_demo.link_order_ship_cust: BEGIN
2021-05-03 12:55:07.255003 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:55:07.255192 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:07.255279 (Thread-1): On model.Dbt_demo.link_order_ship_cust: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_order_ship_cust"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust ("ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "ORDER_SHIPPER_CUSTOMER_PK", "SHIPPER_PK", "CUSTOMER_PK", "ORDER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_order_ship_cust__dbt_tmp
        );
2021-05-03 12:55:07.500323 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:55:07.501801 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-05-03 12:55:07.502005 (Thread-1): Using snowflake connection "model.Dbt_demo.link_order_ship_cust".
2021-05-03 12:55:07.502101 (Thread-1): On model.Dbt_demo.link_order_ship_cust: COMMIT
2021-05-03 12:55:07.689023 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:55:07.693162 (Thread-1): finished collecting timing info
2021-05-03 12:55:07.693431 (Thread-1): On model.Dbt_demo.link_order_ship_cust: Close
2021-05-03 12:55:08.008906 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a264cff70>]}
2021-05-03 12:55:08.010361 (Thread-1): 12:55:08 | 13 of 23 OK created incremental model SS_RAW_VLT.link_order_ship_cust [SUCCESS 0 in 2.94s]
2021-05-03 12:55:08.010532 (Thread-1): Finished running node model.Dbt_demo.link_order_ship_cust
2021-05-03 12:55:08.010707 (Thread-1): Began running node model.Dbt_demo.sat_orders
2021-05-03 12:55:08.011950 (Thread-1): 12:55:08 | 14 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_orders.... [RUN]
2021-05-03 12:55:08.012259 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:08.012388 (Thread-1): Compiling model.Dbt_demo.sat_orders
2021-05-03 12:55:08.034282 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_orders"
2021-05-03 12:55:08.034602 (Thread-1): finished collecting timing info
2021-05-03 12:55:08.099085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:08.099258 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:55:08.099364 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:55:09.236803 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-05-03 12:55:09.266083 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:09.266250 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:55:09.052000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:55:09.052000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_orders
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:55:09.493723 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:55:09.497466 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:09.497577 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:09.635225 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:09.644017 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:09.644147 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:09.771850 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:55:09.785003 (Thread-1): 12:55:09 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:09.804099 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:09.804267 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:09.945687 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:55:09.945879 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:09.945993 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:10.937558 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-05-03 12:55:10.941657 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:10.941768 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:14.271628 (Thread-1): SQL status: SUCCESS 12 in 3.33 seconds
2021-05-03 12:55:14.276004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:14.276122 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:14.400860 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:55:14.403402 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:14.403511 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:14.704368 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:55:14.705626 (Thread-1): 12:55:14 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:14.705836 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:14.706034 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:14.706126 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:15.006702 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:55:15.007808 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:15.007914 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:15.128903 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:15.130686 (Thread-1): 12:55:15 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:15.135985 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:15.136094 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:15.291396 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:55:15.291582 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:15.291669 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:16.398332 (Thread-1): SQL status: SUCCESS 1 in 1.11 seconds
2021-05-03 12:55:16.403808 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:16.403930 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:17.688569 (Thread-1): SQL status: SUCCESS 12 in 1.28 seconds
2021-05-03 12:55:17.692845 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:17.692958 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:17.823269 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:55:17.825540 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:17.825648 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:18.373001 (Thread-1): SQL status: SUCCESS 0 in 0.55 seconds
2021-05-03 12:55:18.374714 (Thread-1): 12:55:18 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:18.374933 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:18.375114 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:18.375209 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:18.576191 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:55:18.577324 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:18.577436 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:18.703240 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:55:18.704704 (Thread-1): 12:55:18 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:18.710576 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:18.710693 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:18.863735 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:55:18.863944 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:18.864039 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:24.801210 (Thread-1): SQL status: SUCCESS 1 in 5.94 seconds
2021-05-03 12:55:24.805290 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:24.805412 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:24.956859 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:55:24.961516 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:24.961635 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:27.201246 (Thread-1): SQL status: SUCCESS 12 in 2.24 seconds
2021-05-03 12:55:27.203544 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:27.203655 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:30.351132 (Thread-1): SQL status: SUCCESS 0 in 3.15 seconds
2021-05-03 12:55:30.352470 (Thread-1): 12:55:30 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:30.352679 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:30.352856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:30.352947 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:30.556592 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:55:30.558066 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:30.558174 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:30.684197 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:55:30.685586 (Thread-1): 12:55:30 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:30.690943 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:30.691057 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:30.837323 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:55:30.837514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:30.837602 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:32.103326 (Thread-1): SQL status: SUCCESS 1 in 1.27 seconds
2021-05-03 12:55:32.107521 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:32.107633 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:32.272066 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:55:32.276448 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:32.276579 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:32.417800 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:32.420094 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:32.420211 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:32.751492 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:55:32.752775 (Thread-1): 12:55:32 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:32.752992 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:32.753167 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:32.753257 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:32.973622 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:55:32.974811 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:32.974929 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:33.099285 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:33.100799 (Thread-1): 12:55:33 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:33.106614 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:33.106730 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:33.268050 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:55:33.268237 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:33.268328 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:36.199046 (Thread-1): SQL status: SUCCESS 1 in 2.93 seconds
2021-05-03 12:55:36.203119 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:36.203239 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:36.499230 (Thread-1): SQL status: SUCCESS 12 in 0.30 seconds
2021-05-03 12:55:36.503837 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:36.503963 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:36.632509 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:55:36.634871 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:36.634985 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:37.063813 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-05-03 12:55:37.065500 (Thread-1): 12:55:37 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:37.065725 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:37.065908 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:37.066029 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:37.471548 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-05-03 12:55:37.472684 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:37.472795 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:37.592080 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:37.593535 (Thread-1): 12:55:37 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:37.599008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:37.599122 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:37.926409 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-05-03 12:55:37.926607 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:37.926700 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:39.087668 (Thread-1): SQL status: SUCCESS 1 in 1.16 seconds
2021-05-03 12:55:39.091703 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:39.091822 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:39.236984 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:55:39.241603 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:39.241725 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:39.384110 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:39.386439 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:39.386556 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:39.628676 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:55:39.630026 (Thread-1): 12:55:39 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:39.630248 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:39.630432 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:39.630542 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:39.816031 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:55:39.817175 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:39.817293 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:39.942289 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:39.943738 (Thread-1): 12:55:39 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:39.949166 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:39.949281 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:40.092870 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:55:40.093060 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:40.093149 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:41.069490 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-05-03 12:55:41.075164 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:41.075277 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:41.239915 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:55:41.244366 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:41.244479 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:41.381631 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:41.383940 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:41.384049 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:41.752129 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-05-03 12:55:41.753731 (Thread-1): 12:55:41 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:41.753936 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:41.754135 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:41.754226 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:42.071006 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:55:42.072102 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:42.072208 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:42.196180 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:42.197560 (Thread-1): 12:55:42 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:42.203281 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:42.203390 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:42.362353 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:55:42.362543 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:42.362630 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:43.329217 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 12:55:43.333166 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:43.333278 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:43.477089 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:43.481651 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:43.481762 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:43.624387 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:43.626689 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:43.626797 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:44.060341 (Thread-1): SQL status: SUCCESS 0 in 0.43 seconds
2021-05-03 12:55:44.061624 (Thread-1): 12:55:44 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:44.061837 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:44.062032 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:44.062124 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:44.282197 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:55:44.283664 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:44.283770 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:44.418315 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:55:44.419701 (Thread-1): 12:55:44 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:44.425051 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:44.425164 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:44.607199 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:55:44.607393 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:44.607480 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:45.537880 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-05-03 12:55:45.542082 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:45.542194 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:45.693643 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:55:45.783106 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:45.783277 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:45.933631 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:55:45.935926 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:45.936037 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:46.202815 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:55:46.204420 (Thread-1): 12:55:46 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:46.204626 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:46.204800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:46.204889 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:46.439738 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:55:46.440835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:46.440940 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:46.560364 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:46.561762 (Thread-1): 12:55:46 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:46.569206 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:46.569323 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:46.750420 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:55:46.750610 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:46.750697 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:47.713006 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 12:55:47.716871 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:47.716985 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:47.869665 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:55:47.874214 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:47.874327 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:48.015492 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:48.017928 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:48.018069 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:48.318820 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:55:48.320141 (Thread-1): 12:55:48 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:48.320351 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:48.320529 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:48.320624 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:48.506347 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:55:48.507826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:48.507942 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:48.632500 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:48.633916 (Thread-1): 12:55:48 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:48.639281 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:48.639391 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:49.885487 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 12:55:49.885674 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:49.885761 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:51.076864 (Thread-1): SQL status: SUCCESS 1 in 1.19 seconds
2021-05-03 12:55:51.081049 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:51.081161 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:51.244926 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:55:51.249334 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:51.249445 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:51.417560 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:55:51.420110 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:51.420221 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:51.787392 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-05-03 12:55:51.788740 (Thread-1): 12:55:51 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:51.788966 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:51.789150 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:51.789246 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:51.999789 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:55:52.000944 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:52.001056 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:52.130525 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:55:52.131984 (Thread-1): 12:55:52 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:52.137805 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:52.137920 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:52.294318 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:55:52.294514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:52.294607 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:53.435755 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-05-03 12:55:53.439732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:53.439842 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:53.594050 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:55:53.600296 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:53.600424 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:53.733602 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:55:53.735947 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:53.736062 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:53.979338 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:55:53.980669 (Thread-1): 12:55:53 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:53.980885 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:53.981067 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:53.981172 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:54.196851 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:55:54.198423 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:54.198537 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:54.336749 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:55:54.338236 (Thread-1): 12:55:54 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:54.343684 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:54.343800 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:54.491666 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:55:54.491863 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:54.491955 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:55.454154 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 12:55:55.458083 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:55.458202 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:55.618495 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:55:55.623048 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:55.623172 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:55.758698 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:55.761017 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:55.761131 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:56.045838 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:55:56.047169 (Thread-1): 12:55:56 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:56.047378 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:56.047554 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:56.047647 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:56.246472 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:55:56.247573 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:56.247684 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:56.371535 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:55:56.373348 (Thread-1): 12:55:56 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:56.378839 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:56.378952 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:56.527575 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:55:56.527762 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:56.527849 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:57.481464 (Thread-1): SQL status: SUCCESS 1 in 0.95 seconds
2021-05-03 12:55:57.485463 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:57.485579 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:57.625349 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:57.629648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:57.629758 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:55:57.768684 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:55:57.770958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:57.771066 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:55:58.042888 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:55:58.044469 (Thread-1): 12:55:58 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:55:58.044681 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:58.044856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:58.044946 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:55:58.239858 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:55:58.240950 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:58.241057 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:55:58.383887 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:55:58.385261 (Thread-1): 12:55:58 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_orders]
2021-05-03 12:55:58.390947 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:58.391055 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:55:58.527995 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:55:58.528183 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:58.528270 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:55:59.775795 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 12:55:59.781165 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:59.781280 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:55:59.946352 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:55:59.950843 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:55:59.950955 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:00.089929 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:56:00.092228 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:00.092336 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:00.487623 (Thread-1): SQL status: SUCCESS 0 in 0.40 seconds
2021-05-03 12:56:00.488891 (Thread-1): 12:56:00 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:00.489093 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:00.489275 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:00.489364 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:00.696147 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:56:00.697610 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:00.697717 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:00.819620 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:00.821017 (Thread-1): 12:56:00 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:00.826425 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:00.826534 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:00.980649 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:56:00.980839 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:00.980927 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:02.127404 (Thread-1): SQL status: SUCCESS 1 in 1.15 seconds
2021-05-03 12:56:02.131631 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:02.131743 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:02.284014 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:02.288429 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:02.288543 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:02.421647 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:56:02.424325 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:02.424442 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:02.690669 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:56:02.691982 (Thread-1): 12:56:02 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:02.692190 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:02.692363 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:02.692452 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:02.875214 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:56:02.876314 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:02.876417 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:02.998466 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:03.000255 (Thread-1): 12:56:03 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:03.005601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:03.005715 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:03.189918 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:56:03.190135 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:03.190223 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:04.057037 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 12:56:04.060996 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:04.061108 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:04.207148 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:04.211399 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:04.211509 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:04.345775 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:56:04.348047 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:04.348161 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:04.663407 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:56:04.666748 (Thread-1): 12:56:04 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:04.666960 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:04.667133 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:04.667222 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:04.851183 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:56:04.852287 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:04.852392 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:04.987353 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:56:04.988752 (Thread-1): 12:56:04 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:04.994453 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:04.994563 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:05.140410 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:56:05.140594 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:05.140680 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:07.541171 (Thread-1): SQL status: SUCCESS 1 in 2.40 seconds
2021-05-03 12:56:07.545024 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:07.545134 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:07.698799 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:07.703318 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:07.703436 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:11.133414 (Thread-1): SQL status: SUCCESS 12 in 3.43 seconds
2021-05-03 12:56:11.135744 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:11.135852 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:11.397303 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:56:11.398628 (Thread-1): 12:56:11 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:11.398833 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:11.399005 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:11.399094 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:11.588888 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:56:11.590019 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:11.590132 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:11.711861 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:11.713773 (Thread-1): 12:56:11 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:11.719073 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:11.719181 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:12.023981 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:56:12.024170 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:12.024256 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:20.463831 (Thread-1): SQL status: SUCCESS 1 in 8.44 seconds
2021-05-03 12:56:20.467856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:20.467969 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:20.615912 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:20.620256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:20.620366 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:20.766501 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:20.768757 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:20.768863 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:21.048638 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:56:21.050269 (Thread-1): 12:56:21 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:21.050477 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:21.050661 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:21.050752 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:21.260128 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:56:21.261240 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:21.261345 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:21.382361 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:21.383777 (Thread-1): 12:56:21 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:21.389503 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:21.389611 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:21.534623 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:56:21.534805 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:21.534891 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:26.404726 (Thread-1): SQL status: SUCCESS 1 in 4.87 seconds
2021-05-03 12:56:26.408693 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:26.408818 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:26.552862 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:56:26.559269 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:26.559399 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:26.707163 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:26.709422 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:26.709536 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:27.018614 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:56:27.019883 (Thread-1): 12:56:27 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:27.020085 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:27.020260 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:27.020350 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:27.342591 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 12:56:27.344061 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:27.344167 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:27.535631 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:56:27.537065 (Thread-1): 12:56:27 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:27.542443 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:27.542554 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:27.758851 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:56:27.759034 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:27.759119 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:29.592214 (Thread-1): SQL status: SUCCESS 1 in 1.83 seconds
2021-05-03 12:56:29.596418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:29.596532 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:29.742169 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:29.746573 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:29.746691 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:30.032189 (Thread-1): SQL status: SUCCESS 12 in 0.29 seconds
2021-05-03 12:56:30.034519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:30.034634 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:30.418747 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-05-03 12:56:30.420014 (Thread-1): 12:56:30 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:30.420216 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:30.420388 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:30.420477 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:30.610924 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:56:30.612027 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:30.612131 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:30.729515 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:30.730925 (Thread-1): 12:56:30 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:30.736600 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:30.736709 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:30.894926 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:56:30.895113 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:30.895199 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:32.052808 (Thread-1): SQL status: SUCCESS 1 in 1.16 seconds
2021-05-03 12:56:32.056765 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:32.056876 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:32.435213 (Thread-1): SQL status: SUCCESS 12 in 0.38 seconds
2021-05-03 12:56:32.439711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:32.439834 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:32.567691 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:56:32.570001 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:32.570112 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:33.149510 (Thread-1): SQL status: SUCCESS 0 in 0.58 seconds
2021-05-03 12:56:33.151138 (Thread-1): 12:56:33 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:33.151349 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:33.151521 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:33.151609 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:35.452153 (Thread-1): SQL status: SUCCESS 1 in 2.30 seconds
2021-05-03 12:56:35.453285 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:35.453406 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:35.583906 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:56:35.585339 (Thread-1): 12:56:35 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:35.592760 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:35.592873 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:35.743903 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:56:35.744096 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:35.744193 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:36.779704 (Thread-1): SQL status: SUCCESS 1 in 1.04 seconds
2021-05-03 12:56:36.783582 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:36.783692 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:36.942925 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:56:36.947377 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:36.947500 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:37.067822 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:56:37.070129 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:37.070249 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:37.338563 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:56:37.339832 (Thread-1): 12:56:37 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:37.340036 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:37.340209 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:37.340298 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:37.541876 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:56:37.543027 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:37.543132 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:37.671117 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:56:37.672924 (Thread-1): 12:56:37 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:37.678232 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:37.678340 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:37.831594 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:56:37.831782 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:37.831869 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:38.736722 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:56:38.740725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:38.740838 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:38.904584 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:56:38.908885 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:38.908998 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:39.038944 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:56:39.041232 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:39.041347 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:39.345925 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:56:39.347560 (Thread-1): 12:56:39 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:39.347768 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:39.347946 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:39.348038 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:39.540496 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:56:39.541617 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:39.541726 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:39.659657 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:39.661056 (Thread-1): 12:56:39 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:39.666811 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:39.666923 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:39.823280 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:56:39.823462 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:39.823547 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:40.828322 (Thread-1): SQL status: SUCCESS 1 in 1.00 seconds
2021-05-03 12:56:40.832195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:40.832304 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:40.979252 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:40.985437 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:40.985559 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:41.136978 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:41.139261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:41.139376 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:41.422897 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:56:41.424180 (Thread-1): 12:56:41 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:41.424382 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:41.424555 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:41.424650 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:41.616227 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:56:41.617322 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:41.617427 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:41.742451 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:41.744309 (Thread-1): 12:56:41 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:41.749601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:41.749709 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:44.915571 (Thread-1): SQL status: SUCCESS 1 in 3.17 seconds
2021-05-03 12:56:44.915762 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:44.915854 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:46.678238 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2021-05-03 12:56:46.682259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:46.682374 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:46.942824 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-05-03 12:56:46.947186 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:46.947306 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:47.101730 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:47.104031 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:47.104139 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:47.371597 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:56:47.373199 (Thread-1): 12:56:47 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:47.373402 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:47.373575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:47.373668 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:47.555613 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:56:47.556727 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:47.556832 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:47.682202 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:56:47.683626 (Thread-1): 12:56:47 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:47.689359 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:47.689470 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:47.837606 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:56:47.837788 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:47.837874 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:48.750118 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:56:48.754042 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:48.754155 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:48.898209 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:56:48.902728 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:48.902850 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:49.224376 (Thread-1): SQL status: SUCCESS 12 in 0.32 seconds
2021-05-03 12:56:49.342341 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:49.342510 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:49.592844 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:56:49.594151 (Thread-1): 12:56:49 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:49.594357 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:49.594530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:49.594616 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:49.793887 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:56:49.795024 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:49.795127 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:49.936793 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:56:49.938706 (Thread-1): 12:56:49 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:49.943987 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:49.944094 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:50.093343 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:56:50.093528 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:50.093613 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:54.558921 (Thread-1): SQL status: SUCCESS 1 in 4.47 seconds
2021-05-03 12:56:54.563041 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:54.563159 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:54.705871 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:56:54.710085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:54.710201 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:54.860636 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:54.862951 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:54.863057 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:55.122911 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:56:55.124517 (Thread-1): 12:56:55 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:55.124724 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:55.124902 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:55.124991 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:55.321770 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:56:55.322880 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:55.322985 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:55.459500 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:56:55.460968 (Thread-1): 12:56:55 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:55.466798 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:55.466911 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:55.611988 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:56:55.612173 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:55.612260 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:56.525472 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:56:56.529663 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:56.529787 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:56.680687 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:56.685235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:56.685361 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:56.818183 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:56:56.820515 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:56.820627 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:57.111102 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:56:57.112412 (Thread-1): 12:56:57 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:57.112623 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:57.112801 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:57.112893 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:57.343647 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:56:57.344775 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:57.344882 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:57.473597 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:56:57.475450 (Thread-1): 12:56:57 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:57.480844 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:57.480955 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:57.619295 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:56:57.619491 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:57.620433 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:56:58.615481 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-05-03 12:56:58.619489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:58.619601 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:56:58.767397 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:56:58.771638 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:58.771758 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:56:58.914226 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:56:58.916476 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:58.916584 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:56:59.267085 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:56:59.268687 (Thread-1): 12:56:59 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:56:59.268892 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:59.269073 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:59.269164 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:56:59.456983 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:56:59.458105 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:59.458212 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:32.750000'))) AS period_of_load
2021-05-03 12:56:59.581570 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:56:59.582993 (Thread-1): 12:56:59 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_orders]
2021-05-03 12:56:59.588289 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:59.588404 (Thread-1): On model.Dbt_demo.sat_orders: BEGIN
2021-05-03 12:56:59.740744 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:56:59.740936 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:56:59.741023 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp  as
      (select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_orders AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:32.750000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:32.750000'))
    
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.ORDERID, a.ORDERDATE, a.SHIPDATE, a.SHIPADDRESS, a.SHIPCITY, a.SHIPREGION, a.SHIPCOUNTRY, a.SHIPPOSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.ORDERID, e.ORDERDATE, e.SHIPDATE, e.SHIPADDRESS, e.SHIPCITY, e.SHIPREGION, e.SHIPCOUNTRY, e.SHIPPOSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:01.161782 (Thread-1): SQL status: SUCCESS 1 in 1.42 seconds
2021-05-03 12:57:01.165707 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:57:01.165824 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
2021-05-03 12:57:01.327897 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:57:01.332405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:57:01.332523 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders
2021-05-03 12:57:01.465134 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:57:01.467496 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:57:01.467605 (Thread-1): On model.Dbt_demo.sat_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_orders"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders ("ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "ORDER_PK", "ORDER_HASHDIFF", "ORDERID", "ORDERDATE", "SHIPDATE", "SHIPADDRESS", "SHIPCITY", "SHIPREGION", "SHIPCOUNTRY", "SHIPPOSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_orders__dbt_tmp
                );
2021-05-03 12:57:01.868846 (Thread-1): SQL status: SUCCESS 0 in 0.40 seconds
2021-05-03 12:57:01.870209 (Thread-1): 12:57:01 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_orders]
2021-05-03 12:57:01.870422 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:57:01.870602 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_orders".
2021-05-03 12:57:01.870694 (Thread-1): On model.Dbt_demo.sat_orders: COMMIT
2021-05-03 12:57:02.229669 (Thread-1): SQL status: SUCCESS 1 in 0.36 seconds
2021-05-03 12:57:02.234776 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_orders"
2021-05-03 12:57:02.237892 (Thread-1): finished collecting timing info
2021-05-03 12:57:02.238212 (Thread-1): On model.Dbt_demo.sat_orders: Close
2021-05-03 12:57:02.454255 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a262304f0>]}
2021-05-03 12:57:02.455731 (Thread-1): 12:57:02 | 14 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_orders [INSERT 0 in 114.44s]
2021-05-03 12:57:02.455905 (Thread-1): Finished running node model.Dbt_demo.sat_orders
2021-05-03 12:57:02.456075 (Thread-1): Began running node model.Dbt_demo.hub_products
2021-05-03 12:57:02.457363 (Thread-1): 12:57:02 | 15 of 23 START incremental model SS_RAW_VLT.hub_products............. [RUN]
2021-05-03 12:57:02.457702 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:02.457830 (Thread-1): Compiling model.Dbt_demo.hub_products
2021-05-03 12:57:02.471050 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_products"
2021-05-03 12:57:02.471368 (Thread-1): finished collecting timing info
2021-05-03 12:57:02.479122 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:02.479244 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_PK, PRODUCTID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_PK, a.PRODUCTID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products AS d
    ON a.PRODUCT_PK = d.PRODUCT_PK
    WHERE d.PRODUCT_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:57:02.479351 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:57:04.241303 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2021-05-03 12:57:04.244907 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:04.245027 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
2021-05-03 12:57:04.403891 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-05-03 12:57:04.407830 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:04.407942 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-05-03 12:57:04.565502 (Thread-1): SQL status: SUCCESS 4 in 0.16 seconds
2021-05-03 12:57:04.571270 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:04.571384 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products
2021-05-03 12:57:04.696504 (Thread-1): SQL status: SUCCESS 4 in 0.13 seconds
2021-05-03 12:57:04.698194 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_products"
2021-05-03 12:57:04.698956 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:04.699058 (Thread-1): On model.Dbt_demo.hub_products: BEGIN
2021-05-03 12:57:04.901154 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:57:04.901335 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:04.901420 (Thread-1): On model.Dbt_demo.hub_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_products"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products ("PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_PK", "PRODUCTID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_products__dbt_tmp
        );
2021-05-03 12:57:05.170012 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:57:05.171171 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-05-03 12:57:05.171344 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_products".
2021-05-03 12:57:05.171456 (Thread-1): On model.Dbt_demo.hub_products: COMMIT
2021-05-03 12:57:05.360048 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:57:05.364564 (Thread-1): finished collecting timing info
2021-05-03 12:57:05.364840 (Thread-1): On model.Dbt_demo.hub_products: Close
2021-05-03 12:57:05.580913 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a264b1730>]}
2021-05-03 12:57:05.582356 (Thread-1): 12:57:05 | 15 of 23 OK created incremental model SS_RAW_VLT.hub_products........ [SUCCESS 0 in 3.12s]
2021-05-03 12:57:05.582528 (Thread-1): Finished running node model.Dbt_demo.hub_products
2021-05-03 12:57:05.582701 (Thread-1): Began running node model.Dbt_demo.link_prod_supp
2021-05-03 12:57:05.584116 (Thread-1): 12:57:05 | 16 of 23 START incremental model SS_RAW_VLT.link_prod_supp........... [RUN]
2021-05-03 12:57:05.584486 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:05.584625 (Thread-1): Compiling model.Dbt_demo.link_prod_supp
2021-05-03 12:57:05.598729 (Thread-1): Writing injected SQL for node "model.Dbt_demo.link_prod_supp"
2021-05-03 12:57:05.599048 (Thread-1): finished collecting timing info
2021-05-03 12:57:05.606888 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:05.607015 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT PRODUCT_SUPPLIER_PK, PRODUCT_PK, SUPPLIER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY PRODUCT_SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.PRODUCT_SUPPLIER_PK, a.PRODUCT_PK, a.SUPPLIER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp AS d
    ON a.PRODUCT_SUPPLIER_PK = d.PRODUCT_SUPPLIER_PK
    WHERE d.PRODUCT_SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:57:05.607128 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:57:07.065680 (Thread-1): SQL status: SUCCESS 1 in 1.46 seconds
2021-05-03 12:57:07.069306 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:07.069429 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
2021-05-03 12:57:07.200488 (Thread-1): SQL status: SUCCESS 5 in 0.13 seconds
2021-05-03 12:57:07.204618 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:07.204740 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-05-03 12:57:07.324592 (Thread-1): SQL status: SUCCESS 5 in 0.12 seconds
2021-05-03 12:57:07.330283 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:07.330408 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp
2021-05-03 12:57:07.454187 (Thread-1): SQL status: SUCCESS 5 in 0.12 seconds
2021-05-03 12:57:07.455983 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.link_prod_supp"
2021-05-03 12:57:07.456791 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:07.456905 (Thread-1): On model.Dbt_demo.link_prod_supp: BEGIN
2021-05-03 12:57:07.618224 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:07.618420 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:07.618511 (Thread-1): On model.Dbt_demo.link_prod_supp: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.link_prod_supp"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp ("PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "PRODUCT_SUPPLIER_PK", "PRODUCT_PK", "SUPPLIER_PK", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.link_prod_supp__dbt_tmp
        );
2021-05-03 12:57:07.921649 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:57:07.922863 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-05-03 12:57:07.923046 (Thread-1): Using snowflake connection "model.Dbt_demo.link_prod_supp".
2021-05-03 12:57:07.923142 (Thread-1): On model.Dbt_demo.link_prod_supp: COMMIT
2021-05-03 12:57:08.123738 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:57:08.128447 (Thread-1): finished collecting timing info
2021-05-03 12:57:08.128726 (Thread-1): On model.Dbt_demo.link_prod_supp: Close
2021-05-03 12:57:08.383101 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a263067f0>]}
2021-05-03 12:57:08.384568 (Thread-1): 12:57:08 | 16 of 23 OK created incremental model SS_RAW_VLT.link_prod_supp...... [SUCCESS 0 in 2.80s]
2021-05-03 12:57:08.384751 (Thread-1): Finished running node model.Dbt_demo.link_prod_supp
2021-05-03 12:57:08.384937 (Thread-1): Began running node model.Dbt_demo.sat_products
2021-05-03 12:57:08.386119 (Thread-1): 12:57:08 | 17 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_products.. [RUN]
2021-05-03 12:57:08.386643 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:08.386795 (Thread-1): Compiling model.Dbt_demo.sat_products
2021-05-03 12:57:08.409309 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_products"
2021-05-03 12:57:08.409626 (Thread-1): finished collecting timing info
2021-05-03 12:57:08.417028 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:08.417143 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:57:08.417242 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:57:09.581460 (Thread-1): SQL status: SUCCESS 1 in 1.16 seconds
2021-05-03 12:57:09.584796 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:09.584904 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:57:09.238000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:57:09.238000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_products
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:57:09.777184 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:57:09.780996 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:09.781106 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:09.924950 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:09.927365 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:09.927478 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:13.388374 (Thread-1): SQL status: SUCCESS 1 in 3.46 seconds
2021-05-03 12:57:13.389765 (Thread-1): 12:57:13 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_products]
2021-05-03 12:57:13.395257 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:13.395365 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:13.545734 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:57:13.545919 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:13.546028 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:14.981367 (Thread-1): SQL status: SUCCESS 1 in 1.44 seconds
2021-05-03 12:57:14.985233 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:14.985342 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:15.223893 (Thread-1): SQL status: SUCCESS 12 in 0.24 seconds
2021-05-03 12:57:15.228503 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:15.228619 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:15.371166 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:15.373473 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:15.373580 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:16.164931 (Thread-1): SQL status: SUCCESS 0 in 0.79 seconds
2021-05-03 12:57:16.166252 (Thread-1): 12:57:16 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:16.166454 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:16.166627 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:16.166715 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:16.359942 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:57:16.361044 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:16.361148 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:16.490039 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:57:16.491420 (Thread-1): 12:57:16 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_products]
2021-05-03 12:57:16.497157 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:16.497264 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:16.652685 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:16.652872 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:16.652956 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:17.630283 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-05-03 12:57:17.634239 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:17.634349 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:17.799722 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:57:17.804228 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:17.804339 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:17.966054 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:57:17.968328 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:17.968434 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:18.211059 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:57:18.212401 (Thread-1): 12:57:18 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:18.212614 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:18.212793 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:18.212886 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:18.481988 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-05-03 12:57:18.483458 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:18.483570 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:18.632011 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:57:18.633419 (Thread-1): 12:57:18 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_products]
2021-05-03 12:57:18.638886 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:18.638994 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:18.787539 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:57:18.787732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:18.787820 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:20.660146 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2021-05-03 12:57:20.664008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:20.664122 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:20.880415 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:57:20.884779 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:20.884889 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:21.056549 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:57:21.058848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:21.058963 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:21.404034 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 12:57:21.405297 (Thread-1): 12:57:21 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:21.405502 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:21.405681 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:21.405770 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:21.668758 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 12:57:21.669846 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:21.669950 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:21.815033 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:57:21.816446 (Thread-1): 12:57:21 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_products]
2021-05-03 12:57:21.822199 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:21.822308 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:21.979976 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:21.980164 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:21.980250 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:23.318674 (Thread-1): SQL status: SUCCESS 1 in 1.34 seconds
2021-05-03 12:57:23.322609 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:23.322732 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:23.476750 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:57:23.481293 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:23.481403 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:23.669691 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 12:57:23.671979 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:23.672087 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:24.029569 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:57:24.030896 (Thread-1): 12:57:24 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:24.031103 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:24.031276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:24.031365 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:24.405471 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-05-03 12:57:24.406955 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:24.407061 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:24.565983 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:24.567396 (Thread-1): 12:57:24 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_products]
2021-05-03 12:57:24.572797 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:24.572911 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:24.821333 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:57:24.821520 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:24.821607 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:26.355230 (Thread-1): SQL status: SUCCESS 1 in 1.53 seconds
2021-05-03 12:57:26.359088 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:26.359198 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:26.628191 (Thread-1): SQL status: SUCCESS 12 in 0.27 seconds
2021-05-03 12:57:26.632596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:26.632710 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:26.796623 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:57:26.799177 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:26.799286 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:27.188044 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-05-03 12:57:27.189313 (Thread-1): 12:57:27 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:27.189527 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:27.189711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:27.189803 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:27.448861 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 12:57:27.449988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:27.450097 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:27.623109 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:57:27.624910 (Thread-1): 12:57:27 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_products]
2021-05-03 12:57:27.630315 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:27.630424 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:27.804796 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:57:27.804983 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:27.805069 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:29.834227 (Thread-1): SQL status: SUCCESS 1 in 2.03 seconds
2021-05-03 12:57:29.838357 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:29.838471 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:30.000803 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:57:30.006575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:30.006688 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:30.144540 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:30.146863 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:30.146971 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:30.499062 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:57:30.500683 (Thread-1): 12:57:30 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:30.500892 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:30.501068 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:30.501158 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:30.719414 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:57:30.720504 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:30.720608 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:30.850195 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:57:30.851627 (Thread-1): 12:57:30 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_products]
2021-05-03 12:57:30.857447 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:30.857560 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:31.018109 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:31.018300 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:31.018385 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:32.345099 (Thread-1): SQL status: SUCCESS 1 in 1.33 seconds
2021-05-03 12:57:32.349014 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:32.349124 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:32.504150 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:57:32.508530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:32.508646 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:32.725830 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:57:32.728146 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:32.728253 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:32.973914 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:57:32.975213 (Thread-1): 12:57:32 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:32.975417 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:32.975591 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:32.975682 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:33.243167 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-05-03 12:57:33.244277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:33.244382 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:33.380552 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:57:33.382390 (Thread-1): 12:57:33 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_products]
2021-05-03 12:57:33.388123 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:33.388232 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:33.548343 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:33.548524 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:33.548611 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:34.405943 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:57:34.409876 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:34.410004 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:35.099872 (Thread-1): SQL status: SUCCESS 12 in 0.69 seconds
2021-05-03 12:57:35.104252 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:35.104361 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:35.241217 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:35.243505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:35.243617 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:35.499338 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:57:35.500930 (Thread-1): 12:57:35 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:35.501133 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:35.501306 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:35.501394 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:35.750583 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:57:35.751681 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:35.751785 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:35.885228 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:57:35.886673 (Thread-1): 12:57:35 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_products]
2021-05-03 12:57:35.892063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:35.892170 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:36.050268 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:36.050448 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:36.050531 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:37.233322 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-05-03 12:57:37.237107 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:37.237216 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:37.712821 (Thread-1): SQL status: SUCCESS 12 in 0.48 seconds
2021-05-03 12:57:37.817647 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:37.817806 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:37.969554 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:57:37.971853 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:37.971961 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:38.246160 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:57:38.247844 (Thread-1): 12:57:38 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:38.248058 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:38.248235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:38.248328 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:38.463766 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:57:38.464875 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:38.464992 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:38.590296 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:57:38.591759 (Thread-1): 12:57:38 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_products]
2021-05-03 12:57:38.597689 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:38.597803 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:38.761750 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:38.761935 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:38.762052 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:39.616577 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:57:39.620482 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:39.620593 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:40.225825 (Thread-1): SQL status: SUCCESS 12 in 0.61 seconds
2021-05-03 12:57:40.230292 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:40.230408 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:40.372434 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:40.374760 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:40.374869 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:40.693888 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:57:40.695200 (Thread-1): 12:57:40 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:40.695408 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:40.695585 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:40.695675 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:40.900961 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:57:40.902142 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:40.902261 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:41.035036 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:57:41.036917 (Thread-1): 12:57:41 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_products]
2021-05-03 12:57:41.042480 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:41.042598 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:41.239285 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:57:41.239477 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:41.239570 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:42.127688 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 12:57:42.131621 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:42.131738 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:42.311699 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:57:42.316172 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:42.316286 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:42.452846 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:42.455212 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:42.455329 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:42.746655 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:57:42.750322 (Thread-1): 12:57:42 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:42.750553 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:42.750737 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:42.750839 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:42.955071 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:57:42.956244 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:42.956357 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:43.098429 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:57:43.099833 (Thread-1): 12:57:43 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_products]
2021-05-03 12:57:43.105610 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:43.105719 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:43.262919 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:57:43.263118 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:43.263208 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:44.156096 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 12:57:44.159969 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:44.160080 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:44.323882 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:57:44.328300 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:44.328411 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:44.466149 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:44.468447 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:44.468554 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:44.792477 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:57:44.793729 (Thread-1): 12:57:44 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:44.793938 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:44.794134 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:44.794223 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:45.000689 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:57:45.001798 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:45.001902 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:45.134179 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:57:45.135980 (Thread-1): 12:57:45 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_products]
2021-05-03 12:57:45.141391 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:45.141505 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:45.293728 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:57:45.293914 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:45.294027 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:46.917043 (Thread-1): SQL status: SUCCESS 1 in 1.62 seconds
2021-05-03 12:57:46.921037 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:46.921162 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:47.086887 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:57:47.091351 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:47.091479 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:47.232655 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:47.234926 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:47.235031 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:47.506143 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:57:47.507733 (Thread-1): 12:57:47 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:47.507943 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:47.508115 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:47.508203 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:47.934871 (Thread-1): SQL status: SUCCESS 1 in 0.43 seconds
2021-05-03 12:57:47.935956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:47.936060 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:48.075490 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:57:48.076878 (Thread-1): 12:57:48 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_products]
2021-05-03 12:57:48.082350 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:48.082465 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:48.233425 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:57:48.233606 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:48.233691 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:49.168700 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-05-03 12:57:49.172568 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:49.172679 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:49.340730 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:57:49.346729 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:49.346841 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:49.489382 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:57:49.491699 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:49.491805 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:49.820704 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:57:49.821991 (Thread-1): 12:57:49 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:49.822198 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:49.822386 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:49.822475 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:50.018215 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:57:50.019301 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:50.019405 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:50.280917 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 12:57:50.282754 (Thread-1): 12:57:50 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_products]
2021-05-03 12:57:50.288177 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:50.288285 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:50.457887 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:57:50.458098 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:50.458186 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:51.361824 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:57:51.365830 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:51.365942 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:51.533857 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:57:51.538420 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:51.538539 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:51.687840 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:57:51.690143 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:51.690250 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:51.966828 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:57:51.968411 (Thread-1): 12:57:51 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:51.968615 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:51.968788 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:51.968876 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:52.380574 (Thread-1): SQL status: SUCCESS 1 in 0.41 seconds
2021-05-03 12:57:52.381665 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:52.381769 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:52.516897 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:57:52.518377 (Thread-1): 12:57:52 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_products]
2021-05-03 12:57:52.523894 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:52.524015 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:52.699902 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:57:52.700093 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:52.700184 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:53.562465 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:57:53.566445 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:53.566563 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:53.731725 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:57:53.736212 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:53.736327 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:53.963072 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 12:57:53.965400 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:53.965514 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:54.293107 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 12:57:54.294417 (Thread-1): 12:57:54 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:54.294622 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:54.294794 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:54.294882 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:54.497632 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:57:54.498769 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:54.498875 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:54.676217 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:57:54.678029 (Thread-1): 12:57:54 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_products]
2021-05-03 12:57:54.683406 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:54.683515 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:54.931280 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:57:54.931471 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:54.931571 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:57:56.067351 (Thread-1): SQL status: SUCCESS 1 in 1.14 seconds
2021-05-03 12:57:56.072847 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:56.072961 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:57:56.248194 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:57:56.252650 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:56.252760 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:57:56.441256 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 12:57:56.443562 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:56.443670 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:57:56.802061 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:57:56.803354 (Thread-1): 12:57:56 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:57:56.803560 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:56.803742 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:56.803835 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:57:56.999617 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:57:57.000655 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:57.000758 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:57:57.132422 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:57:57.133816 (Thread-1): 12:57:57 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_products]
2021-05-03 12:57:57.139256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:57.139363 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:57:59.415788 (Thread-1): SQL status: SUCCESS 1 in 2.28 seconds
2021-05-03 12:57:59.415980 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:57:59.416067 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:00.491030 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-05-03 12:58:00.494935 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:00.495054 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:00.664290 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:58:00.668726 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:00.668837 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:00.903217 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 12:58:00.905620 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:00.905730 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:01.273565 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-05-03 12:58:01.274888 (Thread-1): 12:58:01 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:01.275090 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:01.275263 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:01.275353 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:01.471304 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:58:01.472414 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:01.472519 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:01.601620 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:58:01.603489 (Thread-1): 12:58:01 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_products]
2021-05-03 12:58:01.608938 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:01.609049 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:01.782012 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:58:01.782204 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:01.782290 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:02.929852 (Thread-1): SQL status: SUCCESS 1 in 1.15 seconds
2021-05-03 12:58:02.933888 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:02.934024 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:03.114054 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:58:03.118541 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:03.118654 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:03.271527 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:58:03.273813 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:03.273920 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:03.581421 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 12:58:03.584700 (Thread-1): 12:58:03 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:03.584911 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:03.585086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:03.585175 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:03.788943 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:58:03.790062 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:03.790167 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:03.949787 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:03.951192 (Thread-1): 12:58:03 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_products]
2021-05-03 12:58:03.956639 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:03.956763 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:04.113295 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:04.113482 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:04.113570 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:05.689087 (Thread-1): SQL status: SUCCESS 1 in 1.58 seconds
2021-05-03 12:58:05.693015 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:05.693131 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:05.850965 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:58:05.855464 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:05.855586 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:05.993643 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:58:05.996000 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:05.996118 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:06.290805 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:58:06.292208 (Thread-1): 12:58:06 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:06.292428 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:06.292618 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:06.292720 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:06.498287 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:58:06.499430 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:06.499542 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:06.657398 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:06.658892 (Thread-1): 12:58:06 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_products]
2021-05-03 12:58:06.664854 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:06.664971 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:06.817798 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:58:06.818006 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:06.818097 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:07.721140 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:58:07.725128 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:07.725240 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:07.891475 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:58:07.896054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:07.896168 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:08.032336 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:58:08.034835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:08.034951 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:09.017064 (Thread-1): SQL status: SUCCESS 0 in 0.98 seconds
2021-05-03 12:58:09.018369 (Thread-1): 12:58:09 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:09.018572 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:09.018744 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:09.018832 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:09.229989 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:58:09.231448 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:09.231552 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:09.373329 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:58:09.374751 (Thread-1): 12:58:09 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_products]
2021-05-03 12:58:09.380178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:09.380286 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:09.766760 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-05-03 12:58:09.766949 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:09.767042 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:11.680787 (Thread-1): SQL status: SUCCESS 1 in 1.91 seconds
2021-05-03 12:58:11.685013 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:11.685144 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:11.869122 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:58:11.875018 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:11.875129 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:12.020822 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:58:12.023360 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:12.023469 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:12.832589 (Thread-1): SQL status: SUCCESS 0 in 0.81 seconds
2021-05-03 12:58:12.833918 (Thread-1): 12:58:12 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:12.834159 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:12.834350 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:12.834446 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:13.082844 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:58:13.083992 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:13.084101 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:13.352918 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-05-03 12:58:13.354424 (Thread-1): 12:58:13 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_products]
2021-05-03 12:58:13.360345 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:13.360460 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:13.515991 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:13.516182 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:13.516274 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:14.416061 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 12:58:14.420116 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:14.420234 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:14.593414 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:58:14.598148 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:14.598268 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:14.801380 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:58:14.803711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:14.803818 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:15.067153 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:58:15.068437 (Thread-1): 12:58:15 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:15.068645 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:15.068823 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:15.068913 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:15.271684 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:58:15.273168 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:15.273274 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:15.415274 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:58:15.416653 (Thread-1): 12:58:15 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_products]
2021-05-03 12:58:15.422142 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:15.422250 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:15.599404 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:58:15.599587 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:15.599673 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:16.487700 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 12:58:16.491934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:16.492047 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:17.802686 (Thread-1): SQL status: SUCCESS 12 in 1.31 seconds
2021-05-03 12:58:17.807090 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:17.807203 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:18.070549 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-05-03 12:58:18.073077 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:18.073194 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:18.317726 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:58:18.319015 (Thread-1): 12:58:18 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:18.319220 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:18.319398 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:18.319489 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:18.547042 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 12:58:18.548147 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:18.548252 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:18.686518 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:58:18.687914 (Thread-1): 12:58:18 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_products]
2021-05-03 12:58:18.693669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:18.693782 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:18.852600 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:18.852785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:18.852870 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:20.108946 (Thread-1): SQL status: SUCCESS 1 in 1.26 seconds
2021-05-03 12:58:20.114337 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:20.114448 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:20.277124 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:58:20.281626 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:20.281741 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:20.431486 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:58:20.433769 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:20.433876 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:20.681638 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:58:20.682949 (Thread-1): 12:58:20 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:20.683156 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:20.683328 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:20.683415 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:20.888114 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:58:20.889582 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:20.889688 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:21.023492 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:58:21.024901 (Thread-1): 12:58:21 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_products]
2021-05-03 12:58:21.030395 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:21.030504 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:21.192756 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:21.192943 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:21.193029 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:22.069724 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 12:58:22.074039 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:22.074155 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:22.227382 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:58:22.231787 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:22.231901 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:22.428362 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:58:22.430925 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:22.431034 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:22.713474 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:58:22.714774 (Thread-1): 12:58:22 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:22.714980 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:22.715157 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:22.715246 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:22.952645 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:58:22.953748 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:22.953853 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:23.210217 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 12:58:23.211645 (Thread-1): 12:58:23 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_products]
2021-05-03 12:58:23.217399 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:23.217507 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:23.548615 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-05-03 12:58:23.548801 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:23.548887 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:24.461711 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:58:24.465720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:24.465833 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:24.826580 (Thread-1): SQL status: SUCCESS 12 in 0.36 seconds
2021-05-03 12:58:24.831100 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:24.831211 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:25.039982 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-05-03 12:58:25.146141 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:25.146308 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:25.640929 (Thread-1): SQL status: SUCCESS 0 in 0.49 seconds
2021-05-03 12:58:25.642248 (Thread-1): 12:58:25 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:25.642454 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:25.642630 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:25.642727 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:25.854478 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:58:25.855593 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:25.855697 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:26.009115 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:58:26.012665 (Thread-1): 12:58:26 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_products]
2021-05-03 12:58:26.018004 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:26.018113 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:26.226488 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 12:58:26.226671 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:26.226757 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:28.249130 (Thread-1): SQL status: SUCCESS 1 in 2.02 seconds
2021-05-03 12:58:28.253086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:28.253197 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:28.427379 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:58:28.431603 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:28.431716 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:28.564295 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:58:28.566635 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:28.566749 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:28.863697 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:58:28.865301 (Thread-1): 12:58:28 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:28.865515 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:28.865689 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:28.865781 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:29.090811 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:58:29.091923 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:29.092040 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:29.235275 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:58:29.236684 (Thread-1): 12:58:29 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_products]
2021-05-03 12:58:29.242505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:29.242615 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:29.405318 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:29.405500 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:29.405591 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:30.520857 (Thread-1): SQL status: SUCCESS 1 in 1.12 seconds
2021-05-03 12:58:30.524800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:30.524910 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:30.702167 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:58:30.706694 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:30.706812 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:30.845881 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:58:30.848224 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:30.848332 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:31.206653 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:58:31.207947 (Thread-1): 12:58:31 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:31.208151 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:31.208324 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:31.208412 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:31.426135 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:58:31.427247 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:31.427350 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:31.564824 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:58:31.566654 (Thread-1): 12:58:31 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_products]
2021-05-03 12:58:31.572012 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:31.572119 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:31.737272 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:58:31.737455 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:31.737541 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:35.438739 (Thread-1): SQL status: SUCCESS 1 in 3.70 seconds
2021-05-03 12:58:35.442667 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:35.442786 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:35.884529 (Thread-1): SQL status: SUCCESS 12 in 0.44 seconds
2021-05-03 12:58:35.890715 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:35.890825 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:36.033444 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:58:36.035752 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:36.035869 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:36.351303 (Thread-1): SQL status: SUCCESS 0 in 0.32 seconds
2021-05-03 12:58:36.352588 (Thread-1): 12:58:36 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:36.352791 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:36.352965 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:36.353060 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:36.679009 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-05-03 12:58:36.680500 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:36.680606 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:39.409000'))) AS period_of_load
2021-05-03 12:58:36.986437 (Thread-1): SQL status: SUCCESS 1 in 0.31 seconds
2021-05-03 12:58:36.987832 (Thread-1): 12:58:36 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_products]
2021-05-03 12:58:36.993246 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:36.993353 (Thread-1): On model.Dbt_demo.sat_products: BEGIN
2021-05-03 12:58:37.271330 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 12:58:37.271519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:37.271607 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp  as
      (select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_products AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:39.409000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:39.409000'))
    
),

update_records AS (
    SELECT a.PRODUCT_PK, a.PRODUCT_HASHDIFF, a.PRODUCTID, a.PRODUCTNAME, a.QUANTITYPERUNIT, a.UNITPRICE, a.CATEGORYID, a.UNITSINSTOCK, a.UNITSONORDER, a.REORDERLEVEL, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products as a
    JOIN source_data as b
    ON a.PRODUCT_PK = b.PRODUCT_PK
),

latest_records AS (
    SELECT c.PRODUCT_PK, c.PRODUCT_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.PRODUCT_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.PRODUCT_PK, e.PRODUCT_HASHDIFF, e.PRODUCTID, e.PRODUCTNAME, e.QUANTITYPERUNIT, e.UNITPRICE, e.CATEGORYID, e.UNITSINSTOCK, e.UNITSONORDER, e.REORDERLEVEL, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.PRODUCT_HASHDIFF = e.PRODUCT_HASHDIFF
    WHERE latest_records.PRODUCT_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:38.841486 (Thread-1): SQL status: SUCCESS 1 in 1.57 seconds
2021-05-03 12:58:38.845690 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:38.845807 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
2021-05-03 12:58:39.009563 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:58:39.014112 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:39.014230 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products
2021-05-03 12:58:39.275293 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-05-03 12:58:39.277832 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:39.277949 (Thread-1): On model.Dbt_demo.sat_products: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_products"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products ("PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "PRODUCT_PK", "PRODUCT_HASHDIFF", "PRODUCTID", "PRODUCTNAME", "QUANTITYPERUNIT", "UNITPRICE", "CATEGORYID", "UNITSINSTOCK", "UNITSONORDER", "REORDERLEVEL", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_products__dbt_tmp
                );
2021-05-03 12:58:39.650156 (Thread-1): SQL status: SUCCESS 0 in 0.37 seconds
2021-05-03 12:58:39.651430 (Thread-1): 12:58:39 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_products]
2021-05-03 12:58:39.651634 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:39.651809 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_products".
2021-05-03 12:58:39.651913 (Thread-1): On model.Dbt_demo.sat_products: COMMIT
2021-05-03 12:58:39.928462 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 12:58:39.928890 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_products"
2021-05-03 12:58:39.931955 (Thread-1): finished collecting timing info
2021-05-03 12:58:39.932234 (Thread-1): On model.Dbt_demo.sat_products: Close
2021-05-03 12:58:40.807997 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a26291ca0>]}
2021-05-03 12:58:40.809456 (Thread-1): 12:58:40 | 17 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_products [INSERT 0 in 92.42s]
2021-05-03 12:58:40.809625 (Thread-1): Finished running node model.Dbt_demo.sat_products
2021-05-03 12:58:40.809787 (Thread-1): Began running node model.Dbt_demo.hub_customers
2021-05-03 12:58:40.811060 (Thread-1): 12:58:40 | 18 of 23 START incremental model SS_RAW_VLT.hub_customers............ [RUN]
2021-05-03 12:58:40.811370 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:40.811492 (Thread-1): Compiling model.Dbt_demo.hub_customers
2021-05-03 12:58:40.824371 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_customers"
2021-05-03 12:58:40.824677 (Thread-1): finished collecting timing info
2021-05-03 12:58:40.832089 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:40.832204 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT CUSTOMER_PK, CUSTOMERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 12:58:40.832306 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:58:42.588500 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2021-05-03 12:58:42.593353 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:42.593463 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
2021-05-03 12:58:42.787691 (Thread-1): SQL status: SUCCESS 4 in 0.19 seconds
2021-05-03 12:58:42.791684 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:42.791793 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-05-03 12:58:42.939433 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-05-03 12:58:42.943539 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:42.943650 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers
2021-05-03 12:58:43.098440 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-05-03 12:58:43.100113 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_customers"
2021-05-03 12:58:43.100893 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:43.100995 (Thread-1): On model.Dbt_demo.hub_customers: BEGIN
2021-05-03 12:58:43.255450 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:58:43.255637 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:43.255723 (Thread-1): On model.Dbt_demo.hub_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_customers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers ("CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "CUSTOMER_PK", "CUSTOMERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_customers__dbt_tmp
        );
2021-05-03 12:58:43.815825 (Thread-1): SQL status: SUCCESS 3 in 0.56 seconds
2021-05-03 12:58:43.816999 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-05-03 12:58:43.817174 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_customers".
2021-05-03 12:58:43.817264 (Thread-1): On model.Dbt_demo.hub_customers: COMMIT
2021-05-03 12:58:44.120872 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 12:58:44.125408 (Thread-1): finished collecting timing info
2021-05-03 12:58:44.125675 (Thread-1): On model.Dbt_demo.hub_customers: Close
2021-05-03 12:58:44.386333 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2621f4f0>]}
2021-05-03 12:58:44.387759 (Thread-1): 12:58:44 | 18 of 23 OK created incremental model SS_RAW_VLT.hub_customers....... [SUCCESS 3 in 3.57s]
2021-05-03 12:58:44.387932 (Thread-1): Finished running node model.Dbt_demo.hub_customers
2021-05-03 12:58:44.388097 (Thread-1): Began running node model.Dbt_demo.sat_customers
2021-05-03 12:58:44.389342 (Thread-1): 12:58:44 | 19 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_customers. [RUN]
2021-05-03 12:58:44.389656 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:44.389776 (Thread-1): Compiling model.Dbt_demo.sat_customers
2021-05-03 12:58:44.411627 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_customers"
2021-05-03 12:58:44.411933 (Thread-1): finished collecting timing info
2021-05-03 12:58:44.419887 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:44.420015 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 12:58:44.420124 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 12:58:45.194808 (Thread-1): SQL status: SUCCESS 1 in 0.77 seconds
2021-05-03 12:58:45.198129 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:45.198238 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 05:58:44.918000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 05:58:44.918000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_customers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 12:58:45.386631 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:58:45.390381 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:45.390491 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:58:45.518955 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:58:45.521350 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:45.521456 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:58:45.667072 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:58:45.668475 (Thread-1): 12:58:45 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_customers]
2021-05-03 12:58:45.673855 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:45.673979 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:58:45.821483 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:58:45.821669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:45.821755 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:46.800598 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-05-03 12:58:46.804507 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:46.804617 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:58:46.963424 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:58:46.967862 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:46.967971 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:58:47.519500 (Thread-1): SQL status: SUCCESS 12 in 0.55 seconds
2021-05-03 12:58:47.521800 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:47.521907 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:58:47.807540 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 12:58:47.808828 (Thread-1): 12:58:47 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:58:47.809032 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:47.809205 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:47.809294 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:47.983759 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:58:47.984867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:47.984972 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:58:48.099964 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:58:48.101399 (Thread-1): 12:58:48 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_customers]
2021-05-03 12:58:48.107444 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:48.107553 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:58:48.246529 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:58:48.246720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:48.246807 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:49.828888 (Thread-1): SQL status: SUCCESS 1 in 1.58 seconds
2021-05-03 12:58:49.832841 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:49.832955 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:58:49.980792 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:58:49.985309 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:49.985428 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:58:50.107471 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:58:50.109725 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:50.109831 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:58:52.509330 (Thread-1): SQL status: SUCCESS 0 in 2.40 seconds
2021-05-03 12:58:52.510675 (Thread-1): 12:58:52 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:58:52.510880 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:52.511053 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:52.511142 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:52.733430 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:58:52.734906 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:52.735013 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:58:53.017056 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 12:58:53.018502 (Thread-1): 12:58:53 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_customers]
2021-05-03 12:58:53.023856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:53.023976 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:58:53.206949 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:58:53.207153 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:53.207241 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:55.636839 (Thread-1): SQL status: SUCCESS 1 in 2.43 seconds
2021-05-03 12:58:55.642597 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:55.642706 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:58:55.872834 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 12:58:55.877275 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:55.877385 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:58:56.028741 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:58:56.031237 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:56.031345 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:58:56.488228 (Thread-1): SQL status: SUCCESS 0 in 0.46 seconds
2021-05-03 12:58:56.489534 (Thread-1): 12:58:56 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:58:56.489740 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:56.489914 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:56.490026 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:56.725635 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:58:56.726759 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:56.726865 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:58:56.841505 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:58:56.843302 (Thread-1): 12:58:56 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_customers]
2021-05-03 12:58:56.848559 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:56.848666 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:58:57.029607 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:58:57.029788 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:57.029872 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:58:57.841341 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-05-03 12:58:57.845333 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:57.845443 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:58:58.015896 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:58:58.020415 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:58.020544 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:58:58.161300 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:58:58.163611 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:58.163720 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:58:58.420723 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 12:58:58.422333 (Thread-1): 12:58:58 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:58:58.422543 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:58.422718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:58.422807 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:58:58.639949 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:58:58.641054 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:58.641158 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:58:58.762029 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:58:58.763409 (Thread-1): 12:58:58 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_customers]
2021-05-03 12:58:58.769056 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:58.769164 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:58:58.931564 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:58:58.931747 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:58:58.931833 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:00.125219 (Thread-1): SQL status: SUCCESS 1 in 1.19 seconds
2021-05-03 12:59:00.129095 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:00.129207 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:00.281394 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:59:00.285804 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:00.285913 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:00.407168 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:00.409490 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:00.409604 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:03.875732 (Thread-1): SQL status: SUCCESS 0 in 3.47 seconds
2021-05-03 12:59:03.877023 (Thread-1): 12:59:03 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:03.877229 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:03.877405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:03.877500 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:04.122163 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:59:04.123269 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:04.123374 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:04.296303 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:59:04.298114 (Thread-1): 12:59:04 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:04.303425 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:04.303534 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:04.464461 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:59:04.464645 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:04.464732 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:05.543989 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-05-03 12:59:05.547950 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:05.548065 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:05.809673 (Thread-1): SQL status: SUCCESS 12 in 0.26 seconds
2021-05-03 12:59:05.814271 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:05.814383 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:05.935963 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:05.938281 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:05.938390 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:06.216030 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:59:06.217645 (Thread-1): 12:59:06 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:06.217864 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:06.218059 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:06.218151 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:06.419460 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:59:06.420614 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:06.420730 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:06.534411 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:06.535872 (Thread-1): 12:59:06 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:06.541272 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:06.541385 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:08.772905 (Thread-1): SQL status: SUCCESS 1 in 2.23 seconds
2021-05-03 12:59:08.773096 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:08.773186 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:09.588123 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-05-03 12:59:09.592027 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:09.592141 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:09.726401 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:59:09.730814 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:09.730925 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:09.858706 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:59:09.861101 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:09.861220 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:10.109191 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:59:10.110514 (Thread-1): 12:59:10 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:10.110718 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:10.110892 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:10.110981 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:10.352890 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 12:59:10.354017 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:10.354124 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:10.460145 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:10.461913 (Thread-1): 12:59:10 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:10.467217 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:10.467324 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:10.643501 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:59:10.643695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:10.643782 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:11.721340 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-05-03 12:59:11.725360 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:11.725478 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:11.914642 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 12:59:11.920610 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:11.920721 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:12.096983 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:59:12.099276 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:12.099384 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:12.373280 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:59:12.374582 (Thread-1): 12:59:12 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:12.374790 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:12.374964 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:12.375053 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:12.810111 (Thread-1): SQL status: SUCCESS 1 in 0.43 seconds
2021-05-03 12:59:12.811138 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:12.811242 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:12.924414 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:12.925813 (Thread-1): 12:59:12 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:12.931145 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:12.931263 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:13.069752 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:59:13.069941 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:13.070062 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:14.393397 (Thread-1): SQL status: SUCCESS 1 in 1.32 seconds
2021-05-03 12:59:14.397277 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:14.397397 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:14.536904 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:59:14.636558 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:14.636719 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:14.755910 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:14.758214 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:14.758323 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:14.997593 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:59:14.999278 (Thread-1): 12:59:14 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:14.999483 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:14.999656 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:14.999764 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:15.184900 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:59:15.186067 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:15.186180 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:15.295629 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:15.297020 (Thread-1): 12:59:15 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:15.302770 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:15.302881 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:15.439453 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:59:15.439645 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:15.439732 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:16.263420 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-05-03 12:59:16.267305 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:16.267416 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:16.419219 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:59:16.423651 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:16.423761 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:16.545666 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:16.547959 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:16.548064 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:16.813421 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:59:16.814777 (Thread-1): 12:59:16 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:16.814996 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:16.815169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:16.815277 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:16.990441 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:59:16.991592 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:16.991703 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:19.205751 (Thread-1): SQL status: SUCCESS 1 in 2.21 seconds
2021-05-03 12:59:19.207594 (Thread-1): 12:59:19 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:19.212915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:19.213024 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:19.348672 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:59:19.348859 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:19.348945 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:20.183105 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-05-03 12:59:20.188775 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:20.188888 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:20.321362 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:59:20.391021 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:20.391182 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:20.512708 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:20.515190 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:20.515299 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:21.115914 (Thread-1): SQL status: SUCCESS 0 in 0.60 seconds
2021-05-03 12:59:21.117194 (Thread-1): 12:59:21 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:21.117396 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:21.117573 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:21.117662 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:21.301106 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:59:21.302232 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:21.302340 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:21.415711 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:21.417445 (Thread-1): 12:59:21 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:21.422715 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:21.422823 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:21.553870 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:59:21.554087 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:21.554184 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:22.433574 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 12:59:22.437694 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:22.437815 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:22.577837 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:59:22.582417 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:22.582531 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:22.702308 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:22.704611 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:22.704722 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:22.970405 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:59:22.971724 (Thread-1): 12:59:22 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:22.971933 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:22.972111 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:22.972203 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:23.171677 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:59:23.173123 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:23.173228 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:23.288804 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:59:23.290197 (Thread-1): 12:59:23 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:23.295497 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:23.295604 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:23.456981 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:59:23.457161 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:23.457246 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:24.273575 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-05-03 12:59:24.277514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:24.277631 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:24.412711 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:59:24.418588 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:24.418712 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:24.540226 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:24.542589 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:24.542703 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:24.838641 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 12:59:24.839948 (Thread-1): 12:59:24 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:24.840154 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:24.840330 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:24.840419 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:25.091092 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:59:25.092575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:25.092680 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:25.201712 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:25.203121 (Thread-1): 12:59:25 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:25.208431 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:25.208544 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:25.428112 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:59:25.428295 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:25.428382 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:26.245214 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-05-03 12:59:26.249062 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:26.249179 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:26.389427 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:59:26.394060 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:26.394184 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:26.511629 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:26.513916 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:26.514062 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:27.046742 (Thread-1): SQL status: SUCCESS 0 in 0.53 seconds
2021-05-03 12:59:27.048023 (Thread-1): 12:59:27 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:27.048230 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:27.048405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:27.048498 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:27.235396 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:59:27.236849 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:27.236956 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:30.451031 (Thread-1): SQL status: SUCCESS 1 in 3.21 seconds
2021-05-03 12:59:30.452438 (Thread-1): 12:59:30 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:30.457758 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:30.457873 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:30.622224 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 12:59:30.622408 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:30.622494 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:31.695515 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-05-03 12:59:31.699378 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:31.699489 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:31.862490 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:59:31.866968 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:31.867083 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:31.989956 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:31.992238 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:31.992345 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:32.346336 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 12:59:32.347637 (Thread-1): 12:59:32 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:32.347841 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:32.348018 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:32.348106 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:32.532632 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:59:32.534130 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:32.534252 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:32.656275 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:59:32.657665 (Thread-1): 12:59:32 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:32.662984 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:32.663101 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:32.802691 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:59:32.802884 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:32.802973 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:33.984019 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-05-03 12:59:33.987888 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:33.988010 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:34.122817 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:59:34.127320 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:34.127436 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:34.249805 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:34.252092 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:34.252210 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:34.492292 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:59:34.493546 (Thread-1): 12:59:34 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:34.493746 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:34.493923 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:34.494040 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:34.761236 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-05-03 12:59:34.762711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:34.762817 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:34.870067 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:34.871444 (Thread-1): 12:59:34 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:34.876812 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:34.876925 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:35.080898 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 12:59:35.081087 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:35.081174 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:36.170453 (Thread-1): SQL status: SUCCESS 1 in 1.09 seconds
2021-05-03 12:59:36.174368 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:36.174482 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:36.396866 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 12:59:36.401338 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:36.401448 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:36.573868 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 12:59:36.576175 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:36.576282 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:36.913898 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 12:59:36.915214 (Thread-1): 12:59:36 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:36.915418 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:36.915591 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:36.915679 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:37.266818 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-05-03 12:59:37.268258 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:37.268366 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:37.383316 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:37.384703 (Thread-1): 12:59:37 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:37.390025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:37.390132 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:37.641864 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 12:59:37.642078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:37.642171 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:38.628479 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-05-03 12:59:38.632401 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:38.632518 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:38.777766 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:59:38.783867 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:38.783992 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:38.979193 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 12:59:38.981527 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:38.981637 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:39.219579 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:59:39.220851 (Thread-1): 12:59:39 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:39.221062 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:39.221235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:39.221324 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:39.415655 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:59:39.416745 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:39.416849 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:39.527002 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:39.528870 (Thread-1): 12:59:39 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:39.534153 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:39.534260 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:39.687437 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:59:39.687627 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:39.687715 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:40.516897 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-05-03 12:59:40.520891 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:40.521006 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:40.674177 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:59:40.678489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:40.678599 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:40.795610 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:40.797885 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:40.798021 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:41.036861 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 12:59:41.038487 (Thread-1): 12:59:41 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:41.038691 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:41.038862 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:41.038949 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:41.228147 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:59:41.229245 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:41.229350 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:41.339629 (Thread-1): SQL status: SUCCESS 1 in 0.11 seconds
2021-05-03 12:59:41.341017 (Thread-1): 12:59:41 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:41.346682 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:41.346791 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:41.480777 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:59:41.480956 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:41.481042 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:42.361011 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 12:59:42.364938 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:42.365050 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:42.504884 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:59:42.509417 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:42.509530 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:42.640310 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 12:59:42.642607 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:42.642713 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:42.888997 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 12:59:42.890300 (Thread-1): 12:59:42 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:42.890502 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:42.890678 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:42.890774 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:43.064358 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 12:59:43.065832 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:43.065939 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:43.188338 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:59:43.189735 (Thread-1): 12:59:43 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:43.195077 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:43.195193 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:43.322984 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:59:43.323170 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:43.323257 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:44.104071 (Thread-1): SQL status: SUCCESS 1 in 0.78 seconds
2021-05-03 12:59:44.110012 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:44.110131 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:44.258201 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:59:44.262663 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:44.262778 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:44.382733 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:44.385027 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:44.385138 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:45.309312 (Thread-1): SQL status: SUCCESS 0 in 0.92 seconds
2021-05-03 12:59:45.310661 (Thread-1): 12:59:45 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:45.310873 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:45.311057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:45.311150 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:45.492017 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:59:45.493157 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:45.493269 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:45.669413 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:59:45.671375 (Thread-1): 12:59:45 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:45.677107 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:45.677224 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:45.828167 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:59:45.828355 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:45.828441 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:46.676658 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:59:46.680609 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:46.680720 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:49.916951 (Thread-1): SQL status: SUCCESS 12 in 3.24 seconds
2021-05-03 12:59:49.921287 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:49.921405 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:50.082271 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:59:50.084564 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:50.084672 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:50.353303 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 12:59:50.354917 (Thread-1): 12:59:50 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:50.355124 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:50.355296 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:50.355392 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:50.543120 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:59:50.544201 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:50.544304 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:50.672601 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:59:50.674045 (Thread-1): 12:59:50 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:50.679798 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:50.679909 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:50.834321 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 12:59:50.834512 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:50.834599 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:51.744350 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 12:59:51.748259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:51.748372 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:51.900009 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 12:59:51.906115 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:51.906230 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:52.023696 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:52.025930 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:52.026061 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:52.463042 (Thread-1): SQL status: SUCCESS 0 in 0.44 seconds
2021-05-03 12:59:52.464336 (Thread-1): 12:59:52 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:52.464548 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:52.464723 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:52.464813 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:52.680241 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:59:52.681327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:52.681440 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:52.801334 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:59:52.803181 (Thread-1): 12:59:52 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:52.808430 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:52.808539 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:52.941815 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:59:52.942025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:52.942115 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:53.803979 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 12:59:53.808104 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:53.808216 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:54.033523 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 12:59:54.037893 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:54.038030 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:54.158213 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:54.160494 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:54.160602 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:54.517487 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 12:59:54.518776 (Thread-1): 12:59:54 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:54.518978 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:54.519150 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:54.519238 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:54.737418 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:59:54.738553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:54.738657 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:54.882750 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 12:59:54.884153 (Thread-1): 12:59:54 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:54.889822 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:54.889932 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:55.020522 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:59:55.020714 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:55.020800 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:55.871134 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 12:59:55.875222 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:55.875349 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:56.017813 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 12:59:56.022484 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:56.022602 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:56.185667 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 12:59:56.188031 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:56.188144 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:56.472552 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:59:56.473902 (Thread-1): 12:59:56 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:56.474141 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:56.474324 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:56.474420 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:56.694325 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 12:59:56.695833 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:56.695946 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:56.816199 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:59:56.817634 (Thread-1): 12:59:56 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:56.823075 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:56.823195 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:56.957405 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 12:59:56.957599 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:56.957691 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 12:59:57.784563 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-05-03 12:59:57.790008 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:57.790127 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 12:59:57.967209 (Thread-1): SQL status: SUCCESS 12 in 0.18 seconds
2021-05-03 12:59:57.971718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:57.971833 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 12:59:58.088338 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 12:59:58.090923 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:58.091041 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 12:59:58.369242 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 12:59:58.370606 (Thread-1): 12:59:58 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 12:59:58.370818 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:58.371001 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:58.371096 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 12:59:58.561899 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 12:59:58.563070 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:58.563180 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 12:59:58.680037 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 12:59:58.681828 (Thread-1): 12:59:58 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_customers]
2021-05-03 12:59:58.687125 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:58.687233 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 12:59:58.868977 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 12:59:58.869163 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 12:59:58.869249 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:00.043083 (Thread-1): SQL status: SUCCESS 1 in 1.17 seconds
2021-05-03 13:00:00.047282 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:00.047442 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 13:00:00.208032 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:00:00.212339 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:00.212449 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 13:00:00.384324 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 13:00:00.472695 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:00.472862 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 13:00:00.850777 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-05-03 13:00:00.852086 (Thread-1): 13:00:00 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 13:00:00.852299 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:00.852478 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:00.852573 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:01.058020 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:00:01.059138 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:01.059243 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 13:00:01.207417 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:00:01.208832 (Thread-1): 13:00:01 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_customers]
2021-05-03 13:00:01.214212 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:01.214322 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 13:00:01.353073 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:00:01.353256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:01.353341 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:02.450345 (Thread-1): SQL status: SUCCESS 1 in 1.10 seconds
2021-05-03 13:00:02.454535 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:02.454647 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 13:00:02.622519 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 13:00:02.626878 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:02.626988 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 13:00:02.748773 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 13:00:02.751089 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:02.751199 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 13:00:03.022042 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:00:03.023327 (Thread-1): 13:00:03 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 13:00:03.023527 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:03.023702 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:03.023791 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:03.249033 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:00:03.250163 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:03.250266 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 13:00:03.780689 (Thread-1): SQL status: SUCCESS 1 in 0.53 seconds
2021-05-03 13:00:03.782117 (Thread-1): 13:00:03 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_customers]
2021-05-03 13:00:03.789954 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:03.790085 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 13:00:04.012479 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 13:00:04.012675 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:04.013662 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:04.986733 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 13:00:04.990679 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:04.990803 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 13:00:05.143474 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:00:05.147990 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:05.148104 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 13:00:10.782255 (Thread-1): SQL status: SUCCESS 12 in 5.63 seconds
2021-05-03 13:00:10.784604 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:10.784718 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 13:00:11.051529 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:00:11.053214 (Thread-1): 13:00:11 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 13:00:11.053432 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:11.053612 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:11.053709 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:11.252024 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:00:11.253169 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:11.253279 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 13:00:11.374859 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:00:11.376326 (Thread-1): 13:00:11 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_customers]
2021-05-03 13:00:11.382168 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:11.382284 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 13:00:11.525812 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:00:11.526038 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:11.526128 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:12.941076 (Thread-1): SQL status: SUCCESS 1 in 1.41 seconds
2021-05-03 13:00:12.944998 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:12.945109 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 13:00:16.212815 (Thread-1): SQL status: SUCCESS 12 in 3.27 seconds
2021-05-03 13:00:16.217392 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:16.217503 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 13:00:16.365580 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:00:16.367928 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:16.368040 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 13:00:16.927927 (Thread-1): SQL status: SUCCESS 4 in 0.56 seconds
2021-05-03 13:00:16.929259 (Thread-1): 13:00:16 + Ran for day 30 of 31 (2021-05-03); 4 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 13:00:16.929481 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:16.929668 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:16.929761 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:17.252819 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 13:00:17.253934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:17.254063 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:44.400000'))) AS period_of_load
2021-05-03 13:00:17.373691 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:00:17.375105 (Thread-1): 13:00:17 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_customers]
2021-05-03 13:00:17.380466 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:17.380575 (Thread-1): On model.Dbt_demo.sat_customers: BEGIN
2021-05-03 13:00:17.562324 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 13:00:17.562530 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:17.562618 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp  as
      (select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_customers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:44.400000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:44.400000'))
    
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.CUSTOMERID, a.CUSTOMERNAME, a.CONTACT, a.CITY, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.CUSTOMERID, e.CUSTOMERNAME, e.CONTACT, e.CITY, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:18.617912 (Thread-1): SQL status: SUCCESS 1 in 1.06 seconds
2021-05-03 13:00:18.622090 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:18.622205 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
2021-05-03 13:00:19.337664 (Thread-1): SQL status: SUCCESS 12 in 0.72 seconds
2021-05-03 13:00:19.343697 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:19.343816 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers
2021-05-03 13:00:19.471922 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:00:19.474247 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:19.474356 (Thread-1): On model.Dbt_demo.sat_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_customers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers ("CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "CUSTOMER_PK", "CUSTOMER_HASHDIFF", "CUSTOMERID", "CUSTOMERNAME", "CONTACT", "CITY", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_customers__dbt_tmp
                );
2021-05-03 13:00:21.115829 (Thread-1): SQL status: SUCCESS 0 in 1.64 seconds
2021-05-03 13:00:21.117113 (Thread-1): 13:00:21 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_customers]
2021-05-03 13:00:21.117315 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:21.117488 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_customers".
2021-05-03 13:00:21.117576 (Thread-1): On model.Dbt_demo.sat_customers: COMMIT
2021-05-03 13:00:21.302311 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 13:00:21.302752 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_customers"
2021-05-03 13:00:21.305842 (Thread-1): finished collecting timing info
2021-05-03 13:00:21.306154 (Thread-1): On model.Dbt_demo.sat_customers: Close
2021-05-03 13:00:21.563329 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a26167ac0>]}
2021-05-03 13:00:21.564777 (Thread-1): 13:00:21 | 19 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_customers [INSERT 4 in 97.17s]
2021-05-03 13:00:21.564948 (Thread-1): Finished running node model.Dbt_demo.sat_customers
2021-05-03 13:00:21.565121 (Thread-1): Began running node model.Dbt_demo.hub_shippers
2021-05-03 13:00:21.566381 (Thread-1): 13:00:21 | 20 of 23 START incremental model SS_RAW_VLT.hub_shippers............. [RUN]
2021-05-03 13:00:21.566700 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:21.566824 (Thread-1): Compiling model.Dbt_demo.hub_shippers
2021-05-03 13:00:21.579706 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_shippers"
2021-05-03 13:00:21.580041 (Thread-1): finished collecting timing info
2021-05-03 13:00:21.587740 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:21.587861 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SHIPPER_PK, SHIPPERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SHIPPER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SHIPPER_PK, a.SHIPPERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers AS d
    ON a.SHIPPER_PK = d.SHIPPER_PK
    WHERE d.SHIPPER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 13:00:21.587966 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 13:00:24.466790 (Thread-1): SQL status: SUCCESS 1 in 2.88 seconds
2021-05-03 13:00:24.470383 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:24.470493 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
2021-05-03 13:00:35.139171 (Thread-1): SQL status: SUCCESS 4 in 10.67 seconds
2021-05-03 13:00:35.143140 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:35.143260 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-05-03 13:00:35.312251 (Thread-1): SQL status: SUCCESS 4 in 0.17 seconds
2021-05-03 13:00:35.316066 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:35.316176 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers
2021-05-03 13:00:35.741213 (Thread-1): SQL status: SUCCESS 4 in 0.42 seconds
2021-05-03 13:00:35.742891 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_shippers"
2021-05-03 13:00:35.743652 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:35.743753 (Thread-1): On model.Dbt_demo.hub_shippers: BEGIN
2021-05-03 13:00:41.236015 (Thread-1): SQL status: SUCCESS 1 in 5.49 seconds
2021-05-03 13:00:41.236205 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:41.236291 (Thread-1): On model.Dbt_demo.hub_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_shippers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers ("SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SHIPPER_PK", "SHIPPERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_shippers__dbt_tmp
        );
2021-05-03 13:00:43.745073 (Thread-1): SQL status: SUCCESS 0 in 2.51 seconds
2021-05-03 13:00:43.746263 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-05-03 13:00:43.746440 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_shippers".
2021-05-03 13:00:43.746531 (Thread-1): On model.Dbt_demo.hub_shippers: COMMIT
2021-05-03 13:00:43.949858 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:00:43.954078 (Thread-1): finished collecting timing info
2021-05-03 13:00:43.954353 (Thread-1): On model.Dbt_demo.hub_shippers: Close
2021-05-03 13:00:44.159207 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a262d05e0>]}
2021-05-03 13:00:44.160618 (Thread-1): 13:00:44 | 20 of 23 OK created incremental model SS_RAW_VLT.hub_shippers........ [SUCCESS 0 in 22.59s]
2021-05-03 13:00:44.160793 (Thread-1): Finished running node model.Dbt_demo.hub_shippers
2021-05-03 13:00:44.160966 (Thread-1): Began running node model.Dbt_demo.sat_shippers
2021-05-03 13:00:44.162224 (Thread-1): 13:00:44 | 21 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_shippers.. [RUN]
2021-05-03 13:00:44.162536 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:44.162657 (Thread-1): Compiling model.Dbt_demo.sat_shippers
2021-05-03 13:00:44.181916 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_shippers"
2021-05-03 13:00:44.182259 (Thread-1): finished collecting timing info
2021-05-03 13:00:44.189568 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:44.189689 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 13:00:44.189792 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 13:00:45.228466 (Thread-1): SQL status: SUCCESS 1 in 1.04 seconds
2021-05-03 13:00:45.231896 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:45.232013 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 06:00:44.971000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 06:00:44.971000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_shippers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 13:00:45.416984 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 13:00:45.420932 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:45.421047 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:00:45.568495 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:00:45.570639 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:45.570750 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:00:45.692818 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:00:45.694309 (Thread-1): 13:00:45 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_shippers]
2021-05-03 13:00:45.699813 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:45.699928 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:00:45.858142 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:00:45.858335 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:45.858425 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:46.940959 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-05-03 13:00:46.945910 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:46.946044 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:00:47.110383 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:00:47.114641 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:47.114753 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:00:47.286027 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 13:00:47.287934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:47.288041 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:00:47.669713 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-05-03 13:00:47.671037 (Thread-1): 13:00:47 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:00:47.671243 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:00:47.671416 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:47.671506 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:00:47.885628 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:00:47.886758 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:47.886864 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:00:48.015386 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:00:48.016722 (Thread-1): 13:00:48 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_shippers]
2021-05-03 13:00:48.021702 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:48.021816 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:00:48.193357 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:00:48.193543 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:48.193629 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:51.181985 (Thread-1): SQL status: SUCCESS 1 in 2.99 seconds
2021-05-03 13:00:51.186126 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:51.186235 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:00:51.661845 (Thread-1): SQL status: SUCCESS 7 in 0.48 seconds
2021-05-03 13:00:51.665856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:51.665982 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:00:51.928307 (Thread-1): SQL status: SUCCESS 7 in 0.26 seconds
2021-05-03 13:00:51.930226 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:51.930334 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:00:52.548082 (Thread-1): SQL status: SUCCESS 0 in 0.62 seconds
2021-05-03 13:00:52.549641 (Thread-1): 13:00:52 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:00:52.549846 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:00:52.550045 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:52.550137 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:00:52.763846 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:00:52.764948 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:52.765052 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:00:53.986369 (Thread-1): SQL status: SUCCESS 1 in 1.22 seconds
2021-05-03 13:00:53.987771 (Thread-1): 13:00:53 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_shippers]
2021-05-03 13:00:53.993110 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:53.993222 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:00:54.151370 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:00:54.151560 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:54.151648 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:54.960447 (Thread-1): SQL status: SUCCESS 1 in 0.81 seconds
2021-05-03 13:00:54.964368 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:54.964481 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:00:55.119478 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:00:55.123670 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:55.123781 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:00:55.267601 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:00:55.269499 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:55.269613 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:00:56.682284 (Thread-1): SQL status: SUCCESS 0 in 1.41 seconds
2021-05-03 13:00:56.683634 (Thread-1): 13:00:56 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:00:56.683854 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:00:56.684038 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:56.684133 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:00:56.898777 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:00:56.902122 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:56.902236 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:00:57.044803 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:00:57.046310 (Thread-1): 13:00:57 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_shippers]
2021-05-03 13:00:57.051435 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:57.051553 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:00:57.214754 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:00:57.214946 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:57.215035 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:00:59.814661 (Thread-1): SQL status: SUCCESS 1 in 2.60 seconds
2021-05-03 13:00:59.818950 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:00:59.819079 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:00.122317 (Thread-1): SQL status: SUCCESS 7 in 0.30 seconds
2021-05-03 13:01:00.126382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:00.126492 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:00.356440 (Thread-1): SQL status: SUCCESS 7 in 0.23 seconds
2021-05-03 13:01:00.358552 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:00.358660 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:03.928788 (Thread-1): SQL status: SUCCESS 0 in 3.57 seconds
2021-05-03 13:01:03.930107 (Thread-1): 13:01:03 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:03.930311 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:03.930483 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:03.930570 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:04.151430 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 13:01:04.152547 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:04.152653 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:04.408769 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 13:01:04.410596 (Thread-1): 13:01:04 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:04.415613 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:04.415723 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:04.712621 (Thread-1): SQL status: SUCCESS 1 in 0.30 seconds
2021-05-03 13:01:04.712808 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:04.712894 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:07.832460 (Thread-1): SQL status: SUCCESS 1 in 3.12 seconds
2021-05-03 13:01:07.836462 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:07.836576 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:08.003543 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 13:01:08.007681 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:08.007811 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:08.150463 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:01:08.152402 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:08.152525 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:08.768221 (Thread-1): SQL status: SUCCESS 0 in 0.62 seconds
2021-05-03 13:01:08.769914 (Thread-1): 13:01:08 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:08.770158 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:08.770342 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:08.770440 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:08.960846 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:01:08.962026 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:08.962139 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:12.200348 (Thread-1): SQL status: SUCCESS 1 in 3.24 seconds
2021-05-03 13:01:12.201761 (Thread-1): 13:01:12 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:12.207215 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:12.207330 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:15.876655 (Thread-1): SQL status: SUCCESS 1 in 3.67 seconds
2021-05-03 13:01:15.876841 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:15.876927 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:16.856358 (Thread-1): SQL status: SUCCESS 1 in 0.98 seconds
2021-05-03 13:01:16.860325 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:16.860452 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:17.105351 (Thread-1): SQL status: SUCCESS 7 in 0.24 seconds
2021-05-03 13:01:17.111191 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:17.111437 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:17.265588 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:01:17.267517 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:17.267625 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:20.472594 (Thread-1): SQL status: SUCCESS 0 in 3.20 seconds
2021-05-03 13:01:20.473925 (Thread-1): 13:01:20 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:20.474171 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:20.474355 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:20.474450 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:20.754833 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 13:01:20.755958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:20.756069 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:22.995856 (Thread-1): SQL status: SUCCESS 1 in 2.24 seconds
2021-05-03 13:01:22.997317 (Thread-1): 13:01:22 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:23.002488 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:23.002620 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:23.183481 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 13:01:23.183681 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:23.183773 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:25.990546 (Thread-1): SQL status: SUCCESS 1 in 2.81 seconds
2021-05-03 13:01:25.994705 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:25.994822 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:26.153151 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:01:26.157176 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:26.157288 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:26.325671 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 13:01:26.327589 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:26.327699 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:26.593764 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:01:26.595375 (Thread-1): 13:01:26 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:26.595578 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:26.595754 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:26.595843 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:26.796832 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:01:26.797926 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:26.798058 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:30.122257 (Thread-1): SQL status: SUCCESS 1 in 3.32 seconds
2021-05-03 13:01:30.123681 (Thread-1): 13:01:30 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:30.129198 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:30.129320 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:31.466792 (Thread-1): SQL status: SUCCESS 1 in 1.34 seconds
2021-05-03 13:01:31.466983 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:31.467072 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:33.416991 (Thread-1): SQL status: SUCCESS 1 in 1.95 seconds
2021-05-03 13:01:33.420915 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:33.421028 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:33.577048 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:01:33.581263 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:33.581375 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:33.743058 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:01:33.744995 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:33.745107 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:36.405946 (Thread-1): SQL status: SUCCESS 0 in 2.66 seconds
2021-05-03 13:01:36.407259 (Thread-1): 13:01:36 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:36.407463 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:36.407653 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:36.407743 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:36.677863 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-05-03 13:01:36.678990 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:36.679094 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:36.821306 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:01:36.822706 (Thread-1): 13:01:36 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:36.827703 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:36.827809 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:37.016046 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:01:37.016230 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:37.016316 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:38.267855 (Thread-1): SQL status: SUCCESS 1 in 1.25 seconds
2021-05-03 13:01:38.273553 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:38.273670 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:38.486235 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-05-03 13:01:38.590555 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:38.590718 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:38.725176 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 13:01:38.727131 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:38.727256 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:42.130347 (Thread-1): SQL status: SUCCESS 0 in 3.40 seconds
2021-05-03 13:01:42.131660 (Thread-1): 13:01:42 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:42.131871 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:42.132048 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:42.132141 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:43.044246 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 13:01:43.045785 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:43.045896 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:43.196836 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:01:43.198287 (Thread-1): 13:01:43 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:43.203401 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:43.203512 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:43.435818 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:01:43.436011 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:43.436101 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:44.372516 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-05-03 13:01:44.376724 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:44.376834 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:45.186421 (Thread-1): SQL status: SUCCESS 7 in 0.81 seconds
2021-05-03 13:01:45.190505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:45.190623 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:45.331945 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:01:45.333815 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:45.333921 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:45.593554 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 13:01:45.594873 (Thread-1): 13:01:45 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:45.595080 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:45.595256 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:45.595346 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:46.218704 (Thread-1): SQL status: SUCCESS 1 in 0.62 seconds
2021-05-03 13:01:46.219805 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:46.219910 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:46.365439 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:01:46.367280 (Thread-1): 13:01:46 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:46.372307 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:46.372414 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:49.640121 (Thread-1): SQL status: SUCCESS 1 in 3.27 seconds
2021-05-03 13:01:49.640311 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:49.640397 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:50.462813 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-05-03 13:01:50.466787 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:50.466899 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:50.616796 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:01:50.620720 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:50.620829 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:50.760585 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:01:50.762546 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:50.762660 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:51.094278 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 13:01:51.097749 (Thread-1): 13:01:51 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:51.097983 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:51.098167 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:51.098266 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:51.325141 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:01:51.326298 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:51.326410 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:51.454816 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:01:51.456266 (Thread-1): 13:01:51 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:51.461361 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:51.461474 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:51.632093 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:01:51.632283 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:51.632378 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:52.492213 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 13:01:52.496132 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:52.496252 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:52.689280 (Thread-1): SQL status: SUCCESS 7 in 0.19 seconds
2021-05-03 13:01:52.693501 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:52.693626 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:52.837903 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:01:52.839848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:52.839954 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:53.120858 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 13:01:53.122186 (Thread-1): 13:01:53 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:53.122392 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:53.122575 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:53.122665 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:53.351321 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:01:53.352433 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:53.352549 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:53.481988 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:01:53.483404 (Thread-1): 13:01:53 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:53.488788 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:53.488898 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:53.675840 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:01:53.676025 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:53.676120 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:01:54.563033 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 13:01:54.567014 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:54.567129 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:01:54.723140 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:01:54.727319 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:54.727430 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:01:54.970968 (Thread-1): SQL status: SUCCESS 7 in 0.24 seconds
2021-05-03 13:01:54.972878 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:54.972987 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:01:55.363663 (Thread-1): SQL status: SUCCESS 0 in 0.39 seconds
2021-05-03 13:01:55.364957 (Thread-1): 13:01:55 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:55.365166 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:55.365343 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:55.365432 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:01:58.695881 (Thread-1): SQL status: SUCCESS 1 in 3.33 seconds
2021-05-03 13:01:58.696934 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:58.697039 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:01:58.832527 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:01:58.833941 (Thread-1): 13:01:58 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_shippers]
2021-05-03 13:01:58.838988 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:58.839096 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:01:58.988946 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:01:58.989129 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:01:58.989216 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:00.055056 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-05-03 13:02:00.058947 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:00.059066 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:00.221984 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:02:00.227552 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:00.227664 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:02.469137 (Thread-1): SQL status: SUCCESS 7 in 2.24 seconds
2021-05-03 13:02:02.471064 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:02.471175 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:03.017705 (Thread-1): SQL status: SUCCESS 0 in 0.55 seconds
2021-05-03 13:02:03.019022 (Thread-1): 13:02:03 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:03.019229 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:03.019405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:03.019494 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:03.226824 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:02:03.227926 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:03.228032 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:03.491926 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 13:02:03.493742 (Thread-1): 13:02:03 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:03.498807 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:03.498916 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:03.893605 (Thread-1): SQL status: SUCCESS 1 in 0.39 seconds
2021-05-03 13:02:03.893789 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:03.893876 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:05.073908 (Thread-1): SQL status: SUCCESS 1 in 1.18 seconds
2021-05-03 13:02:05.077944 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:05.078088 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:05.363125 (Thread-1): SQL status: SUCCESS 7 in 0.28 seconds
2021-05-03 13:02:05.367330 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:05.367443 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:05.506670 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:02:05.508544 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:05.508650 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:05.799759 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 13:02:05.801038 (Thread-1): 13:02:05 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:05.801241 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:05.801418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:05.801508 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:06.032607 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:02:06.033644 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:06.033747 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:06.170968 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:02:06.172446 (Thread-1): 13:02:06 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:06.177497 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:06.177607 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:06.333062 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:02:06.333249 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:06.333335 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:07.290116 (Thread-1): SQL status: SUCCESS 1 in 0.96 seconds
2021-05-03 13:02:07.293926 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:07.294058 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:07.448902 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:02:07.452984 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:07.453097 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:07.665687 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-05-03 13:02:07.667805 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:07.667913 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:07.938354 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:02:07.939636 (Thread-1): 13:02:07 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:07.939838 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:07.940012 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:07.940102 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:08.223960 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 13:02:08.225050 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:08.225153 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:08.378979 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:02:08.380795 (Thread-1): 13:02:08 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:08.385776 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:08.385891 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:11.680234 (Thread-1): SQL status: SUCCESS 1 in 3.29 seconds
2021-05-03 13:02:11.680420 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:11.680516 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:12.469161 (Thread-1): SQL status: SUCCESS 1 in 0.79 seconds
2021-05-03 13:02:12.474666 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:12.474777 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:12.634476 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:02:12.638652 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:12.638762 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:12.768641 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 13:02:12.770579 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:12.770689 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:13.052415 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 13:02:13.053701 (Thread-1): 13:02:13 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:13.053918 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:13.054118 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:13.054208 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:14.428441 (Thread-1): SQL status: SUCCESS 1 in 1.37 seconds
2021-05-03 13:02:14.429907 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:14.430042 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:14.690597 (Thread-1): SQL status: SUCCESS 1 in 0.26 seconds
2021-05-03 13:02:14.692012 (Thread-1): 13:02:14 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:14.697047 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:14.697156 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:14.843474 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:02:14.843669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:14.843757 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:18.897386 (Thread-1): SQL status: SUCCESS 1 in 4.05 seconds
2021-05-03 13:02:18.901224 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:18.901339 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:19.062396 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:02:19.066475 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:19.066584 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:19.323357 (Thread-1): SQL status: SUCCESS 7 in 0.26 seconds
2021-05-03 13:02:19.325302 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:19.325410 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:19.568167 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 13:02:19.569469 (Thread-1): 13:02:19 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:19.569672 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:19.569845 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:19.569936 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:19.920486 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-05-03 13:02:19.921594 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:19.921698 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:20.056674 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:02:20.058593 (Thread-1): 13:02:20 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:20.063957 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:20.064066 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:20.234102 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:02:20.234290 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:20.234382 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:21.229074 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-05-03 13:02:21.233064 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:21.233175 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:49.768791 (Thread-1): SQL status: SUCCESS 7 in 28.54 seconds
2021-05-03 13:02:49.773050 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:49.773165 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:49.907879 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 13:02:49.909790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:49.909902 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:50.292467 (Thread-1): SQL status: SUCCESS 0 in 0.38 seconds
2021-05-03 13:02:50.293774 (Thread-1): 13:02:50 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:50.294015 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:50.294198 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:50.294292 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:50.496480 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:02:50.499826 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:50.499940 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:50.641478 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:02:50.642900 (Thread-1): 13:02:50 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:50.647912 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:50.648021 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:50.812179 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:02:50.812368 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:50.812456 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:53.701757 (Thread-1): SQL status: SUCCESS 1 in 2.89 seconds
2021-05-03 13:02:53.705561 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:53.705672 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:54.102938 (Thread-1): SQL status: SUCCESS 7 in 0.40 seconds
2021-05-03 13:02:54.107042 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:54.107152 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:54.486421 (Thread-1): SQL status: SUCCESS 7 in 0.38 seconds
2021-05-03 13:02:54.488559 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:54.488665 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:54.900108 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-05-03 13:02:54.901389 (Thread-1): 13:02:54 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:54.901590 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:54.901765 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:54.901856 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:55.108529 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:02:55.109615 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:55.109721 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:55.318208 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:02:55.319994 (Thread-1): 13:02:55 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:55.324984 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:55.325093 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:55.492326 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:02:55.492512 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:55.492610 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:56.384693 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 13:02:56.388655 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:56.388765 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:56.538304 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:02:56.542590 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:56.542707 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:56.682540 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:02:56.684452 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:56.684560 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:56.948460 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 13:02:56.949770 (Thread-1): 13:02:56 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:56.950006 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:56.950189 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:56.950282 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:57.478605 (Thread-1): SQL status: SUCCESS 1 in 0.53 seconds
2021-05-03 13:02:57.479669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:57.479778 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:57.604920 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:02:57.606385 (Thread-1): 13:02:57 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:57.611455 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:57.611567 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:57.776346 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:02:57.776529 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:57.776615 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:02:58.595558 (Thread-1): SQL status: SUCCESS 1 in 0.82 seconds
2021-05-03 13:02:58.599379 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:58.599489 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:02:58.765174 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 13:02:58.770751 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:58.770861 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:02:58.917589 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:02:58.919706 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:58.919812 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:02:59.279141 (Thread-1): SQL status: SUCCESS 0 in 0.36 seconds
2021-05-03 13:02:59.280407 (Thread-1): 13:02:59 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:59.280613 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:59.280797 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:59.280895 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:02:59.492105 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:02:59.493212 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:59.493317 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:02:59.686257 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:02:59.688047 (Thread-1): 13:02:59 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_shippers]
2021-05-03 13:02:59.693057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:59.693164 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:02:59.839924 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:02:59.840109 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:02:59.840194 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:00.937233 (Thread-1): SQL status: SUCCESS 1 in 1.10 seconds
2021-05-03 13:03:00.941218 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:00.941327 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:01.446367 (Thread-1): SQL status: SUCCESS 7 in 0.50 seconds
2021-05-03 13:03:01.450567 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:01.450684 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:01.917093 (Thread-1): SQL status: SUCCESS 7 in 0.47 seconds
2021-05-03 13:03:01.919012 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:01.919119 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:02.495806 (Thread-1): SQL status: SUCCESS 0 in 0.58 seconds
2021-05-03 13:03:02.497111 (Thread-1): 13:03:02 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:02.497322 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:02.497499 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:02.497588 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:02.862894 (Thread-1): SQL status: SUCCESS 1 in 0.37 seconds
2021-05-03 13:03:02.863950 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:02.864054 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:02.991477 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:03:02.992910 (Thread-1): 13:03:02 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:02.997983 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:02.998102 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:03.482635 (Thread-1): SQL status: SUCCESS 1 in 0.48 seconds
2021-05-03 13:03:03.482828 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:03.482914 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:04.350175 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 13:03:04.354013 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:04.354131 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:04.626003 (Thread-1): SQL status: SUCCESS 7 in 0.27 seconds
2021-05-03 13:03:04.630064 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:04.630174 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:04.810327 (Thread-1): SQL status: SUCCESS 7 in 0.18 seconds
2021-05-03 13:03:04.812402 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:04.812510 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:05.530774 (Thread-1): SQL status: SUCCESS 0 in 0.72 seconds
2021-05-03 13:03:05.532041 (Thread-1): 13:03:05 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:05.532242 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:05.532421 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:05.532511 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:05.780016 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 13:03:05.781110 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:05.781214 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:05.912500 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:03:05.914282 (Thread-1): 13:03:05 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:05.919243 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:05.919354 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:06.068088 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:03:06.068279 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:06.068365 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:08.601483 (Thread-1): SQL status: SUCCESS 1 in 2.53 seconds
2021-05-03 13:03:08.607033 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:08.607154 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:08.767304 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:03:08.771502 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:08.771622 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:09.449212 (Thread-1): SQL status: SUCCESS 7 in 0.68 seconds
2021-05-03 13:03:09.451158 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:09.451269 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:09.728359 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 13:03:09.729643 (Thread-1): 13:03:09 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:09.729845 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:09.730051 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:09.730141 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:09.932938 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:03:09.934454 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:09.934559 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:10.057342 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:03:10.058767 (Thread-1): 13:03:10 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:10.063789 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:10.063897 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:10.617756 (Thread-1): SQL status: SUCCESS 1 in 0.55 seconds
2021-05-03 13:03:10.617937 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:10.618054 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:12.174828 (Thread-1): SQL status: SUCCESS 1 in 1.56 seconds
2021-05-03 13:03:12.178663 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:12.178773 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:12.416650 (Thread-1): SQL status: SUCCESS 7 in 0.24 seconds
2021-05-03 13:03:12.420749 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:12.420860 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:12.554626 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 13:03:12.556729 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:12.556836 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:12.902019 (Thread-1): SQL status: SUCCESS 0 in 0.35 seconds
2021-05-03 13:03:12.903318 (Thread-1): 13:03:12 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:12.903528 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:12.903710 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:12.903801 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:13.110113 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:03:13.111225 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:13.111329 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:13.441036 (Thread-1): SQL status: SUCCESS 1 in 0.33 seconds
2021-05-03 13:03:13.442468 (Thread-1): 13:03:13 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:13.447886 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:13.447991 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:13.613920 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:03:13.614130 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:13.614218 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:15.581917 (Thread-1): SQL status: SUCCESS 1 in 1.97 seconds
2021-05-03 13:03:15.585885 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:15.586014 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:15.792037 (Thread-1): SQL status: SUCCESS 7 in 0.21 seconds
2021-05-03 13:03:15.796200 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:15.796323 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:15.931642 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:03:16.033489 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:16.033652 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:16.316764 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 13:03:16.318084 (Thread-1): 13:03:16 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:16.318292 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:16.318470 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:16.318559 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:16.913484 (Thread-1): SQL status: SUCCESS 1 in 0.59 seconds
2021-05-03 13:03:16.914636 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:16.914743 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:19.161008 (Thread-1): SQL status: SUCCESS 1 in 2.25 seconds
2021-05-03 13:03:19.164690 (Thread-1): 13:03:19 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:19.169689 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:19.169802 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:19.328992 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:03:19.329177 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:19.329262 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:20.552501 (Thread-1): SQL status: SUCCESS 1 in 1.22 seconds
2021-05-03 13:03:20.556514 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:20.556632 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:20.726649 (Thread-1): SQL status: SUCCESS 7 in 0.17 seconds
2021-05-03 13:03:20.730823 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:20.730933 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:20.875756 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:03:20.877650 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:20.877757 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:21.287625 (Thread-1): SQL status: SUCCESS 0 in 0.41 seconds
2021-05-03 13:03:21.288910 (Thread-1): 13:03:21 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:21.289115 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:21.289288 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:21.289377 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:21.641276 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-05-03 13:03:21.642344 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:21.642462 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:21.784740 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:03:21.786177 (Thread-1): 13:03:21 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:21.791180 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:21.791288 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:21.997499 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:03:21.997693 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:21.997779 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:22.843129 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 13:03:22.846992 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:22.847104 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:23.009496 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:03:23.013688 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:23.013814 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:23.147877 (Thread-1): SQL status: SUCCESS 7 in 0.13 seconds
2021-05-03 13:03:23.150028 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:23.150138 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:23.457738 (Thread-1): SQL status: SUCCESS 0 in 0.31 seconds
2021-05-03 13:03:23.459043 (Thread-1): 13:03:23 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:23.459248 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:23.459423 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:23.459520 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:23.661166 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:03:23.662294 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:23.662400 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:23.839156 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 13:03:23.840576 (Thread-1): 13:03:23 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:23.845995 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:23.846118 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:24.011756 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:03:24.011948 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:24.012037 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:24.934608 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-05-03 13:03:24.938597 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:24.938712 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:25.092807 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:03:25.098691 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:25.098812 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:25.244292 (Thread-1): SQL status: SUCCESS 7 in 0.15 seconds
2021-05-03 13:03:25.246250 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:25.246365 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:28.658691 (Thread-1): SQL status: SUCCESS 0 in 3.41 seconds
2021-05-03 13:03:28.659969 (Thread-1): 13:03:28 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:28.660171 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:28.660343 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:28.660443 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:28.889794 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:03:28.890925 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:28.891035 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:49.248000'))) AS period_of_load
2021-05-03 13:03:29.020175 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:03:29.021572 (Thread-1): 13:03:29 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:29.026596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:29.026704 (Thread-1): On model.Dbt_demo.sat_shippers: BEGIN
2021-05-03 13:03:29.175077 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:03:29.175269 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:29.175354 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp  as
      (select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_shippers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:49.248000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:49.248000'))
    
),

update_records AS (
    SELECT a.SHIPPER_PK, a.SHIPPER_HASHDIFF, a.SHIPPERID, a.COMPANYNAME, a.PHONE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers as a
    JOIN source_data as b
    ON a.SHIPPER_PK = b.SHIPPER_PK
),

latest_records AS (
    SELECT c.SHIPPER_PK, c.SHIPPER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SHIPPER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SHIPPER_PK, e.SHIPPER_HASHDIFF, e.SHIPPERID, e.COMPANYNAME, e.PHONE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SHIPPER_HASHDIFF = e.SHIPPER_HASHDIFF
    WHERE latest_records.SHIPPER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:30.248604 (Thread-1): SQL status: SUCCESS 1 in 1.07 seconds
2021-05-03 13:03:30.252903 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:30.253030 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
2021-05-03 13:03:30.417149 (Thread-1): SQL status: SUCCESS 7 in 0.16 seconds
2021-05-03 13:03:30.421265 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:30.421397 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers
2021-05-03 13:03:30.564820 (Thread-1): SQL status: SUCCESS 7 in 0.14 seconds
2021-05-03 13:03:30.566760 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:30.566885 (Thread-1): On model.Dbt_demo.sat_shippers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_shippers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers ("SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SHIPPER_PK", "SHIPPER_HASHDIFF", "SHIPPERID", "COMPANYNAME", "PHONE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_shippers__dbt_tmp
                );
2021-05-03 13:03:30.971778 (Thread-1): SQL status: SUCCESS 0 in 0.40 seconds
2021-05-03 13:03:30.973426 (Thread-1): 13:03:30 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_shippers]
2021-05-03 13:03:30.973636 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:30.973811 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_shippers".
2021-05-03 13:03:30.973900 (Thread-1): On model.Dbt_demo.sat_shippers: COMMIT
2021-05-03 13:03:31.178099 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:03:31.178535 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_shippers"
2021-05-03 13:03:31.181590 (Thread-1): finished collecting timing info
2021-05-03 13:03:31.181864 (Thread-1): On model.Dbt_demo.sat_shippers: Close
2021-05-03 13:03:31.416207 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a26141460>]}
2021-05-03 13:03:31.417651 (Thread-1): 13:03:31 | 21 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_shippers [INSERT 0 in 167.25s]
2021-05-03 13:03:31.417821 (Thread-1): Finished running node model.Dbt_demo.sat_shippers
2021-05-03 13:03:31.418013 (Thread-1): Began running node model.Dbt_demo.hub_suppliers
2021-05-03 13:03:31.419175 (Thread-1): 13:03:31 | 22 of 23 START incremental model SS_RAW_VLT.hub_suppliers............ [RUN]
2021-05-03 13:03:31.419606 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:31.419731 (Thread-1): Compiling model.Dbt_demo.hub_suppliers
2021-05-03 13:03:31.432882 (Thread-1): Writing injected SQL for node "model.Dbt_demo.hub_suppliers"
2021-05-03 13:03:31.433222 (Thread-1): finished collecting timing info
2021-05-03 13:03:31.440862 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:31.440988 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    

      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp  as
      (-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT SUPPLIER_PK, SUPPLIERID, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY SUPPLIER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIERID, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers AS d
    ON a.SUPPLIER_PK = d.SUPPLIER_PK
    WHERE d.SUPPLIER_PK IS NULL
)

SELECT * FROM records_to_insert
      );
2021-05-03 13:03:31.441099 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 13:03:33.464359 (Thread-1): SQL status: SUCCESS 1 in 2.02 seconds
2021-05-03 13:03:33.469351 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:33.469471 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
2021-05-03 13:03:33.616738 (Thread-1): SQL status: SUCCESS 4 in 0.15 seconds
2021-05-03 13:03:33.620666 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:33.620782 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-05-03 13:03:33.789281 (Thread-1): SQL status: SUCCESS 4 in 0.17 seconds
2021-05-03 13:03:33.793365 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:33.793474 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers
2021-05-03 13:03:35.096897 (Thread-1): SQL status: SUCCESS 4 in 1.30 seconds
2021-05-03 13:03:35.098587 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.hub_suppliers"
2021-05-03 13:03:35.099358 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:35.099461 (Thread-1): On model.Dbt_demo.hub_suppliers: BEGIN
2021-05-03 13:03:35.258011 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:03:35.258192 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:35.258277 (Thread-1): On model.Dbt_demo.hub_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.hub_suppliers"} */


        insert into DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers ("SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE")
        (
            select "SUPPLIER_PK", "SUPPLIERID", "LOAD_DATE", "RECORD_SOURCE"
            from DATAVAULTDEMO_DB.SS_RAW_VLT.hub_suppliers__dbt_tmp
        );
2021-05-03 13:03:35.562782 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 13:03:35.563929 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-05-03 13:03:35.564108 (Thread-1): Using snowflake connection "model.Dbt_demo.hub_suppliers".
2021-05-03 13:03:35.564200 (Thread-1): On model.Dbt_demo.hub_suppliers: COMMIT
2021-05-03 13:03:35.786595 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 13:03:35.791158 (Thread-1): finished collecting timing info
2021-05-03 13:03:35.791441 (Thread-1): On model.Dbt_demo.hub_suppliers: Close
2021-05-03 13:03:36.279064 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a246f0bb0>]}
2021-05-03 13:03:36.280494 (Thread-1): 13:03:36 | 22 of 23 OK created incremental model SS_RAW_VLT.hub_suppliers....... [SUCCESS 0 in 4.86s]
2021-05-03 13:03:36.280669 (Thread-1): Finished running node model.Dbt_demo.hub_suppliers
2021-05-03 13:03:36.280842 (Thread-1): Began running node model.Dbt_demo.sat_suppliers
2021-05-03 13:03:36.281991 (Thread-1): 13:03:36 | 23 of 23 START vault_insert_by_period model SS_RAW_VLT.sat_suppliers. [RUN]
2021-05-03 13:03:36.282518 (Thread-1): Acquiring new snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:36.282674 (Thread-1): Compiling model.Dbt_demo.sat_suppliers
2021-05-03 13:03:36.304797 (Thread-1): Writing injected SQL for node "model.Dbt_demo.sat_suppliers"
2021-05-03 13:03:36.305146 (Thread-1): finished collecting timing info
2021-05-03 13:03:36.312749 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:36.312882 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

            WITH stage AS (
            
                SELECT LOAD_DATE FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers
                
            )

            SELECT MIN(LOAD_DATE) AS MIN, MAX(LOAD_DATE) AS MAX
            FROM stage
2021-05-03 13:03:36.312987 (Thread-1): Opening a new connection, currently in state closed
2021-05-03 13:03:37.407278 (Thread-1): SQL status: SUCCESS 1 in 1.09 seconds
2021-05-03 13:03:37.410612 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:37.410721 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
with data as (
            select
                coalesce(max(LOAD_DATE), '2021-05-03 06:03:37.098000-07:00')::timestamp as start_timestamp,
                coalesce(

    dateadd(
        millisecond,
        86399999,
        nullif('2021-05-03 06:03:37.098000-07:00','none')::timestamp
        )

,
                         
    current_timestamp::
    timestamp_ntz

 ) as stop_timestamp
            from SS_RAW_VLT.sat_suppliers
        )
        select
            start_timestamp,
            stop_timestamp,
            

    datediff(
        day,
        start_timestamp,
        stop_timestamp
        )

 + 1 as num_periods
        from data
2021-05-03 13:03:37.901746 (Thread-1): SQL status: SUCCESS 1 in 0.49 seconds
2021-05-03 13:03:37.905552 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:37.905666 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:38.054432 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:03:38.056814 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:38.056922 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 0, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:38.173703 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:03:38.175101 (Thread-1): 13:03:38 + Running for day 1 of 31 (2021-04-04) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:38.180511 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:38.180622 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:38.331786 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:03:38.331967 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:38.332053 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '0 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:40.284874 (Thread-1): SQL status: SUCCESS 1 in 1.95 seconds
2021-05-03 13:03:40.288795 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:40.288907 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:40.554526 (Thread-1): SQL status: SUCCESS 12 in 0.27 seconds
2021-05-03 13:03:40.559001 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:40.559112 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:40.789762 (Thread-1): SQL status: SUCCESS 12 in 0.23 seconds
2021-05-03 13:03:40.792081 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:40.792188 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:03:41.259491 (Thread-1): SQL status: SUCCESS 0 in 0.47 seconds
2021-05-03 13:03:41.260782 (Thread-1): 13:03:41 + Ran for day 1 of 31 (2021-04-04); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:41.260988 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:41.261162 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:41.261259 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:41.640331 (Thread-1): SQL status: SUCCESS 1 in 0.38 seconds
2021-05-03 13:03:41.641436 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:41.641540 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 1, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:41.767162 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:03:41.768573 (Thread-1): 13:03:41 + Running for day 2 of 31 (2021-04-05) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:41.774403 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:41.774519 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:42.090650 (Thread-1): SQL status: SUCCESS 1 in 0.32 seconds
2021-05-03 13:03:42.090838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:42.090925 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '1 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:43.628436 (Thread-1): SQL status: SUCCESS 1 in 1.54 seconds
2021-05-03 13:03:43.632414 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:43.632529 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:43.856889 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 13:03:43.861382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:43.861493 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:44.233003 (Thread-1): SQL status: SUCCESS 12 in 0.37 seconds
2021-05-03 13:03:44.235291 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:44.235398 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:03:44.921497 (Thread-1): SQL status: SUCCESS 0 in 0.69 seconds
2021-05-03 13:03:44.922811 (Thread-1): 13:03:44 + Ran for day 2 of 31 (2021-04-05); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:44.923023 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:44.923211 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:44.923300 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:45.396285 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-05-03 13:03:45.397733 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:45.397838 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 2, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:45.551343 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:03:45.552768 (Thread-1): 13:03:45 + Running for day 3 of 31 (2021-04-06) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:45.558157 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:45.558267 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:45.717742 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:03:45.717929 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:45.718046 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '2 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:46.999645 (Thread-1): SQL status: SUCCESS 1 in 1.28 seconds
2021-05-03 13:03:47.003467 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:47.003577 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:47.659896 (Thread-1): SQL status: SUCCESS 12 in 0.66 seconds
2021-05-03 13:03:47.664302 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:47.664418 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:47.812174 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:03:47.814446 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:47.814554 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:03:48.093160 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 13:03:48.094469 (Thread-1): 13:03:48 + Ran for day 3 of 31 (2021-04-06); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:48.094674 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:48.094858 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:48.094947 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:48.374185 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 13:03:48.375287 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:48.375392 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 3, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:48.542184 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:03:48.543586 (Thread-1): 13:03:48 + Running for day 4 of 31 (2021-04-07) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:48.549648 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:48.549759 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:48.687052 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:03:48.687239 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:48.687325 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '3 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:49.624976 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-05-03 13:03:49.629057 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:49.629174 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:49.793216 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:03:49.797891 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:49.798031 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:49.957716 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:03:49.960049 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:49.960162 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:03:50.205996 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 13:03:50.207337 (Thread-1): 13:03:50 + Ran for day 4 of 31 (2021-04-07); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:50.207548 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:50.207734 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:50.207828 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:50.421134 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:03:50.422669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:50.422785 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 4, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:50.601146 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 13:03:50.602579 (Thread-1): 13:03:50 + Running for day 5 of 31 (2021-04-08) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:50.607943 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:50.608052 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:50.748292 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:03:50.748480 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:50.748566 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '4 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:51.574857 (Thread-1): SQL status: SUCCESS 1 in 0.83 seconds
2021-05-03 13:03:51.578664 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:51.578774 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:51.732294 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:03:51.736647 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:51.736764 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:51.955995 (Thread-1): SQL status: SUCCESS 12 in 0.22 seconds
2021-05-03 13:03:51.960165 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:51.960294 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:03:52.225472 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:03:52.226777 (Thread-1): 13:03:52 + Ran for day 5 of 31 (2021-04-08); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:52.226981 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:52.227167 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:52.227257 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:52.515656 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-05-03 13:03:52.516757 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:52.516869 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 5, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:52.653155 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:03:52.654959 (Thread-1): 13:03:52 + Running for day 6 of 31 (2021-04-09) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:52.660442 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:52.660556 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:52.806032 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:03:52.806219 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:52.806307 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '5 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:54.727927 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2021-05-03 13:03:54.731993 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:54.732116 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:54.943644 (Thread-1): SQL status: SUCCESS 12 in 0.21 seconds
2021-05-03 13:03:54.948189 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:54.948322 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:55.133480 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 13:03:55.135778 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:55.135888 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:03:55.402411 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:03:55.404048 (Thread-1): 13:03:55 + Ran for day 6 of 31 (2021-04-09); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:55.404256 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:55.404434 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:55.404523 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:55.611886 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:03:55.612963 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:55.613068 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 6, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:55.741195 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:03:55.742627 (Thread-1): 13:03:55 + Running for day 7 of 31 (2021-04-10) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:55.748323 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:55.748430 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:55.942306 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:03:55.942502 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:55.942590 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '6 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:56.838690 (Thread-1): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 13:03:56.842598 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:56.842710 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:57.000024 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:03:57.004403 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:57.004513 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:03:57.156544 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:03:57.158839 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:57.158950 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:03:57.439996 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 13:03:57.441294 (Thread-1): 13:03:57 + Ran for day 7 of 31 (2021-04-10); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:57.441497 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:57.441673 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:57.441762 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:03:57.678429 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 13:03:57.679542 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:57.679648 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 7, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:03:57.807143 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:03:57.808933 (Thread-1): 13:03:57 + Running for day 8 of 31 (2021-04-11) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:03:57.814339 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:57.814446 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:03:57.963524 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:03:57.963709 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:57.963793 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '7 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:03:58.934186 (Thread-1): SQL status: SUCCESS 1 in 0.97 seconds
2021-05-03 13:03:58.938160 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:58.938271 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:03:59.098075 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:03:59.104093 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:03:59.104203 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:02.706929 (Thread-1): SQL status: SUCCESS 12 in 3.60 seconds
2021-05-03 13:04:02.709240 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:02.709355 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:03.050300 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 13:04:03.051935 (Thread-1): 13:04:03 + Ran for day 8 of 31 (2021-04-11); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:03.052155 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:03.052327 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:03.052418 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:03.248477 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:04:03.249568 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:03.249671 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 8, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:03.483341 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:04:03.484760 (Thread-1): 13:04:03 + Running for day 9 of 31 (2021-04-12) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:03.490165 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:03.490271 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:03.637387 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:03.637576 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:03.637663 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '8 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:04.717738 (Thread-1): SQL status: SUCCESS 1 in 1.08 seconds
2021-05-03 13:04:04.721653 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:04.721766 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:04.867333 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:04:04.959659 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:04.959833 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:05.089939 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:05.092244 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:05.092351 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:05.417759 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 13:04:05.419436 (Thread-1): 13:04:05 + Ran for day 9 of 31 (2021-04-12); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:05.419645 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:05.419818 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:05.419905 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:05.883902 (Thread-1): SQL status: SUCCESS 1 in 0.46 seconds
2021-05-03 13:04:05.885002 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:05.885113 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 9, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:06.011447 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:04:06.012858 (Thread-1): 13:04:06 + Running for day 10 of 31 (2021-04-13) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:06.018613 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:06.018729 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:06.158263 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:04:06.158450 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:06.158535 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '9 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:07.442972 (Thread-1): SQL status: SUCCESS 1 in 1.28 seconds
2021-05-03 13:04:07.446900 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:07.447013 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:07.831413 (Thread-1): SQL status: SUCCESS 12 in 0.38 seconds
2021-05-03 13:04:07.835818 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:07.835928 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:07.973106 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 13:04:07.975415 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:07.975524 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:10.631849 (Thread-1): SQL status: SUCCESS 0 in 2.66 seconds
2021-05-03 13:04:10.633128 (Thread-1): 13:04:10 + Ran for day 10 of 31 (2021-04-13); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:10.633333 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:10.633506 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:10.633594 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:10.841660 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:04:10.842809 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:10.842915 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 10, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:10.976926 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:04:10.978739 (Thread-1): 13:04:10 + Running for day 11 of 31 (2021-04-14) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:10.984063 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:10.984173 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:11.118011 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:04:11.118195 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:11.118292 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '10 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:12.390586 (Thread-1): SQL status: SUCCESS 1 in 1.27 seconds
2021-05-03 13:04:12.396261 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:12.396375 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:12.553075 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:04:12.557600 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:12.557726 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:12.703786 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:04:12.706101 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:12.706214 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:13.038753 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 13:04:13.040395 (Thread-1): 13:04:13 + Ran for day 11 of 31 (2021-04-14); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:13.040612 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:13.040787 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:13.040877 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:13.254423 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:04:13.255517 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:13.255620 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 11, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:13.376843 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:04:13.378282 (Thread-1): 13:04:13 + Running for day 12 of 31 (2021-04-15) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:13.383718 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:13.383827 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:13.536681 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:13.536872 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:13.536957 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '11 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:14.338636 (Thread-1): SQL status: SUCCESS 1 in 0.80 seconds
2021-05-03 13:04:14.342531 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:14.342641 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:14.476979 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:14.481385 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:14.481498 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:14.616357 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:14.618651 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:14.618765 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:14.874408 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 13:04:14.875704 (Thread-1): 13:04:14 + Ran for day 12 of 31 (2021-04-15); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:14.875911 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:14.876092 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:14.876183 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:15.069885 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:04:15.071027 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:15.071132 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 12, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:15.191790 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:04:15.193598 (Thread-1): 13:04:15 + Running for day 13 of 31 (2021-04-16) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:15.198942 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:15.199050 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:15.349909 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:15.350120 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:15.350206 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '12 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:16.295315 (Thread-1): SQL status: SUCCESS 1 in 0.94 seconds
2021-05-03 13:04:16.299340 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:16.299461 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:16.470511 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 13:04:16.474958 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:16.475069 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:16.614615 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 13:04:16.616865 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:16.616972 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:16.886650 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:04:16.890138 (Thread-1): 13:04:16 + Ran for day 13 of 31 (2021-04-16); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:16.890355 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:16.890526 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:16.890615 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:17.095268 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:04:17.096350 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:17.096454 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 13, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:17.221561 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:04:17.222982 (Thread-1): 13:04:17 + Running for day 14 of 31 (2021-04-17) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:17.228352 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:17.228464 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:17.405470 (Thread-1): SQL status: SUCCESS 1 in 0.18 seconds
2021-05-03 13:04:17.405669 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:17.405762 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '13 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:18.337704 (Thread-1): SQL status: SUCCESS 1 in 0.93 seconds
2021-05-03 13:04:18.341632 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:18.341749 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:18.505480 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:04:18.509995 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:18.510115 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:18.647217 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 13:04:18.649539 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:18.649661 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:18.937002 (Thread-1): SQL status: SUCCESS 0 in 0.29 seconds
2021-05-03 13:04:18.938367 (Thread-1): 13:04:18 + Ran for day 14 of 31 (2021-04-17); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:18.938581 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:18.938764 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:18.938859 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:19.287025 (Thread-1): SQL status: SUCCESS 1 in 0.35 seconds
2021-05-03 13:04:19.288152 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:19.288263 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 14, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:19.413331 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:04:19.414813 (Thread-1): 13:04:19 + Running for day 15 of 31 (2021-04-18) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:19.420690 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:19.420809 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:19.566403 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:19.566596 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:19.566690 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '14 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:20.425792 (Thread-1): SQL status: SUCCESS 1 in 0.86 seconds
2021-05-03 13:04:20.429903 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:20.430046 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:20.576336 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:04:20.581024 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:20.581145 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:20.726943 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:04:20.729257 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:20.729371 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:21.207758 (Thread-1): SQL status: SUCCESS 0 in 0.48 seconds
2021-05-03 13:04:21.209030 (Thread-1): 13:04:21 + Ran for day 15 of 31 (2021-04-18); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:21.209234 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:21.209409 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:21.209498 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:21.488379 (Thread-1): SQL status: SUCCESS 1 in 0.28 seconds
2021-05-03 13:04:21.489838 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:21.489944 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 15, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:21.614882 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:04:21.616270 (Thread-1): 13:04:21 + Running for day 16 of 31 (2021-04-19) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:21.621616 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:21.621734 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:22.000293 (Thread-1): SQL status: SUCCESS 1 in 0.38 seconds
2021-05-03 13:04:22.000476 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:22.000562 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '15 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:22.853326 (Thread-1): SQL status: SUCCESS 1 in 0.85 seconds
2021-05-03 13:04:22.857535 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:22.857644 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:23.477761 (Thread-1): SQL status: SUCCESS 12 in 0.62 seconds
2021-05-03 13:04:23.483766 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:23.483881 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:23.615348 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:23.617796 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:23.617907 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:23.876938 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 13:04:23.878255 (Thread-1): 13:04:23 + Ran for day 16 of 31 (2021-04-19); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:23.878461 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:23.878637 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:23.878726 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:24.350230 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-05-03 13:04:24.351338 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:24.351442 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 16, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:24.497022 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:24.498443 (Thread-1): 13:04:24 + Running for day 17 of 31 (2021-04-20) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:24.504168 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:24.504284 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:24.655115 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:24.655306 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:24.655394 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '16 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:25.569862 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 13:04:25.573845 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:25.573953 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:25.731986 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:04:25.736509 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:25.736619 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:25.879962 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 13:04:25.882281 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:25.882399 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:26.156721 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:04:26.158012 (Thread-1): 13:04:26 + Ran for day 17 of 31 (2021-04-20); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:26.158223 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:26.158398 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:26.158488 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:26.398544 (Thread-1): SQL status: SUCCESS 1 in 0.24 seconds
2021-05-03 13:04:26.400030 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:26.400144 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 17, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:26.553236 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:26.554675 (Thread-1): 13:04:26 + Running for day 18 of 31 (2021-04-21) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:26.560053 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:26.560161 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:26.717756 (Thread-1): SQL status: SUCCESS 1 in 0.16 seconds
2021-05-03 13:04:26.717941 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:26.718062 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '17 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:30.166773 (Thread-1): SQL status: SUCCESS 1 in 3.45 seconds
2021-05-03 13:04:30.170994 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:30.171105 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:30.315137 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 13:04:30.319503 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:30.319612 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:30.759192 (Thread-1): SQL status: SUCCESS 12 in 0.44 seconds
2021-05-03 13:04:30.761496 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:30.761604 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:31.105681 (Thread-1): SQL status: SUCCESS 0 in 0.34 seconds
2021-05-03 13:04:31.107004 (Thread-1): 13:04:31 + Ran for day 18 of 31 (2021-04-21); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:31.107207 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:31.107382 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:31.107471 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:31.354083 (Thread-1): SQL status: SUCCESS 1 in 0.25 seconds
2021-05-03 13:04:31.355190 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:31.355294 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 18, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:31.483577 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:04:31.485406 (Thread-1): 13:04:31 + Running for day 19 of 31 (2021-04-22) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:31.490835 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:31.490943 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:31.664622 (Thread-1): SQL status: SUCCESS 1 in 0.17 seconds
2021-05-03 13:04:31.664810 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:31.664897 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '18 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:33.370013 (Thread-1): SQL status: SUCCESS 1 in 1.70 seconds
2021-05-03 13:04:33.375473 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:33.375588 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:33.515169 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 13:04:33.519655 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:33.519768 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:33.646513 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:33.648780 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:33.648887 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:33.905660 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 13:04:33.907296 (Thread-1): 13:04:33 + Ran for day 19 of 31 (2021-04-22); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:33.907505 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:33.907680 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:33.907769 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:34.178825 (Thread-1): SQL status: SUCCESS 1 in 0.27 seconds
2021-05-03 13:04:34.179901 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:34.180012 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 19, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:34.676860 (Thread-1): SQL status: SUCCESS 1 in 0.50 seconds
2021-05-03 13:04:34.678319 (Thread-1): 13:04:34 + Running for day 20 of 31 (2021-04-23) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:34.683707 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:34.683827 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:34.831701 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:34.831892 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:34.831980 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '19 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:37.171313 (Thread-1): SQL status: SUCCESS 1 in 2.34 seconds
2021-05-03 13:04:37.175211 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:37.175328 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:37.378789 (Thread-1): SQL status: SUCCESS 12 in 0.20 seconds
2021-05-03 13:04:37.383235 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:37.383353 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:37.572439 (Thread-1): SQL status: SUCCESS 12 in 0.19 seconds
2021-05-03 13:04:37.574778 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:37.574889 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:38.984163 (Thread-1): SQL status: SUCCESS 0 in 1.41 seconds
2021-05-03 13:04:38.985466 (Thread-1): 13:04:38 + Ran for day 20 of 31 (2021-04-23); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:38.985670 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:38.985848 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:38.985937 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:39.536256 (Thread-1): SQL status: SUCCESS 1 in 0.55 seconds
2021-05-03 13:04:39.537355 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:39.537460 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 20, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:39.746337 (Thread-1): SQL status: SUCCESS 1 in 0.21 seconds
2021-05-03 13:04:39.748191 (Thread-1): 13:04:39 + Running for day 21 of 31 (2021-04-24) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:39.753601 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:39.753715 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:41.116380 (Thread-1): SQL status: SUCCESS 1 in 1.36 seconds
2021-05-03 13:04:41.116569 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:41.116659 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '20 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:45.085288 (Thread-1): SQL status: SUCCESS 1 in 3.97 seconds
2021-05-03 13:04:45.089282 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:45.089395 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:45.332159 (Thread-1): SQL status: SUCCESS 12 in 0.24 seconds
2021-05-03 13:04:45.336618 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:45.336731 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:45.465518 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:45.467807 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:45.467914 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:45.729274 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 13:04:45.732803 (Thread-1): 13:04:45 + Ran for day 21 of 31 (2021-04-24); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:45.733019 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:45.733193 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:45.733282 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:45.933143 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:04:45.934249 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:45.934354 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 21, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:46.058780 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:04:46.060152 (Thread-1): 13:04:46 + Running for day 22 of 31 (2021-04-25) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:46.065817 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:46.065925 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:46.206745 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:04:46.206930 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:46.207017 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '21 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:47.085212 (Thread-1): SQL status: SUCCESS 1 in 0.88 seconds
2021-05-03 13:04:47.089093 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:47.089207 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:47.239552 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:04:47.243960 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:47.244071 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:47.392500 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:04:47.394815 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:47.394925 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:49.754757 (Thread-1): SQL status: SUCCESS 0 in 2.36 seconds
2021-05-03 13:04:49.756037 (Thread-1): 13:04:49 + Ran for day 22 of 31 (2021-04-25); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:49.756243 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:49.756418 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:49.756508 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:50.048167 (Thread-1): SQL status: SUCCESS 1 in 0.29 seconds
2021-05-03 13:04:50.049289 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:50.049393 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 22, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:50.175196 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:04:50.177012 (Thread-1): 13:04:50 + Running for day 23 of 31 (2021-04-26) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:50.182447 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:50.182563 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:50.414847 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:04:50.415030 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:50.415116 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '22 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:51.304171 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2021-05-03 13:04:51.308188 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:51.308301 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:51.453821 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:04:51.458405 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:51.458520 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:51.595209 (Thread-1): SQL status: SUCCESS 12 in 0.14 seconds
2021-05-03 13:04:51.597467 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:51.597572 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:51.840342 (Thread-1): SQL status: SUCCESS 0 in 0.24 seconds
2021-05-03 13:04:51.841942 (Thread-1): 13:04:51 + Ran for day 23 of 31 (2021-04-26); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:51.842172 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:51.842346 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:51.842435 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:52.044573 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:04:52.045659 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:52.045768 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 23, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:52.174152 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:04:52.175578 (Thread-1): 13:04:52 + Running for day 24 of 31 (2021-04-27) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:52.180931 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:52.181039 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:52.331278 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:04:52.331466 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:52.331552 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '23 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:53.254346 (Thread-1): SQL status: SUCCESS 1 in 0.92 seconds
2021-05-03 13:04:53.258223 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:53.258335 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:53.415511 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:04:53.421556 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:53.421674 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:53.549006 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:53.551328 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:53.551437 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:53.804299 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 13:04:53.805586 (Thread-1): 13:04:53 + Ran for day 24 of 31 (2021-04-27); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:53.805788 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:53.805980 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:53.806074 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:54.143749 (Thread-1): SQL status: SUCCESS 1 in 0.34 seconds
2021-05-03 13:04:54.144861 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:54.144967 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 24, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:54.269851 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:04:54.271298 (Thread-1): 13:04:54 + Running for day 25 of 31 (2021-04-28) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:54.277058 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:54.277168 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:54.417955 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:04:54.418178 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:54.418264 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '24 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:04:57.502711 (Thread-1): SQL status: SUCCESS 1 in 3.08 seconds
2021-05-03 13:04:57.506686 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:57.506801 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:04:57.674741 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 13:04:57.679367 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:57.679485 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:04:57.812490 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:04:57.814802 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:57.814917 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:04:58.068545 (Thread-1): SQL status: SUCCESS 0 in 0.25 seconds
2021-05-03 13:04:58.069844 (Thread-1): 13:04:58 + Ran for day 25 of 31 (2021-04-28); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:58.070077 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:58.070259 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:58.070352 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:04:58.295042 (Thread-1): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 13:04:58.296525 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:58.296631 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 25, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:04:58.432695 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:04:58.434163 (Thread-1): 13:04:58 + Running for day 26 of 31 (2021-04-29) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:04:58.439614 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:58.439726 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:04:58.578603 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:04:58.578789 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:04:58.578875 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '25 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '25 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:05:00.689493 (Thread-1): SQL status: SUCCESS 1 in 2.11 seconds
2021-05-03 13:05:00.693789 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:00.693925 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:05:00.846637 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:05:00.851078 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:00.851195 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:05:00.980637 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:05:00.983154 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:00.983265 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:05:01.317069 (Thread-1): SQL status: SUCCESS 0 in 0.33 seconds
2021-05-03 13:05:01.318434 (Thread-1): 13:05:01 + Ran for day 26 of 31 (2021-04-29); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:01.318648 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:01.318832 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:01.318926 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:01.518743 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:05:01.519887 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:01.520002 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 26, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:05:01.663157 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:05:01.665042 (Thread-1): 13:05:01 + Running for day 27 of 31 (2021-04-30) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:01.670505 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:01.670620 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:05:01.811772 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:05:01.811957 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:01.812042 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '26 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '26 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:05:03.021762 (Thread-1): SQL status: SUCCESS 1 in 1.21 seconds
2021-05-03 13:05:03.027320 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:03.027464 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:05:03.182590 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:05:03.187085 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:03.187193 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:05:03.319863 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:05:03.410856 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:03.411022 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:05:03.671012 (Thread-1): SQL status: SUCCESS 0 in 0.26 seconds
2021-05-03 13:05:03.672308 (Thread-1): 13:05:03 + Ran for day 27 of 31 (2021-04-30); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:03.672515 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:03.672687 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:03.672777 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:04.998977 (Thread-1): SQL status: SUCCESS 1 in 1.33 seconds
2021-05-03 13:05:05.000082 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:05.000187 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 27, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:05:05.123981 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:05:05.125897 (Thread-1): 13:05:05 + Running for day 28 of 31 (2021-05-01) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:05.131301 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:05.131411 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:05:05.280590 (Thread-1): SQL status: SUCCESS 1 in 0.15 seconds
2021-05-03 13:05:05.280790 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:05.280877 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '27 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '27 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:05:06.271899 (Thread-1): SQL status: SUCCESS 1 in 0.99 seconds
2021-05-03 13:05:06.275931 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:06.276044 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:05:06.447079 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 13:05:06.451395 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:06.451508 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:05:06.581982 (Thread-1): SQL status: SUCCESS 12 in 0.13 seconds
2021-05-03 13:05:06.584252 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:06.584359 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:05:06.851533 (Thread-1): SQL status: SUCCESS 0 in 0.27 seconds
2021-05-03 13:05:06.853137 (Thread-1): 13:05:06 + Ran for day 28 of 31 (2021-05-01); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:06.853345 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:06.853519 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:06.853608 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:07.086696 (Thread-1): SQL status: SUCCESS 1 in 0.23 seconds
2021-05-03 13:05:07.087831 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:07.087939 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 28, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:05:07.228392 (Thread-1): SQL status: SUCCESS 1 in 0.14 seconds
2021-05-03 13:05:07.229840 (Thread-1): 13:05:07 + Running for day 29 of 31 (2021-05-02) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:07.235299 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:07.235412 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:05:07.425542 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:05:07.425734 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:07.425824 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '28 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '28 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:05:08.337491 (Thread-1): SQL status: SUCCESS 1 in 0.91 seconds
2021-05-03 13:05:08.341472 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:08.341587 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:05:08.502307 (Thread-1): SQL status: SUCCESS 12 in 0.16 seconds
2021-05-03 13:05:08.506711 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:08.506828 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:05:08.654180 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:05:08.656456 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:08.656564 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:05:08.955151 (Thread-1): SQL status: SUCCESS 0 in 0.30 seconds
2021-05-03 13:05:08.956443 (Thread-1): 13:05:08 + Ran for day 29 of 31 (2021-05-02); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:08.956647 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:08.956821 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:08.956910 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:09.158131 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:05:09.159241 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:09.159346 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 29, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:05:09.274463 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2021-05-03 13:05:09.278079 (Thread-1): 13:05:09 + Running for day 30 of 31 (2021-05-03) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:09.283385 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:09.283496 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:05:09.715971 (Thread-1): SQL status: SUCCESS 1 in 0.43 seconds
2021-05-03 13:05:09.716154 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:09.716240 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '29 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '29 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:05:10.721696 (Thread-1): SQL status: SUCCESS 1 in 1.01 seconds
2021-05-03 13:05:10.725699 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:10.725816 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:05:10.896286 (Thread-1): SQL status: SUCCESS 12 in 0.17 seconds
2021-05-03 13:05:10.900787 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:10.900897 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:05:11.023085 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 13:05:11.025375 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:11.025484 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:05:11.309152 (Thread-1): SQL status: SUCCESS 0 in 0.28 seconds
2021-05-03 13:05:11.310454 (Thread-1): 13:05:11 + Ran for day 30 of 31 (2021-05-03); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:11.310661 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:11.310833 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:11.310923 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:11.508690 (Thread-1): SQL status: SUCCESS 1 in 0.20 seconds
2021-05-03 13:05:11.509732 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:11.509838 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
SELECT DATE_TRUNC('day', DATEADD(day, 30, TO_DATE('2021-04-04 10:22:53.733000'))) AS period_of_load
2021-05-03 13:05:11.643624 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2021-05-03 13:05:11.645053 (Thread-1): 13:05:11 + Running for day 31 of 31 (2021-05-04) [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:11.650455 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:11.650565 (Thread-1): On model.Dbt_demo.sat_suppliers: BEGIN
2021-05-03 13:05:12.118978 (Thread-1): SQL status: SUCCESS 1 in 0.47 seconds
2021-05-03 13:05:12.119161 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:12.119250 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */


      create or replace temporary table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp  as
      (select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE" from (

-- Generated by dbtvault.

WITH source_data AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_STG.v_stg_suppliers AS a
    WHERE (TO_DATE(LOAD_DATE) >= DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '30 day') AND
             TO_DATE(LOAD_DATE) < DATE_TRUNC('day', TO_DATE('2021-04-04 10:22:53.733000') + INTERVAL '30 day' + INTERVAL '1 day'))
      AND (TO_DATE(LOAD_DATE) >= TO_DATE('2021-04-04 10:22:53.733000'))
    
),

update_records AS (
    SELECT a.SUPPLIER_PK, a.SUPPLIER_HASHDIFF, a.SUPPLIERID, a.COMPANYNAME, a.CONTACTNAME, a.CONTACTTITLE, a.ADDRESS, a.REGION, a.COUNTRY, a.POSTALCODE, a.LOAD_DATE, a.RECORD_SOURCE
    FROM DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers as a
    JOIN source_data as b
    ON a.SUPPLIER_PK = b.SUPPLIER_PK
),

latest_records AS (
    SELECT c.SUPPLIER_PK, c.SUPPLIER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.SUPPLIER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
    QUALIFY latest = 'Y'
),

records_to_insert AS (
    SELECT DISTINCT e.SUPPLIER_PK, e.SUPPLIER_HASHDIFF, e.SUPPLIERID, e.COMPANYNAME, e.CONTACTNAME, e.CONTACTTITLE, e.ADDRESS, e.REGION, e.COUNTRY, e.POSTALCODE, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.SUPPLIER_HASHDIFF = e.SUPPLIER_HASHDIFF
    WHERE latest_records.SUPPLIER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert)
      );
2021-05-03 13:05:12.993151 (Thread-1): SQL status: SUCCESS 1 in 0.87 seconds
2021-05-03 13:05:12.997086 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:12.997197 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
2021-05-03 13:05:13.148967 (Thread-1): SQL status: SUCCESS 12 in 0.15 seconds
2021-05-03 13:05:13.153409 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:13.153525 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */

    describe table DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers
2021-05-03 13:05:13.272261 (Thread-1): SQL status: SUCCESS 12 in 0.12 seconds
2021-05-03 13:05:13.274552 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:13.274670 (Thread-1): On model.Dbt_demo.sat_suppliers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "snowflake", "target_name": "dev", "node_id": "model.Dbt_demo.sat_suppliers"} */
insert into DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers ("SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE")
                (
                    select "SUPPLIER_PK", "SUPPLIER_HASHDIFF", "SUPPLIERID", "COMPANYNAME", "CONTACTNAME", "CONTACTTITLE", "ADDRESS", "REGION", "COUNTRY", "POSTALCODE", "LOAD_DATE", "RECORD_SOURCE"
                    from DATAVAULTDEMO_DB.SS_RAW_VLT.sat_suppliers__dbt_tmp
                );
2021-05-03 13:05:13.742528 (Thread-1): SQL status: SUCCESS 0 in 0.47 seconds
2021-05-03 13:05:13.743824 (Thread-1): 13:05:13 + Ran for day 31 of 31 (2021-05-04); 0 records inserted [model.Dbt_demo.sat_suppliers]
2021-05-03 13:05:13.744035 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:13.744212 (Thread-1): Using snowflake connection "model.Dbt_demo.sat_suppliers".
2021-05-03 13:05:13.744300 (Thread-1): On model.Dbt_demo.sat_suppliers: COMMIT
2021-05-03 13:05:13.935160 (Thread-1): SQL status: SUCCESS 1 in 0.19 seconds
2021-05-03 13:05:13.935599 (Thread-1): Writing runtime SQL for node "model.Dbt_demo.sat_suppliers"
2021-05-03 13:05:13.938691 (Thread-1): finished collecting timing info
2021-05-03 13:05:13.938969 (Thread-1): On model.Dbt_demo.sat_suppliers: Close
2021-05-03 13:05:14.189692 (Thread-1): Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '777e914f-929c-43b2-aef7-566fed065632', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2608a100>]}
2021-05-03 13:05:14.191169 (Thread-1): 13:05:14 | 23 of 23 OK created vault_insert_by_period model SS_RAW_VLT.sat_suppliers [INSERT 0 in 97.91s]
2021-05-03 13:05:14.191338 (Thread-1): Finished running node model.Dbt_demo.sat_suppliers
2021-05-03 13:05:14.192848 (MainThread): Acquiring new snowflake connection "master".
2021-05-03 13:05:14.193094 (MainThread): Using snowflake connection "master".
2021-05-03 13:05:14.193195 (MainThread): On master: BEGIN
2021-05-03 13:05:14.193299 (MainThread): Opening a new connection, currently in state closed
2021-05-03 13:05:15.089543 (MainThread): SQL status: SUCCESS 1 in 0.90 seconds
2021-05-03 13:05:15.089751 (MainThread): On master: COMMIT
2021-05-03 13:05:15.089913 (MainThread): Using snowflake connection "master".
2021-05-03 13:05:15.090025 (MainThread): On master: COMMIT
2021-05-03 13:05:15.310685 (MainThread): SQL status: SUCCESS 1 in 0.22 seconds
2021-05-03 13:05:15.310899 (MainThread): On master: Close
2021-05-03 13:05:15.666059 (MainThread): 13:05:15 | 
2021-05-03 13:05:15.666278 (MainThread): 13:05:15 | Finished running 10 view models, 8 incremental models, 5 vault_insert_by_period models in 646.56s.
2021-05-03 13:05:15.666409 (MainThread): Connection 'master' was properly closed.
2021-05-03 13:05:15.666496 (MainThread): Connection 'model.Dbt_demo.sat_suppliers' was properly closed.
2021-05-03 13:05:15.802603 (MainThread): 
2021-05-03 13:05:15.802813 (MainThread): Completed successfully
2021-05-03 13:05:15.802989 (MainThread): 
Done. PASS=23 WARN=0 ERROR=0 SKIP=0 TOTAL=23
2021-05-03 13:05:15.803239 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2634b5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a267b6190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3a2619ee80>]}
2021-05-03 13:05:15.803469 (MainThread): Flushing usage events
